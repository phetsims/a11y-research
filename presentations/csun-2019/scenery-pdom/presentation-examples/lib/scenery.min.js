function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _get=function t(e,i,n){null===e&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,i);if(void 0===s){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,n)}if("value"in s)return s.value;var a=s.get;if(void 0!==a)return a.call(n)},_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(){if(!window.hasOwnProperty("_"))throw new Error("Underscore/Lodash not found: _");if(!window.hasOwnProperty("$"))throw new Error("jQuery not found: $");!function(){"use strict";window.assertions=window.assertions||{},window.assertions.assertFunction=window.assertions.assertFunction||function(t,e){if(!t){if(window.navigator&&"Microsoft Internet Explorer"===window.navigator.appName)try{throw new Error}catch(t){e=e+", stack=\n"+t.stack}var i=e?"Assertion failed: "+e:"Assertion failed";throw console&&console.log&&console.log(i),new Error(i)}},window.assert=window.assert||null,window.assertSlow=window.assertSlow||null,window.assertions.enableAssert=function(){window.assert=window.assertions.assertFunction,window.console&&window.console.log&&window.console.log("enabling assert")},window.assertions.disableAssert=function(){window.assert=null,window.console&&window.console.log&&window.console.log("disabling assert")},window.assertions.enableAssertSlow=function(){window.assertSlow=window.assertions.assertFunction,window.console&&window.console.log&&window.console.log("enabling assertSlow")},window.assertions.disableAssertSlow=function(){window.assertSlow=null,window.console&&window.console.log&&window.console.log("disabling assertSlow")}}(),function(){"use strict";window.phetio=window.phetio||{};window.phetio.PhetioIDUtils={append:function(t,e){return t+"."+e},getComponentName:function(t){var e=t.lastIndexOf(".");return-1===e?t:t.substring(e+1,t.length)},getParentID:function(t){var e=t.lastIndexOf(".");return t.substring(0,e)},getDOMElementID:function(t){return"phetioID:"+t},getGeneralID:function(t,e){var i=phetio.PhetioIDUtils.append(t.CAMEL_CASE_SIMULATION_NAME,"general");return phetio.PhetioIDUtils.append(i,e)},SEPARATOR:"."}}(),function(t){if("object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof i&&i.amd)i([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).himalaya=t()}}(function(){return function t(i,n,s){function r(o,h){if(!n[o]){if(!i[o]){var l="function"==typeof e&&e;if(!h&&l)return l(o,!0);if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[o]={exports:{}};i[o][0].call(c.exports,function(t){var e=i[o][1][t];return r(e||t)},c,c.exports,t,i,n,s)}return n[o].exports}for(var a="function"==typeof e&&e,o=0;o<s.length;o++)r(s[o]);return r}({1:[function(t,e,i){"use strict";function n(t){return"number"==typeof t&&isNaN(t)}Object.defineProperty(i,"__esModule",{value:!0}),i.startsWith=function(t,e,i){return t.substr(i||0,e.length)===e},i.endsWith=function(t,e,i){var n=(i||t.length)-e.length,s=t.lastIndexOf(e,n);return-1!==s&&s===n},i.stringIncludes=function(t,e,i){return-1!==t.indexOf(e,i||0)},i.isRealNaN=n,i.arrayIncludes=function(t,e,i){var s=t.length;if(0===s)return!1;for(var r=0|i,a=n(e),o=r>=0?r:s+r;o<s;){var h=t[o++];if(h===e)return!0;if(a&&n(h))return!0}return!1}},{}],2:[function(t,e,i){"use strict";function n(t){return t.map(function(t){var e=s(t.type);if("Element"===e){return{type:e,tagName:t.tagName.toLowerCase(),attributes:l(t.attributes),children:n(t.children)}}return{type:e,content:t.content}})}function s(t){return t.charAt(0).toUpperCase()+t.slice(1)}function r(t){return t.split("-").reduce(function(t,e){return t+e.charAt(0).toUpperCase()+e.slice(1)})}function a(t){if("string"!=typeof t)return t;if(""===t)return t;var e=+t;return isNaN(e)?t:e}function o(t){var e=t.charAt(0),i=t.length-1;return'"'===e||"'"===e&&e===t.charAt(i)?t.slice(1,i):t}function h(t,e){var i=t.indexOf(e);return-1===i?[t]:[t.slice(0,i),t.slice(i+e.length)]}function l(t){return t.reduce(function(t,e){var i=h(e.trim(),"="),n=c(i,2),s=n[0],l=n[1];if(l=l?o(l):s,"class"===s)t.className=l.split(" ");else if("style"===s)t.style=u(l);else if((0,d.startsWith)(s,"data-")){t.dataset=t.dataset||{};var f=r(s.slice(5));t.dataset[f]=a(l)}else t[r(s)]=a(l);return t},{})}function u(t){return t.trim().split(";").map(function(t){return t.trim().split(":")}).reduce(function(t,e){var i=c(e,2),n=i[0],s=i[1];if(s){var o=r(n.trim()),h=a(s.trim());t[o]=h}return t},{})}Object.defineProperty(i,"__esModule",{value:!0});var c=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],n=!0,s=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done)&&(i.push(a.value),!e||i.length!==e);n=!0);}catch(t){s=!0,r=t}finally{try{!n&&o.return&&o.return()}finally{if(s)throw r}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();i.default=n,i.capitialize=s,i.camelCase=r,i.castValue=a,i.unquote=o,i.splitHead=h,i.formatAttributes=l,i.formatStyles=u;var d=t("../compat")},{"../compat":1}],3:[function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function s(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h,i=(0,r.default)(t,e),n=(0,a.default)(i,e);return(0,o.default)(n,e)}Object.defineProperty(i,"__esModule",{value:!0}),i.parseDefaults=void 0,i.parse=s;var r=n(t("./lexer")),a=n(t("./parser")),o=n(t("./formats/v0")),h=i.parseDefaults={voidTags:["!doctype","area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],closingTags:["html","head","body","p","dt","dd","li","option","thead","th","tbody","tr","td","tfoot","colgroup"],childlessTags:["style","script","template"],format:o.default};i.default={parse:s,parseDefaults:h}},{"./formats/v0":2,"./lexer":4,"./parser":5}],4:[function(t,e,i){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function s(t){for(var e=t.str,i=e.length;t.cursor<i;){if("<"!==e.charAt(t.cursor))r(t);else{if((0,c.startsWith)(e,"!--",t.cursor+1))a(t);else{var n=o(t);if(n){var s=n.toLowerCase(),h=t.options.childlessTags;(0,c.arrayIncludes)(h,s)&&u(n,t)}}}}}function r(t){var e=t.str,i=t.cursor,n=e.indexOf("<",i);if(-1===n){var s=e.slice(i);return t.cursor=e.length,void t.tokens.push({type:"text",content:s})}if(n!==i){var r=e.slice(i,n);t.cursor=n,t.tokens.push({type:"text",content:r})}}function a(t){t.cursor+=4;var e=t.str,i=t.cursor,n=e.indexOf("--\x3e",i);if(-1===n){var s=e.slice(i);return t.cursor=e.length,void t.tokens.push({type:"comment",content:s})}var r=e.slice(i,n);t.cursor=n+3,t.tokens.push({type:"comment",content:r})}function o(t){var e=t.str,i="/"===e.charAt(t.cursor+1);t.tokens.push({type:"tag-start",close:i}),t.cursor+=i?2:1;var n=h(t);l(t);var s="/"===e.charAt(t.cursor);return t.tokens.push({type:"tag-end",close:s}),t.cursor+=s?2:1,n}function h(t){for(var e=t.str,i=t.cursor,n=e.length,s=i;s<n;){var r=e.charAt(s);if(!(" "===r||"/"===r||">"===r))break;s++}for(var a=s+1;a<n;){var o=e.charAt(a);if(!!(" "===o||"/"===o||">"===o))break;a++}t.cursor=a;var h=e.slice(s,a);return t.tokens.push({type:"tag",content:h}),h}function l(t){for(var e=t.str,i=t.tokens,n=t.cursor,s=null,r=n,a=[],o=e.length;n<o;){var h=e.charAt(n);if(s){h===s&&(s=null),n++}else{if("/"===h||">"===h){n!==r&&a.push(e.slice(r,n));break}if(" "===h)n!==r&&a.push(e.slice(r,n)),r=n+1,n++;else{"'"===h||'"'===h?(s=h,n++):n++}}}t.cursor=n;for(var l=a.length,u="attribute",d=0;d<l;d++){var f=a[d];if(f&&f.length){if(-1===f.indexOf("=")){var m=a[d+1];if(m&&(0,c.startsWith)(m,"=")){if(m.length>1){var p=f+m;i.push({type:u,content:p}),d+=1;continue}var g=a[d+2];if(d+=1,g){var v=f+"="+g;i.push({type:u,content:v}),d+=1;continue}}}if((0,c.endsWith)(f,"=")){var y=a[d+1];if(y&&!(0,c.stringIncludes)(y,"=")){var E=f+y;i.push({type:u,content:E}),d+=1;continue}var b=f.slice(0,-1);i.push({type:u,content:b})}else i.push({type:u,content:f})}}}function u(t,e){for(var i=e.str,s=e.cursor,a=e.tokens,o=i.length,u=s;u<o;){var c=i.indexOf("</",u);if(-1===c){r(e);break}var d={str:i,cursor:c+2,tokens:[]},f=h(d);if(t.toLowerCase()===f.toLowerCase()){var m=i.slice(s,c);a.push({type:"text",content:m});var p={type:"tag-start",close:!0},g={type:"tag-end",close:!1};l(d),a.push.apply(a,[p].concat(n(d.tokens),[g])),e.cursor=d.cursor+1;break}u=d.cursor}}Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t,e){var i={str:t,options:e,cursor:0,tokens:[]};return s(i),i.tokens},i.lex=s,i.lexText=r,i.lexComment=a,i.lexTag=o,i.lexTagName=h,i.lexTagAttributes=l,i.lexSkipTag=u;var c=t("./compat")},{"./compat":1}],5:[function(t,e,i){"use strict";function n(t){for(var e=t.tokens,i=t.options,r=t.stack,a=r[r.length-1].children,o=e.length,h=t.cursor;h<o;){var l=e[h];if("tag-start"===l.type){var u=e[++h];h++;var c=u.content.toLowerCase();if(l.close){for(var d=void 0;(d=r.pop())&&c!==d.tagName;);for(;h<o;){if("tag-end"!==e[h].type)break;h++}break}if((0,s.arrayIncludes)(i.closingTags,c))for(var f=r.length-1;f>0;){if(c===r[f].tagName){a=(r=r.slice(0,f))[f-1].children;break}f-=1}for(var m=[],p=void 0;h<o&&"tag-end"!==(p=e[h]).type;)m.push(p.content),h++;h++;var g=[];a.push({type:"element",tagName:u.content,attributes:m,children:g});if(!(p.close||(0,s.arrayIncludes)(i.voidTags,c))){r.push({tagName:c,children:g});var v={tokens:e,options:i,cursor:h,stack:r};n(v),h=v.cursor}}else a.push(l),h++}t.cursor=h}Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t,e){var i={tagName:null,children:[]};return n({tokens:t,options:e,cursor:0,stack:[i]}),i.children},i.parse=n;var s=t("./compat")},{"./compat":1}]},{},[3])(3)});var t,e,i;!function(n){function s(t,e){return y.call(t,e)}function r(t,e){var i,n,s,r,a,o,h,l,u,c,d,f=e&&e.split("/"),m=g.map,p=m&&m["*"]||{};if(t&&"."===t.charAt(0))if(e){for(f=f.slice(0,f.length-1),a=(t=t.split("/")).length-1,g.nodeIdCompat&&b.test(t[a])&&(t[a]=t[a].replace(b,"")),t=f.concat(t),u=0;u<t.length;u+=1)if("."===(d=t[u]))t.splice(u,1),u-=1;else if(".."===d){if(1===u&&(".."===t[2]||".."===t[0]))break;u>0&&(t.splice(u-1,2),u-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((f||p)&&m){for(u=(i=t.split("/")).length;u>0;u-=1){if(n=i.slice(0,u).join("/"),f)for(c=f.length;c>0;c-=1)if((s=m[f.slice(0,c).join("/")])&&(s=s[n])){r=s,o=u;break}if(r)break;!h&&p&&p[n]&&(h=p[n],l=u)}!r&&h&&(r=h,o=l),r&&(i.splice(0,o,r),t=i.join("/"))}return t}function a(t,e){return function(){return c.apply(n,E.call(arguments,0).concat([t,e]))}}function o(t){return function(e){m[t]=e}}function h(t){if(s(p,t)){var e=p[t];delete p[t],v[t]=!0,u.apply(n,e)}if(!s(m,t)&&!s(v,t))throw new Error("No "+t);return m[t]}function l(t){var e,i=t?t.indexOf("!"):-1;return i>-1&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}var u,c,d,f,m={},p={},g={},v={},y=Object.prototype.hasOwnProperty,E=[].slice,b=/\.js$/;d=function(t,e){var i,n=l(t),s=n[0];return t=n[1],s&&(i=h(s=r(s,e))),s?t=i&&i.normalize?i.normalize(t,function(t){return function(e){return r(e,t)}}(e)):r(t,e):(s=(n=l(t=r(t,e)))[0],t=n[1],s&&(i=h(s))),{f:s?s+"!"+t:t,n:t,pr:s,p:i}},f={require:function(t){return a(t)},exports:function(t){var e=m[t];return void 0!==e?e:m[t]={}},module:function(t){return{id:t,uri:"",exports:m[t],config:function(t){return function(){return g&&g.config&&g.config[t]||{}}}(t)}}},u=function(t,e,i,r){var l,u,c,g,y,E,b=[],_=void 0===i?"undefined":_typeof(i);if(r=r||t,"undefined"===_||"function"===_){for(e=!e.length&&i.length?["require","exports","module"]:e,y=0;y<e.length;y+=1)if(g=d(e[y],r),"require"===(u=g.f))b[y]=f.require(t);else if("exports"===u)b[y]=f.exports(t),E=!0;else if("module"===u)l=b[y]=f.module(t);else if(s(m,u)||s(p,u)||s(v,u))b[y]=h(u);else{if(!g.p)throw new Error(t+" missing "+u);g.p.load(g.n,a(r,!0),o(u),{}),b[y]=m[u]}c=i?i.apply(m[t],b):void 0,t&&(l&&l.exports!==n&&l.exports!==m[t]?m[t]=l.exports:c===n&&E||(m[t]=c))}else t&&(m[t]=i)},t=e=c=function(t,e,i,s,r){if("string"==typeof t)return f[t]?f[t](e):h(d(t,e).f);if(!t.splice){if((g=t).deps&&c(g.deps,g.callback),!e)return;e.splice?(t=e,e=i,i=null):t=n}return e=e||function(){},"function"==typeof i&&(i=s,s=r),s?u(n,t,e,i):setTimeout(function(){u(n,t,e,i)},4),c},c.config=function(t){return c(t)},t._defined=m,(i=function(t,e,i){e.splice||(i=e,e=[]),s(m,t)||s(p,t)||(p[t]=[t,e,i])}).amd={jQuery:!0}}(),i("almond",function(){}),i("PHET_CORE/Namespace",["require"],function(t){"use strict";function e(t){this.name=t,window.phet&&(window.phet[t]=this)}return e.prototype={constructor:e,register:function(t,e){if(t.indexOf(".")<0)this[t]=e;else{for(var i=t.split("."),n=this,s=0;s<i.length-1;s++)n=n[i[s]];var r=i[i.length-1];n[r]=e}return e}},e}),i("AXON/axon",["require","PHET_CORE/Namespace"],function(t){"use strict";return new(t("PHET_CORE/Namespace"))("axon")}),i("AXON/ValidatorDef",["require","AXON/axon"],function(t){"use strict";var e=t("AXON/axon"),i=["string","number","boolean","function"],n={assertions:!1},s=["valueType","validValues","isValidValue"],r={isValidValidator:function(t,e){if(e=e||n,!(t.hasOwnProperty("isValidValue")||t.hasOwnProperty("valueType")||t.hasOwnProperty("validValues")))return!1;var s=t.valueType;if("function"!=typeof s&&"string"!=typeof s&&null!==s&&void 0!==s)return!1;if("string"==typeof s&&!_.includes(i,s))return!1;if(t.hasOwnProperty("isValidValue")&&"function"!=typeof t.isValidValue&&null!==t.isValidValue&&void 0!==t.isValidValue)return!1;if(void 0!==t.validValues&&null!==t.validValues){if(!Array.isArray(t.validValues))return!1;var a=_.omit(t,"validValues");if(r.containsValidatorKey(a))for(var o=0;o<t.validValues.length;o++)if(!r.isValueValid(t.validValues[o],a))return!1}return!0},validateValidator:function(t){},containsValidatorKey:function(t){for(var e=0;e<s.length;e++)if(t.hasOwnProperty(s[e]))return!0;return!1},isValueValid:function(t,i,s){if(s=s||n,!1!==i.validateOptionsOnValidateValue&&!e.ValidatorDef.isValidValidator(i,s))return!1;if(i.hasOwnProperty("valueType")){var r=i.valueType;if("string"==typeof r&&(void 0===t?"undefined":_typeof(t))!==r)return!1;if(r===Array&&!Array.isArray(t))return!1;if("function"==typeof r&&!(t instanceof r))return!1}return(!i.hasOwnProperty("validValues")||-1!==i.validValues.indexOf(t))&&!(i.hasOwnProperty("isValidValue")&&!i.isValidValue(t))}};return r.VALIDATOR_KEYS=s,e.register("ValidatorDef",r)}),i("PHET_CORE/phetCore",["require","PHET_CORE/Namespace"],function(t){"use strict";var e=t("PHET_CORE/Namespace"),i=new e("phetCore");return i.register("Namespace",e),i}),i("PHET_CORE/extend",["require","PHET_CORE/phetCore"],function(t){"use strict";function e(t){return _.each(Array.prototype.slice.call(arguments,1),function(e){if(e)for(var i in e)Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}),t}return t("PHET_CORE/phetCore").register("extend",e),e}),i("PHET_CORE/inherit",["require","PHET_CORE/extend","PHET_CORE/phetCore"],function(t){"use strict";function e(t,e,n,s){function r(){}return r.prototype=t.prototype,e.prototype=i(new r,{constructor:e},n),i(e,s),e}var i=t("PHET_CORE/extend");return t("PHET_CORE/phetCore").register("inherit",e),e}),i("TANDEM/tandemNamespace",["require","PHET_CORE/Namespace"],function(t){"use strict";return new(t("PHET_CORE/Namespace"))("tandem")}),i("TANDEM/phetioInherit",["require","AXON/ValidatorDef","PHET_CORE/inherit","TANDEM/tandemNamespace"],function(t){"use strict";t("AXON/ValidatorDef");var e=t("PHET_CORE/inherit"),i=function(t,i,n,s,r){e(t,n,s,r),r.parameterTypes&&(i=i+".<"+r.parameterTypes.map(function(t){return t.typeName}).join(", ")+">"),n.methodOrder=r.methodOrder||[],n.methodOrder.forEach(function(t){}),n.typeName=i,n.methods=s,n.supertype=t,n.getMethodDeclaration=function(e){return this.methods[e]?this.methods[e]:"ObjectIO"===i?null:t.getMethodDeclaration(e)};var a=t.allEvents||[],o=n.events||[];n.allEvents=a.concat(o),n.allMethods=_.extend({},t.allMethods,s);for(var h in t)t.hasOwnProperty(h)&&(n.hasOwnProperty(h)||"events"===h||(n[h]=t[h]));return n};return t("TANDEM/tandemNamespace").register("phetioInherit",i),i}),i("AXON/validate",["require","AXON/axon","AXON/ValidatorDef"],function(t){"use strict";var e=t("AXON/axon");t("AXON/ValidatorDef");return e.register("validate",function(t,e){return t})}),i("TANDEM/types/ObjectIO",["require","TANDEM/phetioInherit","TANDEM/tandemNamespace","AXON/validate"],function(t){"use strict";function e(t,e){this.instance=t,this.phetioID=e,s(t,this.constructor.validator)}var i=t("TANDEM/phetioInherit"),n=t("TANDEM/tandemNamespace"),s=t("AXON/validate");return i(window.Object,"ObjectIO",e,{},{documentation:"The root of the wrapper object hierarchy.",validator:{isValidValue:function(t){return null!==t&&"object"===(void 0===t?"undefined":_typeof(t))}},toStateObject:function(t){return t},fromStateObject:function(t){return t}}),n.register("ObjectIO",e),e}),i("TANDEM/types/BooleanIO",["require","TANDEM/types/ObjectIO","TANDEM/phetioInherit","TANDEM/tandemNamespace"],function(t){"use strict";function e(){}var i=t("TANDEM/types/ObjectIO"),n=t("TANDEM/phetioInherit"),s=t("TANDEM/tandemNamespace");return n(i,"BooleanIO",e,{},{documentation:"Wrapper for the built-in JS boolean type (true/false)",validator:{valueType:"boolean"},toStateObject:function(t){return t},fromStateObject:function(t){return t}}),s.register("BooleanIO",e),e}),i("TANDEM/types/FunctionIO",["require","TANDEM/types/ObjectIO","TANDEM/phetioInherit","TANDEM/tandemNamespace"],function(t){"use strict";function e(t,e){for(var s=0;s<e.length;s++)e[s];var r=e.map(function(t){return t.typeName}).join(", ");return""===r&&(r="VoidIO"),n(i,"FunctionIO",function(t,e){i.call(t,e)},{},{documentation:"Wrapper for the built-in JS function type.<br><strong>Arguments:</strong> "+r+"<br><strong>Return Type:</strong> "+t.typeName,validator:{valueType:"function"},returnType:t,parameterTypes:e,wrapForPhetioCommandProcessor:!0})}var i=t("TANDEM/types/ObjectIO"),n=t("TANDEM/phetioInherit");return t("TANDEM/tandemNamespace").register("FunctionIO",e),e}),i("TANDEM/types/VoidIO",["require","TANDEM/types/ObjectIO","TANDEM/phetioInherit","TANDEM/tandemNamespace"],function(t){"use strict";function e(){}var i=t("TANDEM/types/ObjectIO"),n=t("TANDEM/phetioInherit"),s=t("TANDEM/tandemNamespace");return n(i,"VoidIO",e,{},{documentation:"Type for which there is no instance, usually to mark functions without a return value",validator:{isValidValue:function(){return!0}},toStateObject:function(){}}),s.register("VoidIO",e),e}),i("AXON/EmitterIO",["require","AXON/ValidatorDef","AXON/axon","TANDEM/types/FunctionIO","TANDEM/types/ObjectIO","TANDEM/phetioInherit","TANDEM/types/VoidIO"],function(t){"use strict";function e(t){var e=t.map(function(t){for(var e=Object.keys(t),i=0;i<e.length;i++)e[i];return t.type}),i=t.map(function(t){return t.validator||t.type.validator});return r(s,"EmitterIO",function(t,e){s.call(this,t,e)},{addListener:{returnType:a,parameterTypes:[n(a,e)],implementation:function(t){this.instance.addListener(t)},documentation:"Adds a listener which will be called when the emitter emits."},emit:{returnType:a,parameterTypes:e,implementation:function(){this.instance.emit.apply(this.instance,arguments)},documentation:"Emits a single event to all listeners.",invocableForReadOnlyInstances:!1}},{documentation:"Emits when an event occurs. "+(0===t.length?"No arguments.":"The arguments are:<br><ol>"+t.map(function(t){var e=t.documentation?". "+t.documentation:"";return"<li>"+t.name+": "+t.type.typeName+e+"</li>"}).join("\n")+"</ol>"),events:["emitted"],parameterTypes:e,elements:t,validators:i,validator:{isValidValue:function(t){return t instanceof phet.axon.Emitter}}})}t("AXON/ValidatorDef");var i=t("AXON/axon"),n=t("TANDEM/types/FunctionIO"),s=t("TANDEM/types/ObjectIO"),r=t("TANDEM/phetioInherit"),a=t("TANDEM/types/VoidIO");return i.register("EmitterIO",e),e}),i("PHET_CORE/Enumeration",["require","PHET_CORE/phetCore"],function(t){"use strict";var e=t("PHET_CORE/phetCore"),i=function(){function t(e,i){var n=this;_classCallCheck(this,t),this.VALUES=[],this.KEYS=[],e.forEach(function(t){n[t]={name:t,toString:function(){return t}},n.VALUES.push(n[t]),n.KEYS.push(t)}),i&&i(this)}return _createClass(t,[{key:"includes",value:function(t){return this.VALUES.includes(t)}}]),t}();return e.register("Enumeration",i)}),i("TANDEM/types/ArrayIO",["require","AXON/ValidatorDef","TANDEM/types/ObjectIO","TANDEM/phetioInherit","TANDEM/tandemNamespace"],function(t){"use strict";function e(t){return s(n,"ArrayIO",function(t,e){n.call(this,t,e)},{},{parameterTypes:[t],documentation:"A wrapper for the built-in JS array type, with the element type specified.",elementType:t,validator:{valueType:Array,isValidValue:function(e){return _.every(e,function(e){return i.isValueValid(e,{valueType:t})})}},toStateObject:function(e){for(var i=[],n=0;n<e.length;n++)i.push(t.toStateObject(e[n]));return i},fromStateObject:function(e){for(var i=[],n=0;n<e.length;n++)i.push(t.fromStateObject(e[n]));return i},setValue:function(t,e){t.length=0,t.push.apply(t,e)}})}var i=t("AXON/ValidatorDef"),n=t("TANDEM/types/ObjectIO"),s=t("TANDEM/phetioInherit");return t("TANDEM/tandemNamespace").register("ArrayIO",e),e}),i("TANDEM/types/StringIO",["require","TANDEM/types/ObjectIO","TANDEM/phetioInherit","TANDEM/tandemNamespace"],function(t){"use strict";function e(){}var i=t("TANDEM/types/ObjectIO"),n=t("TANDEM/phetioInherit"),s=t("TANDEM/tandemNamespace");return n(i,"StringIO",e,{},{documentation:"Wrapper for the built-in JS string type",validator:{valueType:"string"},toStateObject:function(t){return t},fromStateObject:function(t){return t}}),s.register("StringIO",e),e}),i("PHET_CORE/EnumerationIO",["require","PHET_CORE/Enumeration","PHET_CORE/phetCore","TANDEM/types/ObjectIO","TANDEM/phetioInherit","TANDEM/types/ArrayIO","TANDEM/types/StringIO"],function(t){"use strict";function e(t){return s(n,"EnumerationIO",function(t,e){},{getValues:{returnType:r(a),parameterTypes:[],implementation:function(){return t.values.map(function(t){return t.name})},documentation:"Gets the possible values of the enumeration."}},{validator:n.validator,documentation:"Enumeration pattern that provides a fixed set of possible values",parameterTypes:[],events:[],toStateObject:function(t){return t.name},fromStateObject:function(e){return t[e]}})}t("PHET_CORE/Enumeration");var i=t("PHET_CORE/phetCore"),n=t("TANDEM/types/ObjectIO"),s=t("TANDEM/phetioInherit"),r=t("TANDEM/types/ArrayIO"),a=t("TANDEM/types/StringIO");return i.register("EnumerationIO",e),e}),i("TANDEM/LinkedElementIO",["require","TANDEM/tandemNamespace","TANDEM/types/ObjectIO","TANDEM/phetioInherit"],function(t){"use strict";function e(t,e){n.call(this,t,e)}var i=t("TANDEM/tandemNamespace"),n=t("TANDEM/types/ObjectIO");return t("TANDEM/phetioInherit")(n,"LinkedElementIO",e,{},{documentation:"A LinkedElement",validator:{isValidValue:function(){return!0}},toStateObject:function(t){return{elementID:t&&t.element?t.element.tandem.phetioID:"null"}},fromStateObject:function(t){return{}}}),i.register("LinkedElementIO",e),e}),i("PHET_CORE/toCamelCase",["require","PHET_CORE/phetCore"],function(t){"use strict";function e(t){return t.toLowerCase().replace(/-(.)/g,function(t,e){return e.toUpperCase()})}return t("PHET_CORE/phetCore").register("toCamelCase",e),e}),i("text",["module"],function(t){"use strict";var i,n,s,r,a,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],h=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,u="undefined"!=typeof location&&location.href,c=u&&location.protocol&&location.protocol.replace(/\:/,""),d=u&&location.hostname,f=u&&(location.port||void 0),m={},p=t.config&&t.config()||{};return i={version:"2.0.12",strip:function(t){if(t){var e=(t=t.replace(h,"")).match(l);e&&(t=e[1])}else t="";return t},jsEscape:function(t){return t.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:p.createXhr||function(){var t,e,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(e=0;e<3;e+=1){i=o[e];try{t=new ActiveXObject(i)}catch(t){}if(t){o=[i];break}}return t},parseName:function(t){var e,i,n,s=!1,r=t.indexOf("."),a=0===t.indexOf("./")||0===t.indexOf("../");return-1!==r&&(!a||r>1)?(e=t.substring(0,r),i=t.substring(r+1,t.length)):e=t,n=i||e,-1!==(r=n.indexOf("!"))&&(s="strip"===n.substring(r+1),n=n.substring(0,r),i?i=n:e=n),{moduleName:e,ext:i,strip:s}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(t,e,n,s){var r,a,o,h=i.xdRegExp.exec(t);return!h||(r=h[2],a=h[3],a=a.split(":"),o=a[1],a=a[0],!(r&&r!==e||a&&a.toLowerCase()!==n.toLowerCase()||(o||a)&&o!==s))},finishLoad:function(t,e,n,s){n=e?i.strip(n):n,p.isBuild&&(m[t]=n),s(n)},load:function(t,e,n,s){if(s&&s.isBuild&&!s.inlineText)n();else{p.isBuild=s&&s.isBuild;var r=i.parseName(t),a=r.moduleName+(r.ext?"."+r.ext:""),o=e.toUrl(a),h=p.useXhr||i.useXhr;0!==o.indexOf("empty:")?!u||h(o,c,d,f)?i.get(o,function(e){i.finishLoad(t,r.strip,e,n)},function(t){n.error&&n.error(t)}):e([a],function(t){i.finishLoad(r.moduleName+"."+r.ext,r.strip,t,n)}):n()}},write:function(t,e,n,s){if(m.hasOwnProperty(e)){var r=i.jsEscape(m[e]);n.asModule(t+"!"+e,"define(function () { return '"+r+"';});\n")}},writeFile:function(t,e,n,s,r){var a=i.parseName(e),o=a.ext?"."+a.ext:"",h=a.moduleName+o,l=n.toUrl(a.moduleName+o)+".js";i.load(h,n,function(e){var n=function(t){return s(l,t)};n.asModule=function(t,e){return s.asModule(t,l,e)},i.write(t,h,n,r)},r)}},"node"===p.env||!p.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(n=e.nodeRequire("fs"),i.get=function(t,e,i){try{var s=n.readFileSync(t,"utf8");0===s.indexOf("\ufeff")&&(s=s.substring(1)),e(s)}catch(t){i&&i(t)}}):"xhr"===p.env||!p.env&&i.createXhr()?i.get=function(t,e,n,s){var r,a=i.createXhr();if(a.open("GET",t,!0),s)for(r in s)s.hasOwnProperty(r)&&a.setRequestHeader(r.toLowerCase(),s[r]);p.onXhr&&p.onXhr(a,t),a.onreadystatechange=function(i){var s,r;4===a.readyState&&((s=a.status||0)>399&&s<600?((r=new Error(t+" HTTP status: "+s)).xhr=a,n&&n(r)):e(a.responseText),p.onXhrComplete&&p.onXhrComplete(a,t))},a.send(null)}:"rhino"===p.env||!p.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?i.get=function(t,e){var i,n,s=new java.io.File(t),r=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),"utf-8")),o="";try{for(i=new java.lang.StringBuffer,(n=a.readLine())&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&i.append(n);null!==(n=a.readLine());)i.append(r),i.append(n);o=String(i.toString())}finally{a.close()}e(o)}:("xpconnect"===p.env||!p.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(s=Components.classes,r=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),a="@mozilla.org/windows-registry-key;1"in s,i.get=function(t,e){var i,n,o,h={};a&&(t=t.replace(/\//g,"\\")),o=new FileUtils.File(t);try{(i=s["@mozilla.org/network/file-input-stream;1"].createInstance(r.nsIFileInputStream)).init(o,1,0,!1),(n=s["@mozilla.org/intl/converter-input-stream;1"].createInstance(r.nsIConverterInputStream)).init(i,"utf-8",i.available(),r.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),n.readString(i.available(),h),n.close(),i.close(),e(h.value)}catch(t){throw new Error((o&&o.path||"")+": "+t)}}),i}),i("text!REPOSITORY/package.json",[],function(){return'{\r\n  "name": "scenery",\r\n  "version": "0.0.0",\r\n  "license": "MIT",\r\n  "repository": {\r\n    "type": "git",\r\n    "url": "https://github.com/phetsims/scenery.git"\r\n  },\r\n  "devDependencies": {\r\n    "grunt": "~1.0.0"\r\n  },\r\n  "phet": {\r\n    "generatedUnitTests": true,\r\n    "requirejsNamespace": "SCENERY",\r\n    "buildStandalone": true,\r\n    "isJSOnly": true,\r\n    "requiresLodash": true,\r\n    "requiresJQuery": true,\r\n    "assignGlobals": {\r\n      "scenery": "main",\r\n      "kite": "KITE/main",\r\n      "dot": "DOT/main",\r\n      "axon": "AXON/main",\r\n      "phetCore": "PHET_CORE/main"\r\n    },\r\n    "finalizeJS": "scenery.Util.polyfillRequestAnimationFrame();"\r\n  },\r\n  "eslintConfig": {\r\n    "extends": "../chipper/eslint/sim_eslintrc.js"\r\n  }\r\n}'}),i("TANDEM/Tandem",["require","PHET_CORE/inherit","TANDEM/tandemNamespace","PHET_CORE/toCamelCase","text!REPOSITORY/package.json"],function(t){"use strict";function e(t,e){e=_.extend({supplied:!0,required:!0},e),this.phetioID=void 0!==t?t:"",this.required=e.required,this.supplied=e.supplied}function i(t){e.call(this,t),this.groupElementIndex=0}var n=t("PHET_CORE/inherit"),s=t("TANDEM/tandemNamespace"),r=t("PHET_CORE/toCamelCase"),a=t("text!REPOSITORY/package.json"),o=JSON.parse(a),h=!(!window.phet||!window.phet.phetio),l={required:[],optional:[],uninstrumented:[]},u=[],c=!1,d=[];return s.register("Tandem",e),n(Object,e,{addPhetioObject:function(t){if(h){if(e.validationEnabled(),phet.phetio.queryParameters.phetioPrintMissingTandems&&this.required&&!this.supplied&&l.required.push({phetioID:this.phetioID,stack:(new Error).stack}),!this.required&&!this.supplied){if(phet.phetio.queryParameters.phetioPrintMissingTandems){var i=(new Error).stack;-1===i.indexOf("PhetFont")&&l.optional.push({phetioID:this.phetioID,stack:i})}return}if(c)for(var n=0;n<u.length;n++)u[n].addPhetioObject(t);else d.push(t)}},removeInstance:function(t){if((this.required||this.supplied)&&h)for(var e=0;e<u.length;e++)u[e].removePhetioObject(t)},createTandem:function(t,i){var n=this.phetioID.length>0?phetio.PhetioIDUtils.append(this.phetioID,t):t;return i=_.extend({supplied:this.supplied,required:this.required},i),new e(n,i)},createGroupTandem:function(t){return new i(phetio.PhetioIDUtils.append(this.phetioID,t))},get tail(){return phetio.PhetioIDUtils.getComponentName(this.phetioID)},get parentTandem(){return new e(phetio.PhetioIDUtils.getParentID(this.phetioID),{required:this.required,supplied:this.supplied})}},{addPhetioObjectListener:function(t){u.push(t)},launch:function(){for(c=!0;d.length>0;){d.shift().register()}},disallowTandem:function(t){e.validationEnabled()},indicateUninstrumentedCode:function(){h&&(this.validationEnabled(),phet.phetio.queryParameters.phetioPrintMissingTandems&&l.uninstrumented.push({stack:(new Error).stack}))},validationEnabled:function(){return h&&phet.phetio.queryParameters.phetioValidateTandems&&!phet.phetio.queryParameters.phetioPrintMissingTandems}}),e.rootTandem=new e(r(o.name)),e.generalTandem=e.rootTandem.createTandem("general"),e.optional=e.rootTandem.createTandem("optionalTandem",{required:!1,supplied:!1}),e.required=e.rootTandem.createTandem("requiredTandem",{required:h&&(phet.phetio.queryParameters.phetioValidateTandems||phet.phetio.queryParameters.phetioPrintMissingTandems),supplied:!1}),e.missingTandems=l,s.register("Tandem.GroupTandem",i),n(e,i,{createNextTandem:function(){return new e(this.phetioID+"_"+this.groupElementIndex++)}}),e}),i("ifphetio",["require"],function(t){"use strict";var e={};return{load:function(i,n,s,r){if(r.isBuild){var a=n.toUrl(i);!1===/\.js$/.test(a)&&(a+=".js"),global.phet&&global.phet.chipper&&"phet-io"===global.phet.chipper.brand?(e[i]={content:global.phet.chipper.grunt.file.read(a),attach:t.attach},n([i],s)):s()}else{"phet-io"===(window.phet&&window.phet.chipper&&window.phet.chipper.brand)?n([i],s):s(function(){})}},write:function(t,i,n){var s=null;global.phet&&global.phet.chipper&&"phet-io"===global.phet.chipper.brand?(s='define("'+i+'", function(){'+e[i].content+"});",n.asModule(i,s,e[i].content)):n(s='define("'+i+'", function(){return function(){ return function(){}; };});')}}}),i("PHET_IO/dataStream",function(){return function(){return function(){}}}),i("TANDEM/PhetioObject",["require","PHET_CORE/Enumeration","PHET_CORE/EnumerationIO","PHET_CORE/inherit","TANDEM/LinkedElementIO","TANDEM/types/ObjectIO","TANDEM/Tandem","TANDEM/tandemNamespace","ifphetio!PHET_IO/dataStream"],function(t){"use strict";function e(t){this.tandem=null,this.phetioType=null,this.phetioState=null,this.phetioReadOnly=null,this.phetioDocumentation=null,this.phetioWrapper=null,this.phetioObjectInitialized=!1,this.phetioMessageStack=[],this.isDisposed=!1,this.phetioEventType=null,this.phetioHighFrequency=null,this.phetioPlayback=null,this.phetioStudioControl=null,this.phetioFeatured=!1,this.phetioEventMetadata=null,this.phetioComponentOptions=null,this.linkedElements=[],t&&this.initializePhetioObject({},t)}var i=t("PHET_CORE/Enumeration"),n=t("PHET_CORE/EnumerationIO"),s=t("PHET_CORE/inherit"),r=t("TANDEM/LinkedElementIO"),a=t("TANDEM/types/ObjectIO"),o=t("TANDEM/Tandem"),h=t("TANDEM/tandemNamespace"),l=t("ifphetio!PHET_IO/dataStream"),u=!(!window.phet||!window.phet.phetio),c=new i(["USER","MODEL","WRAPPER"]),d={},f={tandem:o.optional,phetioType:a,phetioDocumentation:null,phetioState:!0,phetioReadOnly:!1,phetioEventType:c.MODEL,phetioHighFrequency:!1,phetioPlayback:!1,phetioStudioControl:!0,phetioComponentOptions:null,phetioFeatured:!1,phetioEventMetadata:null},m=_.keys(f);h.register("PhetioObject",e),s(Object,e,{initializePhetioObject:function(t,e){if(0!==_.intersection(_.keys(e),m).length){e=_.extend({},f,t,e),this.tandem=e.tandem,this.phetioType=e.phetioType,this.phetioState=e.phetioState,this.phetioReadOnly=e.phetioReadOnly,this.phetioEventType=e.phetioEventType,this.phetioDocumentation=e.phetioDocumentation,this.phetioHighFrequency=e.phetioHighFrequency,this.phetioPlayback=e.phetioPlayback,this.phetioStudioControl=e.phetioStudioControl,this.phetioComponentOptions=e.phetioComponentOptions||d,this.phetioFeatured=e.phetioFeatured,this.phetioEventMetadata=e.phetioEventMetadata,this.phetioPlayback&&(this.phetioEventMetadata=this.phetioEventMetadata||{},this.phetioEventMetadata.playback=!0),u&&this.tandem.supplied&&(this.phetioWrapper=new this.phetioType(this,this.tandem.phetioID)),this.register(),this.phetioObjectInitialized=!0}},register:function(){u&&this.tandem.supplied,this.tandem.addPhetioObject(this)},phetioStartEvent:function(t,e){window.phet&&window.phet.phetio&&!window.phet.phetio.queryParameters.phetioEmitHighFrequencyEvents&&this.phetioHighFrequency?this.phetioMessageStack.push(-1):this.isPhetioInstrumented()&&("function"==typeof e&&(e=e()),this.phetioMessageStack.push(l.start(this.phetioEventType,this,t,e,this.phetioEventMetadata)))},phetioEndEvent:function(){var t=this.phetioMessageStack.pop();-1!==t&&this.isPhetioInstrumented()&&l.end(t)},isPhetioInstrumented:function(){return this.tandem&&this.tandem.supplied&&u},getMetadata:function(){return{phetioTypeName:this.phetioType.typeName,phetioDocumentation:this.phetioDocumentation,phetioState:this.phetioState,phetioReadOnly:this.phetioReadOnly,phetioEventType:n(c).toStateObject(this.phetioEventType).toLowerCase(),phetioHighFrequency:this.phetioHighFrequency,phetioPlayback:this.phetioPlayback,phetioStudioControl:this.phetioStudioControl,phetioFeatured:this.phetioFeatured}},addLinkedElement:function(t,e){this.linkedElements.push(new p(t,e))},dispose:function(){this.phetioObjectInitialized&&(this.tandem.removeInstance(this),this.phetioWrapper&&this.phetioWrapper.dispose&&this.phetioWrapper.dispose()),this.linkedElements.forEach(function(t){t.dispose()}),this.linkedElements.length=0,this.isDisposed=!0}},{DEFAULT_OPTIONS:f,EventType:c});var p=function(t){function i(t,e){_classCallCheck(this,i);var n=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,_.extend({phetioType:r,phetioFeatured:t.phetioFeatured,phetioReadOnly:!0},e)));return n.element=t,n}return _inherits(i,e),i}();return h.register("PhetioObject.LinkedElement",p),e}),i("AXON/Emitter",["require","AXON/axon","AXON/EmitterIO","TANDEM/PhetioObject","TANDEM/Tandem","AXON/ValidatorDef","AXON/validate"],function(t){"use strict";var e=t("AXON/axon"),i=t("AXON/EmitterIO"),n=t("TANDEM/PhetioObject"),s=t("TANDEM/Tandem"),r=(t("AXON/ValidatorDef"),t("AXON/validate")),a=i([]),o=[],h=function(t){function e(t){_classCallCheck(this,e);var i=t&&t.hasOwnProperty("phetioType");t&&t.hasOwnProperty("validators");(t=_.extend({validators:o,validationEnabled:!0,first:null,last:null,tandem:s.optional,phetioState:!1,phetioType:a},t)).phetioPlayback&&(t.phetioEventMetadata=t.phetioEventMetadata||{},t.phetioEventMetadata.dataKeys=t.phetioType.elements.map(function(t){return t.name})),i&&(t.validators=t.phetioType.validators);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r(t.validators,{valueType:Array}),n.validators=t.validators,n.validationEnabled=t.validationEnabled,n.listeners=[],n.activeListenersStack=[],n.first=t.first,n.first&&n.listeners.push(n.first),n.last=t.last,n.last&&n.listeners.push(n.last),n}return _inherits(e,n),_createClass(e,[{key:"dispose",value:function(){this.first=null,this.last=null,this.listeners.length=0,_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"dispose",this).call(this)}},{key:"addListener",value:function(t){this.defendListeners();var e=this.last?this.listeners.length-1:this.listeners.length;this.listeners.splice(e,0,t)}},{key:"removeListener",value:function(t){var e=this.listeners.indexOf(t);this.defendListeners(),this.listeners.splice(e,1),this.last===t&&(this.last=null),this.first===t&&(this.first=null)}},{key:"removeAllListeners",value:function(){for(;this.listeners.length>0;)this.removeListener(this.listeners[0])}},{key:"defendListeners",value:function(){for(var t=this.activeListenersStack.length-1;t>=0&&!this.activeListenersStack[t].defended;t--){var e=this.listeners.slice();e.defended=!0,this.activeListenersStack[t]=e}}},{key:"getPhetioData",value:function(){var t=null;if(this.phetioType.elements.length>0){t={};for(var e=0;e<this.phetioType.elements.length;e++){var i=this.phetioType.elements[e];t[i.name]=i.type.toStateObject(arguments[e])}}return t}},{key:"emit",value:function(){if(this.isPhetioInstrumented()&&this.phetioStartEvent("emitted",this.getPhetioData.apply(this,arguments)),this.listeners.length>0){this.activeListenersStack.push(this.listeners);for(var t=this.activeListenersStack.length-1,e=0;e<this.activeListenersStack[t].length;e++)this.activeListenersStack[t][e].apply(null,arguments);this.activeListenersStack.pop()}this.isPhetioInstrumented()&&this.phetioEndEvent()}},{key:"hasListener",value:function(t){return this.listeners.indexOf(t)>=0}},{key:"hasListeners",value:function(){return this.listeners.length>0}},{key:"getListenerCount",value:function(){return this.listeners.length}}]),e}();return e.register("Emitter",h)}),i("AXON/Multilink",["require","AXON/axon","PHET_CORE/inherit"],function(t){"use strict";function e(t,e,i){this.dependencies=t;var n=this;this.dependencyListeners=[],t.forEach(function(i,s){var r=function(i){n.isDisposed||e.apply(null,t.map(function(t){return t.get()}))};n.dependencyListeners.push(r),i.lazyLink(r)}),i||e.apply(null,t.map(function(t){return t.get()})),this.isDisposed=!1}var i=t("AXON/axon"),n=t("PHET_CORE/inherit");return i.register("Multilink",e),n(Object,e,{dispose:function(){for(var t=0;t<this.dependencies.length;t++){var e=this.dependencies[t];e.isDisposed||e.unlink(this.dependencyListeners[t])}this.dependencies=null,this.dependencyListeners=null,this.isDisposed=!0}})}),i("AXON/units",["require","AXON/axon"],function(t){"use strict";var e={values:["amperes","milliamperes","becquerels","centimeters","centimeters-squared","coulombs","degrees Celsius","farads","kilograms","grams","gray","henrys","henries","hertz","joules","katals","kelvins","liters","liters/second","lumens","lux","meters","meters/second","meters/second/second","moles","moles/liter","nanometers","newtons","newtons/meters","newtons-second/meters","ohms","ohm-centimeters","pascals","percent","radians","radians/second","seconds","siemens","sieverts","steradians","tesla","view-coordinates/second","volts","watts","webers","cm","nm"],isValidUnits:function(t){return _.includes(e.values,t)}};return t("AXON/axon").register("units",e),e}),i("AXON/Property",["require","AXON/axon","AXON/Emitter","AXON/Multilink","TANDEM/PhetioObject","TANDEM/Tandem","AXON/units","AXON/validate","AXON/ValidatorDef"],function(t){"use strict";var e=t("AXON/axon"),i=t("AXON/Emitter"),n=t("AXON/Multilink"),s=t("TANDEM/PhetioObject"),r=t("TANDEM/Tandem"),a=(t("AXON/units"),t("AXON/validate"),t("AXON/ValidatorDef")),o=0,h=function(t){function e(t,n){_classCallCheck(this,e),n=_.extend({tandem:r.optional,useDeepEquality:!1,units:null,reentrant:!1,validateOptionsOnValidateValue:!1},n),a.containsValidatorKey(n)||(n.isValidValue=function(){return!0}),n.units&&(n.phetioEventMetadata=n.phetioEventMetadata||{},n.phetioEventMetadata.units=n.units);var s=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n));return s.id=o++,s.units=n.units,s.useDeepEquality=n.useDeepEquality,s.validate=!1,r.validationEnabled()&&s.isPhetioInstrumented()&&!1&&(!1)(!!n.phetioType,"phetioType passed to Property must be specified. Tandem.phetioID: "+s.tandem.phetioID),r.validationEnabled()&&s.isPhetioInstrumented()&&!1&&(!1)(!!n.phetioType.elementType,"phetioType.elementType must be specified. Tandem.phetioID: "+s.tandem.phetioID),s._value=t,s._initialValue=t,s.validValues=n.validValues,s.changedEmitter=new i({validationEnabled:!1}),s.notifying=!1,s.reentrant=n.reentrant,s.isDeferred=!1,s.deferredValue=null,s.hasDeferredValue=!1,s}return _inherits(e,s),_createClass(e,[{key:"get",value:function(){return this._value}},{key:"set",value:function(t){return this.validate&&this.validate(t),this.isDeferred?(this.deferredValue=t,this.hasDeferredValue=!0):this.equalsValue(t)||this.setValueAndNotifyListeners(t),this}},{key:"equalsValue",value:function(t){return this.areValuesEqual(t,this._value)}},{key:"areValuesEqual",value:function(t,e){return this.useDeepEquality&&t&&e&&t.constructor===e.constructor?t.equals(e):t===e}},{key:"getInitialValue",value:function(){return this._initialValue}},{key:"setValueAndNotifyListeners",value:function(t){var e=this.get();this._value=t,this._notifyListeners(e)}},{key:"_notifyListeners",value:function(t){var e=this;this.phetioStartEvent("changed",function(){return{oldValue:e.phetioType.elementType.toStateObject(t),newValue:e.phetioType.elementType.toStateObject(e.get())}}),this.notifying=!0,this.changedEmitter.emit(this.get(),t,this),this.notifying=!1,this.isPhetioInstrumented()&&this.phetioEndEvent()}},{key:"notifyListenersStatic",value:function(){this.changedEmitter.emit(this.get(),void 0,this)}},{key:"setDeferred",value:function(t){var e=this;if(t)this.isDeferred=!0;else if(!t){this.isDeferred=!1;var i=this._value;if(this.hasDeferredValue&&(this._value=this.deferredValue,this.hasDeferredValue=!1),!this.equalsValue(i))return function(){return e._notifyListeners(i)}}return null}},{key:"reset",value:function(){this.set(this._initialValue)}},{key:"link",value:function(t){this.changedEmitter.addListener(t),t(this.get(),null,this)}},{key:"lazyLink",value:function(t){this.changedEmitter.addListener(t)}},{key:"unlink",value:function(t){this.changedEmitter.removeListener(t)}},{key:"unlinkAll",value:function(){this.changedEmitter.removeAllListeners()}},{key:"linkAttribute",value:function(t,e){var i=function(i){t[e]=i};return this.link(i),i}},{key:"unlinkAttribute",value:function(t){this.unlink(t)}},{key:"toString",value:function(){return"Property#"+this.id+"{"+this.get()+"}"}},{key:"valueOf",value:function(){return this.toString()}},{key:"debug",value:function(t){var e=function(e){return console.log(t,e)};return this.link(e),e}},{key:"toggle",value:function(){this.value=!this.value}},{key:"dispose",value:function(){this.unlinkAll(),_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"dispose",this).call(this),this.changedEmitter.dispose()}},{key:"hasListener",value:function(t){return this.changedEmitter.hasListener(t)}},{key:"hasListeners",value:function(){return this.changedEmitter.hasListeners()}},{key:"initialValue",get:function(){return this.getInitialValue()}},{key:"value",get:function(){return this.get()},set:function(t){this.set(t)}}],[{key:"multilink",value:function(t,e){return new n(t,e,!1)}},{key:"lazyMultilink",value:function(t,e){return new n(t,e,!0)}},{key:"unmultilink",value:function(t){t.dispose()}}]),e}();return e.register("Property",h)}),i("PHET_IO/phetioEngine",function(){return function(){return function(){}}}),i("AXON/PropertyIO",["require","AXON/axon","TANDEM/types/FunctionIO","TANDEM/types/ObjectIO","AXON/Property","TANDEM/phetioInherit","TANDEM/types/VoidIO","AXON/validate","ifphetio!PHET_IO/phetioEngine"],function(t){"use strict";function e(t){return a(s,"PropertyIO",function(t,e){s.call(this,t,e)},{getValue:{returnType:t,parameterTypes:[],implementation:function(){return this.instance.get()},documentation:"Gets the current value."},setValue:{returnType:o,parameterTypes:[t],implementation:function(t){this.instance.set(t)},documentation:"Sets the value of the property. If the value differs from the previous value, listeners are notified with the new value.",invocableForReadOnlyInstances:!1},link:{returnType:o,parameterTypes:[n(o,[t,t])],implementation:function(t){this.instance.link(t)},documentation:"Adds a listener which will be called when the value changes. On registration, the listener is also called with the current value. The listener takes two arguments, the new value and the previous value."},lazyLink:{returnType:o,parameterTypes:[n(o,[t,t])],implementation:function(t){this.instance.lazyLink(t)},documentation:'Adds a listener which will be called when the value changes. This method is like "link", but without the current-value callback on registration. The listener takes two arguments, the new value and the previous value.'},unlink:{returnType:o,parameterTypes:[n(o,[t])],implementation:function(t){this.instance.unlink(t)},documentation:"Removes a listener."}},{documentation:"Observable values that send out notifications when the value changes. This differs from the traditional listener pattern in that added listeners also receive a callback with the current value when the listeners are registered. This is a widely-used pattern in PhET-iO simulations.",methodOrder:["link","lazyLink"],elementType:t,validator:{valueType:r},parameterTypes:[t],events:["changed"],getAPI:function(){return{elementType:l.getAPIForType(t)}},toStateObject:function(e){h(e,this.validator);var i={value:t.toStateObject(e.value)};return e.validValues&&(i.validValues=e.validValues.map(function(e){return t.toStateObject(e)})),e.units&&(i.units=e.units),i},fromStateObject:function(e){return{units:e.units,value:t.fromStateObject(e.value),validValues:e.validValues&&e.validValues.map(function(e){return t.fromStateObject(e)})}},setValue:function(t,e){h(t,this.validator),t.units=e.units,t.set(e.value),t.validValues=e.validValues}})}var i=t("AXON/axon"),n=t("TANDEM/types/FunctionIO"),s=t("TANDEM/types/ObjectIO"),r=t("AXON/Property"),a=t("TANDEM/phetioInherit"),o=t("TANDEM/types/VoidIO"),h=t("AXON/validate"),l=t("ifphetio!PHET_IO/phetioEngine");return i.register("PropertyIO",e),e}),i("AXON/BooleanProperty",["require","AXON/axon","TANDEM/types/BooleanIO","AXON/Property","AXON/PropertyIO"],function(t){"use strict";var e=t("AXON/axon"),i=t("TANDEM/types/BooleanIO"),n=t("AXON/Property"),s=t("AXON/PropertyIO")(i),r=function(t){function e(t,i){return _classCallCheck(this,e),i=i||{},i.valueType="boolean",i.phetioType=s,_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i))}return _inherits(e,n),e}();return e.register("BooleanProperty",r)}),i("AXON/DerivedPropertyIO",["require","AXON/axon","TANDEM/phetioInherit","AXON/PropertyIO","TANDEM/types/VoidIO"],function(t){"use strict";function e(t){var i=new s(t),a=function(t,e){i.call(this,t,e)};return n(i,"DerivedPropertyIO",a,{setValue:{returnType:r,parameterTypes:[t],implementation:function(t){return this.instance.set(t)},documentation:"Errors out when you try to set a derived property.",invocableForReadOnlyInstances:!1}},{documentation:"Like PropertyIO, but not settable.  Instead it is derived from other DerivedPropertyIO or PropertyIO instances",parameterTypes:[t],elementType:t,validator:{isValidValue:function(t){return t instanceof phet.axon.DerivedProperty}}}),a.outerType=e,a}var i=t("AXON/axon"),n=t("TANDEM/phetioInherit"),s=t("AXON/PropertyIO"),r=t("TANDEM/types/VoidIO");return i.register("DerivedPropertyIO",e),e}),i("AXON/DerivedProperty",["require","AXON/axon","AXON/DerivedPropertyIO","AXON/Property","TANDEM/Tandem"],function(t){"use strict";var e=t("AXON/axon"),i=(t("AXON/DerivedPropertyIO"),t("AXON/Property")),n=t("TANDEM/Tandem"),s=function(t){function e(t,i,s){_classCallCheck(this,e),s=_.extend({tandem:n.optional,phetioType:null,phetioReadOnly:!0},s);var r=i.apply(null,t.map(function(t){return t.get()})),a=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r,s));a.dependencies=t,a._initialValue=null,a.isPhetioInstrumented();var o=a;a.dependencyListeners=[];for(var h=0;h<t.length;h++){!function(n){var s=function(){_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"set",a).call(a,i.apply(null,t.map(function(t){return t.get()})))};o.dependencyListeners.push(s),n.lazyLink(s)}(t[h])}return a}return _inherits(e,i),_createClass(e,[{key:"dispose",value:function(){for(var t=0;t<this.dependencies.length;t++){var i=this.dependencies[t];i.isDisposed||i.unlink(this.dependencyListeners[t])}this.dependencies=null,this.dependencyListeners=null,_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"dispose",this).call(this,this)}},{key:"set",value:function(t){throw new Error("Cannot set values directly to a DerivedProperty, tried to set: "+t)}},{key:"reset",value:function(){throw new Error("Cannot reset a DerivedProperty directly")}},{key:"getInitialValue",value:function(){throw new Error("Cannot get the initial value of a DerivedProperty")}},{key:"value",set:function(t){throw new Error("Cannot es5-set values directly to a DerivedProperty, tried to set: "+t)},get:function(){return _get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"get",this).call(this)}}],[{key:"valueEquals",value:function(t,i,n){return new e([t,i],r,n)}},{key:"and",value:function(t,i){return new e(t,_.reduce.bind(null,t,a,!0),i)}},{key:"or",value:function(t,i){return new e(t,_.reduce.bind(null,t,o,!1),i)}}]),e}(),r=function(t,e){return t===e},a=function(t,e){return t&&e.value},o=function(t,e){return t||e.value};return e.register("DerivedProperty",s)}),i("AXON/DynamicProperty",["require","AXON/axon","AXON/Property"],function(t){"use strict";var e=t("AXON/axon"),i=t("AXON/Property"),n=function(t){function e(t,i){_classCallCheck(this,e);var n="string"==typeof(i=_.extend({bidirectional:!1,defaultValue:null,derive:_.identity,map:_.identity,inverseMap:_.identity},i)).derive?_.property(i.derive):i.derive,s="string"==typeof i.map?_.property(i.map):i.map,r=s(null===t.value?i.defaultValue:n(t.value).value),a=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r,i));return a.defaultValue=i.defaultValue,a.derive=n,a.map=s,a.inverseMap="string"==typeof i.inverseMap?_.property(i.inverseMap):i.inverseMap,a.bidirectional=i.bidirectional,a.valuePropertyProperty=t,a.isExternallyChanging=!1,a.bidirectional||(a._initialValue=null),a.propertyPropertyListener=a.onPropertyPropertyChange.bind(a),a.propertyListener=a.onPropertyChange.bind(a),t.link(a.propertyListener),i.bidirectional&&a.lazyLink(a.onSelfChange.bind(a)),a}return _inherits(e,i),_createClass(e,[{key:"onPropertyPropertyChange",value:function(t,i,n){if(this.bidirectional&&null!==this.valuePropertyProperty.value&&n){if(this.derive(this.valuePropertyProperty.value)===n&&n.equalsValue(this.inverseMap(this.value)))return}_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"set",this).call(this,this.map(t))}},{key:"onPropertyChange",value:function(t,e){e&&this.derive(e).unlink(this.propertyPropertyListener),t?this.derive(t).link(this.propertyPropertyListener):this.onPropertyPropertyChange(this.defaultValue,null,null)}},{key:"onSelfChange",value:function(t){if(null!==this.valuePropertyProperty.value){var e=this.derive(this.valuePropertyProperty.value);this.areValuesEqual(t,this.map(e.value))||(e.value=this.inverseMap(t))}}},{key:"dispose",value:function(){this.valuePropertyProperty.unlink(this.propertyListener),null!==this.valuePropertyProperty.value&&this.derive(this.valuePropertyProperty.value).unlink(this.propertyPropertyListener),_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"dispose",this).call(this,this)}},{key:"reset",value:function(){null!==this.valuePropertyProperty.value&&this.derive(this.valuePropertyProperty.value).reset()}},{key:"getInitialValue",value:function(){return _get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getInitialValue",this).call(this)}},{key:"set",value:function(t){this.isExternallyChanging=!0,_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"set",this).call(this,t),this.isExternallyChanging=!1}}]),e}();return e.register("DynamicProperty",n)}),i("PHET_CORE/cleanArray",["require","PHET_CORE/phetCore"],function(t){"use strict";function e(t){if(t){for(;t.length;)t.pop();return t}return[]}return t("PHET_CORE/phetCore").register("cleanArray",e),e}),i("AXON/Events",["require","AXON/axon","PHET_CORE/cleanArray"],function(t){"use strict";function e(){this._eventListeners={},this._staticEventListeners={}}var i=t("AXON/axon"),n=t("PHET_CORE/cleanArray");return i.register("Events",e),e.prototype={dispose:function(){this.removeAllEventListeners()},on:function(t,e){this._eventListeners[t]=this._eventListeners[t]||[],this._eventListeners[t].push(e)},onStatic:function(t,e){this._staticEventListeners[t]=this._staticEventListeners[t]||[],this._staticEventListeners[t].push(e)},off:function(t,e){var i=-1;return this._eventListeners[t]&&-1!==(i=this._eventListeners[t].indexOf(e))&&this._eventListeners[t].splice(i,1),i},offStatic:function(t,e){var i=-1;return this._staticEventListeners[t]&&-1!==(i=this._staticEventListeners[t].indexOf(e))&&this._staticEventListeners[t].splice(i,1),i},hasListener:function(t,e){var i=this._eventListeners[t];return!!i&&i.indexOf(e)>=0},hasStaticListener:function(t,e){var i=this._staticEventListeners[t];return!!i&&i.indexOf(e)>=0},removeAllEventListeners:function(){var t;for(t in this._eventListeners)n(this._eventListeners[t]);for(t in this._staticEventListeners)n(this._staticEventListeners[t])},trigger:function(t){var e,i=this._eventListeners[t],n=this._staticEventListeners[t],s=i?i.length:0,r=n?n.length:0,a=1===arguments.length;!a&&(s>0||r>0)&&(e=Array.prototype.slice.call(arguments,1)),s>0&&(i=i.slice());var o;for(o=0;o<s;o++){var h=i[o];a?h():h.apply(this,e)}for(o=0;o<r;o++){var l=n[o];a?l(arguments):l.apply(this,e)}},trigger0:function(t){var e=this._eventListeners[t],i=this._staticEventListeners[t],n=e?e.length:0,s=i?i.length:0;n>0&&(e=e.slice());var r;for(r=0;r<n;r++)e[r]();for(r=0;r<s;r++)i[r]()},trigger1:function(t,e){var i=this._eventListeners[t],n=this._staticEventListeners[t],s=i?i.length:0,r=n?n.length:0;s>0&&(i=i.slice());var a;for(a=0;a<s;a++)i[a](e);for(a=0;a<r;a++)n[a](e)},trigger2:function(t,e,i){var n=this._eventListeners[t],s=this._staticEventListeners[t],r=n?n.length:0,a=s?s.length:0;r>0&&(n=n.slice());var o;for(o=0;o<r;o++)n[o](e,i);for(o=0;o<a;o++)s[o](e,i)}},e}),i("TANDEM/types/NumberIO",["require","TANDEM/types/ObjectIO","TANDEM/phetioInherit","TANDEM/tandemNamespace"],function(t){"use strict";function e(){}var i=t("TANDEM/types/ObjectIO"),n=t("TANDEM/phetioInherit");return t("TANDEM/tandemNamespace").register("NumberIO",e),n(i,"NumberIO",e,{},{documentation:"Wrapper for the built-in JS number type (floating point, but also represents integers)",validator:{valueType:"number"},toStateObject:function(t){return t===Number.POSITIVE_INFINITY?"POSITIVE_INFINITY":t===Number.NEGATIVE_INFINITY?"NEGATIVE_INFINITY":t},fromStateObject:function(t){return"POSITIVE_INFINITY"===t?Number.POSITIVE_INFINITY:"NEGATIVE_INFINITY"===t?Number.NEGATIVE_INFINITY:t}})}),i("DOT/dot",["require","PHET_CORE/Namespace"],function(t){"use strict";var e=new(t("PHET_CORE/Namespace"))("dot");return e.register("v2",function(t,i){return new e.Vector2(t,i)}),e.register("v3",function(t,i,n){return new e.Vector3(t,i,n)}),e.register("v4",function(t,i,n,s){return new e.Vector4(t,i,n,s)}),e.register("FastArray",window.Float64Array?window.Float64Array:window.Array),e}),i("DOT/Range",["require","DOT/dot"],function(t){"use strict";function e(t,e){this._min=t,this._max=e}return t("DOT/dot").register("Range",e),e.prototype={constructor:e,getMin:function(){return this._min},get min(){return this.getMin()},setMin:function(t){this._min=t},set min(t){this.setMin(t)},getMax:function(){return this._max},get max(){return this.getMax()},setMax:function(t){this._max=t},set max(t){this.setMax(t)},setMinMax:function(t,e){this._min=t,this._max=e},copy:function(){return new e(this._min,this._max)},getLength:function(){return this._max-this._min},getCenter:function(){return(this._max+this._min)/2},contains:function(t){return t>=this._min&&t<=this._max},containsRange:function(t){return this._min<=t.min&&this._max>=t.max},intersects:function(t){return this._max>=t.min&&t.max>=this._min},intersectsExclusive:function(t){return this._max>t.min&&t.max>this._min},toString:function(){return"[Range (min:"+this._min+" max:"+this._max+")]"},constrainValue:function(t){return Math.min(Math.max(t,this._min),this._max)},equals:function(t){return this.constructor===t.constructor&&this._min===t.min&&this._max===t.max},get defaultValue(){throw new Error("defaultValue is undefined, did you mean to use RangeWithValue?")}},e}),i("DOT/RangeIO",["require","DOT/dot","TANDEM/types/ObjectIO","TANDEM/phetioInherit","DOT/Range","AXON/validate"],function(t){"use strict";function e(t,e){n.call(this,t,e)}var i=t("DOT/dot"),n=t("TANDEM/types/ObjectIO"),s=t("TANDEM/phetioInherit"),r=t("DOT/Range"),a=t("AXON/validate");return s(n,"RangeIO",e,{},{documentation:'A range with "min" and a "max" members.',validator:{valueType:r},toStateObject:function(t){return a(t,this.validator),{min:t.min,max:t.max}},fromStateObject:function(t){return new r(t.min,t.max)}}),i.register("RangeIO",e),e}),i("AXON/NumberPropertyIO",["require","AXON/axon","TANDEM/types/NumberIO","TANDEM/phetioInherit","AXON/PropertyIO","DOT/RangeIO","AXON/validate"],function(t){"use strict";function e(t,e){h.call(this,t,e)}var i=t("AXON/axon"),n=t("TANDEM/types/NumberIO"),s=t("TANDEM/phetioInherit"),r=t("AXON/PropertyIO"),a=t("DOT/RangeIO"),o=t("AXON/validate"),h=r(n),l=["FloatingPoint","Integer"];return i.register("NumberPropertyIO",e),s(h,"NumberPropertyIO",e,{},{validator:{isValidValue:function(t){return t instanceof phet.axon.NumberProperty}},elementType:n,toStateObject:function(t){o(t,this.validator);var e=h.toStateObject(t);return t.numberType&&(e.numberType=t.numberType),t.range&&(e.range=a.toStateObject(t.range)),e},fromStateObject:function(t){var e=h.fromStateObject(t);return e.numberType=t.numberType,e.range=t.range?a.fromStateObject(t.range):t.range,e},setValue:function(t,e){o(t,this.validator),h.setValue(t,e),t.range=e.range,t.numberType=e.numberType},documentation:"Extends PropertyIO to add values for the numeric range ( min, max ) and numberType ( '"+l.join("' | '")+"' )"}),e.VALID_NUMBER_TYPES=l,e}),i("AXON/NumberProperty",["require","AXON/axon","AXON/NumberPropertyIO","AXON/Property","DOT/Range"],function(t){"use strict";var e=t("AXON/axon"),i=t("AXON/NumberPropertyIO"),n=t("AXON/Property"),s=(t("DOT/Range"),i.VALID_NUMBER_TYPES,function(t){function e(t,n){_classCallCheck(this,e),(n=_.extend({numberType:"FloatingPoint",range:null},n)).phetioType=i,n.valueType="number";var s=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return s.numberType=n.numberType,s.range=n.range,s.assertNumberPropertyValidateValue=!1,n.validValues&&s.assertNumberPropertyValidateValue&&n.validValues.forEach(s.assertNumberPropertyValidateValue),s.assertNumberPropertyValidateValue&&s.assertNumberPropertyValidateValue(t),s}return _inherits(e,n),_createClass(e,[{key:"set",value:function(t){this.assertNumberPropertyValidateValue&&this.assertNumberPropertyValidateValue(t),_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"set",this).call(this,t)}}]),e}());return e.register("NumberProperty",s)}),i("AXON/ObservableArrayIO",["require","AXON/axon","TANDEM/types/FunctionIO","TANDEM/types/NumberIO","TANDEM/types/ObjectIO","TANDEM/phetioInherit","TANDEM/types/VoidIO","AXON/validate","ifphetio!PHET_IO/phetioEngine"],function(t){"use strict";function e(t,e){e=_.extend({isReferenceType:!0},e);return a(r,"ObservableArrayIO",function(t,e){r.call(this,t,e)},{addItemAddedListener:{returnType:o,parameterTypes:[n(o,[t])],implementation:function(t){this.instance.addItemAddedListener(t)},documentation:"Add a listener that is called when an item is added to the observable array."},addItemRemovedListener:{returnType:o,parameterTypes:[n(o,[t])],implementation:function(t){this.instance.addItemRemovedListener(t)},documentation:"Add a listener that is called when an item is removed from the observable array."},getLength:{returnType:s,parameterTypes:[],implementation:function(){return this.instance.length},documentation:"Get the number of elements in the observable array"}},{toStateObject:function(i){return h(i,this.validator),i?{array:i.getArray().map(function(i){return e.isReferenceType?i.phetioID:t.toStateObject(i)})}:i},fromStateObject:function(t){var e=[];return t.array.forEach(function(t){e.push(l.getInstance(t))}),e},setValue:function(t,e){h(t,this.validator),t.clear(),t.addAll(e)},documentation:"An array that sends notifications when its values have changed.",elementType:t,validator:{isValidValue:function(t){return t instanceof phet.axon.ObservableArray}},events:["itemAdded","itemRemoved"]})}var i=t("AXON/axon"),n=t("TANDEM/types/FunctionIO"),s=t("TANDEM/types/NumberIO"),r=t("TANDEM/types/ObjectIO"),a=t("TANDEM/phetioInherit"),o=t("TANDEM/types/VoidIO"),h=t("AXON/validate"),l=t("ifphetio!PHET_IO/phetioEngine");return i.register("ObservableArrayIO",e),e}),i("AXON/ObservableArray",["require","AXON/axon","PHET_CORE/inherit","AXON/NumberProperty","TANDEM/types/ObjectIO","AXON/ObservableArrayIO","TANDEM/PhetioObject","TANDEM/Tandem"],function(t){"use strict";function e(t,e){t instanceof Object&&!Array.isArray(t)&&(e=t,t=null),e=_.extend({allowDuplicates:!1,phetioType:l,tandem:h.optional},e),this.allowDuplicates=e.allowDuplicates,this._array=t||[],this._addedListeners=[],this._removedListeners=[],this.lengthProperty=new s(this._array.length,{numberType:"Integer",tandem:e.tandem.createTandem("lengthProperty"),phetioReadOnly:!0}),this.initialArray=t?t.slice():[],o.call(this,e)}var i=t("AXON/axon"),n=t("PHET_CORE/inherit"),s=t("AXON/NumberProperty"),r=t("TANDEM/types/ObjectIO"),a=t("AXON/ObservableArrayIO"),o=t("TANDEM/PhetioObject"),h=t("TANDEM/Tandem"),l=a(r);return i.register("ObservableArray",e),n(o,e,{dispose:function(){this.lengthProperty.dispose(),o.prototype.dispose.call(this)},reset:function(){for(var t=0;t<this._array.length;t++)this._fireItemRemoved(this._array[t]);for(this._array=this.initialArray.slice(),t=0;t<this._array.length;t++)this._fireItemAdded(this._array[t])},get length(){return this._array.length},addItemAddedListener:function(t){this._addedListeners.push(t)},removeItemAddedListener:function(t){var e=this._addedListeners.indexOf(t);this._addedListeners.splice(e,1)},addItemRemovedListener:function(t){this._removedListeners.push(t)},removeItemRemovedListener:function(t){var e=this._removedListeners.indexOf(t);this._removedListeners.splice(e,1)},_fireItemAdded:function(t){var e=this;this.phetioStartEvent("itemAdded",function(){return e.phetioType.elementType.toStateObject(t)});for(var i=this._addedListeners.slice(0),n=0;n<i.length;n++)i[n](t,this);this.phetioEndEvent()},_fireItemRemoved:function(t){var e=this;this.phetioStartEvent("itemRemoved",function(){return e.phetioType.elementType.toStateObject(t)});for(var i=this._removedListeners.slice(0),n=0;n<i.length;n++)i[n](t,this);this.phetioEndEvent()},add:function(t){this.push(t)},addAll:function(t){for(var e=0;e<t.length;e++)this.add(t[e])},remove:function(t){var e=this._array.indexOf(t);-1!==e&&(this._array.splice(e,1),this.lengthProperty.set(this._array.length),this._fireItemRemoved(t))},removeAll:function(t){for(var e=0;e<t.length;e++)this.remove(t[e])},push:function(t){if(!this.allowDuplicates&&this.contains(t))throw new Error("duplicates are not allowed");this._array.push(t),this.lengthProperty.set(this._array.length),this._fireItemAdded(t)},pop:function(){var t=this._array.pop();return void 0!==t&&(this.lengthProperty.set(this._array.length),this._fireItemRemoved(t)),t},shift:function(){var t=this._array.shift();return void 0!==t&&(this.lengthProperty.set(this._array.length),this._fireItemRemoved(t)),t},contains:function(t){return-1!==this.indexOf(t)},get:function(t){return this._array[t]},indexOf:function(t){return this._array.indexOf(t)},clear:function(){for(;this.length>0;)this.pop()},forEach:function(t){this._array.slice().forEach(t)},map:function(t){return new e(this._array.map(t))},filter:function(t){return new e(this._array.filter(t))},count:function(t){for(var e=0,i=0;i<this._array.length;i++)t(this._array[i])&&e++;return e},find:function(t,e){return _.find(this._array,t,e)},some:function(t){return _.some(this._array,t)},reduce:function(t,e){for(var i=0;i<this._array.length;i++)t=e(t,this._array[i]);return t},getArray:function(){return this._array},splice:function(t,e,i,n,s){for(var r=this._array.splice.apply(this._array,arguments),a=Array.prototype.slice.call(arguments),o=0;o<r.length;o++)this._fireItemRemoved(r[o]);for(var h=2;h<a.length;h++)this._fireItemAdded(a[h]);return r},shuffle:function(t){var e=t.shuffle(this._array);this._array.length=0,Array.prototype.push.apply(this._array,e)}})}),i("AXON/StringProperty",["require","AXON/axon","AXON/Property","AXON/PropertyIO","TANDEM/types/StringIO"],function(t){"use strict";var e=t("AXON/axon"),i=t("AXON/Property"),n=t("AXON/PropertyIO")(t("TANDEM/types/StringIO")),s=function(t){function e(t,i){return _classCallCheck(this,e),i=i||{},i.valueType="string",i.phetioType=n,_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i))}return _inherits(e,i),e}();return e.register("StringProperty",s)}),i("AXON/main",["AXON/axon","AXON/BooleanProperty","AXON/DerivedProperty","AXON/DynamicProperty","AXON/Emitter","AXON/Events","AXON/Multilink","AXON/ObservableArray","AXON/Property","AXON/StringProperty","AXON/NumberProperty"],function(t){"use strict";return t}),i("PHET_CORE/Poolable",["require","PHET_CORE/extend","PHET_CORE/phetCore"],function(t){"use strict";var e=t("PHET_CORE/extend"),i={mixInto:function(t,i){i=_.extend({defaultArguments:[],initialize:t,maxSize:100,initialSize:0,useDefaultConstruction:!1},i);var n=[],s=Function.prototype.bind.bind(t,t),r=s.apply(null,i.defaultArguments),a=i.initialize,o=i.useDefaultConstruction;for(e(t,{pool:n,dirtyFromPool:function(){return n.length?n.pop():new r},createFromPool:function(){var t;return n.length?(t=n.pop(),a.apply(t,arguments)):o?(t=new r,a.apply(t,arguments)):t=new(s.apply(null,arguments)),t}}),e(t.prototype,{freeToPool:function(){n.length<i.maxSize&&n.push(this)}});n.length<i.initialSize;)n.push(new r)}};return t("PHET_CORE/phetCore").register("Poolable",i),i}),i("DOT/Util",["require","DOT/dot"],function(t){"use strict";var e,i,n,s=t("DOT/dot"),r=Number.MIN_VALUE,a=2*Math.PI,o={clamp:function(t,e,i){return t<e?e:t>i?i:t},moduloBetweenDown:function(t,e,i){var n=i-e,s=(t-e)%n;return s<0&&(s+=n),s+e},moduloBetweenUp:function(t,e,i){return-o.moduloBetweenDown(-t,-i,-e)},rangeInclusive:function(t,e){if(e<t)return[];for(var i=new Array(e-t+1),n=t;n<=e;n++)i[n-t]=n;return i},rangeExclusive:function(t,e){return o.rangeInclusive(t+1,e-1)},toRadians:function(t){return Math.PI*t/180},toDegrees:function(t){return 180*t/Math.PI},mod:function(t,e){return t/e%1==0?0:t%e},gcd:function(t,e){return Math.abs(0===e?t:this.gcd(e,o.mod(t,e)))},lcm:function(t,e){return o.roundSymmetric(Math.abs(t*e)/o.gcd(t,e))},lineLineIntersection:function(t,e,i,n){if(t.equals(e)||i.equals(n))return null;var r=t.x-e.x,a=i.x-n.x,o=t.y-e.y,h=i.y-n.y,l=r*h-o*a;if(Math.abs(l)<1e-10)return null;var u=t.x*e.y-t.y*e.x,c=i.x*n.y-i.y*n.x;return new s.Vector2((u*a-r*c)/l,(u*h-o*c)/l)},circleCenterFromPoints:function(t,e,i){var n=new s.Vector2((t.x+e.x)/2,(t.y+e.y)/2),r=new s.Vector2((e.x+i.x)/2,(e.y+i.y)/2),a=new s.Vector2(n.x+(e.y-t.y),n.y-(e.x-t.x)),h=new s.Vector2(r.x+(i.y-e.y),r.y-(i.x-e.x));return o.lineLineIntersection(n,a,r,h)},pointInCircleFromPoints:function(t,e,i,n){var s=t.x-n.x,r=t.y-n.y,a=(t.x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y),o=e.x-n.x,h=e.y-n.y,l=(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y),u=i.x-n.x,c=i.y-n.y,d=(i.x-n.x)*(i.x-n.x)+(i.y-n.y)*(i.y-n.y);return s*h*d+r*l*u+a*o*c-a*h*u-r*o*d-s*l*c>0},sphereRayIntersection:function(t,e,i){i=void 0===i?1e-5:i;var n=new s.Vector3(0,0,0),r=e.direction,a=e.position,o=a.minus(n),h=r.dot(o),l=4*h*h-4*(o.magnitudeSquared()-t*t);if(l<i)return null;var u=r.dot(n)-r.dot(a),c=Math.sqrt(l)/2,d=u-c,f=u+c;if(f<i)return null;var m=e.pointAtDistance(f),p=m.minus(n).normalized();if(d<i)return{distance:f,hitPoint:m,normal:p.negated(),fromOutside:!1};var g=e.pointAtDistance(d);return{distance:d,hitPoint:g,normal:g.minus(n).normalized(),fromOutside:!0}},solveLinearRootsReal:function(t,e){return 0===t?0===e?null:[]:[-e/t]},solveQuadraticRootsReal:function(t,e,i){if(0===t||Math.abs(e/t)>1e7||Math.abs(i/t)>1e7)return o.solveLinearRootsReal(e,i);var n=e*e-4*t*i;if(n<0)return[];var s=Math.sqrt(n);return[(-e-s)/(2*t),(-e+s)/(2*t)]},solveCubicRootsReal:function(t,e,i,n){if(0===t)return o.solveQuadraticRootsReal(e,i,n);if(0===t||Math.abs(e/t)>1e7||Math.abs(i/t)>1e7||Math.abs(n/t)>1e7)return o.solveQuadraticRootsReal(e,i,n);if(0===n||Math.abs(t/n)>1e7||Math.abs(e/n)>1e7||Math.abs(i/n)>1e7)return[0].concat(o.solveQuadraticRootsReal(t,e,i));var s=(3*(i/=t)-(e/=t)*e)/9,r=(-27*(n/=t)+e*(9*i-e*e*2))/54,a=s*s*s+r*r,h=e/3;if(a>1e-7){var l=Math.sqrt(a);return[o.cubeRoot(r+l)+o.cubeRoot(r-l)-h]}if(0===a){var u=o.cubeRoot(r),c=-h-u;return[2*u-h,c,c]}var d=-s*s*s;d=Math.acos(r/Math.sqrt(d));var f=2*Math.sqrt(-s);return[-h+f*Math.cos(d/3),-h+f*Math.cos((d+2*Math.PI)/3),-h+f*Math.cos((d+4*Math.PI)/3)]},cubeRoot:function(t){return t>=0?Math.pow(t,1/3):-Math.pow(-t,1/3)},linear:function(t,e,i,n,s){return(n-i)/(e-t)*(s-t)+i},roundSymmetric:function(t){return(t<0?-1:1)*Math.round(Math.abs(t))},toFixed:function(t,e){var i=Math.pow(10,e);return(o.roundSymmetric(t*i)/i).toFixed(e)},toFixedNumber:function(t,e){return parseFloat(o.toFixed(t,e))},isInteger:function(t){return t%1==0},equalsEpsilon:function(t,e,i){return Math.abs(t-e)<=i},lineSegmentIntersection:function(t,e,i,n,r,a,o,h){var l=function(t,e,i,n,s,r){return(r-e)*(i-t)-(n-e)*(s-t)};if(l(t,e,r,a,o,h)*l(i,n,r,a,o,h)>0||l(r,a,t,e,i,n)*l(o,h,t,e,i,n)>0)return null;var u=(t-i)*(a-h)-(e-n)*(r-o);if(Math.abs(u)<1e-10)return null;if(t===r&&e===a||t===o&&e===h)return new s.Vector2(t,e);if(i===r&&n===a||i===o&&n===h)return new s.Vector2(i,n);var c=((t*n-e*i)*(r-o)-(t-i)*(r*h-a*o))/u,d=((t*n-e*i)*(a-h)-(e-n)*(r*h-a*o))/u;return new s.Vector2(c,d)},distToSegmentSquared:function(t,e,i){var n=e.distanceSquared(i);if(0===n)return t.distanceSquared(e);var r=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/n;return r<0?t.distanceSquared(e):r>1?t.distanceSquared(i):t.distanceSquared(new s.Vector2(e.x+r*(i.x-e.x),e.y+r*(i.y-e.y)))},distToSegment:function(t,e,i){return Math.sqrt(this.distToSegmentSquared(t,e,i))},arePointsCollinear:function(t,e,i,n){return void 0===n&&(n=0),o.triangleArea(t,e,i)<=n},triangleArea:function(t,e,i){return Math.abs(o.triangleAreaSigned(t,e,i))},triangleAreaSigned:function(t,e,i){return t.x*(e.y-i.y)+e.x*(i.y-t.y)+i.x*(t.y-e.y)},sign:function(t){return(t>0)-(t<0)||+t},cosh:function(t){return(Math.exp(t)+Math.exp(-t))/2},sinh:function(t){return(Math.exp(t)-Math.exp(-t))/2},log10:function(t){return Math.log(t)/Math.LN10},boxMullerTransform:function(t,s,o){if(!(e=!e))return n*s+t;var h,l;do{h=o.nextDouble(),l=o.nextDouble()}while(h<=r);return i=Math.sqrt(-2*Math.log(h))*Math.cos(a*l),n=Math.sqrt(-2*Math.log(h))*Math.sin(a*l),i*s+t},numberOfDecimalPlaces:function(t){for(var e=0,i=1;t*i%1!=0;)e++,i*=10;return e},roundToInterval:function(t,e){return o.toFixedNumber(o.roundSymmetric(t/e)*e,o.numberOfDecimalPlaces(e))}};return s.register("Util",o),s.clamp=o.clamp,s.moduloBetweenDown=o.moduloBetweenDown,s.moduloBetweenUp=o.moduloBetweenUp,s.rangeInclusive=o.rangeInclusive,s.rangeExclusive=o.rangeExclusive,s.toRadians=o.toRadians,s.toDegrees=o.toDegrees,s.lineLineIntersection=o.lineLineIntersection,s.lineSegmentIntersection=o.lineSegmentIntersection,s.sphereRayIntersection=o.sphereRayIntersection,s.solveQuadraticRootsReal=o.solveQuadraticRootsReal,s.solveCubicRootsReal=o.solveCubicRootsReal,s.cubeRoot=o.cubeRoot,s.linear=o.linear,s.boxMullerTransform=o.boxMullerTransform,o}),i("DOT/Vector2",["require","DOT/dot","PHET_CORE/inherit","PHET_CORE/Poolable","DOT/Util"],function(t){"use strict";function e(t,e){this.x=t,this.y=e}var i=t("DOT/dot"),n=t("PHET_CORE/inherit"),s=t("PHET_CORE/Poolable");t("DOT/Util"),i.register("Vector2",e),n(Object,e,{isVector2:!0,dimension:2,getMagnitude:function(){return Math.sqrt(this.magnitudeSquared())},get magnitude(){return this.getMagnitude()},magnitudeSquared:function(){return this.x*this.x+this.y*this.y},distance:function(t){return Math.sqrt(this.distanceSquared(t))},distanceXY:function(t,e){var i=this.x-t,n=this.y-e;return Math.sqrt(i*i+n*n)},distanceSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},distanceSquaredXY:function(t,e){var i=this.x-t,n=this.y-e;return i*i+n*n},dot:function(t){return this.x*t.x+this.y*t.y},dotXY:function(t,e){return this.x*t+this.y*e},getAngle:function(){return Math.atan2(this.y,this.x)},get angle(){return this.getAngle()},angleBetween:function(t){var e=this.magnitude,n=t.magnitude;return Math.acos(i.clamp((this.x*t.x+this.y*t.y)/(e*n),-1,1))},equals:function(t){return this.x===t.x&&this.y===t.y},equalsEpsilon:function(t,e){return e||(e=0),Math.max(Math.abs(this.x-t.x),Math.abs(this.y-t.y))<=e},isFinite:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){return isFinite(this.x)&&isFinite(this.y)}),copy:function(t){return t?t.set(this):new e(this.x,this.y)},crossScalar:function(t){return this.x*t.y-this.y*t.x},normalized:function(){var t=this.magnitude;if(0===t)throw new Error("Cannot normalize a zero-magnitude vector");return new e(this.x/t,this.y/t)},roundedSymmetric:function(){return this.copy().roundSymmetric()},withMagnitude:function(t){return this.copy().setMagnitude(t)},timesScalar:function(t){return new e(this.x*t,this.y*t)},times:function(t){return this.timesScalar(t)},componentTimes:function(t){return new e(this.x*t.x,this.y*t.y)},plus:function(t){return new e(this.x+t.x,this.y+t.y)},plusXY:function(t,i){return new e(this.x+t,this.y+i)},plusScalar:function(t){return new e(this.x+t,this.y+t)},minus:function(t){return new e(this.x-t.x,this.y-t.y)},minusXY:function(t,i){return new e(this.x-t,this.y-i)},minusScalar:function(t){return new e(this.x-t,this.y-t)},dividedScalar:function(t){return new e(this.x/t,this.y/t)},negated:function(){return new e(-this.x,-this.y)},perpendicular:function(){return new e(this.y,-this.x)},rotated:function(t){var i=this.angle+t,n=this.magnitude;return new e(n*Math.cos(i),n*Math.sin(i))},rotateAboutXY:function(t,e,i){var n=this.x-t,s=this.y-e,r=Math.cos(i),a=Math.sin(i);return this.x=t+n*r-s*a,this.y=e+n*a+s*r,this},rotateAboutPoint:function(t,e){return this.rotateAboutXY(t.x,t.y,e)},rotatedAboutXY:function(t,i,n){return new e(this.x,this.y).rotateAboutXY(t,i,n)},rotatedAboutPoint:function(t,e){return this.rotatedAboutXY(t.x,t.y,e)},blend:function(t,i){return new e(this.x+(t.x-this.x)*i,this.y+(t.y-this.y)*i)},average:function(t){return this.blend(t,.5)},toString:function(){return"Vector2("+this.x+", "+this.y+")"},toVector3:function(){return new i.Vector3(this.x,this.y,0)},setXY:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},set:function(t){return this.setXY(t.x,t.y)},setMagnitude:function(t){var e=t/this.magnitude;return this.multiplyScalar(e)},add:function(t){return this.setXY(this.x+t.x,this.y+t.y)},addXY:function(t,e){return this.setXY(this.x+t,this.y+e)},addScalar:function(t){return this.setXY(this.x+t,this.y+t)},subtract:function(t){return this.setXY(this.x-t.x,this.y-t.y)},subtractXY:function(t,e){return this.setXY(this.x-t,this.y-e)},subtractScalar:function(t){return this.setXY(this.x-t,this.y-t)},multiplyScalar:function(t){return this.setXY(this.x*t,this.y*t)},multiply:function(t){return this.multiplyScalar(t)},componentMultiply:function(t){return this.setXY(this.x*t.x,this.y*t.y)},divideScalar:function(t){return this.setXY(this.x/t,this.y/t)},negate:function(){return this.setXY(-this.x,-this.y)},normalize:function(){var t=this.magnitude;if(0===t)throw new Error("Cannot normalize a zero-magnitude vector");return this.divideScalar(t)},roundSymmetric:function(){return this.setXY(i.Util.roundSymmetric(this.x),i.Util.roundSymmetric(this.y))},rotate:function(t){var e=this.angle+t,i=this.magnitude;return this.setXY(i*Math.cos(e),i*Math.sin(e))},setPolar:function(t,e){return this.setXY(t*Math.cos(e),t*Math.sin(e))},toStateObject:function(){return{x:this.x,y:this.y}}},{createPolar:function(t,i){return new e(0,0).setPolar(t,i)},fromStateObject:function(t){return new e(t.x,t.y)},getAngleBetweenVectors:function(t,e){var i=e.x-t.x,n=e.y-t.y;return Math.atan2(n,i)},getDistanceBetweenVectors:function(t,e){var i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*n)}}),s.mixInto(e,{initialize:e.prototype.setXY,defaultArguments:[0,0]});var r=e.Immutable=function(t,i){e.call(this,t,i)};return n(e,r),r.mutableOverrideHelper=function(t){r.prototype[t]=function(){throw new Error("Cannot call mutable method '"+t+"' on immutable Vector2")}},r.mutableOverrideHelper("setXY"),r.mutableOverrideHelper("setX"),r.mutableOverrideHelper("setY"),e.ZERO=new e(0,0),e.X_UNIT=new e(1,0),e.Y_UNIT=new e(0,1),e}),i("DOT/Bounds2",["require","DOT/dot","PHET_CORE/inherit","PHET_CORE/Poolable","DOT/Vector2"],function(t){"use strict";function e(t,e,i,n){this.minX=t,this.minY=e,this.maxX=i,this.maxY=n}var i=t("DOT/dot"),n=t("PHET_CORE/inherit"),s=t("PHET_CORE/Poolable"),r=t("DOT/Vector2"),a=new i.Vector2(0,0);return i.register("Bounds2",e),n(Object,e,{isBounds:!0,dimension:2,getWidth:function(){return this.maxX-this.minX},get width(){return this.getWidth()},getHeight:function(){return this.maxY-this.minY},get height(){return this.getHeight()},getX:function(){return this.minX},get x(){return this.getX()},getY:function(){return this.minY},get y(){return this.getY()},getMinX:function(){return this.minX},getMinY:function(){return this.minY},getMaxX:function(){return this.maxX},getMaxY:function(){return this.maxY},getLeft:function(){return this.minX},get left(){return this.minX},getTop:function(){return this.minY},get top(){return this.minY},getRight:function(){return this.maxX},get right(){return this.maxX},getBottom:function(){return this.maxY},get bottom(){return this.maxY},getCenterX:function(){return(this.maxX+this.minX)/2},get centerX(){return this.getCenterX()},getCenterY:function(){return(this.maxY+this.minY)/2},get centerY(){return this.getCenterY()},getLeftTop:function(){return new i.Vector2(this.minX,this.minY)},get leftTop(){return this.getLeftTop()},getCenterTop:function(){return new i.Vector2(this.getCenterX(),this.minY)},get centerTop(){return this.getCenterTop()},getRightTop:function(){return new i.Vector2(this.maxX,this.minY)},get rightTop(){return this.getRightTop()},getLeftCenter:function(){return new i.Vector2(this.minX,this.getCenterY())},get leftCenter(){return this.getLeftCenter()},getCenter:function(){return new i.Vector2(this.getCenterX(),this.getCenterY())},get center(){return this.getCenter()},getRightCenter:function(){return new i.Vector2(this.maxX,this.getCenterY())},get rightCenter(){return this.getRightCenter()},getLeftBottom:function(){return new i.Vector2(this.minX,this.maxY)},get leftBottom(){return this.getLeftBottom()},getCenterBottom:function(){return new i.Vector2(this.getCenterX(),this.maxY)},get centerBottom(){return this.getCenterBottom()},getRightBottom:function(){return new i.Vector2(this.maxX,this.maxY)},get rightBottom(){return this.getRightBottom()},isEmpty:function(){return this.getWidth()<0||this.getHeight()<0},isFinite:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){return isFinite(this.minX)&&isFinite(this.minY)&&isFinite(this.maxX)&&isFinite(this.maxY)}),hasNonzeroArea:function(){return this.getWidth()>0&&this.getHeight()>0},isValid:function(){return!this.isEmpty()&&this.isFinite()},closestPointTo:function(t){if(this.containsCoordinates(t.x,t.y))return t;var e=Math.max(Math.min(t.x,this.maxX),this.x),i=Math.max(Math.min(t.y,this.maxY),this.y);return new r(e,i)},containsCoordinates:function(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY},containsPoint:function(t){return this.containsCoordinates(t.x,t.y)},containsBounds:function(t){return this.minX<=t.minX&&this.maxX>=t.maxX&&this.minY<=t.minY&&this.maxY>=t.maxY},intersectsBounds:function(t){var e=Math.max(this.minX,t.minX),i=Math.max(this.minY,t.minY),n=Math.min(this.maxX,t.maxX),s=Math.min(this.maxY,t.maxY);return n-e>=0&&s-i>=0},minimumDistanceToPointSquared:function(t){var e,i=t.x<this.minX?this.minX:t.x>this.maxX?this.maxX:null,n=t.y<this.minY?this.minY:t.y>this.maxY?this.maxY:null;if(null===i&&null===n)return 0;if(null===i)return(e=n-t.y)*e;if(null===n)return(e=i-t.x)*e;var s=i-t.x,r=n-t.y;return s*s+r*r},maximumDistanceToPointSquared:function(t){var e=t.x>this.getCenterX()?this.minX:this.maxX,i=t.y>this.getCenterY()?this.minY:this.maxY;return e-=t.x,i-=t.y,e*e+i*i},toString:function(){return"[x:("+this.minX+","+this.maxX+"),y:("+this.minY+","+this.maxY+")]"},equals:function(t){return this.minX===t.minX&&this.minY===t.minY&&this.maxX===t.maxX&&this.maxY===t.maxY},equalsEpsilon:function(t,e){e=void 0!==e?e:0;var i=this.isFinite(),n=t.isFinite();return i&&n?Math.abs(this.minX-t.minX)<e&&Math.abs(this.minY-t.minY)<e&&Math.abs(this.maxX-t.maxX)<e&&Math.abs(this.maxY-t.maxY)<e:i===n&&(this===t||(isFinite(this.minX+t.minX)?Math.abs(this.minX-t.minX)<e:this.minX===t.minX)&&(isFinite(this.minY+t.minY)?Math.abs(this.minY-t.minY)<e:this.minY===t.minY)&&(isFinite(this.maxX+t.maxX)?Math.abs(this.maxX-t.maxX)<e:this.maxX===t.maxX)&&(isFinite(this.maxY+t.maxY)?Math.abs(this.maxY-t.maxY)<e:this.maxY===t.maxY))},copy:function(t){return t?t.set(this):new e(this.minX,this.minY,this.maxX,this.maxY)},union:function(t){return new e(Math.min(this.minX,t.minX),Math.min(this.minY,t.minY),Math.max(this.maxX,t.maxX),Math.max(this.maxY,t.maxY))},intersection:function(t){return new e(Math.max(this.minX,t.minX),Math.max(this.minY,t.minY),Math.min(this.maxX,t.maxX),Math.min(this.maxY,t.maxY))},withCoordinates:function(t,i){return new e(Math.min(this.minX,t),Math.min(this.minY,i),Math.max(this.maxX,t),Math.max(this.maxY,i))},withPoint:function(t){return this.withCoordinates(t.x,t.y)},withX:function(t){return this.copy().addX(t)},withY:function(t){return this.copy().addY(t)},withMinX:function(t){return new e(t,this.minY,this.maxX,this.maxY)},withMinY:function(t){return new e(this.minX,t,this.maxX,this.maxY)},withMaxX:function(t){return new e(this.minX,this.minY,t,this.maxY)},withMaxY:function(t){return new e(this.minX,this.minY,this.maxX,t)},roundedOut:function(){return new e(Math.floor(this.minX),Math.floor(this.minY),Math.ceil(this.maxX),Math.ceil(this.maxY))},roundedIn:function(){return new e(Math.ceil(this.minX),Math.ceil(this.minY),Math.floor(this.maxX),Math.floor(this.maxY))},transformed:function(t){return this.copy().transform(t)},dilated:function(t){return new e(this.minX-t,this.minY-t,this.maxX+t,this.maxY+t)},dilatedX:function(t){return new e(this.minX-t,this.minY,this.maxX+t,this.maxY)},dilatedY:function(t){return new e(this.minX,this.minY-t,this.maxX,this.maxY+t)},dilatedXY:function(t,i){return new e(this.minX-t,this.minY-i,this.maxX+t,this.maxY+i)},eroded:function(t){return this.dilated(-t)},erodedX:function(t){return this.dilatedX(-t)},erodedY:function(t){return this.dilatedY(-t)},erodedXY:function(t,e){return this.dilatedXY(-t,-e)},withOffsets:function(t,i,n,s){return new e(this.minX-t,this.minY-i,this.maxX+n,this.maxY+s)},shiftedX:function(t){return new e(this.minX+t,this.minY,this.maxX+t,this.maxY)},shiftedY:function(t){return new e(this.minX,this.minY+t,this.maxX,this.maxY+t)},shifted:function(t,i){return new e(this.minX+t,this.minY+i,this.maxX+t,this.maxY+i)},blend:function(t,i){var n=1-i;return new e(n*this.minX+i*t.minX,n*this.minY+i*t.minY,n*this.maxX+i*t.maxX,n*this.maxY+i*t.maxY)},setMinMax:function(t,e,i,n){return this.minX=t,this.minY=e,this.maxX=i,this.maxY=n,this},setMinX:function(t){return this.minX=t,this},setMinY:function(t){return this.minY=t,this},setMaxX:function(t){return this.maxX=t,this},setMaxY:function(t){return this.maxY=t,this},set:function(t){return this.setMinMax(t.minX,t.minY,t.maxX,t.maxY)},includeBounds:function(t){return this.setMinMax(Math.min(this.minX,t.minX),Math.min(this.minY,t.minY),Math.max(this.maxX,t.maxX),Math.max(this.maxY,t.maxY))},constrainBounds:function(t){return this.setMinMax(Math.max(this.minX,t.minX),Math.max(this.minY,t.minY),Math.min(this.maxX,t.maxX),Math.min(this.maxY,t.maxY))},addCoordinates:function(t,e){return this.setMinMax(Math.min(this.minX,t),Math.min(this.minY,e),Math.max(this.maxX,t),Math.max(this.maxY,e))},addPoint:function(t){return this.addCoordinates(t.x,t.y)},addX:function(t){return this.minX=Math.min(t,this.minX),this.maxX=Math.max(t,this.maxX),this},addY:function(t){return this.minY=Math.min(t,this.minY),this.maxY=Math.max(t,this.maxY),this},roundOut:function(){return this.setMinMax(Math.floor(this.minX),Math.floor(this.minY),Math.ceil(this.maxX),Math.ceil(this.maxY))},roundIn:function(){return this.setMinMax(Math.ceil(this.minX),Math.ceil(this.minY),Math.floor(this.maxX),Math.floor(this.maxY))},transform:function(t){if(this.isEmpty())return this;if(t.isIdentity())return this;var e=this.minX,n=this.minY,s=this.maxX,r=this.maxY;return this.set(i.Bounds2.NOTHING),this.addPoint(t.multiplyVector2(a.setXY(e,n))),this.addPoint(t.multiplyVector2(a.setXY(e,r))),this.addPoint(t.multiplyVector2(a.setXY(s,n))),this.addPoint(t.multiplyVector2(a.setXY(s,r))),this},dilate:function(t){return this.setMinMax(this.minX-t,this.minY-t,this.maxX+t,this.maxY+t)},dilateX:function(t){return this.setMinMax(this.minX-t,this.minY,this.maxX+t,this.maxY)},dilateY:function(t){return this.setMinMax(this.minX,this.minY-t,this.maxX,this.maxY+t)},dilateXY:function(t,e){return this.setMinMax(this.minX-t,this.minY-e,this.maxX+t,this.maxY+e)},erode:function(t){return this.dilate(-t)},erodeX:function(t){return this.dilateX(-t)},erodeY:function(t){return this.dilateY(-t)},erodeXY:function(t,e){return this.dilateXY(-t,-e)},offset:function(t,i,n,s){return new e(this.minX-t,this.minY-i,this.maxX+n,this.maxY+s)},shiftX:function(t){return this.setMinMax(this.minX+t,this.minY,this.maxX+t,this.maxY)},shiftY:function(t){return this.setMinMax(this.minX,this.minY+t,this.maxX,this.maxY+t)},shift:function(t,e){return this.setMinMax(this.minX+t,this.minY+e,this.maxX+t,this.maxY+e)},getClosestPoint:function(t,e,n){return n?n.setXY(t,e):n=new i.Vector2(t,e),n.x<this.minX&&(n.x=this.minX),n.x>this.maxX&&(n.x=this.maxX),n.y<this.minY&&(n.y=this.minY),n.y>this.maxY&&(n.y=this.maxY),n}},{rect:function(t,i,n,s){return new e(t,i,t+n,i+s)},point:function(t,n){if(t instanceof i.Vector2){var s=t;return new e(s.x,s.y,s.x,s.y)}return new e(t,n,t,n)}}),s.mixInto(e,{initialize:e.prototype.setMinMax}),e.NOTHING=new e(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),e.EVERYTHING=new e(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),e}),i("DOT/BinPacker",["require","DOT/Bounds2","DOT/dot","PHET_CORE/inherit"],function(t){"use strict";function e(t){this.rootBin=new n.BinPacker.Bin(t,null)}var i=t("DOT/Bounds2"),n=t("DOT/dot"),s=t("PHET_CORE/inherit");return n.register("BinPacker",e),s(Object,e,{allocate:function(t,e){var i=this.rootBin.findAvailableBin(t,e);if(i){var n=i.split(t,e);return n.use(),n}return null},deallocate:function(t){t.unuse()},toString:function(){function t(n){e+=i+n.toString()+"\n",i+="  ",_.each(n.children,t),i=i.substring(2)}var e="",i="";return t(this.rootBin),e}}),e.Bin=function(t,e){this.bounds=t,this.parent=e,this.isSplit=!1,this.isUsed=!1,this.children=[]},s(Object,e.Bin,{findAvailableBin:function(t,e){if(this.isUsed)return null;if(this.bounds.width<t||this.bounds.height<e)return null;if(this.isSplit){for(var i=0;i<this.children.length;i++){var n=this.children[i].findAvailableBin(t,e);if(n)return n}return null}return this},split:function(t,e){if(t===this.bounds.width&&e===this.bounds.height)return this;this.isSplit=!0;var s=this.bounds.minX+t,r=this.bounds.minY+e,a=new i(this.bounds.minX,this.bounds.minY,s,r),o=new i(s,this.bounds.minY,this.bounds.maxX,r),h=new i(this.bounds.minX,r,this.bounds.maxX,this.bounds.maxY),l=new n.BinPacker.Bin(a,this);return this.children.push(l),o.hasNonzeroArea()&&this.children.push(new n.BinPacker.Bin(o,this)),h.hasNonzeroArea()&&this.children.push(new n.BinPacker.Bin(h,this)),l},use:function(){this.isUsed=!0},unuse:function(){this.isUsed=!1,this.parent&&this.parent.attemptToCollapse()},attemptToCollapse:function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.isSplit||e.isUsed)return}this.children=[],this.isSplit=!1,this.parent&&this.parent.attemptToCollapse()},toString:function(){return this.bounds.toString()+(this.isUsed?" used":"")}}),e}),i("DOT/Vector4",["require","DOT/dot","PHET_CORE/inherit","PHET_CORE/Poolable","DOT/Util"],function(t){"use strict";function e(t,e,i,n){this.x=t,this.y=e,this.z=i,this.w=n}var i=t("DOT/dot"),n=t("PHET_CORE/inherit"),s=t("PHET_CORE/Poolable");t("DOT/Util"),i.register("Vector4",e),n(Object,e,{isVector4:!0,dimension:4,getMagnitude:function(){return Math.sqrt(this.magnitudeSquared())},get magnitude(){return this.getMagnitude()},magnitudeSquared:function(){this.dot(this)},distance:function(t){return this.minus(t).magnitude},distanceXYZW:function(t,e,i,n){var s=this.x-t,r=this.y-e,a=this.z-i,o=this.w-n;return Math.sqrt(s*s+r*r+a*a+o*o)},distanceSquared:function(t){return this.minus(t).magnitudeSquared()},distanceSquaredXYZW:function(t,e,i,n){var s=this.x-t,r=this.y-e,a=this.z-i,o=this.w-n;return s*s+r*r+a*a+o*o},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},dotXYZW:function(t,e,i,n){return this.x*t+this.y*e+this.z*i+this.w*n},angleBetween:function(t){return Math.acos(i.clamp(this.normalized().dot(t.normalized()),-1,1))},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},equalsEpsilon:function(t,e){return e||(e=0),Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)+Math.abs(this.w-t.w)<=e},isFinite:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.z)&&isFinite(this.w)}),copy:function(t){return t?t.set(this):new e(this.x,this.y,this.z,this.w)},normalized:function(){var t=this.magnitude;return this.dividedScalar(t)},roundedSymmetric:function(){return this.copy().roundSymmetric()},withMagnitude:function(t){return this.copy().setMagnitude(t)},timesScalar:function(t){return new e(this.x*t,this.y*t,this.z*t,this.w*t)},times:function(t){return this.timesScalar(t)},componentTimes:function(t){return new e(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},plus:function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},plusXYZW:function(t,i,n,s){return new e(this.x+t,this.y+i,this.z+n,this.w+s)},plusScalar:function(t){return new e(this.x+t,this.y+t,this.z+t,this.w+t)},minus:function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},minusXYZW:function(t,i,n,s){return new e(this.x-t,this.y-i,this.z-n,this.w-s)},minusScalar:function(t){return new e(this.x-t,this.y-t,this.z-t,this.w-t)},dividedScalar:function(t){return new e(this.x/t,this.y/t,this.z/t,this.w/t)},negated:function(){return new e(-this.x,-this.y,-this.z,-this.w)},blend:function(t,e){return this.plus(t.minus(this).times(e))},average:function(t){return this.blend(t,.5)},toString:function(){return"Vector4("+this.x+", "+this.y+", "+this.z+", "+this.w+")"},toVector3:function(){return new i.Vector3(this.x,this.y,this.z)},setXYZW:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},set:function(t){return this.setXYZW(t.x,t.y,t.z,t.w)},setMagnitude:function(t){var e=t/this.magnitude;return this.multiplyScalar(e)},add:function(t){return this.setXYZW(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},addXYZW:function(t,e,i,n){return this.setXYZW(this.x+t,this.y+e,this.z+i,this.w+n)},addScalar:function(t){return this.setXYZW(this.x+t,this.y+t,this.z+t,this.w+t)},subtract:function(t){return this.setXYZW(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},subtractXYZW:function(t,e,i,n){return this.setXYZW(this.x-t,this.y-e,this.z-i,this.w-n)},subtractScalar:function(t){return this.setXYZW(this.x-t,this.y-t,this.z-t,this.w-t)},multiplyScalar:function(t){return this.setXYZW(this.x*t,this.y*t,this.z*t,this.w*t)},multiply:function(t){return this.multiplyScalar(t)},componentMultiply:function(t){return this.setXYZW(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},divideScalar:function(t){return this.setXYZW(this.x/t,this.y/t,this.z/t,this.w/t)},negate:function(){return this.setXYZW(-this.x,-this.y,-this.z,-this.w)},normalize:function(){var t=this.magnitude;if(0===t)throw new Error("Cannot normalize a zero-magnitude vector");return this.divideScalar(t)},roundSymmetric:function(){return this.setXYZW(i.Util.roundSymmetric(this.x),i.Util.roundSymmetric(this.y),i.Util.roundSymmetric(this.z),i.Util.roundSymmetric(this.w))}}),s.mixInto(e,{initialize:e.prototype.setXYZW,defaultArguments:[0,0,0,0]});var r=e.Immutable=function(t,e,i,n){this.x=void 0!==t?t:0,this.y=void 0!==e?e:0,this.z=void 0!==i?i:0,this.w=void 0!==n?n:1};return n(e,r),r.mutableOverrideHelper=function(t){r.prototype[t]=function(){throw new Error("Cannot call mutable method '"+t+"' on immutable Vector4")}},r.mutableOverrideHelper("setXYZW"),r.mutableOverrideHelper("setX"),r.mutableOverrideHelper("setY"),r.mutableOverrideHelper("setZ"),r.mutableOverrideHelper("setW"),e.ZERO=new e(0,0,0,0),e.X_UNIT=new e(1,0,0,0),e.Y_UNIT=new e(0,1,0,0),e.Z_UNIT=new e(0,0,1,0),e.W_UNIT=new e(0,0,0,1),e}),i("DOT/Vector3",["require","DOT/dot","PHET_CORE/inherit","PHET_CORE/Poolable","DOT/Util","DOT/Vector2","DOT/Vector4"],function(t){"use strict";function e(t,e,i){this.x=t,this.y=e,this.z=i}var i=t("DOT/dot"),n=t("PHET_CORE/inherit"),s=t("PHET_CORE/Poolable");t("DOT/Util"),t("DOT/Vector2"),t("DOT/Vector4"),i.register("Vector3",e),n(Object,e,{isVector3:!0,dimension:3,getMagnitude:function(){return Math.sqrt(this.magnitudeSquared())},get magnitude(){return this.getMagnitude()},magnitudeSquared:function(){return this.dot(this)},distance:function(t){return Math.sqrt(this.distanceSquared(t))},distanceXYZ:function(t,e,i){var n=this.x-t,s=this.y-e,r=this.z-i;return Math.sqrt(n*n+s*s+r*r)},distanceSquared:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n},distanceSquaredXYZ:function(t,e,i){var n=this.x-t,s=this.y-e,r=this.z-i;return n*n+s*s+r*r},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},dotXYZ:function(t,e,i){return this.x*t+this.y*e+this.z*i},angleBetween:function(t){return Math.acos(i.clamp(this.normalized().dot(t.normalized()),-1,1))},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},equalsEpsilon:function(t,e){return e||(e=0),Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)<=e},isFinite:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.z)}),copy:function(t){return t?t.set(this):new e(this.x,this.y,this.z)},cross:function(t){return new e(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},normalized:function(){var t=this.magnitude;if(0===t)throw new Error("Cannot normalize a zero-magnitude vector");return new e(this.x/t,this.y/t,this.z/t)},roundedSymmetric:function(){return this.copy().roundSymmetric()},withMagnitude:function(t){return this.copy().setMagnitude(t)},timesScalar:function(t){return new e(this.x*t,this.y*t,this.z*t)},times:function(t){return this.timesScalar(t)},componentTimes:function(t){return new e(this.x*t.x,this.y*t.y,this.z*t.z)},plus:function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z)},plusXYZ:function(t,i,n){return new e(this.x+t,this.y+i,this.z+n)},plusScalar:function(t){return new e(this.x+t,this.y+t,this.z+t)},minus:function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z)},minusXYZ:function(t,i,n){return new e(this.x-t,this.y-i,this.z-n)},minusScalar:function(t){return new e(this.x-t,this.y-t,this.z-t)},dividedScalar:function(t){return new e(this.x/t,this.y/t,this.z/t)},negated:function(){return new e(-this.x,-this.y,-this.z)},blend:function(t,e){return this.plus(t.minus(this).times(e))},average:function(t){return this.blend(t,.5)},toString:function(){return"Vector3("+this.x+", "+this.y+", "+this.z+")"},toVector2:function(){return new i.Vector2(this.x,this.y)},toVector4:function(){return new i.Vector4(this.x,this.y,this.z,1)},setXYZ:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},set:function(t){return this.setXYZ(t.x,t.y,t.z)},setMagnitude:function(t){var e=t/this.magnitude;return this.multiplyScalar(e)},add:function(t){return this.setXYZ(this.x+t.x,this.y+t.y,this.z+t.z)},addXYZ:function(t,e,i){return this.setXYZ(this.x+t,this.y+e,this.z+i)},addScalar:function(t){return this.setXYZ(this.x+t,this.y+t,this.z+t)},subtract:function(t){return this.setXYZ(this.x-t.x,this.y-t.y,this.z-t.z)},subtractXYZ:function(t,e,i){return this.setXYZ(this.x-t,this.y-e,this.z-i)},subtractScalar:function(t){return this.setXYZ(this.x-t,this.y-t,this.z-t)},multiplyScalar:function(t){return this.setXYZ(this.x*t,this.y*t,this.z*t)},multiply:function(t){return this.multiplyScalar(t)},componentMultiply:function(t){return this.setXYZ(this.x*t.x,this.y*t.y,this.z*t.z)},divideScalar:function(t){return this.setXYZ(this.x/t,this.y/t,this.z/t)},negate:function(){return this.setXYZ(-this.x,-this.y,-this.z)},normalize:function(){var t=this.magnitude;if(0===t)throw new Error("Cannot normalize a zero-magnitude vector");return this.divideScalar(t)},roundSymmetric:function(){return this.setXYZ(i.Util.roundSymmetric(this.x),i.Util.roundSymmetric(this.y),i.Util.roundSymmetric(this.z))}},{slerp:function(t,e,n){return i.Quaternion.slerp(new i.Quaternion,i.Quaternion.getRotationQuaternion(t,e),n).timesVector3(t)}}),s.mixInto(e,{initialize:e.prototype.setXYZ,defaultArguments:[0,0,0]});var r=e.Immutable=function(t,e,i){this.x=void 0!==t?t:0,this.y=void 0!==e?e:0,this.z=void 0!==i?i:0};return n(e,r),r.mutableOverrideHelper=function(t){r.prototype[t]=function(){throw new Error("Cannot call mutable method '"+t+"' on immutable Vector3")}},r.mutableOverrideHelper("setXYZ"),r.mutableOverrideHelper("setX"),r.mutableOverrideHelper("setY"),r.mutableOverrideHelper("setZ"),e.ZERO=new e(0,0,0),e.X_UNIT=new e(1,0,0),e.Y_UNIT=new e(0,1,0),e.Z_UNIT=new e(0,0,1),e}),i("DOT/Bounds3",["require","DOT/dot","PHET_CORE/inherit","PHET_CORE/Poolable","DOT/Vector3"],function(t){"use strict";function e(t,e,i,n,s,r){this.minX=t,this.minY=e,this.minZ=i,this.maxX=n,this.maxY=s,this.maxZ=r}var i=t("DOT/dot"),n=t("PHET_CORE/inherit"),s=t("PHET_CORE/Poolable");return t("DOT/Vector3"),i.register("Bounds3",e),n(Object,e,{isBounds:!0,dimension:3,getWidth:function(){return this.maxX-this.minX},get width(){return this.getWidth()},getHeight:function(){return this.maxY-this.minY},get height(){return this.getHeight()},getDepth:function(){return this.maxZ-this.minZ},get depth(){return this.getDepth()},getX:function(){return this.minX},get x(){return this.getX()},getY:function(){return this.minY},get y(){return this.getY()},getZ:function(){return this.minZ},get z(){return this.getZ()},getMinX:function(){return this.minX},getMinY:function(){return this.minY},getMinZ:function(){return this.minZ},getMaxX:function(){return this.maxX},getMaxY:function(){return this.maxY},getMaxZ:function(){return this.maxZ},getLeft:function(){return this.minX},get left(){return this.minX},getTop:function(){return this.minY},get top(){return this.minY},getBack:function(){return this.minZ},get back(){return this.minZ},getRight:function(){return this.maxX},get right(){return this.maxX},getBottom:function(){return this.maxY},get bottom(){return this.maxY},getFront:function(){return this.maxZ},get front(){return this.maxZ},getCenterX:function(){return(this.maxX+this.minX)/2},get centerX(){return this.getCenterX()},getCenterY:function(){return(this.maxY+this.minY)/2},get centerY(){return this.getCenterY()},getCenterZ:function(){return(this.maxZ+this.minZ)/2},get centerZ(){return this.getCenterZ()},getCenter:function(){return new i.Vector3(this.getCenterX(),this.getCenterY(),this.getCenterZ())},get center(){return this.getCenter()},isEmpty:function(){return this.getWidth()<0||this.getHeight()<0||this.getDepth()<0},isFinite:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){return isFinite(this.minX)&&isFinite(this.minY)&&isFinite(this.minZ)&&isFinite(this.maxX)&&isFinite(this.maxY)&&isFinite(this.maxZ)}),hasNonzeroArea:function(){return this.getWidth()>0&&this.getHeight()>0&&this.getDepth()>0},isValid:function(){return!this.isEmpty()&&this.isFinite()},containsCoordinates:function(t,e,i){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY&&this.minZ<=i&&i<=this.maxZ},containsPoint:function(t){return this.containsCoordinates(t.x,t.y,t.z)},containsBounds:function(t){return this.minX<=t.minX&&this.maxX>=t.maxX&&this.minY<=t.minY&&this.maxY>=t.maxY&&this.minZ<=t.minZ&&this.maxZ>=t.maxZ},intersectsBounds:function(t){return!this.intersection(t).isEmpty()},toString:function(){return"[x:("+this.minX+","+this.maxX+"),y:("+this.minY+","+this.maxY+"),z:("+this.minZ+","+this.maxZ+")]"},equals:function(t){return this.minX===t.minX&&this.minY===t.minY&&this.minZ===t.minZ&&this.maxX===t.maxX&&this.maxY===t.maxY&&this.maxZ===t.maxZ},equalsEpsilon:function(t,e){e=void 0!==e?e:0;var i=this.isFinite(),n=t.isFinite();return i&&n?Math.abs(this.minX-t.minX)<e&&Math.abs(this.minY-t.minY)<e&&Math.abs(this.minZ-t.minZ)<e&&Math.abs(this.maxX-t.maxX)<e&&Math.abs(this.maxY-t.maxY)<e&&Math.abs(this.maxZ-t.maxZ)<e:i===n&&(this===t||(isFinite(this.minX+t.minX)?Math.abs(this.minX-t.minX)<e:this.minX===t.minX)&&(isFinite(this.minY+t.minY)?Math.abs(this.minY-t.minY)<e:this.minY===t.minY)&&(isFinite(this.minZ+t.minZ)?Math.abs(this.minZ-t.minZ)<e:this.minZ===t.minZ)&&(isFinite(this.maxX+t.maxX)?Math.abs(this.maxX-t.maxX)<e:this.maxX===t.maxX)&&(isFinite(this.maxY+t.maxY)?Math.abs(this.maxY-t.maxY)<e:this.maxY===t.maxY)&&(isFinite(this.maxZ+t.maxZ)?Math.abs(this.maxZ-t.maxZ)<e:this.maxZ===t.maxZ))},copy:function(t){return t?t.set(this):new e(this.minX,this.minY,this.minZ,this.maxX,this.maxY,this.maxZ)},union:function(t){return new e(Math.min(this.minX,t.minX),Math.min(this.minY,t.minY),Math.min(this.minZ,t.minZ),Math.max(this.maxX,t.maxX),Math.max(this.maxY,t.maxY),Math.max(this.maxZ,t.maxZ))},intersection:function(t){return new e(Math.max(this.minX,t.minX),Math.max(this.minY,t.minY),Math.max(this.minZ,t.minZ),Math.min(this.maxX,t.maxX),Math.min(this.maxY,t.maxY),Math.min(this.maxZ,t.maxZ))},withCoordinates:function(t,i,n){return new e(Math.min(this.minX,t),Math.min(this.minY,i),Math.min(this.minZ,n),Math.max(this.maxX,t),Math.max(this.maxY,i),Math.max(this.maxZ,n))},withPoint:function(t){return this.withCoordinates(t.x,t.y,t.z)},withMinX:function(t){return new e(t,this.minY,this.minZ,this.maxX,this.maxY,this.maxZ)},withMinY:function(t){return new e(this.minX,t,this.minZ,this.maxX,this.maxY,this.maxZ)},withMinZ:function(t){return new e(this.minX,this.minY,t,this.maxX,this.maxY,this.maxZ)},withMaxX:function(t){return new e(this.minX,this.minY,this.minZ,t,this.maxY,this.maxZ)},withMaxY:function(t){return new e(this.minX,this.minY,this.minZ,this.maxX,t,this.maxZ)},withMaxZ:function(t){return new e(this.minX,this.minY,this.minZ,this.maxX,this.maxY,t)},roundedOut:function(){return new e(Math.floor(this.minX),Math.floor(this.minY),Math.floor(this.minZ),Math.ceil(this.maxX),Math.ceil(this.maxY),Math.ceil(this.maxZ))},roundedIn:function(){return new e(Math.ceil(this.minX),Math.ceil(this.minY),Math.ceil(this.minZ),Math.floor(this.maxX),Math.floor(this.maxY),Math.floor(this.maxZ))},transformed:function(t){return this.copy().transform(t)},dilated:function(t){return new e(this.minX-t,this.minY-t,this.minZ-t,this.maxX+t,this.maxY+t,this.maxZ+t)},dilatedX:function(t){return new e(this.minX-t,this.minY,this.minZ,this.maxX+t,this.maxY,this.maxZ)},dilatedY:function(t){return new e(this.minX,this.minY-t,this.minZ,this.maxX,this.maxY+t,this.maxZ)},dilatedZ:function(t){return new e(this.minX,this.minY,this.minZ-t,this.maxX,this.maxY,this.maxZ+t)},dilatedXYZ:function(t,i,n){return new e(this.minX-t,this.minY-i,this.minZ-n,this.maxX+t,this.maxY+i,this.maxZ+n)},eroded:function(t){return this.dilated(-t)},erodedX:function(t){return this.dilatedX(-t)},erodedY:function(t){return this.dilatedY(-t)},erodedZ:function(t){return this.dilatedZ(-t)},erodedXYZ:function(t,e,i){return this.dilatedXYZ(-t,-e,-i)},shiftedX:function(t){return new e(this.minX+t,this.minY,this.minZ,this.maxX+t,this.maxY,this.maxZ)},shiftedY:function(t){return new e(this.minX,this.minY+t,this.minZ,this.maxX,this.maxY+t,this.maxZ)},shiftedZ:function(t){return new e(this.minX,this.minY,this.minZ+t,this.maxX,this.maxY,this.maxZ+t)},shifted:function(t,i,n){return new e(this.minX+t,this.minY+i,this.minZ+n,this.maxX+t,this.maxY+i,this.maxZ+n)},setMinMax:function(t,e,i,n,s,r){return this.minX=t,this.minY=e,this.minZ=i,this.maxX=n,this.maxY=s,this.maxZ=r,this},setMinX:function(t){return this.minX=t,this},setMinY:function(t){return this.minY=t,this},setMinZ:function(t){return this.minZ=t,this},setMaxX:function(t){return this.maxX=t,this},setMaxY:function(t){return this.maxY=t,this},setMaxZ:function(t){return this.maxZ=t,this},set:function(t){return this.setMinMax(t.minX,t.minY,t.minZ,t.maxX,t.maxY,t.maxZ)},includeBounds:function(t){return this.setMinMax(Math.min(this.minX,t.minX),Math.min(this.minY,t.minY),Math.min(this.minZ,t.minZ),Math.max(this.maxX,t.maxX),Math.max(this.maxY,t.maxY),Math.max(this.maxZ,t.maxZ))},constrainBounds:function(t){return this.setMinMax(Math.max(this.minX,t.minX),Math.max(this.minY,t.minY),Math.max(this.minZ,t.minZ),Math.min(this.maxX,t.maxX),Math.min(this.maxY,t.maxY),Math.min(this.maxZ,t.maxZ))},addCoordinates:function(t,e,i){return this.setMinMax(Math.min(this.minX,t),Math.min(this.minY,e),Math.min(this.minZ,i),Math.max(this.maxX,t),Math.max(this.maxY,e),Math.max(this.maxZ,i))},addPoint:function(t){return this.addCoordinates(t.x,t.y,t.z)},roundOut:function(){return this.setMinMax(Math.floor(this.minX),Math.floor(this.minY),Math.floor(this.minZ),Math.ceil(this.maxX),Math.ceil(this.maxY),Math.ceil(this.maxZ))},roundIn:function(){return this.setMinMax(Math.ceil(this.minX),Math.ceil(this.minY),Math.ceil(this.minZ),Math.floor(this.maxX),Math.floor(this.maxY),Math.floor(this.maxZ))},transform:function(t){function e(t){n=Math.min(n,t.x),s=Math.min(s,t.y),r=Math.min(r,t.z),a=Math.max(a,t.x),o=Math.max(o,t.y),h=Math.max(h,t.z)}if(this.isEmpty())return this;if(t.isIdentity())return this;var n=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY,l=new i.Vector3(0,0,0);return e(t.multiplyVector3(l.setXYZ(this.minX,this.minY,this.minZ))),e(t.multiplyVector3(l.setXYZ(this.minX,this.maxY,this.minZ))),e(t.multiplyVector3(l.setXYZ(this.maxX,this.minY,this.minZ))),e(t.multiplyVector3(l.setXYZ(this.maxX,this.maxY,this.minZ))),e(t.multiplyVector3(l.setXYZ(this.minX,this.minY,this.maxZ))),e(t.multiplyVector3(l.setXYZ(this.minX,this.maxY,this.maxZ))),e(t.multiplyVector3(l.setXYZ(this.maxX,this.minY,this.maxZ))),e(t.multiplyVector3(l.setXYZ(this.maxX,this.maxY,this.maxZ))),this.setMinMax(n,s,r,a,o,h)},dilate:function(t){return this.setMinMax(this.minX-t,this.minY-t,this.minZ-t,this.maxX+t,this.maxY+t,this.maxZ+t)},dilateX:function(t){return this.setMinMax(this.minX-t,this.minY,this.minZ,this.maxX+t,this.maxY,this.maxZ)},dilateY:function(t){return this.setMinMax(this.minX,this.minY-t,this.minZ,this.maxX,this.maxY+t,this.maxZ)},dilateZ:function(t){return this.setMinMax(this.minX,this.minY,this.minZ-t,this.maxX,this.maxY,this.maxZ+t)},dilateXYZ:function(t,e,i){return this.setMinMax(this.minX-t,this.minY-e,this.minZ-i,this.maxX+t,this.maxY+e,this.maxZ+i)},erode:function(t){return this.dilate(-t)},erodeX:function(t){return this.dilateX(-t)},erodeY:function(t){return this.dilateY(-t)},erodeZ:function(t){return this.dilateZ(-t)},erodeXYZ:function(t,e,i){return this.dilateXYZ(-t,-e,-i)},shiftX:function(t){return this.setMinMax(this.minX+t,this.minY,this.minZ,this.maxX+t,this.maxY,this.maxZ)},shiftY:function(t){return this.setMinMax(this.minX,this.minY+t,this.minZ,this.maxX,this.maxY+t,this.maxZ)},shiftZ:function(t){return this.setMinMax(this.minX,this.minY,this.minZ+t,this.maxX,this.maxY,this.maxZ+t)},shift:function(t,e,i){return this.setMinMax(this.minX+t,this.minY+e,this.minZ+i,this.maxX+t,this.maxY+e,this.maxZ+i)}},{cuboid:function(t,i,n,s,r,a){return new e(t,i,n,t+s,i+r,n+a)},point:function(t,i,n){return new e(t,i,n,t,i,n)}}),s.mixInto(e,{initialize:e.prototype.setMinMax}),e.NOTHING=new e(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),e.EVERYTHING=new e(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),e}),i("DOT/Complex",["require","DOT/dot","DOT/Util","PHET_CORE/inherit"],function(t){"use strict";function e(t,e){this.real=t,this.imaginary=e}var i=t("DOT/dot");t("DOT/Util");var n=t("PHET_CORE/inherit");return i.register("Complex",e),n(Object,e,{copy:function(t){return t?t.set(this):new e(this.real,this.imaginary)},phase:function(){return Math.atan2(this.imaginary,this.real)},getMagnitude:function(){return Math.sqrt(this.magnitudeSquared())},get magnitude(){return this.getMagnitude()},magnitudeSquared:function(){return this.real*this.real+this.imaginary*this.imaginary},equals:function(t){return this.real===t.real&&this.imaginary===t.imaginary},equalsEpsilon:function(t,e){return e||(e=0),Math.max(Math.abs(this.real-t.real),Math.abs(this.imaginary-t.imaginary))<=e},plus:function(t){return new e(this.real+t.real,this.imaginary+t.imaginary)},minus:function(t){return new e(this.real-t.real,this.imaginary-t.imaginary)},times:function(t){return new e(this.real*t.real-this.imaginary*t.imaginary,this.real*t.imaginary+this.imaginary*t.real)},dividedBy:function(t){var i=t.magnitudeSquared();return new e((this.real*t.real+this.imaginary*t.imaginary)/i,(this.imaginary*t.real-this.real*t.imaginary)/i)},sqrtOf:function(){var t=this.magnitude;return new e(Math.sqrt((t+this.real)/2),(this.imaginary>=0?1:-1)*Math.sqrt((t-this.real)/2))},sinOf:function(){return new e(Math.sin(this.real)*i.Util.cosh(this.imaginary),Math.cos(this.real)*i.Util.sinh(this.imaginary))},cosOf:function(){return new e(Math.cos(this.real)*i.Util.cosh(this.imaginary),-Math.sin(this.real)*i.Util.sinh(this.imaginary))},squared:function(){return this.times(this)},conjugated:function(){return new e(this.real,-this.imaginary)},exponentiated:function(){return e.createPolar(Math.exp(this.real),this.imaginary)},setRealImaginary:function(t,e){return this.real=t,this.imaginary=e,this},setReal:function(t){return this.real=t,this},setImaginary:function(t){return this.imaginary=t,this},set:function(t){return this.setRealImaginary(t.real,t.imaginary)},setPolar:function(t,e){return this.setRealImaginary(t*Math.cos(e),t*Math.sin(e))},add:function(t){return this.setRealImaginary(this.real+t.real,this.imaginary+t.imaginary)},subtract:function(t){return this.setRealImaginary(this.real-t.real,this.imaginary-t.imaginary)},multiply:function(t){return this.setRealImaginary(this.real*t.real-this.imaginary*t.imaginary,this.real*t.imaginary+this.imaginary*t.real)},divide:function(t){var e=t.magnitudeSquared();return this.setRealImaginary((this.real*t.real+this.imaginary*t.imaginary)/e,(this.imaginary*t.real-this.real*t.imaginary)/e)},exponentiate:function(){return this.setPolar(Math.exp(this.real),this.imaginary)},square:function(){return this.multiply(this)},sqrt:function(){var t=this.magnitude;return this.setRealImaginary(Math.sqrt((t+this.real)/2),(this.imaginary>=0?1:-1)*Math.sqrt((t-this.real)/2))},sin:function(){return this.setRealImaginary(Math.sin(this.real)*i.Util.cosh(this.imaginary),Math.cos(this.real)*i.Util.sinh(this.imaginary))},cos:function(){return this.setRealImaginary(Math.cos(this.real)*i.Util.cosh(this.imaginary),-Math.sin(this.real)*i.Util.sinh(this.imaginary))},conjugate:function(){return this.setRealImaginary(this.real,-this.imaginary)},toString:function(){return"Complex("+this.real+", "+this.imaginary+")"}},{real:function(t){return new e(t,0)},imaginary:function(t){return new e(0,t)},createPolar:function(t,i){return new e(t*Math.cos(i),t*Math.sin(i))}}),e.ZERO=new e(0,0),e.ONE=new e(1,0),e.I=e.imaginary(1),e}),i("DOT/ConvexHull2",["require","DOT/dot"],function(t){"use strict";var e={grahamScan:function(t,e){if(t.length<=2)return t;var i=Number.POSITIVE_INFINITY,n=null;_.each(t,function(t){t.y<=i&&(t.y===i&&n?t.x<n.x&&(n=t):(i=t.y,n=t))}),(t=_.sortBy(t,function(t){return t.minus(n).angle})).splice(_.indexOf(t,n),1);var s=[n];return _.each(t,function(t){function i(){if(s.length<2)return!1;var i=function(t,e,i){return e.minus(t).crossScalar(i.minus(t))}(s[s.length-2],s[s.length-1],t);return e?i<0:i<=0}if(n.x!==t.x||n.y!==t.y){for(;i();)s.pop();s.push(t)}}),s}};return t("DOT/dot").register("ConvexHull2",e),e}),i("DOT/DampedHarmonic",["require","DOT/dot","PHET_CORE/inherit"],function(t){"use strict";function e(t,i,n,s,r){this.dampingConstant=i/t,this.angularFrequencySquared=n/t,this.discriminant=this.dampingConstant*this.dampingConstant-4*this.angularFrequencySquared,this.solutionType=0,this.c1=0,this.c2=0,Math.abs(this.discriminant)<1e-5?(this.solutionType=e.CRITICALLY_DAMPED,this.angularFrequency=Math.sqrt(this.angularFrequencySquared),this.c1=s,this.c2=r+this.angularFrequency*s):this.discriminant<0?(this.solutionType=e.UNDER_DAMPED,this.frequency=.5*Math.sqrt(-this.discriminant),this.c1=s,this.c2=this.dampingConstant*s/(2*this.frequency)+r/this.frequency):(this.solutionType=e.OVER_DAMPED,this.positiveRoot=.5*(-this.dampingConstant+Math.sqrt(this.discriminant)),this.negativeRoot=.5*(-this.dampingConstant-Math.sqrt(this.discriminant)),this.c2=(this.negativeRoot*s-r)/(this.negativeRoot-this.positiveRoot),this.c1=s-this.c2)}var i=t("DOT/dot"),n=t("PHET_CORE/inherit");return i.register("DampedHarmonic",e),n(Object,e,{getValue:function(t){if(this.solutionType===e.CRITICALLY_DAMPED)return(this.c1+this.c2*t)*Math.exp(-this.angularFrequency*t);if(this.solutionType===e.UNDER_DAMPED){var i=this.frequency*t;return Math.exp(-this.dampingConstant/2*t)*(this.c1*Math.cos(i)+this.c2*Math.sin(i))}if(this.solutionType===e.OVER_DAMPED)return this.c1*Math.exp(this.negativeRoot*t)+this.c2*Math.exp(this.positiveRoot*t);throw new Error("Unknown solution type?")},getDerivative:function(t){if(this.solutionType===e.CRITICALLY_DAMPED)return Math.exp(-this.angularFrequency*t)*(this.c2-this.angularFrequency*(this.c1+this.c2*t));if(this.solutionType===e.UNDER_DAMPED){var i=this.frequency*t,n=Math.cos(i),s=Math.sin(i),r=this.frequency*(this.c2*n-this.c1*s),a=.5*this.dampingConstant*(this.c1*n+this.c2*s);return Math.exp(-.5*this.dampingConstant*t)*(r-a)}if(this.solutionType===e.OVER_DAMPED)return this.c1*this.negativeRoot*Math.exp(this.negativeRoot*t)+this.c2*this.positiveRoot*Math.exp(this.positiveRoot*t);throw new Error("Unknown solution type?")}},{OVER_DAMPED:1,UNDER_DAMPED:2,CRITICALLY_DAMPED:3}),e}),i("PHET_CORE/arrayRemove",["require","PHET_CORE/phetCore"],function(t){"use strict";function e(t,e){var i=_.indexOf(t,e);t.splice(i,1)}return t("PHET_CORE/phetCore").register("arrayRemove",e),e}),i("DOT/DelaunayTriangulation",["require","PHET_CORE/arrayRemove","DOT/Bounds2","DOT/dot","PHET_CORE/inherit","DOT/Util","DOT/Vector2"],function(t){"use strict";function e(t,r,o){o=_.extend({},o);var h;if(this.points=t,this.constraints=r,this.triangles=[],this.edges=[],this.convexHull=[],0!==t.length){for(this.vertices=t.map(function(t,e){return new i(t,e)}),h=0;h<this.constraints.length;h++){var l=this.constraints[h],c=l[0],d=l[1];this.vertices[c].constrainedVertices.push(this.vertices[d])}for(this.vertices.sort(e.vertexComparison),h=0;h<this.vertices.length;h++){var f=this.vertices[h];f.sortedIndex=h;for(var m=f.constrainedVertices.length-1;m>=0;m--){var p=f.constrainedVertices[m];-1===p.sortedIndex&&(p.constrainedVertices.push(f),f.constrainedVertices.splice(m,1))}}this.bottomVertex=this.vertices[0],this.remainingVertices=this.vertices.slice(1);var g=a.NOTHING.copy();for(h=t.length-1;h>=0;h--)g.addPoint(t[h]);this.artificialMinVertex=new i(new u(g.minX-.4*g.width,g.minY-.4*g.height),-1),this.artificialMaxVertex=new i(new u(g.maxX+.4*g.width,g.minY-.4*g.height),-2),this.edges.push(new n(this.artificialMinVertex,this.artificialMaxVertex)),this.edges.push(new n(this.artificialMaxVertex,this.bottomVertex)),this.edges.push(new n(this.bottomVertex,this.artificialMinVertex)),this.triangles.push(new s(this.artificialMinVertex,this.artificialMaxVertex,this.bottomVertex,this.edges[1],this.edges[2],this.edges[0])),this.firstFrontEdge=this.edges[1],this.edges[1].connectAfter(this.edges[2]),this.firstHullEdge=this.edges[0]}}function i(t,e){this.point=t,this.index=e,this.sortedIndex=-1,this.constrainedVertices=[]}function n(t,e){this.startVertex=t,this.endVertex=e,this.triangles=[],this.nextEdge=null,this.previousEdge=null,this.isConstrained=!1}function s(t,e,i,n,s,r){this.aVertex=t,this.bVertex=e,this.cVertex=i,this.aEdge=n,this.bEdge=s,this.cEdge=r,this.aEdge.addTriangle(this),this.bEdge.addTriangle(this),this.cEdge.addTriangle(this)}var r=t("PHET_CORE/arrayRemove"),a=t("DOT/Bounds2"),o=t("DOT/dot"),h=t("PHET_CORE/inherit"),l=t("DOT/Util"),u=t("DOT/Vector2");return o.register("DelaunayTriangulation",e),h(Object,e,{step:function(){for(var t=this.remainingVertices.shift(),e=t.point.x,i=this.firstFrontEdge;i;){if(e>i.endVertex.point.x){var r=new n(i.startVertex,t),a=new n(t,i.endVertex);r.connectAfter(a),this.edges.push(r),this.edges.push(a),this.triangles.push(new s(i.endVertex,i.startVertex,t,r,a,i)),this.reconnectFrontEdges(i,i,r,a),this.legalizeEdge(i),this.addHalfPiHeuristic(r,a),this.constrainEdges(t,r,a);break}if(e===i.endVertex.point.x){var o=i.nextEdge,h=i,l=i.endVertex,u=o.endVertex,c=h.startVertex,d=new n(t,u),f=new n(c,t),m=new n(l,t);f.connectAfter(d),this.edges.push(d),this.edges.push(f),this.edges.push(m),this.triangles.push(new s(u,l,t,m,d,o)),this.triangles.push(new s(l,c,t,f,m,h)),this.reconnectFrontEdges(h,o,f,d),this.legalizeEdge(o),this.legalizeEdge(h),this.legalizeEdge(m),this.addHalfPiHeuristic(f,d),this.constrainEdges(t,f,d);break}i=i.nextEdge}},fillBorderTriangle:function(t,e,i,r,a){var o=new n(i,a);return this.edges.push(o),this.triangles.push(new s(a,r,i,t,o,e)),this.legalizeEdge(t),this.legalizeEdge(e),o},reconnectFrontEdges:function(t,e,i,n){var s=t.previousEdge,r=e.nextEdge;s?(s.disconnectAfter(),s.connectAfter(i)):this.firstFrontEdge=i,r&&(e.disconnectAfter(),n.connectAfter(r))},addHalfPiHeuristic:function(t,e){for(var i=t.endVertex;t.previousEdge&&l.triangleAreaSigned(i.point,t.startVertex.point,t.previousEdge.startVertex.point)>0&&i.point.minus(t.startVertex.point).angleBetween(t.previousEdge.startVertex.point.minus(t.startVertex.point))<Math.PI/2;){var r=t.previousEdge,a=new n(r.startVertex,i);this.edges.push(a),this.triangles.push(new s(i,t.startVertex,r.startVertex,r,a,t)),this.reconnectFrontEdges(r,t,a,a),this.legalizeEdge(r),this.legalizeEdge(t),t=a}for(;e.nextEdge&&l.triangleAreaSigned(i.point,e.nextEdge.endVertex.point,e.endVertex.point)>0&&i.point.minus(e.endVertex.point).angleBetween(e.nextEdge.endVertex.point.minus(e.endVertex.point))<Math.PI/2;){var o=e.nextEdge,h=new n(i,o.endVertex);this.edges.push(h),this.triangles.push(new s(i,e.nextEdge.endVertex,e.endVertex,o,e,h)),this.reconnectFrontEdges(e,o,h,h),this.legalizeEdge(o),this.legalizeEdge(e),e=h}},constrainEdges:function(t,i,s){for(var a=0;a<t.constrainedVertices.length;a++){var o=t.constrainedVertices[a];if(o===i.startVertex||o===s.endVertex)break;var h=[],l=[],u=null,c=null,d=[],f=[],m=e.vertexProduct(t,i.startVertex,o)>0,p=e.vertexProduct(t,s.endVertex,o)<0;if(!m&&!p){var g,v=i.startVertex;for(u=i.triangles[0];e.vertexProduct(t,g=u.getEdgeOppositeFromVertex(t).getOtherVertex(v),o)<0;)u=u.getEdgeOppositeFromVertex(v).getOtherTriangle(u),v=g;if(u.hasVertex(o))break;d.push(u),c=u.getEdgeOppositeFromVertex(t),f.push(c),h.push(u.getEdgeOppositeFromVertex(v)),l.push(u.getEdgeOppositeFromVertex(c.getOtherVertex(v)))}for(;;){if(m)break;if(p)break;if(c.triangles.length>1){var y=c.getOtherTriangle(u);if(y.hasVertex(o)){d.push(y),h.push(y.getNextEdge(c)),l.push(y.getPreviousEdge(c));break}var E;y.aEdge!==c&&y.aEdge.intersectsConstrainedEdge(t,o)?E=y.aEdge:y.bEdge!==c&&y.bEdge.intersectsConstrainedEdge(t,o)?E=y.bEdge:y.cEdge!==c&&y.cEdge.intersectsConstrainedEdge(t,o)&&(E=y.cEdge),y.getNextEdge(E)===c?h.push(y.getPreviousEdge(E)):l.push(y.getNextEdge(E)),c=E,f.push(c),u=y,d.push(u)}else o.point.x<t.point.x?p=!0:m=!0}for(var b=0;b<d.length;b++){var _=d[b];r(this.triangles,_),_.remove()}for(b=0;b<f.length;b++)r(this.edges,f[b]);var S=new n(o,t);S.isConstrained=!0,this.edges.push(S),h.push(S),l.push(S),l.reverse(),window.triDebug&&window.triDebug(this),this.triangulatePolygon(h),this.triangulatePolygon(l)}},triangulatePolygon:function(t){for(;t.length>3;){for(var e=0;e<t.length;e++)t.length;for(var i=0;i<t.length;i++){var r=i<t.length-1?i+1:0,a=t[i],o=t[r],h=a.getSharedVertex(o),u=a.getOtherVertex(h),c=o.getOtherVertex(h);if(!(l.triangleAreaSigned(u.point,h.point,c.point)<=0)){for(var d=c.point.minus(h.point),f=u.point.minus(h.point),m=d.dot(d),p=d.dot(f),g=f.dot(f),v=m*g-p*p,y=t[0].getSharedVertex(t[t.length-1]),E=!1,b=0;b<t.length;b++){var _=t[b].getOtherVertex(y);if(_!==h&&_!==u&&_!==c){var S=_.point.minus(h.point),T=d.dot(S),C=f.dot(S),x=(g*T-p*C)/v,w=(m*C-p*T)/v;if(x>=-1e-10&&w>=-1e-10&&x+w<1+1e-10){E=!0;break}}y=_}if(!E){var R=new n(u,c);this.edges.push(R),this.triangles.push(new s(u,h,c,o,R,a)),r>i?t.splice(i,2,R):(t.splice(i,1,R),t.splice(r,1)),window.triDebug&&window.triDebug(this)}}}}3===t.length&&(this.triangles.push(new s(t[0].getSharedVertex(t[1]),t[1].getSharedVertex(t[2]),t[0].getSharedVertex(t[2]),t[2],t[0],t[1])),window.triDebug&&window.triDebug(this))},finalize:function(){for(var t=[],e=this.firstFrontEdge.nextEdge;e&&e.nextEdge;)t.push(e),e=e.nextEdge;for(var i=this.firstFrontEdge,n=e,s=0;s<t.length-1;s++){var a=t[s],o=t[s+1];if(l.triangleAreaSigned(o.endVertex.point,a.endVertex.point,a.startVertex.point)>1e-10){var h=this.fillBorderTriangle(a,o,a.startVertex,a.endVertex,o.endVertex);t.splice(s,2,h),s=Math.max(s-2,-1),window.triDebug&&window.triDebug(this)}}this.firstFrontEdge=null;for(var u=[],c=[i],d=i;d!==n;){var f=d.triangles[0];f.remove(),r(this.triangles,f);var m=f.getNonArtificialEdge();if(m){u.push(m);var p=m.getSharedVertex(d);d=f.getEdgeOppositeFromVertex(p)}else c.push(f.getEdgeOppositeFromVertex(d.endVertex)),d=f.getEdgeOppositeFromVertex(d.startVertex);c.push(d)}for(s=0;s<c.length;s++)r(this.edges,c[s]);for(window.triDebug&&window.triDebug(this),s=0;s<u.length-1;s++){a=u[s+1],o=u[s],p=a.getSharedVertex(o);var g=a.getOtherVertex(p),v=o.getOtherVertex(p);l.triangleAreaSigned(v.point,p.point,g.point)>1e-10&&(h=this.fillBorderTriangle(a,o,g,p,v),u.splice(s,2,h),s=Math.max(s-2,-1),window.triDebug&&window.triDebug(this))}for(s=0;s<t.length;s++)this.convexHull.push(t[s].startVertex);for(this.convexHull.push(t[t.length-1].endVertex),s=u.length-1;s>=1;s--)this.convexHull.push(u[s].getSharedVertex(u[s-1]))},legalizeEdge:function(t){if(_.includes(this.edges,t)&&2===t.triangles.length&&!t.isConstrained){var e=t.triangles[0],i=t.triangles[1],a=e.getVertexOppositeFromEdge(t),o=i.getVertexOppositeFromEdge(t);if(l.pointInCircleFromPoints(e.aVertex.point,e.bVertex.point,e.cVertex.point,o.point)||l.pointInCircleFromPoints(i.aVertex.point,i.bVertex.point,i.cVertex.point,a.point)){e.remove(),i.remove(),r(this.triangles,e),r(this.triangles,i),r(this.edges,t);var h=new n(a,o);this.edges.push(h);var u=i.getEdgeOppositeFromVertex(i.getVertexBefore(o)),c=e.getEdgeOppositeFromVertex(e.getVertexAfter(a)),d=e.getEdgeOppositeFromVertex(e.getVertexBefore(a)),f=i.getEdgeOppositeFromVertex(i.getVertexAfter(o));this.triangles.push(new s(a,o,e.getVertexBefore(a),u,c,h)),this.triangles.push(new s(o,a,i.getVertexBefore(o),d,f,h)),this.legalizeEdge(u),this.legalizeEdge(c),this.legalizeEdge(d),this.legalizeEdge(f)}}}},{vertexComparison:function(t,e){return t=t.point,e=e.point,t.y<e.y?-1:t.y>e.y?1:t.x<e.x?-1:t.x>e.x?1:0},vertexProduct:function(t,e,i){var n=e.point.minus(t.point),s=i.point.minus(t.point);return n.crossScalar(s)}}),h(Object,i,{isArtificial:function(){return this.index<0}}),h(Object,n,{isArtificial:function(){return this.startVertex.isArtificial()||this.endVertex.isArtificial()},connectAfter:function(t){this.nextEdge=t,t.previousEdge=this},disconnectAfter:function(){this.nextEdge.previousEdge=null,this.nextEdge=null},addTriangle:function(t){this.triangles.push(t)},removeTriangle:function(t){r(this.triangles,t)},getSharedTriangle:function(t){for(var e=0;e<this.triangles.length;e++)for(var i=this.triangles[e],n=0;n<t.triangles.length;n++)if(t.triangles[n]===i)return i;throw new Error("No common triangle")},getSharedVertex:function(t){return this.startVertex===t.startVertex||this.startVertex===t.endVertex?this.startVertex:this.endVertex},getOtherVertex:function(t){return t===this.startVertex?this.endVertex:this.startVertex},getOtherTriangle:function(t){return this.triangles[0]===t?this.triangles[1]:this.triangles[0]},intersectsConstrainedEdge:function(t,e){return l.lineSegmentIntersection(t.point.x,t.point.y,e.point.x,e.point.y,this.startVertex.point.x,this.startVertex.point.y,this.endVertex.point.x,this.endVertex.point.y)}}),h(Object,s,{hasVertex:function(t){return this.aVertex===t||this.bVertex===t||this.cVertex===t},getVertexOppositeFromEdge:function(t){return t===this.aEdge?this.aVertex:t===this.bEdge?this.bVertex:this.cVertex},getEdgeOppositeFromVertex:function(t){return t===this.aVertex?this.aEdge:t===this.bVertex?this.bEdge:this.cEdge},getVertexBefore:function(t){return t===this.aVertex?this.cVertex:t===this.bVertex?this.aVertex:this.bVertex},getVertexAfter:function(t){return t===this.aVertex?this.bVertex:t===this.bVertex?this.cVertex:this.aVertex},getNonArtificialEdge:function(){return this.aEdge.isArtificial()?this.bEdge.isArtificial()?this.cEdge.isArtificial()?null:this.cEdge:this.bEdge:this.aEdge},getNextEdge:function(t){return this.aEdge===t?this.bEdge:this.bEdge===t?this.cEdge:this.cEdge===t?this.aEdge:void 0},getPreviousEdge:function(t){return this.aEdge===t?this.cEdge:this.bEdge===t?this.aEdge:this.cEdge===t?this.bEdge:void 0},isArtificial:function(){return this.aVertex.isArtificial()||this.bVertex.isArtificial()||this.cVertex.isArtificial()},remove:function(){this.aEdge.removeTriangle(this),this.bEdge.removeTriangle(this),this.cEdge.removeTriangle(this)}}),e}),i("DOT/Dimension2",["require","DOT/dot","PHET_CORE/inherit","DOT/Bounds2"],function(t){"use strict";function e(t,e){this.width=t,this.height=e}var i=t("DOT/dot"),n=t("PHET_CORE/inherit");return t("DOT/Bounds2"),i.register("Dimension2",e),n(Object,e,{toString:function(){return"["+this.width+"w, "+this.height+"h]"},set:function(t){return this.width=t.width,this.height=t.height,this},setWidth:function(t){return this.width=t,this},setHeight:function(t){return this.height=t,this},copy:function(t){return t?t.set(this):new e(this.width,this.height)},toBounds:function(t,e){return t=void 0!==t?t:0,e=void 0!==e?e:0,new i.Bounds2(t,e,this.width+t,this.height+e)},equals:function(t){return this.width===t.width&&this.height===t.height}}),e}),i("DOT/EigenvalueDecomposition",["require","DOT/dot"],function(t){"use strict";function e(t){var e,i,s=t.entries;this.n=t.getColumnDimension();var r=this.n;for(this.V=new n(r*r),this.d=new n(r),this.e=new n(r),this.issymmetric=!0,i=0;i<r&&this.issymmetric;i++)for(e=0;e<r&&this.issymmetric;e++)this.issymmetric=s[e*this.n+i]===s[i*this.n+e];if(this.issymmetric){for(e=0;e<r;e++)for(i=0;i<r;i++)this.V[e*this.n+i]=s[e*this.n+i];this.tred2(),this.tql2()}else{for(this.H=new n(r*r),this.ort=new n(r),i=0;i<r;i++)for(e=0;e<r;e++)this.H[e*this.n+i]=s[e*this.n+i];this.orthes(),this.hqr2()}}var i=t("DOT/dot"),n=window.Float64Array||Array;return i.register("EigenvalueDecomposition",e),e.prototype={constructor:e,getV:function(){return this.V.copy()},getRealEigenvalues:function(){return this.d},getImagEigenvalues:function(){return this.e},getD:function(){for(var t=this.n,e=this.d,n=this.e,s=new i.Matrix(t,t),r=s.entries,a=0;a<t;a++){for(var o=0;o<t;o++)r[a*this.n+o]=0;r[a*this.n+a]=e[a],n[a]>0?r[a*this.n+a+1]=n[a]:n[a]<0&&(r[a*this.n+a-1]=n[a])}return s},tred2:function(){var t,e,i,n,s,r,a=this.n,o=this.V,h=this.d,l=this.e;for(e=0;e<a;e++)h[e]=o[(a-1)*a+e];for(t=a-1;t>0;t--){var u=0;for(r=0,i=0;i<t;i++)u+=Math.abs(h[i]);if(0===u)for(l[t]=h[t-1],e=0;e<t;e++)h[e]=o[(t-1)*a+e],o[t*this.n+e]=0,o[e*this.n+t]=0;else{for(i=0;i<t;i++)h[i]/=u,r+=h[i]*h[i];for(n=h[t-1],s=Math.sqrt(r),n>0&&(s=-s),l[t]=u*s,r-=n*s,h[t-1]=n-s,e=0;e<t;e++)l[e]=0;for(e=0;e<t;e++){for(n=h[e],o[e*this.n+t]=n,s=l[e]+o[e*a+e]*n,i=e+1;i<=t-1;i++)s+=o[i*a+e]*h[i],l[i]+=o[i*a+e]*n;l[e]=s}for(n=0,e=0;e<t;e++)l[e]/=r,n+=l[e]*h[e];var c=n/(r+r);for(e=0;e<t;e++)l[e]-=c*h[e];for(e=0;e<t;e++){for(n=h[e],s=l[e],i=e;i<=t-1;i++)o[i*a+e]-=n*l[i]+s*h[i];h[e]=o[(t-1)*a+e],o[t*this.n+e]=0}}h[t]=r}for(t=0;t<a-1;t++){if(o[(a-1)*a+t]=o[t*a+t],o[t*a+t]=1,0!==(r=h[t+1])){for(i=0;i<=t;i++)h[i]=o[i*a+(t+1)]/r;for(e=0;e<=t;e++){for(s=0,i=0;i<=t;i++)s+=o[i*a+(t+1)]*o[i*a+e];for(i=0;i<=t;i++)o[i*a+e]-=s*h[i]}}for(i=0;i<=t;i++)o[i*a+(t+1)]=0}for(e=0;e<a;e++)h[e]=o[(a-1)*a+e],o[(a-1)*a+e]=0;o[(a-1)*a+(a-1)]=1,l[0]=0},tql2:function(){var t,e,n,s,r,a,o=this.n,h=this.V,l=this.d,u=this.e;for(t=1;t<o;t++)u[t-1]=u[t];u[o-1]=0;var c=0,d=0,f=Math.pow(2,-52);for(s=0;s<o;s++){d=Math.max(d,Math.abs(l[s])+Math.abs(u[s]));for(var m=s;m<o&&!(Math.abs(u[m])<=f*d);)m++;if(m>s){0;do{1,r=l[s],a=(l[s+1]-r)/(2*u[s]);var p=i.Matrix.hypot(a,1);a<0&&(p=-p),l[s]=u[s]/(a+p),l[s+1]=u[s]*(a+p);var g=l[s+1],v=r-l[s];for(t=s+2;t<o;t++)l[t]-=v;c+=v,a=l[m];var y=1,E=y,b=y,_=u[s+1],S=0,T=0;for(t=m-1;t>=s;t--)for(b=E,E=y,T=S,r=y*u[t],v=y*a,p=i.Matrix.hypot(a,u[t]),u[t+1]=S*p,S=u[t]/p,a=(y=a/p)*l[t]-S*r,l[t+1]=v+S*(y*r+S*l[t]),n=0;n<o;n++)v=h[n*o+(t+1)],h[n*o+(t+1)]=S*h[n*o+t]+y*v,h[n*o+t]=y*h[n*o+t]-S*v;a=-S*T*b*_*u[s]/g,u[s]=S*a,l[s]=y*a}while(Math.abs(u[s])>f*d)}l[s]=l[s]+c,u[s]=0}for(t=0;t<o-1;t++){for(n=t,a=l[t],e=t+1;e<o;e++)l[e]<a&&(n=e,a=l[e]);if(n!==t)for(l[n]=l[t],l[t]=a,e=0;e<o;e++)a=h[e*this.n+t],h[e*this.n+t]=h[e*o+n],h[e*o+n]=a}},orthes:function(){var t,e,i,n,s,r=this.n,a=this.V,o=this.H,h=this.ort,l=r-1;for(i=1;i<=l-1;i++){var u=0;for(t=i;t<=l;t++)u+=Math.abs(o[t*r+(i-1)]);if(0!==u){var c=0;for(t=l;t>=i;t--)h[t]=o[t*r+(i-1)]/u,c+=h[t]*h[t];for(s=Math.sqrt(c),h[i]>0&&(s=-s),c-=h[i]*s,h[i]=h[i]-s,e=i;e<r;e++){for(n=0,t=l;t>=i;t--)n+=h[t]*o[t*this.n+e];for(n/=c,t=i;t<=l;t++)o[t*this.n+e]-=n*h[t]}for(t=0;t<=l;t++){for(n=0,e=l;e>=i;e--)n+=h[e]*o[t*this.n+e];for(n/=c,e=i;e<=l;e++)o[t*this.n+e]-=n*h[e]}h[i]=u*h[i],o[i*r+(i-1)]=u*s}}for(t=0;t<r;t++)for(e=0;e<r;e++)a[t*this.n+e]=t===e?1:0;for(i=l-1;i>=1;i--)if(0!==o[i*r+(i-1)]){for(t=i+1;t<=l;t++)h[t]=o[t*r+(i-1)];for(e=i;e<=l;e++){for(s=0,t=i;t<=l;t++)s+=h[t]*a[t*this.n+e];for(s=s/h[i]/o[i*r+(i-1)],t=i;t<=l;t++)a[t*this.n+e]+=s*h[t]}}},cdiv:function(t,e,i,n){var s,r;Math.abs(i)>Math.abs(n)?(r=i+(s=n/i)*n,this.cdivr=(t+s*e)/r,this.cdivi=(e-s*t)/r):(r=n+(s=i/n)*i,this.cdivr=(s*t+e)/r,this.cdivi=(s*e-t)/r)},hqr2:function(){var t,e,i,n,s,r,a,o=this.V,h=this.d,l=this.e,u=this.H,c=this.n;t=c-1;var d,f,m,p,g=c-1,v=Math.pow(2,-52),y=0,E=0,b=0,_=0,S=0,T=0,C=0;for(e=0;e<c;e++)for((e<0||e>g)&&(h[e]=u[e*t+e],l[e]=0),i=Math.max(e-1,0);i<c;i++)C+=Math.abs(u[e*this.n+i]);for(a=0;t>=0;){for(s=t;s>0&&(0===(S=Math.abs(u[(s-1)*t+(s-1)])+Math.abs(u[s*t+s]))&&(S=C),!(Math.abs(u[s*t+(s-1)])<v*S));)s--;if(s===t)u[t*t+t]=u[t*t+t]+y,h[t]=u[t*t+t],l[t]=0,t--,a=0;else if(s===t-1){if(f=u[t*t+t-1]*u[(t-1)*t+t],E=(u[(t-1)*t+(t-1)]-u[t*t+t])/2,b=E*E+f,T=Math.sqrt(Math.abs(b)),u[t*t+t]=u[t*t+t]+y,u[(t-1)*t+(t-1)]=u[(t-1)*t+(t-1)]+y,m=u[t*t+t],b>=0){for(T=E>=0?E+T:E-T,h[t-1]=m+T,h[t]=h[t-1],0!==T&&(h[t]=m-f/T),l[t-1]=0,l[t]=0,E=(m=u[t*t+t-1])/(S=Math.abs(m)+Math.abs(T)),b=T/S,E/=_=Math.sqrt(E*E+b*b),b/=_,i=t-1;i<c;i++)T=u[(t-1)*t+i],u[(t-1)*t+i]=b*T+E*u[t*t+i],u[t*t+i]=b*u[t*t+i]-E*T;for(e=0;e<=t;e++)T=u[e*t+t-1],u[e*t+t-1]=b*T+E*u[e*t+t],u[e*t+t]=b*u[e*t+t]-E*T;for(e=0;e<=g;e++)T=o[e*t+t-1],o[e*t+t-1]=b*T+E*o[e*t+t],o[e*t+t]=b*o[e*t+t]-E*T}else h[t-1]=m+E,h[t]=m+E,l[t-1]=T,l[t]=-T;t-=2,a=0}else{if(m=u[t*t+t],p=0,f=0,s<t&&(p=u[(t-1)*t+(t-1)],f=u[t*t+t-1]*u[(t-1)*t+t]),10===a){for(y+=m,e=0;e<=t;e++)u[e*t+e]-=m;m=p=.75*(S=Math.abs(u[t*t+t-1])+Math.abs(u[(t-1)*t+t-2])),f=-.4375*S*S}if(30===a&&(S=(p-m)/2,(S=S*S+f)>0)){for(S=Math.sqrt(S),p<m&&(S=-S),S=m-f/((p-m)/2+S),e=0;e<=t;e++)u[e*t+e]-=S;y+=S,m=p=f=.964}for(a+=1,r=t-2;r>=s&&(T=u[r*t+r],_=m-T,S=p-T,E=(_*S-f)/u[(r+1)*t+r]+u[r*t+r+1],b=u[(r+1)*t+r+1]-T-_-S,_=u[(r+2)*t+r+1],S=Math.abs(E)+Math.abs(b)+Math.abs(_),E/=S,b/=S,_/=S,r!==s)&&!(Math.abs(u[r*t+(r-1)])*(Math.abs(b)+Math.abs(_))<v*(Math.abs(E)*(Math.abs(u[(r-1)*t+r-1])+Math.abs(T)+Math.abs(u[(r+1)*t+r+1]))));)r--;for(e=r+2;e<=t;e++)u[e*t+e-2]=0,e>r+2&&(u[e*t+e-3]=0);for(n=r;n<=t-1;n++){var x=n!==t-1;if(n!==r&&(E=u[n*t+n-1],b=u[(n+1)*t+n-1],_=x?u[(n+2)*t+n-1]:0,0!==(m=Math.abs(E)+Math.abs(b)+Math.abs(_))&&(E/=m,b/=m,_/=m)),0===m)break;if(S=Math.sqrt(E*E+b*b+_*_),E<0&&(S=-S),0!==S){for(n!==r?u[n*t+n-1]=-S*m:s!==r&&(u[n*t+n-1]=-u[n*t+n-1]),m=(E+=S)/S,p=b/S,T=_/S,b/=E,_/=E,i=n;i<c;i++)E=u[n*t+i]+b*u[(n+1)*t+i],x&&(E+=_*u[(n+2)*t+i],u[(n+2)*t+i]=u[(n+2)*t+i]-E*T),u[n*t+i]=u[n*t+i]-E*m,u[(n+1)*t+i]=u[(n+1)*t+i]-E*p;for(e=0;e<=Math.min(t,n+3);e++)E=m*u[e*t+n]+p*u[e*t+n+1],x&&(E+=T*u[e*t+n+2],u[e*t+n+2]=u[e*t+n+2]-E*_),u[e*t+n]=u[e*t+n]-E,u[e*t+n+1]=u[e*t+n+1]-E*b;for(e=0;e<=g;e++)E=m*o[e*t+n]+p*o[e*t+n+1],x&&(E+=T*o[e*t+n+2],o[e*t+n+2]=o[e*t+n+2]-E*_),o[e*t+n]=o[e*t+n]-E,o[e*t+n+1]=o[e*t+n+1]-E*b}}}}if(0!==C){for(t=c-1;t>=0;t--)if(E=h[t],0===(b=l[t]))for(s=t,u[t*t+t]=1,e=t-1;e>=0;e--){for(f=u[e*t+e]-E,_=0,i=s;i<=t;i++)_+=u[e*this.n+i]*u[i*t+t];if(l[e]<0)T=f,S=_;else if(s=e,0===l[e]?u[e*t+t]=0!==f?-_/f:-_/(v*C):(m=u[e*t+e+1],p=u[(e+1)*t+e],d=(m*S-T*_)/(b=(h[e]-E)*(h[e]-E)+l[e]*l[e]),u[e*t+t]=d,Math.abs(m)>Math.abs(T)?u[(e+1)*t+t]=(-_-f*d)/m:u[(e+1)*t+t]=(-S-p*d)/T),d=Math.abs(u[e*t+t]),v*d*d>1)for(i=e;i<=t;i++)u[i*t+t]=u[i*t+t]/d}else if(b<0)for(s=t-1,Math.abs(u[t*t+t-1])>Math.abs(u[(t-1)*t+t])?(u[(t-1)*t+(t-1)]=b/u[t*t+t-1],u[(t-1)*t+t]=-(u[t*t+t]-E)/u[t*t+t-1]):(this.cdiv(0,-u[(t-1)*t+t],u[(t-1)*t+(t-1)]-E,b),u[(t-1)*t+(t-1)]=this.cdivr,u[(t-1)*t+t]=this.cdivi),u[t*t+t-1]=0,u[t*t+t]=1,e=t-2;e>=0;e--){var w,R,D,P;for(w=0,R=0,i=s;i<=t;i++)w+=u[e*this.n+i]*u[i*t+t-1],R+=u[e*this.n+i]*u[i*t+t];if(f=u[e*t+e]-E,l[e]<0)T=f,_=w,S=R;else if(s=e,0===l[e]?(this.cdiv(-w,-R,f,b),u[e*t+t-1]=this.cdivr,u[e*t+t]=this.cdivi):(m=u[e*t+e+1],p=u[(e+1)*t+e],D=(h[e]-E)*(h[e]-E)+l[e]*l[e]-b*b,P=2*(h[e]-E)*b,0===D&&0===P&&(D=v*C*(Math.abs(f)+Math.abs(b)+Math.abs(m)+Math.abs(p)+Math.abs(T))),this.cdiv(m*_-T*w+b*R,m*S-T*R-b*w,D,P),u[e*t+t-1]=this.cdivr,u[e*t+t]=this.cdivi,Math.abs(m)>Math.abs(T)+Math.abs(b)?(u[(e+1)*t+t-1]=(-w-f*u[e*t+t-1]+b*u[e*t+t])/m,u[(e+1)*t+t]=(-R-f*u[e*t+t]-b*u[e*t+t-1])/m):(this.cdiv(-_-p*u[e*t+t-1],-S-p*u[e*t+t],T,b),u[(e+1)*t+t-1]=this.cdivr,u[(e+1)*t+t]=this.cdivi)),d=Math.max(Math.abs(u[e*t+t-1]),Math.abs(u[e*t+t])),v*d*d>1)for(i=e;i<=t;i++)u[i*t+t-1]=u[i*t+t-1]/d,u[i*t+t]=u[i*t+t]/d}for(e=0;e<c;e++)if(e<0||e>g)for(i=e;i<c;i++)o[e*this.n+i]=u[e*this.n+i];for(i=c-1;i>=0;i--)for(e=0;e<=g;e++){for(T=0,n=0;n<=Math.min(i,g);n++)T+=o[e*t+n]*u[n*t+i];o[e*this.n+i]=T}}}},e}),i("DOT/LinearFunction",["require","DOT/dot","DOT/Util"],function(t){"use strict";function e(t,e,n,s,r){r=!_.isUndefined(r)&&r;var a=function(t,e,n,s,r,a){var o=i.Util.linear(t,e,n,s,r);if(a){var h=Math.max(n,s),l=Math.min(n,s);o=i.Util.clamp(o,l,h)}return o},o=function(i){return a(t,e,n,s,i,r)};return o.inverse=function(i){return a(n,s,t,e,i,r)},o}var i=t("DOT/dot");return t("DOT/Util"),i.register("LinearFunction",e),e}),i("DOT/LUDecomposition",["require","DOT/dot"],function(t){"use strict";function e(t){var e,i,s;this.matrix=t,this.LU=t.getArrayCopy();var r=this.LU;this.m=t.getRowDimension();var a=this.m;this.n=t.getColumnDimension();var o=this.n;for(this.piv=new Uint32Array(a),e=0;e<a;e++)this.piv[e]=e;this.pivsign=1;var h=new n(a);for(i=0;i<o;i++){for(e=0;e<a;e++)h[e]=r[t.index(e,i)];for(e=0;e<a;e++){var l=Math.min(e,i),u=0;for(s=0;s<l;s++){u+=r[t.index(e,s)]*h[s]}h[e]-=u,r[t.index(e,i)]=h[e]}var c=i;for(e=i+1;e<a;e++)Math.abs(h[e])>Math.abs(h[c])&&(c=e);if(c!==i){for(s=0;s<o;s++){var d=t.index(c,s),f=t.index(i,s),m=r[d];r[d]=r[f],r[f]=m}s=this.piv[c],this.piv[c]=this.piv[i],this.piv[i]=s,this.pivsign=-this.pivsign}if(i<a&&0!==r[this.matrix.index(i,i)])for(e=i+1;e<a;e++)r[t.index(e,i)]/=r[t.index(i,i)]}}var i=t("DOT/dot"),n=window.Float64Array||Array;return i.register("LUDecomposition",e),e.prototype={constructor:e,isNonsingular:function(){for(var t=0;t<this.n;t++){var e=this.matrix.index(t,t);if(0===this.LU[e])return!1}return!0},getL:function(){for(var t=new i.Matrix(this.m,this.n),e=0;e<this.m;e++)for(var n=0;n<this.n;n++)t.entries[t.index(e,n)]=e>n?this.LU[this.matrix.index(e,n)]:e===n?1:0;return t},getU:function(){for(var t=new i.Matrix(this.n,this.n),e=0;e<this.n;e++)for(var n=0;n<this.n;n++)t.entries[t.index(e,n)]=e<=n?this.LU[this.matrix.index(e,n)]:0;return t},getPivot:function(){for(var t=new Uint32Array(this.m),e=0;e<this.m;e++)t[e]=this.piv[e];return t},getDoublePivot:function(){for(var t=new n(this.m),e=0;e<this.m;e++)t[e]=this.piv[e];return t},det:function(){if(this.m!==this.n)throw new Error("Matrix must be square.");for(var t=this.pivsign,e=0;e<this.n;e++)t*=this.LU[this.matrix.index(e,e)];return t},solve:function(t){var e,i,n;if(t.getRowDimension()!==this.m)throw new Error("Matrix row dimensions must agree.");if(!this.isNonsingular())throw new Error("Matrix is singular.");var s=t.getColumnDimension(),r=t.getArrayRowMatrix(this.piv,0,s-1);for(n=0;n<this.n;n++)for(e=n+1;e<this.n;e++)for(i=0;i<s;i++)r.entries[r.index(e,i)]-=r.entries[r.index(n,i)]*this.LU[this.matrix.index(e,n)];for(n=this.n-1;n>=0;n--){for(i=0;i<s;i++)r.entries[r.index(n,i)]/=this.LU[this.matrix.index(n,n)];for(e=0;e<n;e++)for(i=0;i<s;i++)r.entries[r.index(e,i)]-=r.entries[r.index(n,i)]*this.LU[this.matrix.index(e,n)]}return r}},e}),i("PHET_CORE/isArray",["require","PHET_CORE/phetCore"],function(t){"use strict";function e(t){return"[object Array]"===Object.prototype.toString.call(t)}return t("PHET_CORE/phetCore").register("isArray",e),e}),i("DOT/SingularValueDecomposition",["require","DOT/dot"],function(t){"use strict";function e(t){this.matrix=t;var e=t,s=e.getArrayCopy();this.m=e.getRowDimension(),this.n=e.getColumnDimension();var r=this.m,a=this.n,o=Math.min,h=Math.max,l=Math.pow,u=Math.abs,c=o(r,a);this.s=new n(o(r+1,a));var d=this.s;this.U=new n(r*c);var f=this.U;this.V=new n(a*a);var m,p,g,v,y,E,b,_=this.V,S=new n(a),T=new n(r),C=i.Matrix.hypot,x=o(r-1,a),w=h(0,o(a-2,r));for(g=0;g<h(x,w);g++){if(g<x){for(d[g]=0,m=g;m<r;m++)d[g]=C(d[g],s[m*a+g]);if(0!==d[g]){for(s[g*a+g]<0&&(d[g]=-d[g]),m=g;m<r;m++)s[m*a+g]/=d[g];s[g*a+g]+=1}d[g]=-d[g]}for(p=g+1;p<a;p++){if(g<x&&0!==d[g]){for(v=0,m=g;m<r;m++)v+=s[m*a+g]*s[m*a+p];for(v=-v/s[g*a+g],m=g;m<r;m++)s[m*a+p]+=v*s[m*a+g]}S[p]=s[g*a+p]}if(g<x)for(m=g;m<r;m++)f[m*c+g]=s[m*a+g];if(g<w){for(S[g]=0,m=g+1;m<a;m++)S[g]=C(S[g],S[m]);if(0!==S[g]){for(S[g+1]<0&&(S[g]=-S[g]),m=g+1;m<a;m++)S[m]/=S[g];S[g+1]+=1}if(S[g]=-S[g],g+1<r&&0!==S[g]){for(m=g+1;m<r;m++)T[m]=0;for(p=g+1;p<a;p++)for(m=g+1;m<r;m++)T[m]+=S[p]*s[m*a+p];for(p=g+1;p<a;p++)for(v=-S[p]/S[g+1],m=g+1;m<r;m++)s[m*a+p]+=v*T[m]}for(m=g+1;m<a;m++)_[m*a+g]=S[m]}}var R=o(a,r+1);for(x<a&&(d[x]=s[x*a+x]),r<R&&(d[R-1]=0),w+1<R&&(S[w]=s[w*a+R-1]),S[R-1]=0,p=x;p<c;p++){for(m=0;m<r;m++)f[m*c+p]=0;f[p*c+p]=1}for(g=x-1;g>=0;g--)if(0!==d[g]){for(p=g+1;p<c;p++){for(v=0,m=g;m<r;m++)v+=f[m*c+g]*f[m*c+p];for(v=-v/f[g*c+g],m=g;m<r;m++)f[m*c+p]+=v*f[m*c+g]}for(m=g;m<r;m++)f[m*c+g]=-f[m*c+g];for(f[g*c+g]=1+f[g*c+g],m=0;m<g-1;m++)f[m*c+g]=0}else{for(m=0;m<r;m++)f[m*c+g]=0;f[g*c+g]=1}for(g=a-1;g>=0;g--){if(g<w&&0!==S[g])for(p=g+1;p<c;p++){for(v=0,m=g+1;m<a;m++)v+=_[m*a+g]*_[m*a+p];for(v=-v/_[(g+1)*a+g],m=g+1;m<a;m++)_[m*a+p]+=v*_[m*a+g]}for(m=0;m<a;m++)_[m*a+g]=0;_[g*a+g]=1}for(var D=R-1,P=0,N=l(2,-52),A=l(2,-966);R>0;){var O;if(P>500)break;for(g=R-2;g>=-1&&-1!==g;g--)if(u(S[g])<=A+N*(u(d[g])+u(d[g+1]))){S[g]=0;break}if(g===R-2)O=4;else{var I;for(I=R-1;I>=g&&I!==g;I--)if(v=(I!==R?u(S[I]):0)+(I!==g+1?u(S[I-1]):0),u(d[I])<=A+N*v){d[I]=0;break}I===g?O=3:I===R-1?O=1:(O=2,g=I)}switch(g++,O){case 1:for(y=S[R-2],S[R-2]=0,p=R-2;p>=g;p--)for(v=C(d[p],y),E=d[p]/v,b=y/v,d[p]=v,p!==g&&(y=-b*S[p-1],S[p-1]=E*S[p-1]),m=0;m<a;m++)v=E*_[m*a+p]+b*_[m*a+R-1],_[m*a+R-1]=-b*_[m*a+p]+E*_[m*a+R-1],_[m*a+p]=v;break;case 2:for(y=S[g-1],S[g-1]=0,p=g;p<R;p++)for(v=C(d[p],y),E=d[p]/v,b=y/v,d[p]=v,y=-b*S[p],S[p]=E*S[p],m=0;m<r;m++)v=E*f[m*c+p]+b*f[m*c+g-1],f[m*c+g-1]=-b*f[m*c+p]+E*f[m*c+g-1],f[m*c+p]=v;break;case 3:var k=h(h(h(h(u(d[R-1]),u(d[R-2])),u(S[R-2])),u(d[g])),u(S[g])),M=d[R-1]/k,L=d[R-2]/k,Y=S[R-2]/k,B=d[g]/k,H=S[g]/k,F=((L+M)*(L-M)+Y*Y)/2,V=M*Y*(M*Y),X=0;0===F&&0===V||(X=Math.sqrt(F*F+V),F<0&&(X=-X),X=V/(F+X)),y=(B+M)*(B-M)+X;var z=B*H;for(p=g;p<R-1;p++){for(E=y/(v=C(y,z)),b=z/v,p!==g&&(S[p-1]=v),y=E*d[p]+b*S[p],S[p]=E*S[p]-b*d[p],z=b*d[p+1],d[p+1]=E*d[p+1],m=0;m<a;m++)v=E*_[m*a+p]+b*_[m*a+p+1],_[m*a+p+1]=-b*_[m*a+p]+E*_[m*a+p+1],_[m*a+p]=v;if(v=C(y,z),E=y/v,b=z/v,d[p]=v,y=E*S[p]+b*d[p+1],d[p+1]=-b*S[p]+E*d[p+1],z=b*S[p+1],S[p+1]=E*S[p+1],p<r-1)for(m=0;m<r;m++)v=E*f[m*c+p]+b*f[m*c+p+1],f[m*c+p+1]=-b*f[m*c+p]+E*f[m*c+p+1],f[m*c+p]=v}S[R-2]=y,P+=1;break;case 4:if(d[g]<=0)for(d[g]=d[g]<0?-d[g]:0,m=0;m<=D;m++)_[m*a+g]=-_[m*a+g];for(;g<D&&!(d[g]>=d[g+1]);){if(v=d[g],d[g]=d[g+1],d[g+1]=v,g<a-1)for(m=0;m<a;m++)v=_[m*a+g+1],_[m*a+g+1]=_[m*a+g],_[m*a+g]=v;if(g<r-1)for(m=0;m<r;m++)v=f[m*c+g+1],f[m*c+g+1]=f[m*c+g],f[m*c+g]=v;g++}P=0,R--;break;default:throw new Error("invalid kase: "+O)}}}var i=t("DOT/dot"),n=window.Float64Array||Array;return i.register("SingularValueDecomposition",e),e.prototype={constructor:e,getU:function(){return new i.Matrix(this.m,Math.min(this.m+1,this.n),this.U,!0)},getV:function(){return new i.Matrix(this.n,this.n,this.V,!0)},getSingularValues:function(){return this.s},getS:function(){for(var t=new i.Matrix(this.n,this.n),e=0;e<this.n;e++){for(var n=0;n<this.n;n++)t.entries[t.index(e,n)]=0;t.entries[t.index(e,e)]=this.s[e]}return t},norm2:function(){return this.s[0]},cond:function(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]},rank:function(){for(var t=Math.pow(2,-23),e=Math.max(this.m,this.n)*this.s[0]*t,i=0,n=0;n<this.s.length;n++)this.s[n]>e&&i++;return i}},e.pseudoinverse=function(t){var n=new e(t),s=i.Matrix.diagonalMatrix(n.getSingularValues().map(function(t){return Math.abs(t)<1e-300?0:1/t}));return n.getV().times(s).times(n.getU().transpose())},e}),i("DOT/QRDecomposition",["require","DOT/dot"],function(t){"use strict";var e=t("DOT/dot"),i=window.Float64Array||Array;e.QRDecomposition=function(t){this.matrix=t,this.QR=t.getArrayCopy();var n=this.QR;this.m=t.getRowDimension();var s=this.m;this.n=t.getColumnDimension();var r=this.n;this.Rdiag=new i(r);var a,o,h;for(h=0;h<r;h++){var l=0;for(a=h;a<s;a++)l=e.Matrix.hypot(l,n[this.matrix.index(a,h)]);if(0!==l){for(n[this.matrix.index(h,h)]<0&&(l=-l),a=h;a<s;a++)n[this.matrix.index(a,h)]/=l;for(n[this.matrix.index(h,h)]+=1,o=h+1;o<r;o++){var u=0;for(a=h;a<s;a++)u+=n[this.matrix.index(a,h)]*n[this.matrix.index(a,o)];for(u=-u/n[this.matrix.index(h,h)],a=h;a<s;a++)n[this.matrix.index(a,o)]+=u*n[this.matrix.index(a,h)]}}this.Rdiag[h]=-l}};var n=e.QRDecomposition;return n.prototype={constructor:n,isFullRank:function(){for(var t=0;t<this.n;t++)if(0===this.Rdiag[t])return!1;return!0},getH:function(){for(var t=new e.Matrix(this.m,this.n),i=0;i<this.m;i++)for(var n=0;n<this.n;n++)t.entries[t.index(i,n)]=i>=n?this.QR[this.matrix.index(i,n)]:0;return t},getR:function(){for(var t=new e.Matrix(this.n,this.n),i=0;i<this.n;i++)for(var n=0;n<this.n;n++)t.entries[t.index(i,n)]=i<n?this.QR[this.matrix.index(i,n)]:i===n?this.Rdiag[i]:0;return t},getQ:function(){var t,i,n,s=new e.Matrix(this.m,this.n);for(n=this.n-1;n>=0;n--){for(t=0;t<this.m;t++)s.entries[s.index(t,n)]=0;for(s.entries[s.index(n,n)]=1,i=n;i<this.n;i++)if(0!==this.QR[this.matrix.index(n,n)]){var r=0;for(t=n;t<this.m;t++)r+=this.QR[this.matrix.index(t,n)]*s.entries[s.index(t,i)];for(r=-r/this.QR[this.matrix.index(n,n)],t=n;t<this.m;t++)s.entries[s.index(t,i)]+=r*this.QR[this.matrix.index(t,n)]}}return s},solve:function(t){if(t.getRowDimension()!==this.m)throw new Error("Matrix row dimensions must agree.");if(!this.isFullRank())throw new Error("Matrix is rank deficient.");var i,n,s,r=t.getColumnDimension(),a=t.getArrayCopy();for(s=0;s<this.n;s++)for(n=0;n<r;n++){var o=0;for(i=s;i<this.m;i++)o+=this.QR[this.matrix.index(i,s)]*a[t.index(i,n)];for(o=-o/this.QR[this.matrix.index(s,s)],i=s;i<this.m;i++)a[t.index(i,n)]+=o*this.QR[this.matrix.index(i,s)]}for(s=this.n-1;s>=0;s--){for(n=0;n<r;n++)a[t.index(s,n)]/=this.Rdiag[s];for(i=0;i<s;i++)for(n=0;n<r;n++)a[t.index(i,n)]-=a[t.index(s,n)]*this.QR[this.matrix.index(i,s)]}return new e.Matrix(this.n,r,a,!0).getMatrix(0,this.n-1,0,r-1)}},n}),i("DOT/Matrix",["require","DOT/dot","PHET_CORE/isArray","DOT/SingularValueDecomposition","DOT/LUDecomposition","DOT/QRDecomposition","DOT/EigenvalueDecomposition","DOT/Vector2","DOT/Vector3","DOT/Vector4"],function(t){"use strict";function e(t,e,i,r){this.m=t,this.n=e;var a=t*e;this.size=a;var o;if(r)this.entries=i;else if(i||(i=0),this.entries=new n(a),s(i))for(o=0;o<a;o++)this.entries[o]=i[o];else for(o=0;o<a;o++)this.entries[o]=i}var i=t("DOT/dot"),n=window.Float64Array||Array,s=t("PHET_CORE/isArray");return t("DOT/SingularValueDecomposition"),t("DOT/LUDecomposition"),t("DOT/QRDecomposition"),t("DOT/EigenvalueDecomposition"),t("DOT/Vector2"),t("DOT/Vector3"),t("DOT/Vector4"),i.register("Matrix",e),e.hypot=function(t,e){var i;return Math.abs(t)>Math.abs(e)?(i=e/t,i=Math.abs(t)*Math.sqrt(1+i*i)):0!==e?(i=t/e,i=Math.abs(e)*Math.sqrt(1+i*i)):i=0,i},e.prototype={constructor:e,copy:function(){for(var t=new e(this.m,this.n),i=0;i<this.size;i++)t.entries[i]=this.entries[i];return t},getArray:function(){return this.entries},getArrayCopy:function(){return new n(this.entries)},getRowDimension:function(){return this.m},getColumnDimension:function(){return this.n},index:function(t,e){return t*this.n+e},get:function(t,e){return this.entries[this.index(t,e)]},set:function(t,e,i){this.entries[this.index(t,e)]=i},getMatrix:function(t,i,n,s){for(var r=new e(i-t+1,s-n+1),a=t;a<=i;a++)for(var o=n;o<=s;o++)r.entries[r.index(a-t,o-n)]=this.entries[this.index(a,o)];return r},getArrayRowMatrix:function(t,i,n){for(var s=new e(t.length,n-i+1),r=0;r<t.length;r++)for(var a=i;a<=n;a++)s.entries[s.index(r,a-i)]=this.entries[this.index(t[r],a)];return s},transpose:function(t){t=t||new e(this.n,this.m);for(var i=0;i<this.m;i++)for(var n=0;n<this.n;n++)t.entries[t.index(n,i)]=this.entries[this.index(i,n)];return t},norm1:function(){for(var t=0,e=0;e<this.n;e++){for(var i=0,n=0;n<this.m;n++)i+=Math.abs(this.entries[this.index(n,e)]);t=Math.max(t,i)}return t},norm2:function(){return new i.SingularValueDecomposition(this).norm2()},normInf:function(){for(var t=0,e=0;e<this.m;e++){for(var i=0,n=0;n<this.n;n++)i+=Math.abs(this.entries[this.index(e,n)]);t=Math.max(t,i)}return t},normF:function(){for(var t=0,i=0;i<this.m;i++)for(var n=0;n<this.n;n++)t=e.hypot(t,this.entries[this.index(i,n)]);return t},uminus:function(){for(var t=new e(this.m,this.n),i=0;i<this.m;i++)for(var n=0;n<this.n;n++)t.entries[t.index(i,n)]=-this.entries[this.index(i,n)];return t},plus:function(t){this.checkMatrixDimensions(t);for(var i=new e(this.m,this.n),n=0;n<this.m;n++)for(var s=0;s<this.n;s++){var r=i.index(n,s);i.entries[r]=this.entries[r]+t.entries[r]}return i},plusEquals:function(t){this.checkMatrixDimensions(t);for(var i=new e(this.m,this.n),n=0;n<this.m;n++)for(var s=0;s<this.n;s++){var r=i.index(n,s);this.entries[r]=this.entries[r]+t.entries[r]}return this},minus:function(t){this.checkMatrixDimensions(t);for(var i=new e(this.m,this.n),n=0;n<this.m;n++)for(var s=0;s<this.n;s++){var r=this.index(n,s);i.entries[r]=this.entries[r]-t.entries[r]}return i},minusEquals:function(t){this.checkMatrixDimensions(t);for(var e=0;e<this.m;e++)for(var i=0;i<this.n;i++){var n=this.index(e,i);this.entries[n]=this.entries[n]-t.entries[n]}return this},arrayTimes:function(t){this.checkMatrixDimensions(t);for(var i=new e(this.m,this.n),n=0;n<this.m;n++)for(var s=0;s<this.n;s++){var r=i.index(n,s);i.entries[r]=this.entries[r]*t.entries[r]}return i},arrayTimesEquals:function(t){this.checkMatrixDimensions(t);for(var e=0;e<this.m;e++)for(var i=0;i<this.n;i++){var n=this.index(e,i);this.entries[n]=this.entries[n]*t.entries[n]}return this},arrayRightDivide:function(t){this.checkMatrixDimensions(t);for(var i=new e(this.m,this.n),n=0;n<this.m;n++)for(var s=0;s<this.n;s++){var r=this.index(n,s);i.entries[r]=this.entries[r]/t.entries[r]}return i},arrayRightDivideEquals:function(t){this.checkMatrixDimensions(t);for(var e=0;e<this.m;e++)for(var i=0;i<this.n;i++){var n=this.index(e,i);this.entries[n]=this.entries[n]/t.entries[n]}return this},arrayLeftDivide:function(t){this.checkMatrixDimensions(t);for(var i=new e(this.m,this.n),n=0;n<this.m;n++)for(var s=0;s<this.n;s++){var r=this.index(n,s);i.entries[r]=t.entries[r]/this.entries[r]}return i},arrayLeftDivideEquals:function(t){this.checkMatrixDimensions(t);for(var e=0;e<this.m;e++)for(var i=0;i<this.n;i++){var n=this.index(e,i);this.entries[n]=t.entries[n]/this.entries[n]}return this},times:function(t){var i,s,r,a,o,h;if(t.isMatrix){if((h=t).m!==this.n)throw new Error("Matrix inner dimensions must agree.");i=new e(this.m,h.n);var l=new n(this.n);for(r=0;r<h.n;r++){for(a=0;a<this.n;a++)l[a]=h.entries[h.index(a,r)];for(s=0;s<this.m;s++){for(o=0,a=0;a<this.n;a++)o+=this.entries[this.index(s,a)]*l[a];i.entries[i.index(s,r)]=o}}return i}for(o=t,i=new e(this.m,this.n),s=0;s<this.m;s++)for(r=0;r<this.n;r++)i.entries[i.index(s,r)]=o*this.entries[this.index(s,r)];return i},timesEquals:function(t){for(var e=0;e<this.m;e++)for(var i=0;i<this.n;i++){var n=this.index(e,i);this.entries[n]=t*this.entries[n]}return this},solve:function(t){return this.m===this.n?new i.LUDecomposition(this).solve(t):new i.QRDecomposition(this).solve(t)},solveTranspose:function(t){return this.transpose().solve(t.transpose())},inverse:function(){return this.solve(e.identity(this.m,this.m))},det:function(){return new i.LUDecomposition(this).det()},rank:function(){return new i.SingularValueDecomposition(this).rank()},cond:function(){return new i.SingularValueDecomposition(this).cond()},trace:function(){for(var t=0,e=0;e<Math.min(this.m,this.n);e++)t+=this.entries[this.index(e,e)];return t},checkMatrixDimensions:function(t){if(t.m!==this.m||t.n!==this.n)throw new Error("Matrix dimensions must agree.")},toString:function(){var t="";t+="dim: "+this.getRowDimension()+"x"+this.getColumnDimension()+"\n";for(var e=0;e<this.getRowDimension();e++){for(var i=0;i<this.getColumnDimension();i++)t+=this.get(e,i)+" ";t+="\n"}return t},extractVector2:function(t){return new i.Vector2(this.get(0,t),this.get(1,t))},extractVector3:function(t){return new i.Vector3(this.get(0,t),this.get(1,t),this.get(2,t))},extractVector4:function(t){return new i.Vector4(this.get(0,t),this.get(1,t),this.get(2,t),this.get(3,t))},setVectors3:function(t){for(var e=t.length,i=0;i<e;i++){var n=t[i];this.entries[i]=n.x,this.entries[i+e]=n.y,this.entries[i+2*e]=n.z}return this},isMatrix:!0},e.identity=function(t,i){for(var n=new e(t,i),s=0;s<t;s++)for(var r=0;r<i;r++)n.entries[n.index(s,r)]=s===r?1:0;return n},e.diagonalMatrix=function(t){for(var i=t.length,n=new e(i,i),s=0;s<i;s++)n.entries[n.index(s,s)]=t[s];return n},e.rowVector2=function(t){return new e(1,2,[t.x,t.y])},e.rowVector3=function(t){return new e(1,3,[t.x,t.y,t.z])},e.rowVector4=function(t){return new e(1,4,[t.x,t.y,t.z,t.w])},e.rowVector=function(t){if(t.isVector2)return e.rowVector2(t);if(t.isVector3)return e.rowVector3(t);if(t.isVector4)return e.rowVector4(t);throw new Error("undetected type of vector: "+t.toString())},e.columnVector2=function(t){return new e(2,1,[t.x,t.y])},e.columnVector3=function(t){return new e(3,1,[t.x,t.y,t.z])},e.columnVector4=function(t){return new e(4,1,[t.x,t.y,t.z,t.w])},e.columnVector=function(t){if(t.isVector2)return e.columnVector2(t);if(t.isVector3)return e.columnVector3(t);if(t.isVector4)return e.columnVector4(t);throw new Error("undetected type of vector: "+t.toString())},e.fromVectors2=function(t){for(var i=t.length,s=new n(2*i),r=0;r<i;r++){var a=t[r];s[r]=a.x,s[r+i]=a.y}return new e(2,i,s,!0)},e.fromVectors3=function(t){for(var i=t.length,s=new n(3*i),r=0;r<i;r++){var a=t[r];s[r]=a.x,s[r+i]=a.y,s[r+2*i]=a.z}return new e(3,i,s,!0)},e.fromVectors4=function(t){for(var i=t.length,s=new n(4*i),r=0;r<i;r++){var a=t[r];s[r]=a.x,s[r+i]=a.y,s[r+2*i]=a.z,s[r+3*i]=a.w}return new e(4,i,s,!0)},e}),i("DOT/Matrix4",["require","DOT/dot","DOT/Vector3","DOT/Vector4"],function(t){"use strict";function e(t,e,i,s,r,a,o,h,l,u,c,d,f,m,p,g,v){this.entries=new n(16),this.rowMajor(void 0!==t?t:1,void 0!==e?e:0,void 0!==i?i:0,void 0!==s?s:0,void 0!==r?r:0,void 0!==a?a:1,void 0!==o?o:0,void 0!==h?h:0,void 0!==l?l:0,void 0!==u?u:0,void 0!==c?c:1,void 0!==d?d:0,void 0!==f?f:0,void 0!==m?m:0,void 0!==p?p:0,void 0!==g?g:1,v)}var i=t("DOT/dot");t("DOT/Vector3"),t("DOT/Vector4");var n=window.Float32Array||Array;i.register("Matrix4",e);var s=e.Types={OTHER:0,IDENTITY:1,TRANSLATION_3D:2,SCALING:3,AFFINE:4};return e.identity=function(){return new e(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,s.IDENTITY)},e.translation=function(t,i,n){return new e(1,0,0,t,0,1,0,i,0,0,1,n,0,0,0,1,s.TRANSLATION_3D)},e.translationFromVector=function(t){return e.translation(t.x,t.y,t.z)},e.scaling=function(t,i,n){return i=void 0===i?t:i,n=void 0===n?t:n,new e(t,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1,s.SCALING)},e.rotationAxisAngle=function(t,i){var n=Math.cos(i),r=Math.sin(i),a=1-n;return new e(t.x*t.x*a+n,t.x*t.y*a-t.z*r,t.x*t.z*a+t.y*r,0,t.y*t.x*a+t.z*r,t.y*t.y*a+n,t.y*t.z*a-t.x*r,0,t.z*t.x*a-t.y*r,t.z*t.y*a+t.x*r,t.z*t.z*a+n,0,0,0,0,1,s.AFFINE)},e.rotationX=function(t){var i=Math.cos(t),n=Math.sin(t);return new e(1,0,0,0,0,i,-n,0,0,n,i,0,0,0,0,1,s.AFFINE)},e.rotationY=function(t){var i=Math.cos(t),n=Math.sin(t);return new e(i,0,n,0,0,1,0,0,-n,0,i,0,0,0,0,1,s.AFFINE)},e.rotationZ=function(t){var i=Math.cos(t),n=Math.sin(t);return new e(i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1,s.AFFINE)},e.gluPerspective=function(t,i,n,s){var r=Math.cos(t)/Math.sin(t);return new e(r/i,0,0,0,0,r,0,0,0,0,(s+n)/(n-s),2*s*n/(n-s),0,0,-1,0)},e.prototype={constructor:e,rowMajor:function(t,e,i,n,r,a,o,h,l,u,c,d,f,m,p,g,v){return this.entries[0]=t,this.entries[1]=r,this.entries[2]=l,this.entries[3]=f,this.entries[4]=e,this.entries[5]=a,this.entries[6]=u,this.entries[7]=m,this.entries[8]=i,this.entries[9]=o,this.entries[10]=c,this.entries[11]=p,this.entries[12]=n,this.entries[13]=h,this.entries[14]=d,this.entries[15]=g,this.type=void 0===v?0===f&&0===m&&0===p&&1===g?s.AFFINE:s.OTHER:v,this},columnMajor:function(t,e,i,n,s,r,a,o,h,l,u,c,d,f,m,p,g){return this.rowMajor(t,s,h,d,e,r,l,f,i,a,u,m,n,o,c,p,g)},set:function(t){return this.rowMajor(t.m00(),t.m01(),t.m02(),t.m03(),t.m10(),t.m11(),t.m12(),t.m13(),t.m20(),t.m21(),t.m22(),t.m23(),t.m30(),t.m31(),t.m32(),t.m33(),t.type)},m00:function(){return this.entries[0]},m01:function(){return this.entries[4]},m02:function(){return this.entries[8]},m03:function(){return this.entries[12]},m10:function(){return this.entries[1]},m11:function(){return this.entries[5]},m12:function(){return this.entries[9]},m13:function(){return this.entries[13]},m20:function(){return this.entries[2]},m21:function(){return this.entries[6]},m22:function(){return this.entries[10]},m23:function(){return this.entries[14]},m30:function(){return this.entries[3]},m31:function(){return this.entries[7]},m32:function(){return this.entries[11]},m33:function(){return this.entries[15]},isFinite:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){return isFinite(this.m00())&&isFinite(this.m01())&&isFinite(this.m02())&&isFinite(this.m03())&&isFinite(this.m10())&&isFinite(this.m11())&&isFinite(this.m12())&&isFinite(this.m13())&&isFinite(this.m20())&&isFinite(this.m21())&&isFinite(this.m22())&&isFinite(this.m23())&&isFinite(this.m30())&&isFinite(this.m31())&&isFinite(this.m32())&&isFinite(this.m33())}),getTranslation:function(){return new i.Vector3(this.m03(),this.m13(),this.m23())},get translation(){return this.getTranslation()},getScaleVector:function(){var t=this.m00()+this.m03(),e=this.m10()+this.m13(),n=this.m20()+this.m23(),s=this.m30()+this.m33(),r=this.m01()+this.m03(),a=this.m11()+this.m13(),o=this.m21()+this.m23(),h=this.m31()+this.m33(),l=this.m02()+this.m03(),u=this.m12()+this.m13(),c=this.m22()+this.m23(),d=this.m32()+this.m33();return new i.Vector3(Math.sqrt(t*t+e*e+n*n+s*s),Math.sqrt(r*r+a*a+o*o+h*h),Math.sqrt(l*l+u*u+c*c+d*d))},get scaleVector(){return this.getScaleVector()},getCSSTransform:function(){return"matrix3d("+this.entries[0].toFixed(20)+","+this.entries[1].toFixed(20)+","+this.entries[2].toFixed(20)+","+this.entries[3].toFixed(20)+","+this.entries[4].toFixed(20)+","+this.entries[5].toFixed(20)+","+this.entries[6].toFixed(20)+","+this.entries[7].toFixed(20)+","+this.entries[8].toFixed(20)+","+this.entries[9].toFixed(20)+","+this.entries[10].toFixed(20)+","+this.entries[11].toFixed(20)+","+this.entries[12].toFixed(20)+","+this.entries[13].toFixed(20)+","+this.entries[14].toFixed(20)+","+this.entries[15].toFixed(20)+")"},get cssTransform(){return this.getCSSTransform()},equals:function(t){return this.m00()===t.m00()&&this.m01()===t.m01()&&this.m02()===t.m02()&&this.m03()===t.m03()&&this.m10()===t.m10()&&this.m11()===t.m11()&&this.m12()===t.m12()&&this.m13()===t.m13()&&this.m20()===t.m20()&&this.m21()===t.m21()&&this.m22()===t.m22()&&this.m23()===t.m23()&&this.m30()===t.m30()&&this.m31()===t.m31()&&this.m32()===t.m32()&&this.m33()===t.m33()},equalsEpsilon:function(t,e){return Math.abs(this.m00()-t.m00())<e&&Math.abs(this.m01()-t.m01())<e&&Math.abs(this.m02()-t.m02())<e&&Math.abs(this.m03()-t.m03())<e&&Math.abs(this.m10()-t.m10())<e&&Math.abs(this.m11()-t.m11())<e&&Math.abs(this.m12()-t.m12())<e&&Math.abs(this.m13()-t.m13())<e&&Math.abs(this.m20()-t.m20())<e&&Math.abs(this.m21()-t.m21())<e&&Math.abs(this.m22()-t.m22())<e&&Math.abs(this.m23()-t.m23())<e&&Math.abs(this.m30()-t.m30())<e&&Math.abs(this.m31()-t.m31())<e&&Math.abs(this.m32()-t.m32())<e&&Math.abs(this.m33()-t.m33())<e},copy:function(){return new e(this.m00(),this.m01(),this.m02(),this.m03(),this.m10(),this.m11(),this.m12(),this.m13(),this.m20(),this.m21(),this.m22(),this.m23(),this.m30(),this.m31(),this.m32(),this.m33(),this.type)},plus:function(t){return new e(this.m00()+t.m00(),this.m01()+t.m01(),this.m02()+t.m02(),this.m03()+t.m03(),this.m10()+t.m10(),this.m11()+t.m11(),this.m12()+t.m12(),this.m13()+t.m13(),this.m20()+t.m20(),this.m21()+t.m21(),this.m22()+t.m22(),this.m23()+t.m23(),this.m30()+t.m30(),this.m31()+t.m31(),this.m32()+t.m32(),this.m33()+t.m33())},minus:function(t){return new e(this.m00()-t.m00(),this.m01()-t.m01(),this.m02()-t.m02(),this.m03()-t.m03(),this.m10()-t.m10(),this.m11()-t.m11(),this.m12()-t.m12(),this.m13()-t.m13(),this.m20()-t.m20(),this.m21()-t.m21(),this.m22()-t.m22(),this.m23()-t.m23(),this.m30()-t.m30(),this.m31()-t.m31(),this.m32()-t.m32(),this.m33()-t.m33())},transposed:function(){return new e(this.m00(),this.m10(),this.m20(),this.m30(),this.m01(),this.m11(),this.m21(),this.m31(),this.m02(),this.m12(),this.m22(),this.m32(),this.m03(),this.m13(),this.m23(),this.m33())},negated:function(){return new e(-this.m00(),-this.m01(),-this.m02(),-this.m03(),-this.m10(),-this.m11(),-this.m12(),-this.m13(),-this.m20(),-this.m21(),-this.m22(),-this.m23(),-this.m30(),-this.m31(),-this.m32(),-this.m33())},inverted:function(){switch(this.type){case s.IDENTITY:return this;case s.TRANSLATION_3D:return new e(1,0,0,-this.m03(),0,1,0,-this.m13(),0,0,1,-this.m23(),0,0,0,1,s.TRANSLATION_3D);case s.SCALING:return new e(1/this.m00(),0,0,0,0,1/this.m11(),0,0,0,0,1/this.m22(),0,0,0,0,1/this.m33(),s.SCALING);case s.AFFINE:case s.OTHER:var t=this.getDeterminant();if(0!==t)return new e((-this.m31()*this.m22()*this.m13()+this.m21()*this.m32()*this.m13()+this.m31()*this.m12()*this.m23()-this.m11()*this.m32()*this.m23()-this.m21()*this.m12()*this.m33()+this.m11()*this.m22()*this.m33())/t,(this.m31()*this.m22()*this.m03()-this.m21()*this.m32()*this.m03()-this.m31()*this.m02()*this.m23()+this.m01()*this.m32()*this.m23()+this.m21()*this.m02()*this.m33()-this.m01()*this.m22()*this.m33())/t,(-this.m31()*this.m12()*this.m03()+this.m11()*this.m32()*this.m03()+this.m31()*this.m02()*this.m13()-this.m01()*this.m32()*this.m13()-this.m11()*this.m02()*this.m33()+this.m01()*this.m12()*this.m33())/t,(this.m21()*this.m12()*this.m03()-this.m11()*this.m22()*this.m03()-this.m21()*this.m02()*this.m13()+this.m01()*this.m22()*this.m13()+this.m11()*this.m02()*this.m23()-this.m01()*this.m12()*this.m23())/t,(this.m30()*this.m22()*this.m13()-this.m20()*this.m32()*this.m13()-this.m30()*this.m12()*this.m23()+this.m10()*this.m32()*this.m23()+this.m20()*this.m12()*this.m33()-this.m10()*this.m22()*this.m33())/t,(-this.m30()*this.m22()*this.m03()+this.m20()*this.m32()*this.m03()+this.m30()*this.m02()*this.m23()-this.m00()*this.m32()*this.m23()-this.m20()*this.m02()*this.m33()+this.m00()*this.m22()*this.m33())/t,(this.m30()*this.m12()*this.m03()-this.m10()*this.m32()*this.m03()-this.m30()*this.m02()*this.m13()+this.m00()*this.m32()*this.m13()+this.m10()*this.m02()*this.m33()-this.m00()*this.m12()*this.m33())/t,(-this.m20()*this.m12()*this.m03()+this.m10()*this.m22()*this.m03()+this.m20()*this.m02()*this.m13()-this.m00()*this.m22()*this.m13()-this.m10()*this.m02()*this.m23()+this.m00()*this.m12()*this.m23())/t,(-this.m30()*this.m21()*this.m13()+this.m20()*this.m31()*this.m13()+this.m30()*this.m11()*this.m23()-this.m10()*this.m31()*this.m23()-this.m20()*this.m11()*this.m33()+this.m10()*this.m21()*this.m33())/t,(this.m30()*this.m21()*this.m03()-this.m20()*this.m31()*this.m03()-this.m30()*this.m01()*this.m23()+this.m00()*this.m31()*this.m23()+this.m20()*this.m01()*this.m33()-this.m00()*this.m21()*this.m33())/t,(-this.m30()*this.m11()*this.m03()+this.m10()*this.m31()*this.m03()+this.m30()*this.m01()*this.m13()-this.m00()*this.m31()*this.m13()-this.m10()*this.m01()*this.m33()+this.m00()*this.m11()*this.m33())/t,(this.m20()*this.m11()*this.m03()-this.m10()*this.m21()*this.m03()-this.m20()*this.m01()*this.m13()+this.m00()*this.m21()*this.m13()+this.m10()*this.m01()*this.m23()-this.m00()*this.m11()*this.m23())/t,(this.m30()*this.m21()*this.m12()-this.m20()*this.m31()*this.m12()-this.m30()*this.m11()*this.m22()+this.m10()*this.m31()*this.m22()+this.m20()*this.m11()*this.m32()-this.m10()*this.m21()*this.m32())/t,(-this.m30()*this.m21()*this.m02()+this.m20()*this.m31()*this.m02()+this.m30()*this.m01()*this.m22()-this.m00()*this.m31()*this.m22()-this.m20()*this.m01()*this.m32()+this.m00()*this.m21()*this.m32())/t,(this.m30()*this.m11()*this.m02()-this.m10()*this.m31()*this.m02()-this.m30()*this.m01()*this.m12()+this.m00()*this.m31()*this.m12()+this.m10()*this.m01()*this.m32()-this.m00()*this.m11()*this.m32())/t,(-this.m20()*this.m11()*this.m02()+this.m10()*this.m21()*this.m02()+this.m20()*this.m01()*this.m12()-this.m00()*this.m21()*this.m12()-this.m10()*this.m01()*this.m22()+this.m00()*this.m11()*this.m22())/t);throw new Error("Matrix could not be inverted, determinant === 0");default:throw new Error("Matrix3.inverted with unknown type: "+this.type)}},timesMatrix:function(t){if(this.type===s.IDENTITY||t.type===s.IDENTITY)return this.type===s.IDENTITY?t:this;if(this.type===t.type){if(this.type===s.TRANSLATION_3D)return new e(1,0,0,this.m03()+t.m02(),0,1,0,this.m13()+t.m12(),0,0,1,this.m23()+t.m23(),0,0,0,1,s.TRANSLATION_3D);if(this.type===s.SCALING)return new e(this.m00()*t.m00(),0,0,0,0,this.m11()*t.m11(),0,0,0,0,this.m22()*t.m22(),0,0,0,0,1,s.SCALING)}return this.type!==s.OTHER&&t.type!==s.OTHER?new e(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22(),this.m00()*t.m03()+this.m01()*t.m13()+this.m02()*t.m23()+this.m03(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22(),this.m10()*t.m03()+this.m11()*t.m13()+this.m12()*t.m23()+this.m13(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22(),this.m20()*t.m03()+this.m21()*t.m13()+this.m22()*t.m23()+this.m23(),0,0,0,1,s.AFFINE):new e(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20()+this.m03()*t.m30(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21()+this.m03()*t.m31(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22()+this.m03()*t.m32(),this.m00()*t.m03()+this.m01()*t.m13()+this.m02()*t.m23()+this.m03()*t.m33(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20()+this.m13()*t.m30(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21()+this.m13()*t.m31(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22()+this.m13()*t.m32(),this.m10()*t.m03()+this.m11()*t.m13()+this.m12()*t.m23()+this.m13()*t.m33(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20()+this.m23()*t.m30(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21()+this.m23()*t.m31(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22()+this.m23()*t.m32(),this.m20()*t.m03()+this.m21()*t.m13()+this.m22()*t.m23()+this.m23()*t.m33(),this.m30()*t.m00()+this.m31()*t.m10()+this.m32()*t.m20()+this.m33()*t.m30(),this.m30()*t.m01()+this.m31()*t.m11()+this.m32()*t.m21()+this.m33()*t.m31(),this.m30()*t.m02()+this.m31()*t.m12()+this.m32()*t.m22()+this.m33()*t.m32(),this.m30()*t.m03()+this.m31()*t.m13()+this.m32()*t.m23()+this.m33()*t.m33())},timesVector4:function(t){var e=this.m00()*t.x+this.m01()*t.y+this.m02()*t.z+this.m03()*t.w,n=this.m10()*t.x+this.m11()*t.y+this.m12()*t.z+this.m13()*t.w,s=this.m20()*t.x+this.m21()*t.y+this.m22()*t.z+this.m23()*t.w,r=this.m30()*t.x+this.m31()*t.y+this.m32()*t.z+this.m33()*t.w;return new i.Vector4(e,n,s,r)},timesVector3:function(t){return this.timesVector4(t.toVector4()).toVector3()},timesTransposeVector4:function(t){var e=this.m00()*t.x+this.m10()*t.y+this.m20()*t.z+this.m30()*t.w,n=this.m01()*t.x+this.m11()*t.y+this.m21()*t.z+this.m31()*t.w,s=this.m02()*t.x+this.m12()*t.y+this.m22()*t.z+this.m32()*t.w,r=this.m03()*t.x+this.m13()*t.y+this.m23()*t.z+this.m33()*t.w;return new i.Vector4(e,n,s,r)},timesTransposeVector3:function(t){return this.timesTransposeVector4(t.toVector4()).toVector3()},timesRelativeVector3:function(t){var e=this.m00()*t.x+this.m10()*t.y+this.m20()*t.z,n=this.m01()*t.y+this.m11()*t.y+this.m21()*t.z,s=this.m02()*t.z+this.m12()*t.y+this.m22()*t.z;return new i.Vector3(e,n,s)},getDeterminant:function(){return this.m03()*this.m12()*this.m21()*this.m30()-this.m02()*this.m13()*this.m21()*this.m30()-this.m03()*this.m11()*this.m22()*this.m30()+this.m01()*this.m13()*this.m22()*this.m30()+this.m02()*this.m11()*this.m23()*this.m30()-this.m01()*this.m12()*this.m23()*this.m30()-this.m03()*this.m12()*this.m20()*this.m31()+this.m02()*this.m13()*this.m20()*this.m31()+this.m03()*this.m10()*this.m22()*this.m31()-this.m00()*this.m13()*this.m22()*this.m31()-this.m02()*this.m10()*this.m23()*this.m31()+this.m00()*this.m12()*this.m23()*this.m31()+this.m03()*this.m11()*this.m20()*this.m32()-this.m01()*this.m13()*this.m20()*this.m32()-this.m03()*this.m10()*this.m21()*this.m32()+this.m00()*this.m13()*this.m21()*this.m32()+this.m01()*this.m10()*this.m23()*this.m32()-this.m00()*this.m11()*this.m23()*this.m32()-this.m02()*this.m11()*this.m20()*this.m33()+this.m01()*this.m12()*this.m20()*this.m33()+this.m02()*this.m10()*this.m21()*this.m33()-this.m00()*this.m12()*this.m21()*this.m33()-this.m01()*this.m10()*this.m22()*this.m33()+this.m00()*this.m11()*this.m22()*this.m33()},get determinant(){return this.getDeterminant()},toString:function(){return this.m00()+" "+this.m01()+" "+this.m02()+" "+this.m03()+"\n"+this.m10()+" "+this.m11()+" "+this.m12()+" "+this.m13()+"\n"+this.m20()+" "+this.m21()+" "+this.m22()+" "+this.m23()+"\n"+this.m30()+" "+this.m31()+" "+this.m32()+" "+this.m33()},makeImmutable:function(){this.rowMajor=function(){throw new Error("Cannot modify immutable matrix")}}},(e.IDENTITY=new e).makeImmutable(),e}),i("DOT/Matrix3",["require","DOT/dot","PHET_CORE/Poolable","DOT/Vector2","DOT/Vector3","DOT/Matrix4"],function(t){"use strict";function e(t){this.entries=[1,0,0,0,1,0,0,0,1],this.type=s.IDENTITY}var i=t("DOT/dot"),n=t("PHET_CORE/Poolable");t("DOT/Vector2"),t("DOT/Vector3"),t("DOT/Matrix4"),i.register("Matrix3",e);var s=e.Types={OTHER:0,IDENTITY:1,TRANSLATION_2D:2,SCALING:3,AFFINE:4};return e.identity=function(){return e.dirtyFromPool().setToIdentity()},e.translation=function(t,i){return e.dirtyFromPool().setToTranslation(t,i)},e.translationFromVector=function(t){return e.translation(t.x,t.y)},e.scaling=function(t,i){return e.dirtyFromPool().setToScale(t,i)},e.scale=e.scaling,e.affine=function(t,i,n,s,r,a){return e.dirtyFromPool().setToAffine(t,i,n,s,r,a)},e.rowMajor=function(t,i,n,s,r,a,o,h,l,u){return e.dirtyFromPool().rowMajor(t,i,n,s,r,a,o,h,l,u)},e.rotationAxisAngle=function(t,i){return e.dirtyFromPool().setToRotationAxisAngle(t,i)},e.rotationX=function(t){return e.dirtyFromPool().setToRotationX(t)},e.rotationY=function(t){return e.dirtyFromPool().setToRotationY(t)},e.rotationZ=function(t){return e.dirtyFromPool().setToRotationZ(t)},e.translationRotation=function(t,i,n){return e.dirtyFromPool().setToTranslationRotation(t,i,n)},e.rotation2=e.rotationZ,e.rotationAround=function(t,i,n){return e.translation(i,n).timesMatrix(e.rotation2(t)).timesMatrix(e.translation(-i,-n))},e.rotationAroundPoint=function(t,i){return e.rotationAround(t,i.x,i.y)},e.fromSVGMatrix=function(t){return e.dirtyFromPool().setToSVGMatrix(t)},e.rotateAToB=function(t,i){return e.dirtyFromPool().setRotationAToB(t,i)},e.prototype={constructor:e,m00:function(){return this.entries[0]},m01:function(){return this.entries[3]},m02:function(){return this.entries[6]},m10:function(){return this.entries[1]},m11:function(){return this.entries[4]},m12:function(){return this.entries[7]},m20:function(){return this.entries[2]},m21:function(){return this.entries[5]},m22:function(){return this.entries[8]},isIdentity:function(){return this.type===s.IDENTITY||this.equals(e.IDENTITY)},isFastIdentity:function(){return this.type===s.IDENTITY},isAffine:function(){return this.type===s.AFFINE||0===this.m20()&&0===this.m21()&&1===this.m22()},isAligned:function(){return this.isAffine()&&0===this.m01()&&0===this.m10()},isAxisAligned:function(){return this.isAffine()&&(0===this.m01()&&0===this.m10()||0===this.m00()&&0===this.m11())},isFinite:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){return isFinite(this.m00())&&isFinite(this.m01())&&isFinite(this.m02())&&isFinite(this.m10())&&isFinite(this.m11())&&isFinite(this.m12())&&isFinite(this.m20())&&isFinite(this.m21())&&isFinite(this.m22())}),getDeterminant:function(){return this.m00()*this.m11()*this.m22()+this.m01()*this.m12()*this.m20()+this.m02()*this.m10()*this.m21()-this.m02()*this.m11()*this.m20()-this.m01()*this.m10()*this.m22()-this.m00()*this.m12()*this.m21()},get determinant(){return this.getDeterminant()},getTranslation:function(){return new i.Vector2(this.m02(),this.m12())},get translation(){return this.getTranslation()},getScaleVector:function(){return new i.Vector2(Math.sqrt(this.m00()*this.m00()+this.m10()*this.m10()),Math.sqrt(this.m01()*this.m01()+this.m11()*this.m11()))},get scaleVector(){return this.getScaleVector()},getRotation:function(){return Math.atan2(this.m10(),this.m00())},get rotation(){return this.getRotation()},toMatrix4:function(){return new i.Matrix4(this.m00(),this.m01(),this.m02(),0,this.m10(),this.m11(),this.m12(),0,this.m20(),this.m21(),this.m22(),0,0,0,0,1)},toAffineMatrix4:function(){return new i.Matrix4(this.m00(),this.m01(),0,this.m02(),this.m10(),this.m11(),0,this.m12(),0,0,1,0,0,0,0,1)},toString:function(){return this.m00()+" "+this.m01()+" "+this.m02()+"\n"+this.m10()+" "+this.m11()+" "+this.m12()+"\n"+this.m20()+" "+this.m21()+" "+this.m22()},toSVGMatrix:function(){var t=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix();return t.a=this.m00(),t.b=this.m10(),t.c=this.m01(),t.d=this.m11(),t.e=this.m02(),t.f=this.m12(),t},getCSSTransform:function(){return"matrix("+this.entries[0].toFixed(20)+","+this.entries[1].toFixed(20)+","+this.entries[3].toFixed(20)+","+this.entries[4].toFixed(20)+","+this.entries[6].toFixed(20)+","+this.entries[7].toFixed(20)+")"},get cssTransform(){return this.getCSSTransform()},getSVGTransform:function(){function t(t){return t.toFixed(20)}switch(this.type){case s.IDENTITY:return"";case s.TRANSLATION_2D:return"translate("+t(this.entries[6])+","+t(this.entries[7])+")";case s.SCALING:return"scale("+t(this.entries[0])+(this.entries[0]===this.entries[4]?"":","+t(this.entries[4]))+")";default:return"matrix("+t(this.entries[0])+","+t(this.entries[1])+","+t(this.entries[3])+","+t(this.entries[4])+","+t(this.entries[6])+","+t(this.entries[7])+")"}},get svgTransform(){return this.getSVGTransform()},getCSSTransformStyles:function(){var t=this.getCSSTransform();return{"-webkit-perspective":1e3,"-webkit-backface-visibility":"hidden","-webkit-transform":t+" translateZ(0)","-moz-transform":t+" translateZ(0)","-ms-transform":t,"-o-transform":t,transform:t,"transform-origin":"top left","-ms-transform-origin":"top left"}},get cssTransformStyles(){return this.getCSSTransformStyles()},equals:function(t){return this.m00()===t.m00()&&this.m01()===t.m01()&&this.m02()===t.m02()&&this.m10()===t.m10()&&this.m11()===t.m11()&&this.m12()===t.m12()&&this.m20()===t.m20()&&this.m21()===t.m21()&&this.m22()===t.m22()},equalsEpsilon:function(t,e){return Math.abs(this.m00()-t.m00())<e&&Math.abs(this.m01()-t.m01())<e&&Math.abs(this.m02()-t.m02())<e&&Math.abs(this.m10()-t.m10())<e&&Math.abs(this.m11()-t.m11())<e&&Math.abs(this.m12()-t.m12())<e&&Math.abs(this.m20()-t.m20())<e&&Math.abs(this.m21()-t.m21())<e&&Math.abs(this.m22()-t.m22())<e},copy:function(){return e.createFromPool(this.m00(),this.m01(),this.m02(),this.m10(),this.m11(),this.m12(),this.m20(),this.m21(),this.m22(),this.type)},plus:function(t){return e.createFromPool(this.m00()+t.m00(),this.m01()+t.m01(),this.m02()+t.m02(),this.m10()+t.m10(),this.m11()+t.m11(),this.m12()+t.m12(),this.m20()+t.m20(),this.m21()+t.m21(),this.m22()+t.m22())},minus:function(t){return e.createFromPool(this.m00()-t.m00(),this.m01()-t.m01(),this.m02()-t.m02(),this.m10()-t.m10(),this.m11()-t.m11(),this.m12()-t.m12(),this.m20()-t.m20(),this.m21()-t.m21(),this.m22()-t.m22())},transposed:function(){return e.createFromPool(this.m00(),this.m10(),this.m20(),this.m01(),this.m11(),this.m21(),this.m02(),this.m12(),this.m22(),this.type===s.IDENTITY||this.type===s.SCALING?this.type:void 0)},negated:function(){return e.createFromPool(-this.m00(),-this.m01(),-this.m02(),-this.m10(),-this.m11(),-this.m12(),-this.m20(),-this.m21(),-this.m22())},inverted:function(){var t;switch(this.type){case s.IDENTITY:return this;case s.TRANSLATION_2D:return e.createFromPool(1,0,-this.m02(),0,1,-this.m12(),0,0,1,s.TRANSLATION_2D);case s.SCALING:return e.createFromPool(1/this.m00(),0,0,0,1/this.m11(),0,0,0,1/this.m22(),s.SCALING);case s.AFFINE:if(0!==(t=this.getDeterminant()))return e.createFromPool((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,0,0,1,s.AFFINE);throw new Error("Matrix could not be inverted, determinant === 0");case s.OTHER:if(0!==(t=this.getDeterminant()))return e.createFromPool((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,(-this.m11()*this.m20()+this.m10()*this.m21())/t,(this.m01()*this.m20()-this.m00()*this.m21())/t,(-this.m01()*this.m10()+this.m00()*this.m11())/t,s.OTHER);throw new Error("Matrix could not be inverted, determinant === 0");default:throw new Error("Matrix3.inverted with unknown type: "+this.type)}},timesMatrix:function(t){if(this.type===s.IDENTITY||t.type===s.IDENTITY)return this.type===s.IDENTITY?t:this;if(this.type===t.type){if(this.type===s.TRANSLATION_2D)return e.createFromPool(1,0,this.m02()+t.m02(),0,1,this.m12()+t.m12(),0,0,1,s.TRANSLATION_2D);if(this.type===s.SCALING)return e.createFromPool(this.m00()*t.m00(),0,0,0,this.m11()*t.m11(),0,0,0,1,s.SCALING)}return this.type!==s.OTHER&&t.type!==s.OTHER?e.createFromPool(this.m00()*t.m00()+this.m01()*t.m10(),this.m00()*t.m01()+this.m01()*t.m11(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02(),this.m10()*t.m00()+this.m11()*t.m10(),this.m10()*t.m01()+this.m11()*t.m11(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12(),0,0,1,s.AFFINE):e.createFromPool(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22())},timesVector2:function(t){var e=this.m00()*t.x+this.m01()*t.y+this.m02(),n=this.m10()*t.x+this.m11()*t.y+this.m12();return new i.Vector2(e,n)},timesVector3:function(t){var e=this.m00()*t.x+this.m01()*t.y+this.m02()*t.z,n=this.m10()*t.x+this.m11()*t.y+this.m12()*t.z,s=this.m20()*t.x+this.m21()*t.y+this.m22()*t.z;return new i.Vector3(e,n,s)},timesTransposeVector2:function(t){var e=this.m00()*t.x+this.m10()*t.y,n=this.m01()*t.x+this.m11()*t.y;return new i.Vector2(e,n)},timesRelativeVector2:function(t){var e=this.m00()*t.x+this.m01()*t.y,n=this.m10()*t.y+this.m11()*t.y;return new i.Vector2(e,n)},rowMajor:function(t,e,i,n,r,a,o,h,l,u){return this.entries[0]=t,this.entries[1]=n,this.entries[2]=o,this.entries[3]=e,this.entries[4]=r,this.entries[5]=h,this.entries[6]=i,this.entries[7]=a,this.entries[8]=l,this.type=void 0===u?0===o&&0===h&&1===l?s.AFFINE:s.OTHER:u,this},set:function(t){return this.rowMajor(t.m00(),t.m01(),t.m02(),t.m10(),t.m11(),t.m12(),t.m20(),t.m21(),t.m22(),t.type)},setArray:function(t){return this.rowMajor(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])},set00:function(t){return this.entries[0]=t,this},set01:function(t){return this.entries[3]=t,this},set02:function(t){return this.entries[6]=t,this},set10:function(t){return this.entries[1]=t,this},set11:function(t){return this.entries[4]=t,this},set12:function(t){return this.entries[7]=t,this},set20:function(t){return this.entries[2]=t,this},set21:function(t){return this.entries[5]=t,this},set22:function(t){return this.entries[8]=t,this},makeImmutable:function(){return this.rowMajor=function(){throw new Error("Cannot modify immutable matrix")},this},columnMajor:function(t,e,i,n,s,r,a,o,h,l){return this.rowMajor(t,n,a,e,s,o,i,r,h,l)},add:function(t){return this.rowMajor(this.m00()+t.m00(),this.m01()+t.m01(),this.m02()+t.m02(),this.m10()+t.m10(),this.m11()+t.m11(),this.m12()+t.m12(),this.m20()+t.m20(),this.m21()+t.m21(),this.m22()+t.m22())},subtract:function(t){return this.rowMajor(this.m00()-t.m00(),this.m01()-t.m01(),this.m02()-t.m02(),this.m10()-t.m10(),this.m11()-t.m11(),this.m12()-t.m12(),this.m20()-t.m20(),this.m21()-t.m21(),this.m22()-t.m22())},transpose:function(){return this.rowMajor(this.m00(),this.m10(),this.m20(),this.m01(),this.m11(),this.m21(),this.m02(),this.m12(),this.m22(),this.type===s.IDENTITY||this.type===s.SCALING?this.type:void 0)},negate:function(){return this.rowMajor(-this.m00(),-this.m01(),-this.m02(),-this.m10(),-this.m11(),-this.m12(),-this.m20(),-this.m21(),-this.m22())},invert:function(){var t;switch(this.type){case s.IDENTITY:return this;case s.TRANSLATION_2D:return this.rowMajor(1,0,-this.m02(),0,1,-this.m12(),0,0,1,s.TRANSLATION_2D);case s.SCALING:return this.rowMajor(1/this.m00(),0,0,0,1/this.m11(),0,0,0,1/this.m22(),s.SCALING);case s.AFFINE:if(0!==(t=this.getDeterminant()))return this.rowMajor((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,0,0,1,s.AFFINE);throw new Error("Matrix could not be inverted, determinant === 0");case s.OTHER:if(0!==(t=this.getDeterminant()))return this.rowMajor((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,(-this.m11()*this.m20()+this.m10()*this.m21())/t,(this.m01()*this.m20()-this.m00()*this.m21())/t,(-this.m01()*this.m10()+this.m00()*this.m11())/t,s.OTHER);throw new Error("Matrix could not be inverted, determinant === 0");default:throw new Error("Matrix3.inverted with unknown type: "+this.type)}},multiplyMatrix:function(t){if(t.type===s.IDENTITY)return this;if(this.type===s.IDENTITY)return this.set(t);if(this.type===t.type){if(this.type===s.TRANSLATION_2D)return this.rowMajor(1,0,this.m02()+t.m02(),0,1,this.m12()+t.m12(),0,0,1,s.TRANSLATION_2D);if(this.type===s.SCALING)return this.rowMajor(this.m00()*t.m00(),0,0,0,this.m11()*t.m11(),0,0,0,1,s.SCALING)}return this.type!==s.OTHER&&t.type!==s.OTHER?this.rowMajor(this.m00()*t.m00()+this.m01()*t.m10(),this.m00()*t.m01()+this.m01()*t.m11(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02(),this.m10()*t.m00()+this.m11()*t.m10(),this.m10()*t.m01()+this.m11()*t.m11(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12(),0,0,1,s.AFFINE):this.rowMajor(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22())},prependTranslation:function(t,e){return this.set02(this.m02()+t),this.set12(this.m12()+e),this.type===s.IDENTITY||this.type===s.TRANSLATION_2D?this.type=s.TRANSLATION_2D:this.type===s.OTHER?this.type=s.OTHER:this.type=s.AFFINE,this},setToIdentity:function(){return this.rowMajor(1,0,0,0,1,0,0,0,1,s.IDENTITY)},setToTranslation:function(t,e){return this.rowMajor(1,0,t,0,1,e,0,0,1,s.TRANSLATION_2D)},setToScale:function(t,e){return e=void 0===e?t:e,this.rowMajor(t,0,0,0,e,0,0,0,1,s.SCALING)},setToAffine:function(t,e,i,n,r,a){return this.rowMajor(t,e,i,n,r,a,0,0,1,s.AFFINE)},setToRotationAxisAngle:function(t,e){var i=Math.cos(e),n=Math.sin(e),r=1-i;return this.rowMajor(t.x*t.x*r+i,t.x*t.y*r-t.z*n,t.x*t.z*r+t.y*n,t.y*t.x*r+t.z*n,t.y*t.y*r+i,t.y*t.z*r-t.x*n,t.z*t.x*r-t.y*n,t.z*t.y*r+t.x*n,t.z*t.z*r+i,s.OTHER)},setToRotationX:function(t){var e=Math.cos(t),i=Math.sin(t);return this.rowMajor(1,0,0,0,e,-i,0,i,e,s.OTHER)},setToRotationY:function(t){var e=Math.cos(t),i=Math.sin(t);return this.rowMajor(e,0,i,0,1,0,-i,0,e,s.OTHER)},setToRotationZ:function(t){var e=Math.cos(t),i=Math.sin(t);return this.rowMajor(e,-i,0,i,e,0,0,0,1,s.AFFINE)},setToTranslationRotation:function(t,e,i){var n=Math.cos(i),r=Math.sin(i);return this.rowMajor(n,-r,t,r,n,e,0,0,1,s.AFFINE)},setToTranslationRotationPoint:function(t,e){return this.setToTranslationRotation(t.x,t.y,e)},setToSVGMatrix:function(t){return this.rowMajor(t.a,t.c,t.e,t.b,t.d,t.f,0,0,1,s.AFFINE)},setRotationAToB:function(t,e){var n,s,r=t,a=e,o=r.cross(a);if(n=r.dot(a),(n<0?-n:n)>.9999){var h,l,u,c=new i.Vector3(r.x>0?r.x:-r.x,r.y>0?r.y:-r.y,r.z>0?r.z:-r.z),d=(c=c.x<c.y?c.x<c.z?i.Vector3.X_UNIT:i.Vector3.Z_UNIT:c.y<c.z?i.Vector3.Y_UNIT:i.Vector3.Z_UNIT).minus(r);return o=c.minus(a),h=2/d.dot(d),l=2/o.dot(o),u=h*l*d.dot(o),this.rowMajor(-h*d.x*d.x-l*o.x*o.x+u*o.x*d.x+1,-h*d.x*d.y-l*o.x*o.y+u*o.x*d.y,-h*d.x*d.z-l*o.x*o.z+u*o.x*d.z,-h*d.y*d.x-l*o.y*o.x+u*o.y*d.x,-h*d.y*d.y-l*o.y*o.y+u*o.y*d.y+1,-h*d.y*d.z-l*o.y*o.z+u*o.y*d.z,-h*d.z*d.x-l*o.z*o.x+u*o.z*d.x,-h*d.z*d.y-l*o.z*o.y+u*o.z*d.y,-h*d.z*d.z-l*o.z*o.z+u*o.z*d.z+1)}var f,m,p,g,v;return s=1/(1+n),f=s*o.x,m=s*o.z,p=f*o.y,g=f*o.z,v=m*o.y,this.rowMajor(n+f*o.x,p-o.z,g+o.y,p+o.z,n+s*o.y*o.y,v-o.x,g-o.y,v+o.x,n+m*o.z)},multiplyVector2:function(t){return t.setXY(this.m00()*t.x+this.m01()*t.y+this.m02(),this.m10()*t.x+this.m11()*t.y+this.m12())},multiplyVector3:function(t){return t.setXYZ(this.m00()*t.x+this.m01()*t.y+this.m02()*t.z,this.m10()*t.x+this.m11()*t.y+this.m12()*t.z,this.m20()*t.x+this.m21()*t.y+this.m22()*t.z)},multiplyTransposeVector2:function(t){return t.setXY(this.m00()*t.x+this.m10()*t.y,this.m01()*t.x+this.m11()*t.y)},multiplyRelativeVector2:function(t){return t.setXY(this.m00()*t.x+this.m01()*t.y,this.m10()*t.y+this.m11()*t.y)},canvasSetTransform:function(t){t.setTransform(this.entries[0],this.entries[1],this.entries[3],this.entries[4],this.entries[6],this.entries[7])},canvasAppendTransform:function(t){this.type!==s.IDENTITY&&t.transform(this.entries[0],this.entries[1],this.entries[3],this.entries[4],this.entries[6],this.entries[7])},copyToArray:function(t){return t[0]=this.m00(),t[1]=this.m10(),t[2]=this.m20(),t[3]=this.m01(),t[4]=this.m11(),t[5]=this.m21(),t[6]=this.m02(),t[7]=this.m12(),t[8]=this.m22(),t}},n.mixInto(e,{initialize:e.prototype.rowMajor,useDefaultConstruction:!0,maxSize:300}),(e.IDENTITY=e.identity()).makeImmutable(),(e.X_REFLECTION=e.createFromPool(-1,0,0,0,1,0,0,0,1,s.AFFINE)).makeImmutable(),(e.Y_REFLECTION=e.createFromPool(1,0,0,0,-1,0,0,0,1,s.AFFINE)).makeImmutable(),e.translationTimesMatrix=function(t,i,n){var r;return n.type===s.IDENTITY||n.type===s.TRANSLATION_2D?e.createFromPool(1,0,n.m02()+t,0,1,n.m12()+i,0,0,1,s.TRANSLATION_2D):(r=n.type===s.OTHER?s.OTHER:s.AFFINE,e.createFromPool(n.m00(),n.m01(),n.m02()+t,n.m10(),n.m11(),n.m12()+i,n.m20(),n.m21(),n.m22(),r))},e.printer={print:function(t){console.log(t.toString())}},e}),i("DOT/MatrixOps3",["require","DOT/dot"],function(t){"use strict";var e=t("DOT/dot"),i=Math.sqrt(.5),n={Array:e.FastArray,index3:function(t,e){return 3*t+e},set3:function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]},transpose3:function(t,e){var i=t[3],n=t[6],s=t[1],r=t[7],a=t[2],o=t[5];e[0]=t[0],e[1]=i,e[2]=n,e[3]=s,e[4]=t[4],e[5]=r,e[6]=a,e[7]=o,e[8]=t[8]},det3:function(t){return t[0]*t[4]*t[8]+t[1]*t[5]*t[6]+t[2]*t[3]*t[7]-t[2]*t[4]*t[6]-t[1]*t[3]*t[8]-t[0]*t[5]*t[7]},mult3:function(t,e,i){var n=t[0]*e[0]+t[1]*e[3]+t[2]*e[6],s=t[0]*e[1]+t[1]*e[4]+t[2]*e[7],r=t[0]*e[2]+t[1]*e[5]+t[2]*e[8],a=t[3]*e[0]+t[4]*e[3]+t[5]*e[6],o=t[3]*e[1]+t[4]*e[4]+t[5]*e[7],h=t[3]*e[2]+t[4]*e[5]+t[5]*e[8],l=t[6]*e[0]+t[7]*e[3]+t[8]*e[6],u=t[6]*e[1]+t[7]*e[4]+t[8]*e[7],c=t[6]*e[2]+t[7]*e[5]+t[8]*e[8];i[0]=n,i[1]=s,i[2]=r,i[3]=a,i[4]=o,i[5]=h,i[6]=l,i[7]=u,i[8]=c},mult3LeftTranspose:function(t,e,i){var n=t[0]*e[0]+t[3]*e[3]+t[6]*e[6],s=t[0]*e[1]+t[3]*e[4]+t[6]*e[7],r=t[0]*e[2]+t[3]*e[5]+t[6]*e[8],a=t[1]*e[0]+t[4]*e[3]+t[7]*e[6],o=t[1]*e[1]+t[4]*e[4]+t[7]*e[7],h=t[1]*e[2]+t[4]*e[5]+t[7]*e[8],l=t[2]*e[0]+t[5]*e[3]+t[8]*e[6],u=t[2]*e[1]+t[5]*e[4]+t[8]*e[7],c=t[2]*e[2]+t[5]*e[5]+t[8]*e[8];i[0]=n,i[1]=s,i[2]=r,i[3]=a,i[4]=o,i[5]=h,i[6]=l,i[7]=u,i[8]=c},mult3RightTranspose:function(t,e,i){var n=t[0]*e[0]+t[1]*e[1]+t[2]*e[2],s=t[0]*e[3]+t[1]*e[4]+t[2]*e[5],r=t[0]*e[6]+t[1]*e[7]+t[2]*e[8],a=t[3]*e[0]+t[4]*e[1]+t[5]*e[2],o=t[3]*e[3]+t[4]*e[4]+t[5]*e[5],h=t[3]*e[6]+t[4]*e[7]+t[5]*e[8],l=t[6]*e[0]+t[7]*e[1]+t[8]*e[2],u=t[6]*e[3]+t[7]*e[4]+t[8]*e[5],c=t[6]*e[6]+t[7]*e[7]+t[8]*e[8];i[0]=n,i[1]=s,i[2]=r,i[3]=a,i[4]=o,i[5]=h,i[6]=l,i[7]=u,i[8]=c},mult3BothTranspose:function(t,e,i){var n=t[0]*e[0]+t[3]*e[1]+t[6]*e[2],s=t[0]*e[3]+t[3]*e[4]+t[6]*e[5],r=t[0]*e[6]+t[3]*e[7]+t[6]*e[8],a=t[1]*e[0]+t[4]*e[1]+t[7]*e[2],o=t[1]*e[3]+t[4]*e[4]+t[7]*e[5],h=t[1]*e[6]+t[4]*e[7]+t[7]*e[8],l=t[2]*e[0]+t[5]*e[1]+t[8]*e[2],u=t[2]*e[3]+t[5]*e[4]+t[8]*e[5],c=t[2]*e[6]+t[5]*e[7]+t[8]*e[8];i[0]=n,i[1]=s,i[2]=r,i[3]=a,i[4]=o,i[5]=h,i[6]=l,i[7]=u,i[8]=c},mult3Vector3:function(t,e,i){var n=t[0]*e.x+t[1]*e.y+t[2]*e.z,s=t[3]*e.x+t[4]*e.y+t[5]*e.z,r=t[6]*e.x+t[7]*e.y+t[8]*e.z;i.x=n,i.y=s,i.z=r},swapNegateColumn:function(t,e,i){var n=t[e],s=t[e+3],r=t[e+6];t[e]=t[i],t[e+3]=t[i+3],t[e+6]=t[i+6],t[i]=-n,t[i+3]=-s,t[i+6]=-r},setIdentity3:function(t){t[0]=t[4]=t[8]=1,t[1]=t[2]=t[3]=t[5]=t[6]=t[7]=0},setGivens3:function(t,e,i,n,s){this.setIdentity3(t),t[this.index3(n,n)]=e,t[this.index3(s,s)]=e,t[this.index3(n,s)]=i,t[this.index3(s,n)]=-i},preMult3Givens:function(t,e,i,n,s){var r=3*n,a=3*s,o=e*t[r+0]+i*t[a+0],h=e*t[a+0]-i*t[r+0],l=e*t[r+1]+i*t[a+1],u=e*t[a+1]-i*t[r+1],c=e*t[r+2]+i*t[a+2],d=e*t[a+2]-i*t[r+2];t[r+0]=o,t[a+0]=h,t[r+1]=l,t[a+1]=u,t[r+2]=c,t[a+2]=d},postMult3Givens:function(t,e,i,n,s){var r=e*t[n+0]+i*t[s+0],a=e*t[s+0]-i*t[n+0],o=e*t[n+3]+i*t[s+3],h=e*t[s+3]-i*t[n+3],l=e*t[n+6]+i*t[s+6],u=e*t[s+6]-i*t[n+6];t[n+0]=r,t[s+0]=a,t[n+3]=o,t[s+3]=h,t[n+6]=l,t[s+6]=u},applyJacobi3:function(t,e,n,s){var r=t[3*n+n],a=t[3*n+s],o=t[3*s+s],h=a*a,l=r-o,u=h<(l*=l),c=1/Math.sqrt(h+l),d=u?c*(r-o):i,f=u?c*a:i;this.preMult3Givens(t,d,f,n,s),this.postMult3Givens(t,d,f,n,s),this.preMult3Givens(e,d,f,n,s)},jacobiIteration3:function(t,e,i){for(var n=0;n<i;n++)this.applyJacobi3(t,e,0,1),this.applyJacobi3(t,e,0,2),this.applyJacobi3(t,e,1,2)},qrAnnihilate3:function(t,e,i,n){var s,r,a=e[this.index3(n,n)],o=e[this.index3(i,n)],h=a*a,l=o*o;if(h+l<1e-10)s=a>0?1:0,r=0;else{var u=1/Math.sqrt(h+l);s=u*a,r=u*o}this.preMult3Givens(e,s,r,n,i),this.postMult3Givens(t,s,r,n,i)},svd3:function(t,e,i,n,s){var r=i,a=s,o=n;this.mult3LeftTranspose(t,t,o),this.setIdentity3(r),this.jacobiIteration3(o,r,e),this.transpose3(r,a),this.mult3(t,a,o);var h,l=o[0]*o[0]+o[3]*o[3]+o[6]*o[6],u=o[1]*o[1]+o[4]*o[4]+o[7]*o[7],c=o[2]*o[2]+o[5]*o[5]+o[8]*o[8];l<u&&(h=l,l=u,u=h,this.swapNegateColumn(o,0,1),this.swapNegateColumn(a,0,1)),l<c&&(h=l,l=c,c=h,this.swapNegateColumn(o,0,2),this.swapNegateColumn(a,0,2)),u<c&&(this.swapNegateColumn(o,1,2),this.swapNegateColumn(a,1,2)),this.setIdentity3(r),this.qrAnnihilate3(r,o,1,0),this.qrAnnihilate3(r,o,2,0),this.qrAnnihilate3(r,o,2,1);r[0]*r[0]+r[1]*r[1]+r[2]*r[2]<.001&&(r[0]=1),r[3]*r[3]+r[4]*r[4]+r[5]*r[5]<.001&&(r[4]=1),r[6]*r[6]+r[7]*r[7]+r[8]*r[8]<.001&&(r[8]=1)},setVectors3:function(t,e){for(var i=t.length,n=0;n<i;n++){var s=t[n];e[n]=s.x,e[n+i]=s.y,e[n+2*i]=s.z}},getColumnVector3:function(t,e,i,n,s){s.x=i[n],s.y=i[n+e],s.z=i[n+2*e]},index:function(t,e,i,n){return e*i+n},transpose:function(t,e,i,n){for(var s=0;s<t;s++)for(var r=0;r<e;r++)n[t*r+s]=i[e*s+r]},mult:function(t,e,i,n,s,r){for(var a=0;a<t;a++)for(var o=0;o<i;o++){for(var h=0,l=0;l<e;l++)h+=n[this.index(t,e,a,l)]*s[this.index(e,i,l,o)];r[this.index(t,i,a,o)]=h}},multRightTranspose:function(t,e,i,n,s,r){for(var a=0;a<t;a++)for(var o=0;o<i;o++){for(var h=0,l=0;l<e;l++)h+=n[this.index(t,e,a,l)]*s[this.index(i,e,o,l)];r[this.index(t,i,a,o)]=h}},permuteColumns:function(t,e,i,n,s){for(var r=0;r<e;r++)for(var a=n.indices[r],o=0;o<t;o++)s[this.index(t,e,o,r)]=i[this.index(t,e,o,a)]}};return e.register("MatrixOps3",n),n}),i("DOT/Permutation",["require","DOT/dot","PHET_CORE/isArray","DOT/Util"],function(t){"use strict";function e(t){this.indices=t}function i(t,e,n){if(0===t.length)n(e);else for(var s=0;s<t.length;s++){var r=t[s],a=t.slice(0);a.splice(s,1);var o=e.slice(0);o.push(r),i(a,o,n)}}var n=t("DOT/dot"),s=t("PHET_CORE/isArray");return t("DOT/Util"),n.register("Permutation",e),e.identity=function(t){for(var i=new Array(t),n=0;n<t;n++)i[n]=n;return new e(i)},e.permutations=function(t){var i=[];return e.forEachPermutation(n.rangeInclusive(0,t-1),function(t){i.push(new e(t))}),i},e.forEachPermutation=function(t,e){i(t,[],e)},e.prototype={constructor:e,size:function(){return this.indices.length},apply:function(t){if(s(t)){if(t.length!==this.size())throw new Error("Permutation length "+this.size()+" not equal to list length "+t.length);for(var e=new Array(t.length),i=0;i<t.length;i++)e[i]=t[this.indices[i]];return e}return this.indices[t]},inverted:function(){for(var t=new Array(this.size()),i=0;i<this.size();i++)t[this.indices[i]]=i;return new e(t)},withIndicesPermuted:function(t){var i=[],n=this;return e.forEachPermutation(t,function(s){for(var r=n.indices,a=r.slice(0),o=0;o<t.length;o++)a[t[o]]=r[s[o]];i.push(new e(a))}),i},toString:function(){return"P["+this.indices.join(", ")+"]"}},e.testMe=function(t){var i=new e([1,4,3,2,0]);t.log(i.toString());var n=i.inverted();t.log(n.toString()),t.log(n.withIndicesPermuted([0,3,4]).toString()),t.log(e.permutations(4).toString())},e}),i("DOT/Plane3",["require","DOT/dot","DOT/Vector3"],function(t){"use strict";function e(t,e){this.normal=t,this.distance=e}var i=t("DOT/dot"),n=t("DOT/Vector3");return i.register("Plane3",e),e.prototype={constructor:e,intersectWithRay:function(t){return t.pointAtDistance(t.distanceToPlane(this))}},e.XY=new e(new n(0,0,1),0),e.XZ=new e(new n(0,1,0),0),e.YZ=new e(new n(1,0,0),0),e.fromTriangle=function(t,i,n){var s=n.minus(t).cross(i.minus(t));return 0===s.magnitude?null:(s.normalize(),new e(s,s.dot(t)))},e}),i("DOT/Quaternion",["require","DOT/dot","PHET_CORE/Poolable","DOT/Vector3","DOT/Matrix3","DOT/Util"],function(t){"use strict";function e(t,e,i,n){this.setXYZW(t,e,i,n)}var i=t("DOT/dot"),n=t("PHET_CORE/Poolable");return t("DOT/Vector3"),t("DOT/Matrix3"),t("DOT/Util"),i.register("Quaternion",e),e.prototype={constructor:e,isQuaternion:!0,setXYZW:function(t,e,i,n){this.x=void 0!==t?t:0,this.y=void 0!==e?e:0,this.z=void 0!==i?i:0,this.w=void 0!==n?n:1},plus:function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},timesScalar:function(t){return new e(this.x*t,this.y*t,this.z*t,this.w*t)},timesQuaternion:function(t){return new e(this.x*t.w-this.z*t.y+this.y*t.z+this.w*t.x,-this.x*t.z+this.y*t.w+this.z*t.x+this.w*t.y,this.x*t.y-this.y*t.x+this.z*t.w+this.w*t.z,-this.x*t.x-this.y*t.y-this.z*t.z+this.w*t.w)},timesVector3:function(t){return 0===t.magnitude?new i.Vector3(0,0,0):new i.Vector3(this.w*this.w*t.x+2*this.y*this.w*t.z-2*this.z*this.w*t.y+this.x*this.x*t.x+2*this.y*this.x*t.y+2*this.z*this.x*t.z-this.z*this.z*t.x-this.y*this.y*t.x,2*this.x*this.y*t.x+this.y*this.y*t.y+2*this.z*this.y*t.z+2*this.w*this.z*t.x-this.z*this.z*t.y+this.w*this.w*t.y-2*this.x*this.w*t.z-this.x*this.x*t.y,2*this.x*this.z*t.x+2*this.y*this.z*t.y+this.z*this.z*t.z-2*this.w*this.y*t.x-this.y*this.y*t.z+2*this.w*this.x*t.y-this.x*this.x*t.z+this.w*this.w*t.z)},getMagnitude:function(){return Math.sqrt(this.magnitudeSquared())},get magnitude(){return this.getMagnitude()},magnitudeSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},normalized:function(){var t=this.magnitude;return this.timesScalar(1/t)},negated:function(){return new e(-this.x,-this.y,-this.z,-this.w)},toRotationMatrix:function(){var t=this.magnitudeSquared(),e=1===t?2:t>0?2/t:0,n=this.x*this.x*e,s=this.x*this.y*e,r=this.x*this.z*e,a=this.w*this.x*e,o=this.y*this.y*e,h=this.y*this.z*e,l=this.w*this.y*e,u=this.z*this.z*e,c=this.w*this.z*e;return i.Matrix3.dirtyFromPool().columnMajor(1-(o+u),s+c,r-l,s-c,1-(n+u),h+a,r+l,h-a,1-(n+o))}},e.fromEulerAngles=function(t,i,n){var s=Math.sin(.5*n),r=Math.cos(.5*n),a=Math.sin(.5*i),o=Math.cos(.5*i),h=Math.sin(.5*t),l=Math.cos(.5*t),u=o*r,c=a*s,d=o*s,f=a*r;return new e(u*h+c*l,f*l+d*h,d*l-f*h,u*l-c*h)},e.fromRotationMatrix=function(t){var i,n=t.m00(),s=t.m01(),r=t.m02(),a=t.m10(),o=t.m11(),h=t.m12(),l=t.m20(),u=t.m21(),c=t.m22(),d=n+o+c;return d>=0?(i=Math.sqrt(d+1),new e(.5*(u-h)/i,.5*(r-l)/i,.5*(a-s)/i,.5*i)):n>o&&n>c?(i=Math.sqrt(1+n-o-c),new e(.5*i,.5*(a+s)/i,.5*(r+l)/i,.5*(u-h)/i)):o>c?(i=Math.sqrt(1+o-n-c),new e(.5*(a+s)/i,.5*i,.5*(u+h)/i,.5*(r-l)/i)):(i=Math.sqrt(1+c-n-o),new e(.5*(r+l)/i,.5*(u+h)/i,.5*i,.5*(a-s)/i))},e.getRotationQuaternion=function(t,n){return e.fromRotationMatrix(i.Matrix3.rotateAToB(t,n))},e.slerp=function(t,i,n){if(t.x===i.x&&t.y===i.y&&t.z===i.z&&t.w===i.w)return t;var s=t.x*i.x+t.y*i.y+t.z*i.z+t.w*i.w;s<0&&(i=i.negated(),s=-s);var r=1-n,a=n;if(1-s>.1){var o=Math.acos(s),h=1/Math.sin(o);r=Math.sin((1-n)*o)*h,a=Math.sin(n*o)*h}return new e(r*t.x+a*i.x,r*t.y+a*i.y,r*t.z+a*i.z,r*t.w+a*i.w)},n.mixInto(e,{initialize:e.prototype.setXYZW}),e}),i("DOT/Random",["require","DOT/dot","PHET_CORE/inherit","DOT/Util"],function(t){"use strict";function e(t){null!==(t=_.extend({seed:null,staticSeed:!1},t)).seed&&t.staticSeed;var e=t.staticSeed?window.phet.chipper.randomSeed:t.seed;this.setSeed(e)}var i=t("DOT/dot"),n=t("PHET_CORE/inherit"),s=t("DOT/Util");return n(Object,e,{setSeed:function(t){this.seed=t,this.seedrandom=null!==this.seed?new Math.seedrandom(this.seed+""):null},nextBoolean:function(){return this.nextDouble()>=.5},nextInt:function(t){return 0|this.nextDouble()*t},nextIntBetween:function(t,e){var i=e-t;return this.nextInt(i+1)+t},sample:function(t){return t[this.nextIntBetween(0,t.length-1)]},shuffle:function(t){var e=this,i=-1,n=new Array(t.length);return _.forEach(t,function(t){var s=e.nextIntBetween(0,++i);n[i]=n[s],n[s]=t}),n},nextDouble:function(){return null===this.seed?Math.random():this.seedrandom()},nextGaussian:function(){return s.boxMullerTransform(0,1,this)}}),i.register("Random",e),e}),i("DOT/Ray2",["require","DOT/dot"],function(t){"use strict";function e(t,e){this.position=t,this.direction=e}return t("DOT/dot").register("Ray2",e),e.prototype={constructor:e,shifted:function(t){return new e(this.pointAtDistance(t),this.direction)},pointAtDistance:function(t){return this.position.plus(this.direction.timesScalar(t))},toString:function(){return this.position.toString()+" => "+this.direction.toString()}},e}),i("DOT/Ray3",["require","DOT/dot"],function(t){"use strict";function e(t,e){this.position=t,this.direction=e}return t("DOT/dot").register("Ray3",e),e.prototype={constructor:e,shifted:function(t){return new e(this.pointAtDistance(t),this.direction)},pointAtDistance:function(t){return this.position.plus(this.direction.timesScalar(t))},distanceToPlane:function(t){return(t.distance-this.position.dot(t.normal))/this.direction.dot(t.normal)},toString:function(){return this.position.toString()+" => "+this.direction.toString()}},e}),i("DOT/Rectangle",["require","DOT/Bounds2","DOT/dot","PHET_CORE/inherit"],function(t){"use strict";function e(t,e,n,s){i.call(this,t,e,t+n,e+s)}var i=t("DOT/Bounds2"),n=t("DOT/dot"),s=t("PHET_CORE/inherit");return n.register("Rectangle",e),s(i,e),e}),i("DOT/Sphere3",["require","DOT/dot","PHET_CORE/inherit"],function(t){"use strict";function e(t,e){this.center=t,this.radius=e}var i=t("DOT/dot"),n=t("PHET_CORE/inherit");return i.register("Sphere3",e),n(Object,e,{intersect:function(t,e){var i=t.direction,n=t.position,s=n.minus(this.center),r=i.dot(s),a=4*r*r-4*(s.magnitudeSquared()-this.radius*this.radius);if(a<e)return null;var o=i.dot(this.center)-i.dot(n),h=Math.sqrt(a)/2,l=o-h,u=o+h;if(u<e)return null;var c=t.pointAtDistance(u),d=c.minus(this.center).normalized();if(l<e)return{distance:u,hitPoint:c,normal:d.negated(),fromOutside:!1};var f=t.pointAtDistance(l);return{distance:l,hitPoint:f,normal:f.minus(this.center).normalized(),fromOutside:!0}},intersections:function(t,e){var i=t.direction,n=t.position,s=n.minus(this.center),r=i.dot(s),a=4*r*r-4*(s.magnitudeSquared()-this.radius*this.radius);if(a<e)return[];var o=i.dot(this.center)-i.dot(n),h=Math.sqrt(a)/2,l=o-h,u=o+h;if(u<e)return[];var c=t.pointAtDistance(u),d=c.minus(this.center).normalized(),f=t.pointAtDistance(l),m=f.minus(this.center).normalized(),p={distance:u,hitPoint:c,normal:d.negated(),fromOutside:!1},g={distance:l,hitPoint:f,normal:m,fromOutside:!0};return l<e?[p,g]:[g,p]}}),e}),i("DOT/Transform3",["require","DOT/dot","AXON/Events","PHET_CORE/inherit","DOT/Matrix3","DOT/Vector2","DOT/Ray2"],function(t){"use strict";function e(t){n.call(this),this.matrix=i.Matrix3.IDENTITY.copy(),this.inverse=i.Matrix3.IDENTITY.copy(),this.matrixTransposed=i.Matrix3.IDENTITY.copy(),this.inverseTransposed=i.Matrix3.IDENTITY.copy(),this.inverseValid=!0,this.transposeValid=!0,this.inverseTransposeValid=!0,t&&this.setMatrix(t)}var i=t("DOT/dot"),n=t("AXON/Events"),s=t("PHET_CORE/inherit");t("DOT/Matrix3"),t("DOT/Vector2"),t("DOT/Ray2");var r=new i.Matrix3;return i.register("Transform3",e),s(n,e,{setMatrix:function(t){this.matrix.set(t),this.invalidate()},invalidate:function(){this.inverseValid=!1,this.transposeValid=!1,this.inverseTransposeValid=!1,this.trigger0("change")},prepend:function(t){r.set(this.matrix),this.matrix.set(t),this.matrix.multiplyMatrix(r),this.invalidate()},prependTranslation:function(t,e){this.matrix.prependTranslation(t,e),this.invalidate()},append:function(t){this.matrix.multiplyMatrix(t),this.invalidate()},prependTransform:function(t){this.prepend(t.matrix)},appendTransform:function(t){this.append(t.matrix)},applyToCanvasContext:function(t){t.setTransform(this.matrix.m00(),this.matrix.m10(),this.matrix.m01(),this.matrix.m11(),this.matrix.m02(),this.matrix.m12())},copy:function(){var t=new e(this.matrix);t.inverse=this.inverse,t.matrixTransposed=this.matrixTransposed,t.inverseTransposed=this.inverseTransposed,t.inverseValid=this.inverseValid,t.transposeValid=this.transposeValid,t.inverseTransposeValid=this.inverseTransposeValid},getMatrix:function(){return this.matrix},getInverse:function(){return this.inverseValid||(this.inverseValid=!0,this.inverse.set(this.matrix),this.inverse.invert()),this.inverse},getMatrixTransposed:function(){return this.transposeValid||(this.transposeValid=!0,this.matrixTransposed.set(this.matrix),this.matrixTransposed.transpose()),this.matrixTransposed},getInverseTransposed:function(){return this.inverseTransposeValid||(this.inverseTransposeValid=!0,this.inverseTransposed.set(this.getInverse()),this.inverseTransposed.transpose()),this.inverseTransposed},isIdentity:function(){return this.matrix.type===i.Matrix3.Types.IDENTITY},isFinite:function(){return this.matrix.isFinite()},transformPosition2:function(t){return this.matrix.timesVector2(t)},transformDelta2:function(t){var e=this.getMatrix();return new i.Vector2(e.m00()*t.x+e.m01()*t.y,e.m10()*t.x+e.m11()*t.y)},transformNormal2:function(t){return this.getInverse().timesTransposeVector2(t).normalize()},transformX:function(t){var e=this.getMatrix();return e.m00()*t+e.m02()},transformY:function(t){var e=this.getMatrix();return e.m11()*t+e.m12()},transformDeltaX:function(t){return this.getMatrix().m00()*t},transformDeltaY:function(t){return this.getMatrix().m11()*t},transformBounds2:function(t){return t.transformed(this.matrix)},transformShape:function(t){return t.transformed(this.matrix)},transformRay2:function(t){return new i.Ray2(this.transformPosition2(t.position),this.transformDelta2(t.direction).normalized())},inversePosition2:function(t){return this.getInverse().timesVector2(t)},inverseDelta2:function(t){var e=this.getInverse();return new i.Vector2(e.m00()*t.x+e.m01()*t.y,e.m10()*t.x+e.m11()*t.y)},inverseNormal2:function(t){return this.matrix.timesTransposeVector2(t).normalize()},inverseX:function(t){var e=this.getInverse();return e.m00()*t+e.m02()},inverseY:function(t){var e=this.getInverse();return e.m11()*t+e.m12()},inverseDeltaX:function(t){var e=this.getInverse();return e.m00()*t},inverseDeltaY:function(t){var e=this.getInverse();return e.m11()*t},inverseBounds2:function(t){return t.transformed(this.getInverse())},inverseShape:function(t){return t.transformed(this.getInverse())},inverseRay2:function(t){return new i.Ray2(this.inversePosition2(t.position),this.inverseDelta2(t.direction).normalized())}}),e}),i("DOT/Transform4",["require","DOT/dot","AXON/Events","PHET_CORE/inherit","DOT/Matrix4","DOT/Vector3","DOT/Ray3"],function(t){"use strict";function e(t){n.call(this),this.matrix=i.Matrix4.IDENTITY.copy(),this.inverse=i.Matrix4.IDENTITY.copy(),this.matrixTransposed=i.Matrix4.IDENTITY.copy(),this.inverseTransposed=i.Matrix4.IDENTITY.copy(),this.inverseValid=!0,this.transposeValid=!0,this.inverseTransposeValid=!0,t&&this.setMatrix(t)}var i=t("DOT/dot"),n=t("AXON/Events"),s=t("PHET_CORE/inherit");t("DOT/Matrix4"),t("DOT/Vector3"),t("DOT/Ray3");var r=new i.Matrix4;return i.register("Transform4",e),s(n,e,{setMatrix:function(t){this.matrix.set(t),this.invalidate()},invalidate:function(){this.inverseValid=!1,this.transposeValid=!1,this.inverseTransposeValid=!1,this.trigger0("change")},prepend:function(t){r.set(this.matrix),this.matrix.set(t),this.matrix.multiplyMatrix(r),this.invalidate()},append:function(t){this.matrix.multiplyMatrix(t),this.invalidate()},prependTransform:function(t){this.prepend(t.matrix)},appendTransform:function(t){this.append(t.matrix)},applyToCanvasContext:function(t){t.setTransform(this.matrix.m00(),this.matrix.m10(),this.matrix.m01(),this.matrix.m11(),this.matrix.m03(),this.matrix.m13())},copy:function(){var t=new e(this.matrix);t.inverse=this.inverse,t.matrixTransposed=this.matrixTransposed,t.inverseTransposed=this.inverseTransposed,t.inverseValid=this.inverseValid,t.transposeValid=this.transposeValid,t.inverseTransposeValid=this.inverseTransposeValid},getMatrix:function(){return this.matrix},getInverse:function(){return this.inverseValid||(this.inverseValid=!0,this.inverse.set(this.matrix),this.inverse.invert()),this.inverse},getMatrixTransposed:function(){return this.transposeValid||(this.transposeValid=!0,this.matrixTransposed.set(this.matrix),this.matrixTransposed.transpose()),this.matrixTransposed},getInverseTransposed:function(){return this.inverseTransposeValid||(this.inverseTransposeValid=!0,this.inverseTransposed.set(this.getInverse()),this.inverseTransposed.transpose()),this.inverseTransposed},isIdentity:function(){return this.matrix.type===i.Matrix4.Types.IDENTITY},isFinite:function(){return this.matrix.isFinite()},transformPosition3:function(t){return this.matrix.timesVector3(t)},transformDelta3:function(t){return this.matrix.timesRelativeVector3(t)},transformNormal3:function(t){return this.getInverse().timesTransposeVector3(t)},transformDeltaX:function(t){return this.transformDelta3(new i.Vector3(t,0,0)).x},transformDeltaY:function(t){return this.transformDelta3(new i.Vector3(0,t,0)).y},transformDeltaZ:function(t){return this.transformDelta3(new i.Vector3(0,0,t)).z},transformRay:function(t){return new i.Ray3(this.transformPosition3(t.position),this.transformPosition3(t.position.plus(t.direction)).minus(this.transformPosition3(t.position)))},inversePosition3:function(t){return this.getInverse().timesVector3(t)},inverseDelta3:function(t){return this.inversePosition3(t).minus(this.inversePosition3(i.Vector3.ZERO))},inverseNormal3:function(t){return this.matrix.timesTransposeVector3(t)},inverseDeltaX:function(t){return this.inverseDelta3(new i.Vector3(t,0,0)).x},inverseDeltaY:function(t){return this.inverseDelta3(new i.Vector3(0,t,0)).y},inverseDeltaZ:function(t){return this.inverseDelta3(new i.Vector3(0,0,t)).z},inverseRay:function(t){return new i.Ray3(this.inversePosition3(t.position),this.inversePosition3(t.position.plus(t.direction)).minus(this.inversePosition3(t.position)))}}),e}),i("DOT/main",["DOT/dot","DOT/BinPacker","DOT/Bounds2","DOT/Bounds3","DOT/Complex","DOT/ConvexHull2","DOT/DampedHarmonic","DOT/DelaunayTriangulation","DOT/Dimension2","DOT/EigenvalueDecomposition","DOT/LinearFunction","DOT/LUDecomposition","DOT/Matrix","DOT/Matrix3","DOT/Matrix4","DOT/MatrixOps3","DOT/Permutation","DOT/Plane3","DOT/QRDecomposition","DOT/Quaternion","DOT/Random","DOT/Range","DOT/Ray2","DOT/Ray3","DOT/Rectangle","DOT/SingularValueDecomposition","DOT/Sphere3","DOT/Transform3","DOT/Transform4","DOT/Util","DOT/Vector2","DOT/Vector3","DOT/Vector4"],function(t){"use strict";return t}),i("KITE/kite",["require","PHET_CORE/Namespace"],function(t){"use strict";var e=new(t("PHET_CORE/Namespace"))("kite");return e.register("svgNumber",function(t){return t.toFixed(20)}),e}),i("KITE/util/Overlap",["require","PHET_CORE/inherit","KITE/kite"],function(t){"use strict";function e(t,e){this.a=t,this.b=e;var i=0,n=1,s=this.apply(i),r=this.apply(n);s>1&&(s=1,i=this.applyInverse(s)),s<0&&(s=0,i=this.applyInverse(s)),r>1&&(r=1,n=this.applyInverse(r)),r<0&&(r=0,n=this.applyInverse(r)),this.t0=i,this.t1=n,t>0?(this.qt0=s,this.qt1=r):(this.qt0=r,this.qt1=s),this.t0<0&&this.t0>-1e-8&&(this.t0=0),this.t0>1&&this.t0<1+1e-8&&(this.t0=1),this.t1<0&&this.t1>-1e-8&&(this.t1=0),this.t1>1&&this.t1<1+1e-8&&(this.t1=1),this.qt0<0&&this.qt0>-1e-8&&(this.qt0=0),this.qt0>1&&this.qt0<1+1e-8&&(this.qt0=1),this.qt1<0&&this.qt1>-1e-8&&(this.qt1=0),this.qt1>1&&this.qt1<1+1e-8&&(this.qt1=1)}var i=t("PHET_CORE/inherit"),n=t("KITE/kite");return n.register("Overlap",e),i(Object,e,{apply:function(t){return this.a*t+this.b},applyInverse:function(t){return(t-this.b)/this.a}},{createLinear:function(t,i,n,s){var r=(s-i)/(n-t);return new e(r,i-t*r)}}),n.Overlap}),i("KITE/util/RayIntersection",["require","PHET_CORE/inherit","KITE/kite","DOT/Util","DOT/Vector2"],function(t){"use strict";function e(t,e,i,n,r){this.point=e,this.normal=i,this.distance=t,this.wind=n,this.t=s.clamp(r,0,1)}var i=t("PHET_CORE/inherit"),n=t("KITE/kite"),s=t("DOT/Util");t("DOT/Vector2");return n.register("RayIntersection",e),i(Object,e),e}),i("KITE/util/SegmentIntersection",["require","PHET_CORE/inherit","KITE/kite","DOT/Util","DOT/Vector2"],function(t){"use strict";function e(t,e,i){this.point=t,this.aT=s.clamp(e,0,1),this.bT=s.clamp(i,0,1)}var i=t("PHET_CORE/inherit"),n=t("KITE/kite"),s=t("DOT/Util");t("DOT/Vector2");return n.register("SegmentIntersection",e),i(Object,e,{getSwapped:function(){return new e(this.point,this.bT,this.aT)}}),e}),i("KITE/ops/BoundsIntersection",["require","PHET_CORE/inherit","KITE/kite","PHET_CORE/Poolable","KITE/util/SegmentIntersection","DOT/Vector2"],function(t){"use strict";function e(t,e,i,n,s,r,a,o,h,l){this.initialize(t,e,i,n,s,r,a,o,h,l)}var i=t("PHET_CORE/inherit"),n=t("KITE/kite"),s=t("PHET_CORE/Poolable"),r=t("KITE/util/SegmentIntersection");t("DOT/Vector2");return n.register("BoundsIntersection",e),i(Object,e,{initialize:function(t,e,i,n,s,r,a,o,h,l){return this.a=t,this.b=e,this.atMin=i,this.atMax=n,this.btMin=s,this.btMax=r,this.aMin=a,this.aMax=o,this.bMin=h,this.bMax=l,this},pushSubdivisions:function(t){var i=(this.atMax+this.atMin)/2,n=(this.btMax+this.btMin)/2;if(i!==this.atMin&&i!==this.atMax&&n!==this.btMin&&n!==this.btMax){var s=this.a.positionAt(i),r=this.b.positionAt(n);e.boxIntersects(this.aMin,s,this.bMin,r)&&t.push(e.createFromPool(this.a,this.b,this.atMin,i,this.btMin,n,this.aMin,s,this.bMin,r)),e.boxIntersects(s,this.aMax,this.bMin,r)&&t.push(e.createFromPool(this.a,this.b,i,this.atMax,this.btMin,n,s,this.aMax,this.bMin,r)),e.boxIntersects(this.aMin,s,r,this.bMax)&&t.push(e.createFromPool(this.a,this.b,this.atMin,i,n,this.btMax,this.aMin,s,r,this.bMax)),e.boxIntersects(s,this.aMax,r,this.bMax)&&t.push(e.createFromPool(this.a,this.b,i,this.atMax,n,this.btMax,s,this.aMax,r,this.bMax)),this.freeToPool()}else t.push(this)},distance:function(t){var e=this.atMin-t.atMin,i=this.atMax-t.atMax,n=this.btMin-t.btMin,s=this.btMax-t.btMax;return e*e+i*i+n*n+s*s},clean:function(){this.a=null,this.b=null,this.aMin=null,this.aMax=null,this.bMin=null,this.bMax=null}},{intersect:function(t,i){if(!t.bounds.intersectsBounds(i.bounds))return[];for(var n=e.getIntersectionRanges(t,i),s=[],a=0;a<n.length;a++){var o=n[a],h=!1;t:for(var l=0;l<s.length;l++)for(var u=s[l],c=0;c<u.length;c++){var d=u[c];if(o.distance(d)<1e-13){u.push(o),h=!0;break t}}h||s.push([o])}var f=[];for(a=0;a<s.length;a++){u=s[a];var m=0,p=0;for(l=0;l<u.length;l++)m+=u[l].atMin+u[l].atMax,p+=u[l].btMin+u[l].btMax;m/=2*u.length,p/=2*u.length;var g=t.positionAt(m),v=i.positionAt(p);f.push(new r(g.average(v),m,p))}for(a=0;a<n.length;a++)n[a].freeToPool();return e.cleanPool(),f},getIntersectionRanges:function(t,i){for(var n=t.getInteriorExtremaTs(),s=i.getInteriorExtremaTs(),r=_.zip([0].concat(n),n.concat([1])),a=_.zip([0].concat(s),s.concat([1])),o=[],h=0;h<r.length;h++)for(var l=0;l<a.length;l++){var u=r[h][0],c=r[h][1],d=a[l][0],f=a[l][1],m=t.positionAt(u),p=t.positionAt(c),g=i.positionAt(d),v=i.positionAt(f);e.boxIntersects(m,p,g,v)&&o.push(e.createFromPool(t,i,u,c,d,f,m,p,g,v))}for(h=0;h<50;h++){var y=[];for(l=o.length-1;l>=0;l--)o[l].pushSubdivisions(y);o=y}return o},boxIntersects:function(t,e,i,n){var s=Math.max(Math.min(t.x,e.x),Math.min(i.x,n.x)),r=Math.max(Math.min(t.y,e.y),Math.min(i.y,n.y)),a=Math.min(Math.max(t.x,e.x),Math.max(i.x,n.x)),o=Math.min(Math.max(t.y,e.y),Math.max(i.y,n.y));return a-s>=0&&o-r>=0},cleanPool:function(){for(var t=0;t<e.pool.length;t++)e.pool[t].clean()}}),s.mixInto(e,{initialize:e.prototype.initialize}),e}),i("KITE/segments/Segment",["require","DOT/Bounds2","KITE/ops/BoundsIntersection","AXON/Events","PHET_CORE/inherit","KITE/kite","DOT/Util"],function(t){"use strict";function e(){r.call(this)}function i(t){return t.getSwapped()}var n=t("DOT/Bounds2"),s=t("KITE/ops/BoundsIntersection"),r=t("AXON/Events"),a=t("PHET_CORE/inherit"),o=t("KITE/kite"),h=t("DOT/Util");o.register("Segment",e);return a(r,e,{areStrokedBoundsDilated:function(){return Math.abs(this.startTangent.x*this.startTangent.y)<1e-7&&Math.abs(this.endTangent.x*this.endTangent.y)<1e-7},getBoundsWithTransform:function(t){return this.transformed(t).getBounds()},slice:function(t,e){var i=this;return e<1&&(i=i.subdivided(e)[0]),t>0&&(i=i.subdivided(h.linear(0,e,0,1,t))[1]),i},subdivisions:function(t){for(var e=this,i=[],n=0;n<t.length;n++){var s=t[n],r=e.subdivided(s);i.push(r[0]),e=r[1];for(var a=n+1;a<t.length;a++)t[a]=h.linear(s,1,0,1,t[a])}return i.push(e),i},subdividedIntoMonotone:function(){return this.subdivisions(this.getInteriorExtremaTs())},isSufficientlyFlat:function(t,i){var n=this.start,s=this.positionAt(.5),r=this.end;return e.isSufficientlyFlat(t,i,n,s,r)},getArcLength:function(t,e,i){if(t=void 0===t?1e-10:t,e=void 0===e?1e-8:e,(i=void 0===i?15:i)<=0||this.isSufficientlyFlat(t,e))return this.start.distance(this.end);var n=this.subdivided(.5);return n[0].getArcLength(t,e,i-1)+n[1].getArcLength(t,e,i-1)},getDashValues:function(t,i,n,s){function r(){c=(c+1)%t.length,f=!f}var a=this,o=[],l=0,u=_.sum(t);(i%=u)<0&&(i+=u);for(var c=0,d=0,f=!0;i>0;)i>=t[c]?(i-=t[c],r()):(d=i,i=0);var m=f;return function i(u,f,m,p,g){var v=(u+f)/2,y=a.positionAt(v);if(g>14||e.isSufficientlyFlat(n,s,m,y,p)){var E=m.distance(y)+y.distance(p);l+=E;for(var b=E;d+b>=t[c];){var _=h.linear(0,E,u,f,E-b+t[c]-d);o.push(_),b-=t[c]-d,d=0,r()}d+=b}else i(u,v,m,y,g+1),i(v,f,y,p,g+1)}(0,1,this.start,this.end,0),{values:o,arcLength:l,initiallyInside:m}},toPiecewiseLinearSegments:function(t,e,i,n,s,r){e=void 0===e?t.minLevels:e,i=void 0===i?t.maxLevels:i,n=n||[];var a=t.pointMap||function(t){return t};s=s||a(this.start),r=r||a(this.end);var h=a(this.positionAt(.5)),l=0===i;if(!l&&e<=0&&(l=this.isSufficientlyFlat(null===t.distanceEpsilon?Number.POSITIVE_INFINITY:t.distanceEpsilon,null===t.curveEpsilon?Number.POSITIVE_INFINITY:t.curveEpsilon)),l)n.push(new o.Line(s,r));else{var u=this.subdivided(.5);u[0].toPiecewiseLinearSegments(t,e-1,i-1,n,s,h),u[1].toPiecewiseLinearSegments(t,e-1,i-1,n,h,r)}return n},toPiecewiseLinearOrArcSegments:function(t){t=_.extend({minLevels:2,maxLevels:7,curvatureThreshold:.02,errorThreshold:10,errorPoints:[.25,.75]},t);var e=[];return this.toPiecewiseLinearOrArcRecursion(t,t.minLevels,t.maxLevels,e,0,1,this.positionAt(0),this.positionAt(1),this.curvatureAt(0),this.curvatureAt(1)),e},toPiecewiseLinearOrArcRecursion:function(t,e,i,n,s,r,a,h,l,u){var c=(s+r)/2,d=this.positionAt(c),f=this.curvatureAt(c);if(i<=0||e<=0&&Math.abs(l-f)+Math.abs(f-u)<2*t.curvatureThreshold){var m=o.Arc.createFromPoints(a,d,h),p=!1;if(m instanceof o.Arc)for(var g=m.radius*m.radius,v=0;v<t.errorPoints.length;v++){var y=t.errorPoints[v],E=this.positionAt(s*(1-y)+r*y);if(Math.abs(E.distanceSquared(m.center)-g)>t.errorThreshold){p=!0;break}}if(!p)return void n.push(m)}this.toPiecewiseLinearOrArcRecursion(t,e-1,i-1,n,s,c,a,d,l,f),this.toPiecewiseLinearOrArcRecursion(t,e-1,i-1,n,c,r,d,h,f,u)},toShape:function(){return new o.Shape([new o.Subpath([this])])}}),e.closestToPoint=function(t,e,i){var s=i*i,r=[],a=[],o=Number.POSITIVE_INFINITY,h=!1;for(_.each(t,function(t){if(t.explicitClosestToPoint){var i=t.explicitClosestToPoint(e);_.each(i,function(t){t.distanceSquared<o?(a=[t],o=t.distanceSquared):t.distanceSquared===o&&a.push(t)})}else for(var s=[0].concat(t.getInteriorExtremaTs()).concat([1]),h=0;h<s.length-1;h++){var l=s[h],u=s[h+1],c=t.positionAt(l),d=t.positionAt(u),f=n.point(c).addPoint(d),m=f.minimumDistanceToPointSquared(e);if(m<=o){var p=f.maximumDistanceToPointSquared(e);p<o&&(o=p,a=[]),r.push({ta:l,tb:u,pa:c,pb:d,segment:t,bounds:f,min:m,max:p})}}});r.length&&!h;){var l=r;r=[],h=!0,_.each(l,function(t){if(!(t.minDistanceSquared>o)){h&&t.pa.distanceSquared(t.pb)>s&&(h=!1);var i=(t.ta+t.tb)/2,l=t.segment.positionAt(i),u=n.point(t.pa).addPoint(l),c=n.point(t.pb).addPoint(l),d=u.minimumDistanceToPointSquared(e),f=c.minimumDistanceToPointSquared(e);if(d<=o){var m=u.maximumDistanceToPointSquared(e);m<o&&(o=m,a=[]),r.push({ta:t.ta,tb:i,pa:t.pa,pb:l,segment:t.segment,bounds:u,min:d,max:m})}if(f<=o){var p=c.maximumDistanceToPointSquared(e);p<o&&(o=p,a=[]),r.push({ta:i,tb:t.tb,pa:l,pb:t.pb,segment:t.segment,bounds:c,min:f,max:p})}}})}return _.each(r,function(t){var i=(t.ta+t.tb)/2,n=t.segment.positionAt(i);a.push({segment:t.segment,t:i,closestPoint:n,distanceSquared:e.distanceSquared(n)})}),a},e.polynomialGetOverlapCubic=function(t,i,n,s,r,a,o,l){if(0===l)return e.polynomialGetOverlapQuadratic(t,i,n,r,a,o);var u=h.sign(s/l)*Math.pow(Math.abs(s/l),1/3);if(0===u)return null;return{a:u,b:(n-u*u*o)/(3*u*u*l)}},e.polynomialGetOverlapQuadratic=function(t,i,n,s,r,a){if(0===a)return e.polynomialGetOverlapLinear(t,i,s,r);if(n/a<0)return null;var o=Math.sqrt(n/a);if(0===o)return null;return{a:o,b:(i-o*r)/(2*o*a)}},e.polynomialGetOverlapLinear=function(t,e,i,n){if(0===n)return t===i||null;var s=e/n;if(0===s)return null;return{a:s,b:(t-i)/n}},e.clipOverlap=function(t){},e.intersect=function(t,e){return o.Line&&t instanceof o.Line&&e instanceof o.Line?o.Line.intersect(t,e):o.Line&&t instanceof o.Line?o.Line.intersectOther(t,e):o.Line&&e instanceof o.Line?o.Line.intersectOther(e,t).map(i):o.Arc&&t instanceof o.Arc&&e instanceof o.Arc?o.Arc.intersect(t,e):s.intersect(t,e)},e.deserialize=function(t){return o[t.type].deserialize(t)},e.isSufficientlyFlat=function(t,e,i,n,s){return!(h.distToSegmentSquared(n,i,s)/i.distanceSquared(s)>e)&&!(h.distToSegmentSquared(n,i,s)>t)},e}),i("KITE/segments/Line",["require","DOT/Bounds2","PHET_CORE/inherit","KITE/kite","KITE/util/Overlap","DOT/Ray2","KITE/util/RayIntersection","KITE/segments/Segment","KITE/util/SegmentIntersection","DOT/Util","DOT/Vector2"],function(t){"use strict";function e(t,e){h.call(this),this._start=t,this._end=e,this.invalidate()}var i=t("DOT/Bounds2"),n=t("PHET_CORE/inherit"),s=t("KITE/kite"),r=t("KITE/util/Overlap"),a=t("DOT/Ray2"),o=t("KITE/util/RayIntersection"),h=t("KITE/segments/Segment"),l=t("KITE/util/SegmentIntersection"),u=t("DOT/Util"),c=t("DOT/Vector2"),d=new c(0,0);return s.register("Line",e),n(h,e,{setStart:function(t){return this._start.equals(t)||(this._start=t,this.invalidate()),this},set start(t){this.setStart(t)},getStart:function(){return this._start},get start(){return this.getStart()},setEnd:function(t){return this._end.equals(t)||(this._end=t,this.invalidate()),this},set end(t){this.setEnd(t)},getEnd:function(){return this._end},get end(){return this.getEnd()},positionAt:function(t){return this._start.plus(this._end.minus(this._start).times(t))},tangentAt:function(t){return this.getStartTangent()},curvatureAt:function(t){return 0},subdivided:function(t){if(0===t||1===t)return[this];var e=this.positionAt(t);return[new s.Line(this._start,e),new s.Line(e,this._end)]},invalidate:function(){this._tangent=null,this._bounds=null,this._svgPathFragment=null,this.trigger0("invalidated")},getStartTangent:function(){return null===this._tangent&&(this._tangent=this._end.minus(this._start).normalized()),this._tangent},get startTangent(){return this.getStartTangent()},getEndTangent:function(){return this.getStartTangent()},get endTangent(){return this.getEndTangent()},getBounds:function(){return null===this._bounds&&(this._bounds=i.NOTHING.copy().addPoint(this._start).addPoint(this._end)),this._bounds},get bounds(){return this.getBounds()},getBoundsWithTransform:function(t){var e=i.NOTHING.copy();return e.addPoint(t.multiplyVector2(d.set(this._start))),e.addPoint(t.multiplyVector2(d.set(this._end))),e},getNondegenerateSegments:function(){return this._start.equals(this._end)?[]:[this]},getSVGPathFragment:function(){return this._svgPathFragment||(this._svgPathFragment="L "+s.svgNumber(this._end.x)+" "+s.svgNumber(this._end.y)),this._svgPathFragment},strokeLeft:function(t){var e=this.getEndTangent().perpendicular().negated().times(t/2);return[new s.Line(this._start.plus(e),this._end.plus(e))]},strokeRight:function(t){var e=this.getStartTangent().perpendicular().times(t/2);return[new s.Line(this._end.plus(e),this._start.plus(e))]},getInteriorExtremaTs:function(){return[]},intersection:function(t){var e=[],i=this._start,n=this._end.minus(i);if(0===n.magnitudeSquared())return e;var s=t.direction.y*n.x-t.direction.x*n.y;if(0===s)return e;var r=(t.direction.x*(i.y-t.position.y)-t.direction.y*(i.x-t.position.x))/s;if(r<0||r>=1)return e;var a=(n.x*(i.y-t.position.y)-n.y*(i.x-t.position.x))/s;if(a<1e-8)return e;var h=n.perpendicular(),l=i.plus(n.times(r)),u=(h.dot(t.direction)>0?h.negated():h).normalized(),c=t.direction.perpendicular().dot(n)<0?1:-1;return e.push(new o(a,l,u,c,r)),e},windingIntersection:function(t){var e=this.intersection(t);return e.length?e[0].wind:0},writeToContext:function(t){t.lineTo(this._end.x,this._end.y)},transformed:function(t){return new s.Line(t.timesVector2(this._start),t.timesVector2(this._end))},explicitClosestToPoint:function(t){var e=this._end.minus(this._start),i=t.minus(this._start).dot(e)/e.magnitudeSquared();i=u.clamp(i,0,1);var n=this.positionAt(i);return[{segment:this,t:i,closestPoint:n,distanceSquared:t.distanceSquared(n)}]},getSignedAreaFragment:function(){return.5*(this._start.x*this._end.y-this._start.y*this._end.x)},reparameterized:function(t,e){return new s.Line(this.positionAt(e),this.positionAt(t+e))},reversed:function(){return new s.Line(this._end,this._start)},polarToCartesian:function(t){return this._start.x===this._end.x?[new s.Line(c.createPolar(this._start.y,this._start.x),c.createPolar(this._end.y,this._end.x))]:this._start.y===this._end.y?[new s.Arc(c.ZERO,this._start.y,this._start.x,this._end.x,this._start.x>this._end.x)]:this.toPiecewiseLinearSegments(t)},getArcLength:function(){return this.start.distance(this.end)},toPiecewiseLinearOrArcSegments:function(){return[this]},serialize:function(){return{type:"Line",startX:this._start.x,startY:this._start.y,endX:this._end.x,endY:this._end.y}}}),e.deserialize=function(t){return new e(new c(t.startX,t.startY),new c(t.endX,t.endY))},e.getOverlaps=function(t,e){var i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-6,s=[],a=t._start.x,o=-1*t._start.x+t._end.x,l=t._start.y,u=-1*t._start.y+t._end.y,c=e._start.x,d=-1*e._start.x+e._end.x,f=e._start.y,m=-1*e._start.y+e._end.y,p=Math.abs(Math.max(t._start.x,t._end.x,e._start.x,e._end.x)-Math.min(t._start.x,t._end.x,e._start.x,e._end.x)),g=Math.abs(Math.max(t._start.y,t._end.y,e._start.y,e._end.y)-Math.min(t._start.y,t._end.y,e._start.y,e._end.y)),v=h.polynomialGetOverlapLinear(a,o,c,d),y=h.polynomialGetOverlapLinear(l,u,f,m);if(null===(i=p>g?null===v||!0===v?y:v:null===y||!0===y?v:y)||!0===i)return s;var E=i.a,b=i.b,_=c+b*d-a,S=E*d-o,T=f+b*m-l,C=E*m-u;if(Math.abs(_)>n||Math.abs(S+_)>n||Math.abs(T)>n||Math.abs(C+T)>n)return s;var x=E+b;return b>1&&x>1||b<0&&x<0?s:[new r(E,b)]},e.intersect=function(t,e){var i=u.lineSegmentIntersection(t.start.x,t.start.y,t.end.x,t.end.y,e.start.x,e.start.y,e.end.x,e.end.y);if(null!==i){var n=t.explicitClosestToPoint(i)[0].t,s=e.explicitClosestToPoint(i)[0].t;return[new l(i,n,s)]}return[]},e.intersectOther=function(t,e){for(var i=t.end.minus(t.start),n=i.magnitude,s=new a(t.start,i.normalize()),r=e.intersection(s),o=[],h=0;h<r.length;h++){var u=r[h],c=u.distance/n;c>1e-8&&c<1-1e-8&&o.push(new l(u.point,c,u.t))}return o},e}),i("KITE/segments/Arc",["require","DOT/Bounds2","PHET_CORE/inherit","KITE/kite","KITE/segments/Line","KITE/util/Overlap","KITE/util/RayIntersection","KITE/segments/Segment","KITE/util/SegmentIntersection","DOT/Util","DOT/Vector2"],function(t){"use strict";function e(t,e,i,n,s){h.call(this),this._center=t,this._radius=e,this._startAngle=i,this._endAngle=n,this._anticlockwise=s,this.invalidate()}var i=t("DOT/Bounds2"),n=t("PHET_CORE/inherit"),s=t("KITE/kite"),r=t("KITE/segments/Line"),a=t("KITE/util/Overlap"),o=t("KITE/util/RayIntersection"),h=t("KITE/segments/Segment"),l=t("KITE/util/SegmentIntersection"),u=t("DOT/Util"),c=t("DOT/Vector2"),d=2*Math.PI;return s.register("Arc",e),n(h,e,{setCenter:function(t){return this._center.equals(t)||(this._center=t,this.invalidate()),this},set center(t){this.setCenter(t)},getCenter:function(){return this._center},get center(){return this.getCenter()},setRadius:function(t){return this._radius!==t&&(this._radius=t,this.invalidate()),this},set radius(t){this.setRadius(t)},getRadius:function(){return this._radius},get radius(){return this.getRadius()},setStartAngle:function(t){return this._startAngle!==t&&(this._startAngle=t,this.invalidate()),this},set startAngle(t){this.setStartAngle(t)},getStartAngle:function(){return this._startAngle},get startAngle(){return this.getStartAngle()},setEndAngle:function(t){return this._endAngle!==t&&(this._endAngle=t,this.invalidate()),this},set endAngle(t){this.setEndAngle(t)},getEndAngle:function(){return this._endAngle},get endAngle(){return this.getEndAngle()},setAnticlockwise:function(t){return this._anticlockwise!==t&&(this._anticlockwise=t,this.invalidate()),this},set anticlockwise(t){this.setAnticlockwise(t)},getAnticlockwise:function(){return this._anticlockwise},get anticlockwise(){return this.getAnticlockwise()},positionAt:function(t){return this.positionAtAngle(this.angleAt(t))},tangentAt:function(t){return this.tangentAtAngle(this.angleAt(t))},curvatureAt:function(t){return(this._anticlockwise?-1:1)/this._radius},subdivided:function(t){if(0===t||1===t)return[this];var e=this.angleAt(0),i=this.angleAt(t),n=this.angleAt(1);return[new s.Arc(this._center,this._radius,e,i,this._anticlockwise),new s.Arc(this._center,this._radius,i,n,this._anticlockwise)]},invalidate:function(){this._start=null,this._end=null,this._startTangent=null,this._endTangent=null,this._actualEndAngle=null,this._isFullPerimeter=null,this._angleDifference=null,this._bounds=null,this._svgPathFragment=null,this._radius<0&&(this._radius=-this._radius,this._startAngle+=Math.PI,this._endAngle+=Math.PI),this.trigger0("invalidated")},getStart:function(){return null===this._start&&(this._start=this.positionAtAngle(this._startAngle)),this._start},get start(){return this.getStart()},getEnd:function(){return null===this._end&&(this._end=this.positionAtAngle(this._endAngle)),this._end},get end(){return this.getEnd()},getStartTangent:function(){return null===this._startTangent&&(this._startTangent=this.tangentAtAngle(this._startAngle)),this._startTangent},get startTangent(){return this.getStartTangent()},getEndTangent:function(){return null===this._endTangent&&(this._endTangent=this.tangentAtAngle(this._endAngle)),this._endTangent},get endTangent(){return this.getEndTangent()},getActualEndAngle:function(){return null===this._actualEndAngle&&(this._actualEndAngle=e.computeActualEndAngle(this._startAngle,this._endAngle,this._anticlockwise)),this._actualEndAngle},get actualEndAngle(){return this.getActualEndAngle()},getIsFullPerimeter:function(){return null===this._isFullPerimeter&&(this._isFullPerimeter=!this._anticlockwise&&this._endAngle-this._startAngle>=2*Math.PI||this._anticlockwise&&this._startAngle-this._endAngle>=2*Math.PI),this._isFullPerimeter},get isFullPerimeter(){return this.getIsFullPerimeter()},getAngleDifference:function(){return null===this._angleDifference&&(this._angleDifference=this._anticlockwise?this._startAngle-this._endAngle:this._endAngle-this._startAngle,this._angleDifference<0&&(this._angleDifference+=2*Math.PI)),this._angleDifference},get angleDifference(){return this.getAngleDifference()},getBounds:function(){return null===this._bounds&&(this._bounds=i.NOTHING.copy().withPoint(this.getStart()).withPoint(this.getEnd()),this._startAngle!==this._endAngle&&(this.includeBoundsAtAngle(0),this.includeBoundsAtAngle(Math.PI/2),this.includeBoundsAtAngle(Math.PI),this.includeBoundsAtAngle(3*Math.PI/2))),this._bounds},get bounds(){return this.getBounds()},getNondegenerateSegments:function(){return this._radius<=0||this._startAngle===this._endAngle?[]:[this]},includeBoundsAtAngle:function(t){this.containsAngle(t)&&(this._bounds=this._bounds.withPoint(this._center.plus(c.createPolar(this._radius,t))))},mapAngle:function(t){return Math.abs(u.moduloBetweenDown(t-this._startAngle,-Math.PI,Math.PI))<1e-8?this._startAngle:Math.abs(u.moduloBetweenDown(t-this.getActualEndAngle(),-Math.PI,Math.PI))<1e-8?this.getActualEndAngle():this._startAngle>this.getActualEndAngle()?u.moduloBetweenUp(t,this._startAngle-2*Math.PI,this._startAngle):u.moduloBetweenDown(t,this._startAngle,this._startAngle+2*Math.PI)},tAtAngle:function(t){var e=(this.mapAngle(t)-this._startAngle)/(this.getActualEndAngle()-this._startAngle);return e},angleAt:function(t){return this._startAngle+(this.getActualEndAngle()-this._startAngle)*t},positionAtAngle:function(t){return this._center.plus(c.createPolar(this._radius,t))},tangentAtAngle:function(t){var e=c.createPolar(1,t);return this._anticlockwise?e.perpendicular():e.perpendicular().negated()},containsAngle:function(t){var e=this._anticlockwise?t-this._endAngle:t-this._startAngle;return u.moduloBetweenDown(e,0,2*Math.PI)<=this.angleDifference},getSVGPathFragment:function(){if(!this._svgPathFragment){var t,e=this._anticlockwise?"0":"1";if(this.angleDifference<2*Math.PI-.01)t=this.angleDifference<Math.PI?"0":"1",this._svgPathFragment="A "+s.svgNumber(this._radius)+" "+s.svgNumber(this._radius)+" 0 "+t+" "+e+" "+s.svgNumber(this.end.x)+" "+s.svgNumber(this.end.y);else{var i=(this._startAngle+this._endAngle)/2,n=this._center.plus(c.createPolar(this._radius,i));t="0";var r="A "+s.svgNumber(this._radius)+" "+s.svgNumber(this._radius)+" 0 "+t+" "+e+" "+s.svgNumber(n.x)+" "+s.svgNumber(n.y),a="A "+s.svgNumber(this._radius)+" "+s.svgNumber(this._radius)+" 0 "+t+" "+e+" "+s.svgNumber(this.end.x)+" "+s.svgNumber(this.end.y);this._svgPathFragment=r+" "+a}}return this._svgPathFragment},strokeLeft:function(t){return[new s.Arc(this._center,this._radius+(this._anticlockwise?1:-1)*t/2,this._startAngle,this._endAngle,this._anticlockwise)]},strokeRight:function(t){return[new s.Arc(this._center,this._radius+(this._anticlockwise?-1:1)*t/2,this._endAngle,this._startAngle,!this._anticlockwise)]},getInteriorExtremaTs:function(){var t=this,e=[];return _.each([0,Math.PI/2,Math.PI,3*Math.PI/2],function(i){if(t.containsAngle(i)){var n=t.tAtAngle(i);n>1e-10&&n<1-1e-10&&e.push(n)}}),e.sort()},intersection:function(t){var e=[],i=t.position.minus(this._center),n=t.direction.dot(i),s=4*n*n-4*(i.magnitudeSquared()-this._radius*this._radius);if(s<0)return e;var r=t.direction.dot(this._center)-t.direction.dot(t.position),a=Math.sqrt(s)/2,h=r-a,l=r+a;if(l<0)return e;var u=t.pointAtDistance(l),c=u.minus(this._center).normalized(),d=c.angle;if(h<0)this.containsAngle(d)&&e.push(new o(l,u,c.negated(),this._anticlockwise?-1:1,this.tAtAngle(d)));else{var f=t.pointAtDistance(h),m=f.minus(this._center).normalized(),p=m.angle;this.containsAngle(p)&&e.push(new o(h,f,m,this._anticlockwise?1:-1,this.tAtAngle(p))),this.containsAngle(d)&&e.push(new o(l,u,c.negated(),this._anticlockwise?-1:1,this.tAtAngle(d)))}return e},windingIntersection:function(t){var e=0,i=this.intersection(t);return _.each(i,function(t){e+=t.wind}),e},writeToContext:function(t){t.arc(this._center.x,this._center.y,this._radius,this._startAngle,this._endAngle,this._anticlockwise)},transformed:function(t){var e=t.timesVector2(c.createPolar(1,this._startAngle)).minus(t.timesVector2(c.ZERO)).angle,i=t.timesVector2(c.createPolar(1,this._endAngle)).minus(t.timesVector2(c.ZERO)).angle,n=t.getDeterminant()>=0?this._anticlockwise:!this._anticlockwise;Math.abs(this._endAngle-this._startAngle)===2*Math.PI&&(i=n?e-2*Math.PI:e+2*Math.PI);var r=t.getScaleVector();if(r.x!==r.y){var a=r.x*this._radius,o=r.y*this._radius;return new s.EllipticalArc(t.timesVector2(this._center),a,o,0,e,i,n)}var h=r.x*this._radius;return new s.Arc(t.timesVector2(this._center),h,e,i,n)},getSignedAreaFragment:function(){var t=this._startAngle,e=this.getActualEndAngle();return.5*this._radius*(this._radius*(e-t)+this._center.x*(Math.sin(e)-Math.sin(t))-this._center.y*(Math.cos(e)-Math.cos(t)))},reversed:function(){return new s.Arc(this._center,this._radius,this._endAngle,this._startAngle,!this._anticlockwise)},getArcLength:function(){return this.getAngleDifference()*this._radius},toPiecewiseLinearOrArcSegments:function(){return[this]},serialize:function(){return{type:"Arc",centerX:this._center.x,centerY:this._center.y,radius:this._radius,startAngle:this._startAngle,endAngle:this._endAngle,anticlockwise:this._anticlockwise}}}),e.deserialize=function(t){return new e(new c(t.centerX,t.centerY),t.radius,t.startAngle,t.endAngle,t.anticlockwise)},e.computeActualEndAngle=function(t,e,i){return i?t>e?e:t<e?e-2*Math.PI:t:t<e?e:t>e?e+2*Math.PI:t},e.getPartialOverlap=function(t,e,i,n,s){var r=i<e,o=r?e:i,h=r?i:e,l=Math.min(t,o);return l<h+1e-8?[]:[a.createLinear(u.clamp(u.linear(0,t,0,1,h),0,1),u.clamp(u.linear(e,i,n,s,h),0,1),u.clamp(u.linear(0,t,0,1,l),0,1),u.clamp(u.linear(e,i,n,s,l),0,1))]},e.getAngularOverlaps=function(t,i,n,s){var r=i-t,a=r<0?-1:1;r*=a;var o,h=u.moduloBetweenDown(a*(n-t),0,d),l=a*(s-n)+h;return l<-1e-10?(o=-h/(l-h),e.getPartialOverlap(r,h,0,0,o).concat(e.getPartialOverlap(r,d,l+d,o,1))):l>d+1e-10?(o=(d-h)/(l-h),e.getPartialOverlap(r,h,d,0,o).concat(e.getPartialOverlap(r,0,l-d,o,1))):e.getPartialOverlap(r,h,l,0,1)},e.getOverlaps=function(t,i){return t._center.distance(i._center)>1e-8||Math.abs(t._radius-i._radius)>1e-8?[]:e.getAngularOverlaps(t._startAngle,t.getActualEndAngle(),i._startAngle,i.getActualEndAngle())},e.getCircleIntersectionPoint=function(t,e,i,n){var s=i.minus(t),r=s.magnitude,a=[];if(r<1e-10||r>e+n+1e-10);else if(r>e+n-1e-10)a=[t.blend(i,e/r)];else{var o=.5*(r*r-n*n+e*e)/r,h=r*r-n*n+e*e,l=4*r*r*e*e-h*h,u=t.blend(i,o/r);if(l>=1e-10){var c=Math.sqrt(l)/r/2,d=s.perpendicular().setMagnitude(c);a=[u.plus(d),u.minus(d)]}else l>-1e-10&&(a=[u])}return a},e.intersect=function(t,i){for(var n=e.getCircleIntersectionPoint(t._center,t._radius,i._center,i._radius),s=[],r=0;r<n.length;r++){var a=n[r],o=a.minus(t._center).angle,h=a.minus(i._center).angle;t.containsAngle(o)&&i.containsAngle(h)&&s.push(new l(a,t.tAtAngle(o),i.tAtAngle(h)))}return s},e.createFromPoints=function(t,i,n){var s=u.circleCenterFromPoints(t,i,n);if(null===s)return new r(t,n);var a=t.minus(s),o=i.minus(s),h=n.minus(s),l=a.angle,c=o.angle,d=h.angle,f=(a.magnitude+o.magnitude+h.magnitude)/3,m=new e(s,f,l,d,!1);return m.containsAngle(c)?m:new e(s,f,l,d,!0)},e}),i("KITE/segments/Quadratic",["require","DOT/Bounds2","PHET_CORE/inherit","KITE/kite","DOT/Matrix3","KITE/util/Overlap","KITE/util/RayIntersection","KITE/segments/Segment","DOT/Util","DOT/Vector2"],function(t){"use strict";function e(t){return t>=0&&t<=1}function i(t,e,i){l.call(this),this._start=t,this._control=e,this._end=i,this.invalidate()}var n=t("DOT/Bounds2"),s=t("PHET_CORE/inherit"),r=t("KITE/kite"),a=t("DOT/Matrix3"),o=t("KITE/util/Overlap"),h=t("KITE/util/RayIntersection"),l=t("KITE/segments/Segment"),u=t("DOT/Util"),c=t("DOT/Vector2"),d=u.solveQuadraticRootsReal,f=u.arePointsCollinear;return r.register("Quadratic",i),s(l,i,{degree:2,setStart:function(t){return this._start.equals(t)||(this._start=t,this.invalidate()),this},set start(t){this.setStart(t)},getStart:function(){return this._start},get start(){return this.getStart()},setControl:function(t){return this._control.equals(t)||(this._control=t,this.invalidate()),this},set control(t){this.setControl(t)},getControl:function(){return this._control},get control(){return this.getControl()},setEnd:function(t){return this._end.equals(t)||(this._end=t,this.invalidate()),this},set end(t){this.setEnd(t)},getEnd:function(){return this._end},get end(){return this.getEnd()},positionAt:function(t){var e=1-t;return this._start.times(e*e).plus(this._control.times(2*e*t)).plus(this._end.times(t*t))},tangentAt:function(t){return this._control.minus(this._start).times(2*(1-t)).plus(this._end.minus(this._control).times(2*t))},curvatureAt:function(t){if(Math.abs(t-.5)>.5-1e-7){var e=t<.5,i=e?this._start:this._end,n=this._control,s=e?this._end:this._start,r=n.minus(i),a=r.magnitude;return(e?-1:1)*r.perpendicular().normalized().dot(s.minus(n))*(this.degree-1)/(this.degree*a*a)}return this.subdivided(t,!0)[0].curvatureAt(1)},subdivided:function(t){if(0===t||1===t)return[this];var e=this._start.blend(this._control,t),i=this._control.blend(this._end,t),n=e.blend(i,t);return[new r.Quadratic(this._start,e,n),new r.Quadratic(n,i,this._end)]},invalidate:function(){this._startTangent=null,this._endTangent=null,this._tCriticalX=null,this._tCriticalY=null,this._bounds=null,this._svgPathFragment=null,this.trigger0("invalidated")},getStartTangent:function(){if(null===this._startTangent){var t=this._start.equals(this._control);this._startTangent=t?this._end.minus(this._start).normalized():this._control.minus(this._start).normalized()}return this._startTangent},get startTangent(){return this.getStartTangent()},getEndTangent:function(){if(null===this._endTangent){var t=this._end.equals(this._control);this._endTangent=t?this._end.minus(this._start).normalized():this._end.minus(this._control).normalized()}return this._endTangent},get endTangent(){return this.getEndTangent()},getTCriticalX:function(){return null===this._tCriticalX&&(this._tCriticalX=i.extremaT(this._start.x,this._control.x,this._end.x)),this._tCriticalX},get tCriticalX(){return this.getTCriticalX()},getTCriticalY:function(){return null===this._tCriticalY&&(this._tCriticalY=i.extremaT(this._start.y,this._control.y,this._end.y)),this._tCriticalY},get tCriticalY(){return this.getTCriticalY()},getNondegenerateSegments:function(){var t=this._start,e=this._control,n=this._end,s=t.equals(n),a=t.equals(e),o=t.equals(e);if(s&&a)return[];if(s){var h=this.positionAt(.5);return[new r.Line(t,h),new r.Line(h,n)]}if(f(t,e,n)){if(a||o)return[new r.Line(t,n)];var l=n.minus(t),u=e.minus(t).dot(l.normalized)/l.magnitude,c=i.extremaT(0,u,1);if(!isNaN(c)&&c>0&&c<1){var d=this.positionAt(c);return _.flatten([new r.Line(t,d).getNondegenerateSegments(),new r.Line(d,n).getNondegenerateSegments()])}return[new r.Line(t,n)]}return[this]},getBounds:function(){if(null===this._bounds){this._bounds=new n(Math.min(this._start.x,this._end.x),Math.min(this._start.y,this._end.y),Math.max(this._start.x,this._end.x),Math.max(this._start.y,this._end.y));var t=this.getTCriticalX(),e=this.getTCriticalY();!isNaN(t)&&t>0&&t<1&&(this._bounds=this._bounds.withPoint(this.positionAt(t))),!isNaN(e)&&e>0&&e<1&&(this._bounds=this._bounds.withPoint(this.positionAt(e)))}return this._bounds},get bounds(){return this.getBounds()},offsetTo:function(t,e){for(var i=[this],n=0;n<5;n++)i=_.flatten(_.map(i,function(t){return t.subdivided(.5,!0)}));var s=_.map(i,function(e){return e.approximateOffset(t)});return e&&(s.reverse(),s=_.map(s,function(t){return t.reversed(!0)})),s},degreeElevated:function(){return new r.Cubic(this._start,this._start.plus(this._control.timesScalar(2)).dividedScalar(3),this._end.plus(this._control.timesScalar(2)).dividedScalar(3),this._end)},approximateOffset:function(t){return new r.Quadratic(this._start.plus((this._start.equals(this._control)?this._end.minus(this._start):this._control.minus(this._start)).perpendicular().normalized().times(t)),this._control.plus(this._end.minus(this._start).perpendicular().normalized().times(t)),this._end.plus((this._end.equals(this._control)?this._end.minus(this._start):this._end.minus(this._control)).perpendicular().normalized().times(t)))},getSVGPathFragment:function(){return this._svgPathFragment||(this._svgPathFragment="Q "+r.svgNumber(this._control.x)+" "+r.svgNumber(this._control.y)+" "+r.svgNumber(this._end.x)+" "+r.svgNumber(this._end.y)),this._svgPathFragment},strokeLeft:function(t){return this.offsetTo(-t/2,!1)},strokeRight:function(t){return this.offsetTo(t/2,!0)},getInteriorExtremaTs:function(){var t=[],e=this.getTCriticalX(),i=this.getTCriticalY();return!isNaN(e)&&e>1e-10&&e<1-1e-10&&t.push(this.tCriticalX),!isNaN(i)&&i>1e-10&&i<1-1e-10&&t.push(this.tCriticalY),t.sort()},intersection:function(t){var e=this,i=[],n=a.rotation2(-t.direction.angle).timesMatrix(a.translation(-t.position.x,-t.position.y)),s=n.timesVector2(this._start),r=n.timesVector2(this._control),o=n.timesVector2(this._end),l=s.y-2*r.y+o.y,u=-2*s.y+2*r.y,c=s.y,f=d(l,u,c);return _.each(f,function(n){if(n>=0&&n<=1){var s=e.positionAt(n),r=e.tangentAt(n).normalized(),a=r.perpendicular(),o=s.minus(t.position);if(o.dot(t.direction)>0){var l=a.dot(t.direction)>0?a.negated():a,u=t.direction.perpendicular().dot(r)<0?1:-1;i.push(new h(o.magnitude,s,l,u,n))}}}),i},windingIntersection:function(t){var e=0,i=this.intersection(t);return _.each(i,function(t){e+=t.wind}),e},writeToContext:function(t){t.quadraticCurveTo(this._control.x,this._control.y,this._end.x,this._end.y)},transformed:function(t){return new r.Quadratic(t.timesVector2(this._start),t.timesVector2(this._control),t.timesVector2(this._end))},getSignedAreaFragment:function(){return 1/6*(this._start.x*(2*this._control.y+this._end.y)+this._control.x*(-2*this._start.y+2*this._end.y)+this._end.x*(-this._start.y-2*this._control.y))},reparameterized:function(t,e){var i=this._start.plus(this._end.plus(this._control.timesScalar(-2))),n=this._control.minus(this._start).timesScalar(2),s=this._start,a=i.timesScalar(t*t),o=i.timesScalar(t*e).timesScalar(2).plus(n.timesScalar(t)),h=i.timesScalar(e*e).plus(n.timesScalar(e)).plus(s);return new r.Quadratic(h,o.timesScalar(.5).plus(h),a.plus(o).plus(h))},reversed:function(){return new r.Quadratic(this._end,this._control,this._start)},serialize:function(){return{type:"Quadratic",startX:this._start.x,startY:this._start.y,controlX:this._control.x,controlY:this._control.y,endX:this._end.x,endY:this._end.y}}}),i.deserialize=function(t){return new i(new c(t.startX,t.startY),new c(t.controlX,t.controlY),new c(t.endX,t.endY))},i.extremaT=function(t,e,i){var n=2*(i-2*e+t);return 0!==n?-2*(e-t)/n:NaN},i.getOverlaps=function(t,i){var n,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-6,r=[],a=t._start.x,h=-2*t._start.x+2*t._control.x,c=t._start.x-2*t._control.x+t._end.x,d=t._start.y,f=-2*t._start.y+2*t._control.y,m=t._start.y-2*t._control.y+t._end.y,p=i._start.x,g=-2*i._start.x+2*i._control.x,v=i._start.x-2*i._control.x+i._end.x,y=i._start.y,E=-2*i._start.y+2*i._control.y,b=i._start.y-2*i._control.y+i._end.y,S=Math.abs(Math.max(t._start.x,t._control.x,t._end.x,i._start.x,i._control.x,i._end.x)-Math.min(t._start.x,t._control.x,t._end.x,i._start.x,i._control.x,i._end.x)),T=Math.abs(Math.max(t._start.y,t._control.y,t._end.y,i._start.y,i._control.y,i._end.y)-Math.min(t._start.y,t._control.y,t._end.y,i._start.y,i._control.y,i._end.y)),C=l.polynomialGetOverlapQuadratic(a,h,c,p,g,v),x=l.polynomialGetOverlapQuadratic(d,f,m,y,E,b);if(null===(n=S>T?null===C||!0===C?x:C:null===x||!0===x?C:x)||!0===n)return r;for(var w=n.a,R=n.b,D=w*w,P=R*R,N=2*w*R,A=p+R*g+P*v-a,O=w*g+N*v-h,I=D*v-c,k=y+R*E+P*b-d,M=w*E+N*b-f,L=D*b-m,Y=u.solveLinearRootsReal(2*I,O),B=u.solveLinearRootsReal(2*L,M),H=_.uniq([0,1].concat(Y?Y.filter(e):[])),F=_.uniq([0,1].concat(B?B.filter(e):[])),V=0;V<H.length;V++){var X=H[V];if(Math.abs((I*X+O)*X+A)>s)return r}for(var z=0;z<F.length;z++){var G=F[z];if(Math.abs((L*G+M)*G+k)>s)return r}var q=w+R;return R>1&&q>1||R<0&&q<0?r:[new o(w,R)]},i}),i("KITE/segments/Cubic",["require","DOT/Bounds2","KITE/ops/BoundsIntersection","PHET_CORE/inherit","KITE/kite","DOT/Matrix3","KITE/util/Overlap","KITE/segments/Quadratic","KITE/util/RayIntersection","KITE/segments/Segment","KITE/util/SegmentIntersection","DOT/Util","DOT/Vector2"],function(t){"use strict";function e(t){return t>=0&&t<=1}function i(t,e,i,n){c.call(this),this._start=t,this._control1=e,this._control2=i,this._end=n,this.invalidate()}var n=t("DOT/Bounds2"),s=t("KITE/ops/BoundsIntersection"),r=t("PHET_CORE/inherit"),a=t("KITE/kite"),o=t("DOT/Matrix3"),h=t("KITE/util/Overlap"),l=t("KITE/segments/Quadratic"),u=t("KITE/util/RayIntersection"),c=t("KITE/segments/Segment"),d=t("KITE/util/SegmentIntersection"),f=t("DOT/Util"),m=t("DOT/Vector2"),p=f.solveQuadraticRootsReal,g=f.solveCubicRootsReal,v=f.arePointsCollinear,y=new m(0,0),E=new m(0,0),b=new m(0,0);return a.register("Cubic",i),r(c,i,{degree:3,setStart:function(t){return this._start.equals(t)||(this._start=t,this.invalidate()),this},set start(t){this.setStart(t)},getStart:function(){return this._start},get start(){return this.getStart()},setControl1:function(t){return this._control1.equals(t)||(this._control1=t,this.invalidate()),this},set control1(t){this.setControl1(t)},getControl1:function(){return this._control1},get control1(){return this.getControl1()},setControl2:function(t){return this._control2.equals(t)||(this._control2=t,this.invalidate()),this},set control2(t){this.setControl2(t)},getControl2:function(){return this._control2},get control2(){return this.getControl2()},setEnd:function(t){return this._end.equals(t)||(this._end=t,this.invalidate()),this},set end(t){this.setEnd(t)},getEnd:function(){return this._end},get end(){return this.getEnd()},positionAt:function(t){var e=1-t,i=e*e*e,n=3*e*e*t,s=3*e*t*t,r=t*t*t;return new m(this._start.x*i+this._control1.x*n+this._control2.x*s+this._end.x*r,this._start.y*i+this._control1.y*n+this._control2.y*s+this._end.y*r)},tangentAt:function(t){var e=1-t;return new m(0,0).set(this._start).multiplyScalar(-3*e*e).add(y.set(this._control1).multiplyScalar(3*e*e-6*e*t)).add(y.set(this._control2).multiplyScalar(6*e*t-3*t*t)).add(y.set(this._end).multiplyScalar(3*t*t))},curvatureAt:function(t){if(Math.abs(t-.5)>.5-1e-7){var e=t<.5,i=e?this._start:this._end,n=e?this._control1:this._control2,s=e?this._control2:this._control1,r=n.minus(i),a=r.magnitude;return(e?-1:1)*r.perpendicular().normalized().dot(s.minus(n))*(this.degree-1)/(this.degree*a*a)}return this.subdivided(t)[0].curvatureAt(1)},subdivided:function(t){if(0===t||1===t)return[this];var e=this._start.blend(this._control1,t),i=this._control2.blend(this._end,t),n=this._control1.blend(this._control2,t),s=e.blend(n,t),r=n.blend(i,t),o=s.blend(r,t);return[new a.Cubic(this._start,e,s,o),new a.Cubic(o,r,i,this._end)]},invalidate:function(){this._startTangent=null,this._endTangent=null,this._r=null,this._s=null,this._tCusp=null,this._tDeterminant=null,this._tInflection1=null,this._tInflection2=null,this._quadratics=null,this._xExtremaT=null,this._yExtremaT=null,this._bounds=null,this._svgPathFragment=null,this.trigger0("invalidated")},getStartTangent:function(){return null===this._startTangent&&(this._startTangent=this.tangentAt(0).normalized()),this._startTangent},get startTangent(){return this.getStartTangent()},getEndTangent:function(){return null===this._endTangent&&(this._endTangent=this.tangentAt(1).normalized()),this._endTangent},get endTangent(){return this.getEndTangent()},getR:function(){return null===this._r&&(this._r=this._control1.minus(this._start).normalized()),this._r},get r(){return this.getR()},getS:function(){return null===this._s&&(this._s=this.getR().perpendicular()),this._s},get s(){return this.getS()},getTCusp:function(){return null===this._tCusp&&this.computeCuspInfo(),this._tCusp},get tCusp(){return this.getTCusp()},getTDeterminant:function(){return null===this._tDeterminant&&this.computeCuspInfo(),this._tDeterminant},get tDeterminant(){return this.getTDeterminant()},getTInflection1:function(){return null===this._tInflection1&&this.computeCuspInfo(),this._tInflection1},get tInflection1(){return this.getTInflection1()},getTInflection2:function(){return null===this._tInflection2&&this.computeCuspInfo(),this._tInflection2},get tInflection2(){return this.getTInflection2()},getQuadratics:function(){return null===this._quadratics&&this.computeCuspSegments(),this._quadratics},getXExtremaT:function(){return null===this._xExtremaT&&(this._xExtremaT=i.extremaT(this._start.x,this._control1.x,this._control2.x,this._end.x)),this._xExtremaT},get xExtremaT(){return this.getXExtremaT()},getYExtremaT:function(){return null===this._yExtremaT&&(this._yExtremaT=i.extremaT(this._start.y,this._control1.y,this._control2.y,this._end.y)),this._yExtremaT},get yExtremaT(){return this.getYExtremaT()},getBounds:function(){if(null===this._bounds){this._bounds=n.NOTHING,this._bounds=this._bounds.withPoint(this._start),this._bounds=this._bounds.withPoint(this._end);var t=this;_.each(this.getXExtremaT(),function(e){e>=0&&e<=1&&(t._bounds=t._bounds.withPoint(t.positionAt(e)))}),_.each(this.getYExtremaT(),function(e){e>=0&&e<=1&&(t._bounds=t._bounds.withPoint(t.positionAt(e)))}),this.hasCusp()&&(this._bounds=this._bounds.withPoint(this.positionAt(this.getTCusp())))}return this._bounds},get bounds(){return this.getBounds()},computeCuspInfo:function(){var t=this._start.times(-1).plus(this._control1.times(3)).plus(this._control2.times(-3)).plus(this._end),e=this._start.times(3).plus(this._control1.times(-6)).plus(this._control2.times(3)),i=this._start.times(-3).plus(this._control1.times(3)),n=t.perpendicular(),s=e.perpendicular(),r=n.dot(e);if(this._tCusp=n.dot(i)/r*-.5,this._tDeterminant=this._tCusp*this._tCusp-1/3*(s.dot(i)/r),this._tDeterminant>=0){var a=Math.sqrt(this._tDeterminant);this._tInflection1=this._tCusp-a,this._tInflection2=this._tCusp+a}else this._tInflection1=NaN,this._tInflection2=NaN},computeCuspSegments:function(){if(this.hasCusp()){this._quadratics=[];var t=this.getTCusp();if(0===t)this._quadratics.push(new l(this.start,this.control2,this.end,!1));else if(1===t)this._quadratics.push(new l(this.start,this.control1,this.end,!1));else{var e=this.subdivided(t);this._quadratics.push(new l(e[0].start,e[0].control1,e[0].end,!1)),this._quadratics.push(new l(e[1].start,e[1].control2,e[1].end,!1))}}else this._quadratics=null},getNondegenerateSegments:function(){var t=this,e=this._start,i=this._control1,n=this._control2,s=this._end,r=this.degreeReduced(1e-9);if(e.equals(s)&&e.equals(i)&&e.equals(n))return[];if(this.hasCusp())return _.flatten(this.getQuadratics().map(function(t){return t.getNondegenerateSegments()}));if(r)return r.getNondegenerateSegments();if(v(e,i,s)&&v(e,n,s)){var o=this.getXExtremaT().concat(this.getYExtremaT()).sort().map(function(e){return t.positionAt(e)}),h=[],l=e;o.length&&(h.push(new a.Line(e,o[0])),l=o[0]);for(var u=1;u<o.length;u++)h.push(new a.Line(o[u-1],o[u])),l=o[u];return h.push(new a.Line(l,s)),_.flatten(h.map(function(t){return t.getNondegenerateSegments()}),!0)}return[this]},hasCusp:function(){var t=this.getTCusp();return t>=0&&t<=1&&this.tangentAt(t).magnitude<1e-7},toRS:function(t){var e=t.minus(this._start);return new m(e.dot(this.getR()),e.dot(this.getS()))},offsetTo:function(t,e){for(var i=[],n=[],s=0;s<32;s++){var r=s/31;e&&(r=1-r),i.push(this.positionAt(r).plus(this.tangentAt(r).perpendicular().normalized().times(t))),s>0&&n.push(new a.Line(i[s-1],i[s]))}return n},getSVGPathFragment:function(){return this._svgPathFragment||(this._svgPathFragment="C "+a.svgNumber(this._control1.x)+" "+a.svgNumber(this._control1.y)+" "+a.svgNumber(this._control2.x)+" "+a.svgNumber(this._control2.y)+" "+a.svgNumber(this._end.x)+" "+a.svgNumber(this._end.y)),this._svgPathFragment},strokeLeft:function(t){return this.offsetTo(-t/2,!1)},strokeRight:function(t){return this.offsetTo(t/2,!0)},getInteriorExtremaTs:function(){var t=this.getXExtremaT().concat(this.getYExtremaT()),e=[];return _.each(t,function(t){t>1e-10&&t<1-1e-10&&_.every(e,function(e){return Math.abs(t-e)>1e-10})&&e.push(t)}),e.sort()},intersection:function(t){var e=this,i=[],n=o.rotation2(-t.direction.angle).timesMatrix(o.translation(-t.position.x,-t.position.y)),s=n.timesVector2(this._start),r=n.timesVector2(this._control1),a=n.timesVector2(this._control2),h=n.timesVector2(this._end),l=-s.y+3*r.y-3*a.y+h.y,c=3*s.y-6*r.y+3*a.y,d=-3*s.y+3*r.y,f=s.y,m=g(l,c,d,f);return _.each(m,function(n){if(n>=0&&n<=1){var s=e.positionAt(n),r=e.tangentAt(n).normalized(),a=r.perpendicular(),o=s.minus(t.position);if(o.dot(t.direction)>0){var h=a.dot(t.direction)>0?a.negated():a,l=t.direction.perpendicular().dot(r)<0?1:-1;i.push(new u(o.magnitude,s,h,l,n))}}}),i},windingIntersection:function(t){var e=0,i=this.intersection(t);return _.each(i,function(t){e+=t.wind}),e},writeToContext:function(t){t.bezierCurveTo(this._control1.x,this._control1.y,this._control2.x,this._control2.y,this._end.x,this._end.y)},transformed:function(t){return new a.Cubic(t.timesVector2(this._start),t.timesVector2(this._control1),t.timesVector2(this._control2),t.timesVector2(this._end))},degreeReduced:function(t){t=t||0;var e=y.set(this._control1).multiplyScalar(3).subtract(this._start).divideScalar(2),i=E.set(this._control2).multiplyScalar(3).subtract(this._end).divideScalar(2);return b.set(e).subtract(i).magnitude<=t?new l(this._start,e.average(i),this._end):null},getSignedAreaFragment:function(){return.05*(this._start.x*(6*this._control1.y+3*this._control2.y+this._end.y)+this._control1.x*(-6*this._start.y+3*this._control2.y+3*this._end.y)+this._control2.x*(-3*this._start.y-3*this._control1.y+6*this._end.y)+this._end.x*(-this._start.y-3*this._control1.y-6*this._control2.y))},reversed:function(){return new a.Cubic(this._end,this._control2,this._control1,this._start)},getSelfIntersection:function(){var t=this.getInteriorExtremaTs(),e=[0].concat(t).concat([1]),i=this.subdivisions(t);if(i.length<3)return null;for(var n=0;n<i.length;n++)for(var r=i[n],a=n+1;a<i.length;a++){var o=i[a],h=s.intersect(r,o);if(h.length){var l=h[0];if(l.aT>1e-7&&l.aT<1-1e-7&&l.bT>1e-7&&l.bT<1-1e-7){var u=e[n]+l.aT*(e[n+1]-e[n]),c=e[a]+l.bT*(e[a+1]-e[a]);return new d(l.point,u,c)}}}return null},serialize:function(){return{type:"Cubic",startX:this._start.x,startY:this._start.y,control1X:this._control1.x,control1Y:this._control1.y,control2X:this._control2.x,control2Y:this._control2.y,endX:this._end.x,endY:this._end.y}}}),i.deserialize=function(t){return new i(new m(t.startX,t.startY),new m(t.control1X,t.control1Y),new m(t.control2X,t.control2Y),new m(t.endX,t.endY))},i.extremaT=function(t,i,n,s){if(t===i&&t===n&&t===s)return[];var r=-3*t+9*i-9*n+3*s,a=6*t-12*i+6*n,o=-3*t+3*i;return _.filter(p(r,a,o),e)},i.getOverlaps=function(t,i){var n,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-6,r=[],a=t._start.x,o=-3*t._start.x+3*t._control1.x,l=3*t._start.x-6*t._control1.x+3*t._control2.x,u=-1*t._start.x+3*t._control1.x-3*t._control2.x+t._end.x,d=t._start.y,m=-3*t._start.y+3*t._control1.y,p=3*t._start.y-6*t._control1.y+3*t._control2.y,g=-1*t._start.y+3*t._control1.y-3*t._control2.y+t._end.y,v=i._start.x,y=-3*i._start.x+3*i._control1.x,E=3*i._start.x-6*i._control1.x+3*i._control2.x,b=-1*i._start.x+3*i._control1.x-3*i._control2.x+i._end.x,S=i._start.y,T=-3*i._start.y+3*i._control1.y,C=3*i._start.y-6*i._control1.y+3*i._control2.y,x=-1*i._start.y+3*i._control1.y-3*i._control2.y+i._end.y,w=Math.abs(Math.max(t._start.x,t._control1.x,t._control2.x,t._end.x,t._start.x,t._control1.x,t._control2.x,t._end.x)-Math.min(t._start.x,t._control1.x,t._control2.x,t._end.x,t._start.x,t._control1.x,t._control2.x,t._end.x)),R=Math.abs(Math.max(t._start.y,t._control1.y,t._control2.y,t._end.y,t._start.y,t._control1.y,t._control2.y,t._end.y)-Math.min(t._start.y,t._control1.y,t._control2.y,t._end.y,t._start.y,t._control1.y,t._control2.y,t._end.y)),D=c.polynomialGetOverlapCubic(a,o,l,u,v,y,E,b),P=c.polynomialGetOverlapCubic(d,m,p,g,S,T,C,x);if(null===(n=w>R?null===D||!0===D?P:D:null===P||!0===P?D:P)||!0===n)return r;for(var N=n.a,A=n.b,O=N*N,I=N*N*N,k=A*A,M=A*A*A,L=2*N*A,Y=3*N*k,B=3*O*A,H=v+A*y+k*E+M*b-a,F=N*y+L*E+Y*b-o,V=O*E+B*b-l,X=I*b-u,z=S+A*T+k*C+M*x-d,G=N*T+L*C+Y*x-m,q=O*C+B*x-p,W=I*x-g,U=f.solveQuadraticRootsReal(3*X,2*V,F),j=f.solveQuadraticRootsReal(3*W,2*q,G),K=_.uniq([0,1].concat(null!==U?U.filter(e):[])),Z=_.uniq([0,1].concat(null!==j?j.filter(e):[])),Q=0;Q<K.length;Q++){var J=K[Q];if(Math.abs(((X*J+V)*J+F)*J+H)>s)return r}for(var $=0;$<Z.length;$++){var tt=Z[$];if(Math.abs(((W*tt+q)*tt+G)*tt+z)>s)return r}var et=N+A;return A>1&&et>1||A<0&&et<0?r:[new h(N,A)]},i}),i("KITE/segments/EllipticalArc",["require","KITE/segments/Arc","DOT/Bounds2","PHET_CORE/inherit","KITE/kite","DOT/Matrix3","KITE/util/RayIntersection","KITE/segments/Segment","DOT/Transform3","DOT/Util","DOT/Vector2"],function(t){"use strict";function e(t,e,i,n,s,r,a){h.call(this),this._center=t,this._radiusX=e,this._radiusY=i,this._rotation=n,this._startAngle=s,this._endAngle=r,this._anticlockwise=a,this.invalidate()}var i=t("KITE/segments/Arc"),n=t("DOT/Bounds2"),s=t("PHET_CORE/inherit"),r=t("KITE/kite"),a=t("DOT/Matrix3"),o=t("KITE/util/RayIntersection"),h=t("KITE/segments/Segment"),l=t("DOT/Transform3"),u=t("DOT/Util"),c=t("DOT/Vector2"),d=u.toDegrees;return r.register("EllipticalArc",e),s(h,e,{setCenter:function(t){return this._center.equals(t)||(this._center=t,this.invalidate()),this},set center(t){this.setCenter(t)},getCenter:function(){return this._center},get center(){return this.getCenter()},setRadiusX:function(t){return this._radiusX!==t&&(this._radiusX=t,this.invalidate()),this},set radiusX(t){this.setRadiusX(t)},getRadiusX:function(){return this._radiusX},get radiusX(){return this.getRadiusX()},setRadiusY:function(t){return this._radiusY!==t&&(this._radiusY=t,this.invalidate()),this},set radiusY(t){this.setRadiusY(t)},getRadiusY:function(){return this._radiusY},get radiusY(){return this.getRadiusY()},setRotation:function(t){return this._rotation!==t&&(this._rotation=t,this.invalidate()),this},set rotation(t){this.setRotation(t)},getRotation:function(){return this._rotation},get rotation(){return this.getRotation()},setStartAngle:function(t){return this._startAngle!==t&&(this._startAngle=t,this.invalidate()),this},set startAngle(t){this.setStartAngle(t)},getStartAngle:function(){return this._startAngle},get startAngle(){return this.getStartAngle()},setEndAngle:function(t){return this._endAngle!==t&&(this._endAngle=t,this.invalidate()),this},set endAngle(t){this.setEndAngle(t)},getEndAngle:function(){return this._endAngle},get endAngle(){return this.getEndAngle()},setAnticlockwise:function(t){return this._anticlockwise!==t&&(this._anticlockwise=t,this.invalidate()),this},set anticlockwise(t){this.setAnticlockwise(t)},getAnticlockwise:function(){return this._anticlockwise},get anticlockwise(){return this.getAnticlockwise()},positionAt:function(t){return this.positionAtAngle(this.angleAt(t))},tangentAt:function(t){return this.tangentAtAngle(this.angleAt(t))},curvatureAt:function(t){var e=this.angleAt(t),i=this._radiusX*Math.sin(e),n=this._radiusY*Math.cos(e),s=Math.pow(n*n+i*i,1.5);return(this._anticlockwise?-1:1)*this._radiusX*this._radiusY/s},subdivided:function(t){if(0===t||1===t)return[this];var e=this.angleAt(0),i=this.angleAt(t),n=this.angleAt(1);return[new r.EllipticalArc(this._center,this._radiusX,this._radiusY,this._rotation,e,i,this._anticlockwise),new r.EllipticalArc(this._center,this._radiusX,this._radiusY,this._rotation,i,n,this._anticlockwise)]},invalidate:function(){if(this._unitTransform=null,this._start=null,this._end=null,this._startTangent=null,this._endTangent=null,this._actualEndAngle=null,this._isFullPerimeter=null,this._angleDifference=null,this._unitArcSegment=null,this._bounds=null,this._svgPathFragment=null,this._radiusX<0&&(this._radiusX=-this._radiusX,this._startAngle=Math.PI-this._startAngle,this._endAngle=Math.PI-this._endAngle,this._anticlockwise=!this._anticlockwise),this._radiusY<0&&(this._radiusY=-this._radiusY,this._startAngle=-this._startAngle,this._endAngle=-this._endAngle,this._anticlockwise=!this._anticlockwise),this._radiusX<this._radiusY){this._rotation+=Math.PI/2,this._startAngle-=Math.PI/2,this._endAngle-=Math.PI/2;var t=this._radiusX;this._radiusX=this._radiusY,this._radiusY=t}if(this._radiusX<this._radiusY)throw new Error("Not verified to work if radiusX < radiusY");this.trigger0("invalidated")},getUnitTransform:function(){return null===this._unitTransform&&(this._unitTransform=e.computeUnitTransform(this._center,this._radiusX,this._radiusY,this._rotation)),this._unitTransform},get unitTransform(){return this.getUnitTransform()},getStart:function(){return null===this._start&&(this._start=this.positionAtAngle(this._startAngle)),this._start},get start(){return this.getStart()},getEnd:function(){return null===this._end&&(this._end=this.positionAtAngle(this._endAngle)),this._end},get end(){return this.getEnd()},getStartTangent:function(){return null===this._startTangent&&(this._startTangent=this.tangentAtAngle(this._startAngle)),this._startTangent},get startTangent(){return this.getStartTangent()},getEndTangent:function(){return null===this._endTangent&&(this._endTangent=this.tangentAtAngle(this._endAngle)),this._endTangent},get endTangent(){return this.getEndTangent()},getActualEndAngle:function(){return null===this._actualEndAngle&&(this._actualEndAngle=i.computeActualEndAngle(this._startAngle,this._endAngle,this._anticlockwise)),this._actualEndAngle},get actualEndAngle(){return this.getActualEndAngle()},getIsFullPerimeter:function(){return null===this._isFullPerimeter&&(this._isFullPerimeter=!this._anticlockwise&&this._endAngle-this._startAngle>=2*Math.PI||this._anticlockwise&&this._startAngle-this._endAngle>=2*Math.PI),this._isFullPerimeter},get isFullPerimeter(){return this.getIsFullPerimeter()},getAngleDifference:function(){return null===this._angleDifference&&(this._angleDifference=this._anticlockwise?this._startAngle-this._endAngle:this._endAngle-this._startAngle,this._angleDifference<0&&(this._angleDifference+=2*Math.PI)),this._angleDifference},get angleDifference(){return this.getAngleDifference()},getUnitArcSegment:function(){return null===this._unitArcSegment&&(this._unitArcSegment=new r.Arc(c.ZERO,1,this._startAngle,this._endAngle,this._anticlockwise)),this._unitArcSegment},get unitArcSegment(){return this.getUnitArcSegment()},getBounds:function(){if(null===this._bounds&&(this._bounds=n.NOTHING.withPoint(this.getStart()).withPoint(this.getEnd()),this._startAngle!==this._endAngle)){var t=Math.atan(-this._radiusY/this._radiusX*Math.tan(this._rotation)),e=Math.atan(this._radiusY/this._radiusX/Math.tan(this._rotation));this.possibleExtremaAngles=[t,t+Math.PI,e,e+Math.PI],_.each(this.possibleExtremaAngles,this.includeBoundsAtAngle.bind(this))}return this._bounds},get bounds(){return this.getBounds()},getNondegenerateSegments:function(){if(this._radiusX<=0||this._radiusY<=0||this._startAngle===this._endAngle)return[];if(this._radiusX===this._radiusY){var t=this._startAngle-this._rotation,e=this._endAngle-this._rotation;return Math.abs(this._endAngle-this._startAngle)===2*Math.PI&&(e=this._anticlockwise?t-2*Math.PI:t+2*Math.PI),[new r.Arc(this._center,this._radiusX,t,e,this._anticlockwise)]}return[this]},includeBoundsAtAngle:function(t){this.unitArcSegment.containsAngle(t)&&(this._bounds=this._bounds.withPoint(this.positionAtAngle(t)))},mapAngle:function(t){return Math.abs(u.moduloBetweenDown(t-this._startAngle,-Math.PI,Math.PI))<1e-8?this._startAngle:Math.abs(u.moduloBetweenDown(t-this.getActualEndAngle(),-Math.PI,Math.PI))<1e-8?this.getActualEndAngle():this._startAngle>this.getActualEndAngle()?u.moduloBetweenUp(t,this._startAngle-2*Math.PI,this._startAngle):u.moduloBetweenDown(t,this._startAngle,this._startAngle+2*Math.PI)},tAtAngle:function(t){return(this.mapAngle(t)-this._startAngle)/(this.getActualEndAngle()-this._startAngle)},angleAt:function(t){return this._startAngle+(this.getActualEndAngle()-this._startAngle)*t},positionAtAngle:function(t){return this.getUnitTransform().transformPosition2(c.createPolar(1,t))},tangentAtAngle:function(t){var e=this.getUnitTransform().transformNormal2(c.createPolar(1,t));return this._anticlockwise?e.perpendicular():e.perpendicular().negated()},offsetTo:function(t,e){for(var i=[],n=[],s=0;s<32;s++){var a=s/31;e&&(a=1-a);var o=this.angleAt(a);i.push(this.positionAtAngle(o).plus(this.tangentAtAngle(o).perpendicular().normalized().times(t))),s>0&&n.push(new r.Line(i[s-1],i[s]))}return n},getSVGPathFragment:function(){if(!this._svgPathFragment){var t,e=this._anticlockwise?"0":"1",i=d(this._rotation);if(this.getAngleDifference()<2*Math.PI-.01)t=this.getAngleDifference()<Math.PI?"0":"1",this._svgPathFragment="A "+r.svgNumber(this._radiusX)+" "+r.svgNumber(this._radiusY)+" "+i+" "+t+" "+e+" "+r.svgNumber(this.getEnd().x)+" "+r.svgNumber(this.getEnd().y);else{var n=(this._startAngle+this._endAngle)/2,s=this.positionAtAngle(n);t="0";var a="A "+r.svgNumber(this._radiusX)+" "+r.svgNumber(this._radiusY)+" "+i+" "+t+" "+e+" "+r.svgNumber(s.x)+" "+r.svgNumber(s.y),o="A "+r.svgNumber(this._radiusX)+" "+r.svgNumber(this._radiusY)+" "+i+" "+t+" "+e+" "+r.svgNumber(this.getEnd().x)+" "+r.svgNumber(this.getEnd().y);this._svgPathFragment=a+" "+o}}return this._svgPathFragment},strokeLeft:function(t){return this.offsetTo(-t/2,!1)},strokeRight:function(t){return this.offsetTo(t/2,!0)},getInteriorExtremaTs:function(){var t=this,e=[];return _.each(this.possibleExtremaAngles,function(i){if(t.unitArcSegment.containsAngle(i)){var n=t.tAtAngle(i);n>1e-10&&n<1-1e-10&&e.push(n)}}),e.sort()},intersection:function(t){var e=this.getUnitTransform(),i=e.inverseRay2(t),n=this.getUnitArcSegment().intersection(i);return _.map(n,function(i){var n=e.transformPosition2(i.point),s=t.position.distance(n),r=e.inverseNormal2(i.normal);return new o(s,n,r,i.wind,i.t)})},windingIntersection:function(t){var e=this.getUnitTransform().inverseRay2(t);return this.getUnitArcSegment().windingIntersection(e)},writeToContext:function(t){t.ellipse?t.ellipse(this._center.x,this._center.y,this._radiusX,this._radiusY,this._rotation,this._startAngle,this._endAngle,this._anticlockwise):(this.getUnitTransform().getMatrix().canvasAppendTransform(t),t.arc(0,0,1,this._startAngle,this._endAngle,this._anticlockwise),this.getUnitTransform().getInverse().canvasAppendTransform(t))},transformed:function(t){var e=t.timesVector2(c.createPolar(this._radiusX,this._rotation)).minus(t.timesVector2(c.ZERO)),i=t.timesVector2(c.createPolar(this._radiusY,this._rotation+Math.PI/2)).minus(t.timesVector2(c.ZERO)),n=e.angle,s=e.magnitude,a=i.magnitude,o=t.getDeterminant()<0,h=o?!this._anticlockwise:this._anticlockwise,l=o?-this._startAngle:this._startAngle,u=o?-this._endAngle:this._endAngle;return Math.abs(this._endAngle-this._startAngle)===2*Math.PI&&(u=h?l-2*Math.PI:l+2*Math.PI),new r.EllipticalArc(t.timesVector2(this._center),s,a,n,l,u,h)},getSignedAreaFragment:function(){var t=this._startAngle,e=this.getActualEndAngle(),i=Math.sin(t),n=Math.sin(e),s=Math.cos(t),r=Math.cos(e);return.5*(this._radiusX*this._radiusY*(e-t)+Math.cos(this._rotation)*(this._radiusX*this._center.y*(s-r)+this._radiusY*this._center.x*(n-i))+Math.sin(this._rotation)*(this._radiusX*this._center.x*(r-s)+this._radiusY*this._center.y*(n-i)))},reversed:function(){return new r.EllipticalArc(this._center,this._radiusX,this._radiusY,this._rotation,this._endAngle,this._startAngle,!this._anticlockwise)},serialize:function(){return{type:"EllipticalArc",centerX:this._center.x,centerY:this._center.y,radiusX:this._radiusX,radiusY:this._radiusY,rotation:this._rotation,startAngle:this._startAngle,endAngle:this._endAngle,anticlockwise:this._anticlockwise}}}),e.deserialize=function(t){return new e(new c(t.centerX,t.centerY),t.radiusX,t.radiusY,t.rotation,t.startAngle,t.endAngle,t.anticlockwise)},e.getOverlaps=function(t,e){return t._center.distance(e._center)>1e-8?[]:Math.abs(t._radiusX-e._radiusX)>1e-8||Math.abs(t._radiusY-e._radiusY)>1e-8||Math.abs(u.moduloBetweenDown(t._rotation-e._rotation+Math.PI/2,0,Math.PI)-Math.PI/2)>1e-10?[]:i.getAngularOverlaps(t._startAngle+t._rotation,t.getActualEndAngle()+t._rotation,e._startAngle+e._rotation,e.getActualEndAngle()+e._rotation)},e.computeUnitTransform=function(t,e,i,n){return new l(a.translation(t.x,t.y).timesMatrix(a.rotation2(n)).timesMatrix(a.scaling(e,i)))},e}),i("KITE/util/LineStyles",["require","KITE/segments/Arc","PHET_CORE/inherit","KITE/kite","KITE/segments/Line","DOT/Util"],function(t){"use strict";function e(t){t=_.extend({},o,t),this.lineWidth=t.lineWidth,this.lineCap=t.lineCap,this.lineJoin=t.lineJoin,this.lineDash=t.lineDash,this.lineDashOffset=t.lineDashOffset,this.miterLimit=t.miterLimit}var i=t("KITE/segments/Arc"),n=t("PHET_CORE/inherit"),s=t("KITE/kite"),r=t("KITE/segments/Line"),a=t("DOT/Util").lineLineIntersection,o={lineWidth:1,lineCap:"butt",lineJoin:"miter",lineDash:[],lineDashOffset:0,miterLimit:10};return s.register("LineStyles",e),n(Object,e,{equals:function(t){if(!(this.lineWidth===t.lineWidth&&this.lineCap===t.lineCap&&this.lineJoin===t.lineJoin&&this.miterLimit===t.miterLimit&&this.lineDashOffset===t.lineDashOffset))return!1;if(this.lineDash.length!==t.lineDash.length)return!1;for(var e=0;e<this.lineDash.length;e++)if(this.lineDash[e]!==t.lineDash[e])return!1;return!0},leftJoin:function(t,e,n){e=e.normalized(),n=n.normalized();var s=t.plus(e.perpendicular().negated().times(this.lineWidth/2)),o=t.plus(n.perpendicular().negated().times(this.lineWidth/2)),h=s.equals(o)?[]:[new r(s,o)];if(!(e.perpendicular().dot(n)>1e-12))return h;switch(this.lineJoin){case"round":var l=e.angle+Math.PI/2,u=n.angle+Math.PI/2;return[new i(t,this.lineWidth/2,l,u,!0)];case"miter":var c=e.angleBetween(n.negated());if(1/Math.sin(c/2)<=this.miterLimit&&c<Math.PI-1e-5){var d=a(s,s.plus(e),o,o.plus(n));return[new r(s,d),new r(d,o)]}return h;case"bevel":return h;default:throw new Error("invalid lineJoin: "+this.lineJoin)}},rightJoin:function(t,e,i){return this.leftJoin(t,i.negated(),e.negated())},cap:function(t,e){e=e.normalized();var n=t.plus(e.perpendicular().times(-this.lineWidth/2)),s=t.plus(e.perpendicular().times(this.lineWidth/2));switch(this.lineCap){case"butt":return[new r(n,s)];case"round":var a=e.angle;return[new i(t,this.lineWidth/2,a+Math.PI/2,a-Math.PI/2,!0)];case"square":var o=e.perpendicular().negated().times(this.lineWidth/2),h=e.perpendicular().times(this.lineWidth/2),l=e.times(this.lineWidth/2),u=t.plus(o).plus(l),c=t.plus(h).plus(l);return[new r(n,u),new r(u,c),new r(c,s)];default:throw new Error("invalid lineCap: "+this.lineCap)}}}),e.DEFAULT_OPTIONS=o,s.LineStyles}),i("KITE/util/Subpath",["require","KITE/segments/Arc","DOT/Bounds2","AXON/Events","PHET_CORE/inherit","KITE/kite","KITE/segments/Line","KITE/util/LineStyles","KITE/segments/Segment","DOT/Vector2"],function(t){"use strict";function e(t,e,i){s.call(this);var n=this;if(this.segments=[],this.points=e||(t&&t.length?_.map(t,function(t){return t.start}).concat(t[t.length-1].end):[]),this.closed=!!i,this._strokedSubpaths=null,this._strokedSubpathsComputed=!1,this._strokedStyles=null,this._bounds=null,this._invalidateListener=this.invalidate.bind(this),this._invalidatingPoints=!1,t)for(var r=0;r<t.length;r++)_.each(t[r].getNondegenerateSegments(),function(t){n.addSegmentDirectly(t)})}var i=t("KITE/segments/Arc"),n=t("DOT/Bounds2"),s=t("AXON/Events"),r=t("PHET_CORE/inherit"),a=t("KITE/kite"),o=t("KITE/segments/Line"),h=t("KITE/util/LineStyles"),l=t("KITE/segments/Segment"),u=t("DOT/Vector2");return a.register("Subpath",e),r(s,e,{getBounds:function(){if(null===this._bounds){var t=n.NOTHING.copy();_.each(this.segments,function(e){t.includeBounds(e.getBounds())}),this._bounds=t}return this._bounds},get bounds(){return this.getBounds()},getArcLength:function(t,e,i){for(var n=0,s=0;s<this.segments.length;s++)n+=this.segments[s].getArcLength(t,e,i);return n},copy:function(){return new e(this.segments.slice(0),this.points.slice(0),this.closed)},invalidatePoints:function(){this._invalidatingPoints=!0;for(var t=this.segments.length,e=0;e<t;e++)this.segments[e].invalidate();this._invalidatingPoints=!1,this.invalidate()},invalidate:function(){this._invalidatingPoints||(this._bounds=null,this._strokedSubpathsComputed=!1,this.trigger0("invalidated"))},addPoint:function(t){return this.points.push(t),this},addSegmentDirectly:function(t){return this.segments.push(t),t.onStatic("invalidated",this._invalidateListener),this},addSegment:function(t){for(var e=t.getNondegenerateSegments().length,i=0;i<e;i++)this.addSegmentDirectly(t);return this.invalidate(),this},addClosingSegment:function(){if(this.hasClosingSegment()){var t=this.getClosingSegment();this.addSegmentDirectly(t),this.invalidate(),this.addPoint(this.getFirstPoint()),this.closed=!0}},close:function(){this.closed=!0,this.addClosingSegment()},getLength:function(){return this.points.length},getFirstPoint:function(){return _.first(this.points)},getLastPoint:function(){return _.last(this.points)},getFirstSegment:function(){return _.first(this.segments)},getLastSegment:function(){return _.last(this.segments)},getFillSegments:function(){var t=this.segments.slice();return this.hasClosingSegment()&&t.push(this.getClosingSegment()),t},isDrawable:function(){return this.segments.length>0},isClosed:function(){return this.closed},hasClosingSegment:function(){return!this.getFirstPoint().equalsEpsilon(this.getLastPoint(),1e-9)},getClosingSegment:function(){return new o(this.getLastPoint(),this.getFirstPoint())},writeToContext:function(t){if(this.isDrawable()){var e=this.getFirstSegment().start;t.moveTo(e.x,e.y);for(var i=this.segments.length,n=0;n<i;n++)this.segments[n].writeToContext(t);this.closed&&t.closePath()}},toPiecewiseLinear:function(t){return new e(_.flatten(_.map(this.segments,function(e){return e.toPiecewiseLinearSegments(t)})),null,this.closed)},transformed:function(t){return new e(_.map(this.segments,function(e){return e.transformed(t)}),_.map(this.points,function(e){return t.timesVector2(e)}),this.closed)},nonlinearTransformed:function(t){return new e(_.flatten(_.map(this.segments,function(e){return t.methodName&&e[t.methodName]?e[t.methodName](t):e.toPiecewiseLinearSegments(t)})),null,this.closed)},getBoundsWithTransform:function(t){for(var e=n.NOTHING.copy(),i=this.segments.length,s=0;s<i;s++)e.includeBounds(this.segments[s].getBoundsWithTransform(t));return e},offset:function(t){if(!this.isDrawable())return new e([],null,this.closed);if(0===t)return new e(this.segments.slice(),null,this.closed);var n,s=this.segments.slice(),r=[];for(n=0;n<s.length;n++)r.push(s[n].strokeLeft(2*t));var a=[];for(n=0;n<s.length;n++){if(this.closed||n>0){var o=(n>0?n:s.length)-1,h=s[n].start,l=s[o].endTangent,u=s[n].startTangent,c=l.perpendicular().negated().times(t).angle,d=u.perpendicular().negated().times(t).angle,f=l.perpendicular().dot(u)>0;a.push(new i(h,Math.abs(t),c,d,f))}a=a.concat(r[n])}return new e(a,null,this.closed)},stroked:function(t){function i(t){a=a.concat(t)}function n(t){l=l.concat(t)}if(!this.isDrawable())return[];if(void 0===t&&(t=new h),this._strokedSubpathsComputed&&this._strokedStyles.equals(t))return this._strokedSubpaths;var s,r=t.lineWidth,a=[],l=[],u=this.getFirstSegment(),c=this.getLastSegment(),d=c.end.equals(u.start),f=d?null:new o(this.segments[this.segments.length-1].end,this.segments[0].start);for(s=0;s<this.segments.length;s++)s>0&&i(t.leftJoin(this.segments[s].start,this.segments[s-1].endTangent,this.segments[s].startTangent)),i(this.segments[s].strokeLeft(r));for(s=this.segments.length-1;s>=0;s--)s<this.segments.length-1&&n(t.rightJoin(this.segments[s].end,this.segments[s].endTangent,this.segments[s+1].startTangent)),n(this.segments[s].strokeRight(r));var m;return this.closed?(d?(i(t.leftJoin(c.end,c.endTangent,u.startTangent)),n(t.rightJoin(c.end,c.endTangent,u.startTangent))):(i(t.leftJoin(f.start,c.endTangent,f.startTangent)),i(f.strokeLeft(r)),i(t.leftJoin(f.end,f.endTangent,u.startTangent)),n(t.rightJoin(f.end,f.endTangent,u.startTangent)),n(f.strokeRight(r)),n(t.rightJoin(f.start,c.endTangent,f.startTangent))),m=[new e(a,null,!0),new e(l,null,!0)]):m=[new e(a.concat(t.cap(c.end,c.endTangent)).concat(l).concat(t.cap(u.start,u.startTangent.negated())),null,!0)],this._strokedSubpaths=m,this._strokedSubpathsComputed=!0,this._strokedStyles=new h(t),m},dashed:function(t,i,n,s){function r(t,e){var i=t[t.length-1].concat(e[0]),n=t.slice(0,t.length-1).concat([i]).concat(e.slice(1));return n}function a(t,e){if(!t.hasRightFilled||!e.hasLeftFilled)return!1;var i=_.last(_.last(t.segmentArrays)),n=e.segmentArrays[0][0];return i.end.distance(n.start)<1e-5}for(var o=[],h=0;h<this.segments.length;h++){var l=this.segments[h],u=l.getDashValues(t,i,n,s);o.push(u),i+=u.arcLength;var c=[0].concat(u.values).concat([1]),d=u.initiallyInside;u.hasLeftFilled=d,u.hasRightFilled=c.length%2==0?d:!d,u.segmentArrays=[];for(var f=d?0:1;f<c.length-1;f+=2)c[f]!==c[f+1]&&u.segmentArrays.push([l.slice(c[f],c[f+1])])}for(h=o.length-1;h>=1;h--){var m=o[h-1],p=o[h];a(m,p)&&o.splice(h-1,2,{segmentArrays:r(m.segmentArrays,p.segmentArrays),hasLeftFilled:m.hasLeftFilled,hasRightFilled:p.hasRightFilled})}return o.length>1&&a(o[o.length-1],o[0])&&(m=o.pop(),p=o.shift(),o.push({segmentArrays:r(m.segmentArrays,p.segmentArrays),hasLeftFilled:m.hasLeftFilled,hasRightFilled:p.hasRightFilled})),this.closed&&1===o.length&&1===o[0].segmentArrays.length&&o[0].hasLeftFilled&&o[0].hasRightFilled?[new e(o[0].segmentArrays[0],null,!0)]:_.flatten(o.map(function(t){return t.segmentArrays})).map(function(t){return new e(t)})},serialize:function(){return{type:"Subpath",segments:this.segments.map(function(t){return t.serialize()}),points:this.points.map(function(t){return{x:t.x,y:t.y}}),closed:this.closed}}}),e.deserialize=function(t){return new e(t.segments.map(l.deserialize),t.points.map(function(t){return new u(t.x,t.y)}),t.closed)},e}),i("KITE/ops/Boundary",["require","DOT/Bounds2","PHET_CORE/cleanArray","PHET_CORE/inherit","KITE/kite","PHET_CORE/Poolable","DOT/Ray2","KITE/util/Subpath","DOT/Vector2"],function(t){"use strict";function e(t){this.id=++u,this.initialize(t)}var i=t("DOT/Bounds2"),n=t("PHET_CORE/cleanArray"),s=t("PHET_CORE/inherit"),r=t("KITE/kite"),a=t("PHET_CORE/Poolable"),o=t("DOT/Ray2"),h=t("KITE/util/Subpath"),l=t("DOT/Vector2"),u=0;return r.register("Boundary",e),s(Object,e,{initialize:function(t){return this.halfEdges=t,this.signedArea=this.computeSignedArea(),this.bounds=this.computeBounds(),this.childBoundaries=n(this.childBoundaries),this},dispose:function(){this.halfEdges=[],n(this.childBoundaries),this.freeToPool()},isInner:function(){return this.signedArea>0},computeSignedArea:function(){for(var t=0,e=0;e<this.halfEdges.length;e++)t+=this.halfEdges[e].signedAreaFragment;return t},computeBounds:function(){for(var t=i.NOTHING.copy(),e=0;e<this.halfEdges.length;e++)t.includeBounds(this.halfEdges[e].edge.segment.getBounds());return t},computeExtremePoint:function(t){for(var e=[],n=0;n<this.halfEdges.length;n++)e.push(this.halfEdges[n].edge.segment.transformed(t.getMatrix()));var s=i.NOTHING.copy();for(n=0;n<e.length;n++)s.includeBounds(e[n].getBounds());for(n=0;n<e.length;n++){var r=e[n];if(r.getBounds().top===s.top){for(var a=new l(0,Number.POSITIVE_INFINITY),o=[0,1].concat(r.getInteriorExtremaTs()),h=0;h<o.length;h++){var u=r.positionAt(o[h]);u.y<a.y&&(a=u)}return t.inversePosition2(a)}}throw new Error("Should not reach here if we have segments")},computeExtremeRay:function(t){var e=this.computeExtremePoint(t),i=t.inverseDelta2(new l(0,-1)).normalized();return new o(e.plus(i.timesScalar(1e-4)),i)},hasHalfEdge:function(t){for(var e=0;e<this.halfEdges.length;e++)if(this.halfEdges[e]===t)return!0;return!1},toSubpath:function(){for(var t=[],e=0;e<this.halfEdges.length;e++)t.push(this.halfEdges[e].getDirectionalSegment());return new h(t,null,!0)}}),a.mixInto(e,{initialize:e.prototype.initialize}),r.Boundary}),i("KITE/ops/HalfEdge",["require","PHET_CORE/inherit","KITE/kite","PHET_CORE/Poolable","DOT/Vector2"],function(t){"use strict";function e(t,e){this.initialize(t,e)}var i=t("PHET_CORE/inherit"),n=t("KITE/kite"),s=t("PHET_CORE/Poolable"),r=t("DOT/Vector2");return n.register("HalfEdge",e),i(Object,e,{initialize:function(t,e){return this.edge=t,this.face=null,this.isReversed=e,this.signedAreaFragment=t.signedAreaFragment*(e?-1:1),this.startVertex=null,this.endVertex=null,this.sortVector=this.sortVector||new r(0,0),this.data=null,this.updateReferences(),this},dispose:function(){this.edge=null,this.face=null,this.startVertex=null,this.endVertex=null,this.data=null,this.freeToPool()},getNext:function(t){for(var e=1;;e++){var i=this.endVertex.incidentHalfEdges.indexOf(this)-e;i<0&&(i+=this.endVertex.incidentHalfEdges.length);var n=this.endVertex.incidentHalfEdges[i].getReversed();if(!t||t(n.edge))return n}},updateReferences:function(){this.startVertex=this.isReversed?this.edge.endVertex:this.edge.startVertex,this.endVertex=this.isReversed?this.edge.startVertex:this.edge.endVertex},getEndTangent:function(){return this.isReversed?this.edge.segment.startTangent:this.edge.segment.endTangent.negated()},getEndCurvature:function(){return this.isReversed?-this.edge.segment.curvatureAt(0):this.edge.segment.curvatureAt(1)},getReversed:function(){return this.isReversed?this.edge.forwardHalf:this.edge.reversedHalf},getDirectionalSegment:function(){return this.isReversed?this.edge.segment.reversed():this.edge.segment}}),s.mixInto(e,{initialize:e.prototype.initialize}),n.HalfEdge}),i("KITE/ops/Vertex",["require","PHET_CORE/cleanArray","PHET_CORE/inherit","KITE/kite","KITE/segments/Line","PHET_CORE/Poolable","DOT/Vector2"],function(t){"use strict";function e(t){this.id=++h,this.initialize(t)}var i=t("PHET_CORE/cleanArray"),n=t("PHET_CORE/inherit"),s=t("KITE/kite"),r=t("KITE/segments/Line"),a=t("PHET_CORE/Poolable"),o=t("DOT/Vector2"),h=0;return s.register("Vertex",e),n(Object,e,{initialize:function(t){return this.point=t,this.incidentHalfEdges=i(this.incidentHalfEdges),this.visited=!1,this.visitIndex=0,this.lowIndex=0,this},dispose:function(){this.point=o.ZERO,i(this.incidentHalfEdges),this.freeToPool()},sortEdges:function(){for(var t=[],i=0;i<this.incidentHalfEdges.length;i++){var n=this.incidentHalfEdges[i];t.push(n.sortVector.setXY(n.getEndTangent().angle,n.getEndCurvature()))}for(var s=1e-4-Math.PI,r=!1;!r;){for(r=!0,i=0;i<t.length;i++)t[i].x<s&&(r=!1);if(!r)for(i=0;i<t.length;i++){var a=t[i];a.x-=1.62594024516,a.x<-Math.PI-1e-4&&(a.x+=2*Math.PI)}}this.incidentHalfEdges.sort(e.edgeComparison)}},{edgeComparison:function(t,e){var i=t.sortVector.x,n=e.sortVector.x;if(Math.abs(i-n)>1e-5||i!==n&&t.edge.segment instanceof r&&e.edge.segment instanceof r)return i<n?-1:1;var s=t.sortVector.y,a=e.sortVector.y;if(Math.abs(s-a)>1e-5)return s<a?1:-1;throw new Error("TODO: Need to implement more advanced disambiguation ")}}),a.mixInto(e,{initialize:e.prototype.initialize}),s.Vertex}),i("KITE/ops/Edge",["require","KITE/ops/HalfEdge","PHET_CORE/inherit","KITE/kite","KITE/segments/Line","PHET_CORE/Poolable","KITE/segments/Segment","KITE/ops/Vertex"],function(t){"use strict";function e(t,e,i){this.id=++a,this.initialize(t,e,i)}var i=t("KITE/ops/HalfEdge"),n=t("PHET_CORE/inherit"),s=t("KITE/kite"),r=(t("KITE/segments/Line"),t("PHET_CORE/Poolable")),a=(t("KITE/segments/Segment"),t("KITE/ops/Vertex"),0);return s.register("Edge",e),n(Object,e,{initialize:function(t,e,n){return this.segment=t,this.startVertex=e,this.endVertex=n,this.signedAreaFragment=t.getSignedAreaFragment(),this.forwardHalf=i.createFromPool(this,!1),this.reversedHalf=i.createFromPool(this,!0),this.visited=!1,this.data=null,this},dispose:function(){this.segment=null,this.startVertex=null,this.endVertex=null,this.forwardHalf.dispose(),this.reversedHalf.dispose(),this.forwardHalf=null,this.reversedHalf=null,this.data=null,this.freeToPool()},getOtherVertex:function(t){return this.startVertex===t?this.endVertex:this.startVertex},updateReferences:function(){this.forwardHalf.updateReferences(),this.reversedHalf.updateReferences()}}),r.mixInto(e,{initialize:e.prototype.initialize}),s.Edge}),i("KITE/ops/Face",["require","PHET_CORE/cleanArray","PHET_CORE/inherit","KITE/kite","PHET_CORE/Poolable"],function(t){"use strict";function e(t){this.id=++a,this.initialize(t)}var i=t("PHET_CORE/cleanArray"),n=t("PHET_CORE/inherit"),s=t("KITE/kite"),r=t("PHET_CORE/Poolable"),a=0;return s.register("Face",e),n(Object,e,{initialize:function(t){return this.boundary=t,this.holes=i(this.holes),this.windingMap=null,this.filled=null,t&&this.addBoundaryFaceReferences(t),this},dispose:function(){this.boundary=null,i(this.holes),this.windingMap=null,this.filled=null,this.freeToPool()},addBoundaryFaceReferences:function(t){for(var e=0;e<t.halfEdges.length;e++)t.halfEdges[e].face=this},recursivelyAddHoles:function(t){this.holes.push(t),this.addBoundaryFaceReferences(t);for(var e=0;e<t.childBoundaries.length;e++)this.recursivelyAddHoles(t.childBoundaries[e])}}),r.mixInto(e,{initialize:e.prototype.initialize}),s.Face}),i("KITE/ops/Loop",["require","PHET_CORE/cleanArray","PHET_CORE/inherit","KITE/kite","PHET_CORE/Poolable","KITE/util/Subpath"],function(t){"use strict";function e(t,e){this.id=++o,this.initialize(t,e)}var i=t("PHET_CORE/cleanArray"),n=t("PHET_CORE/inherit"),s=t("KITE/kite"),r=t("PHET_CORE/Poolable"),a=t("KITE/util/Subpath"),o=0;return s.register("Loop",e),n(Object,e,{initialize:function(t,e){return this.shapeId=t,this.closed=e,this.halfEdges=i(this.halfEdges),this},toSubpath:function(){for(var t=[],e=0;e<this.halfEdges.length;e++)t.push(this.halfEdges[e].getDirectionalSegment());return new a(t,void 0,this.closed)},dispose:function(){i(this.halfEdges),this.freeToPool()}}),r.mixInto(e,{initialize:e.prototype.initialize}),s.Loop}),i("KITE/ops/Graph",["require","KITE/segments/Arc","PHET_CORE/arrayRemove","KITE/ops/Boundary","PHET_CORE/cleanArray","KITE/segments/Cubic","KITE/ops/Edge","KITE/segments/EllipticalArc","KITE/ops/Face","PHET_CORE/inherit","KITE/kite","KITE/segments/Line","KITE/ops/Loop","DOT/Matrix3","KITE/segments/Quadratic","KITE/segments/Segment","KITE/util/Subpath","DOT/Transform3","DOT/Util","KITE/ops/Vertex"],function(t){"use strict";function e(){this.vertices=[],this.edges=[],this.innerBoundaries=[],this.outerBoundaries=[],this.boundaries=[],this.shapeIds=[],this.loops=[],this.unboundedFace=l.createFromPool(null),this.faces=[this.unboundedFace]}var i=t("KITE/segments/Arc"),n=t("PHET_CORE/arrayRemove"),s=t("KITE/ops/Boundary"),r=t("PHET_CORE/cleanArray"),a=t("KITE/segments/Cubic"),o=t("KITE/ops/Edge"),h=t("KITE/segments/EllipticalArc"),l=t("KITE/ops/Face"),u=t("PHET_CORE/inherit"),c=t("KITE/kite"),d=t("KITE/segments/Line"),f=t("KITE/ops/Loop"),m=t("DOT/Matrix3"),p=t("KITE/segments/Quadratic"),g=t("KITE/segments/Segment"),v=t("KITE/util/Subpath"),y=t("DOT/Transform3"),E=t("DOT/Util"),b=t("KITE/ops/Vertex"),S=0;return c.register("Graph",e),u(Object,e,{addShape:function(t,e,i){for(var n=0;n<e.subpaths.length;n++)this.addSubpath(t,e.subpaths[n],i)},addSubpath:function(t,e,i){if(i=_.extend({ensureClosed:!0},i),this.shapeIds.indexOf(t)<0&&this.shapeIds.push(t),0!==e.segments.length){var n,s=e.closed||i.ensureClosed,r=i.ensureClosed?e.getFillSegments():e.segments,a=[];for(n=0;n<r.length;n++){var h=n-1;h<0&&(h=r.length-1);var l=r[h].end,u=r[n].start;s||0!==n||(l=u),u.equals(l)?a.push(b.createFromPool(u)):a.push(b.createFromPool(u.average(l)))}s||a.push(b.createFromPool(r[r.length-1].end));var c=f.createFromPool(t,s);for(n=0;n<r.length;n++){var d=n+1;s&&d===r.length&&(d=0);var m=o.createFromPool(r[n],a[n],a[d]);c.halfEdges.push(m.forwardHalf),this.addEdge(m)}this.loops.push(c),this.vertices.push.apply(this.vertices,a)}},computeSimplifiedFaces:function(){this.eliminateOverlap(),this.eliminateSelfIntersection(),this.eliminateIntersection(),this.collapseVertices(),this.removeBridges(),this.removeLowOrderVertices(),this.orderVertexEdges(),this.extractFaces(),this.computeBoundaryTree(),this.computeWindingMap()},computeFaceInclusion:function(t){for(var e=0;e<this.faces.length;e++){var i=this.faces[e];i.filled=t(i.windingMap)}},createFilledSubGraph:function(){for(var t=new e,i={},n=0;n<this.edges.length;n++){var s=this.edges[n];if(s.forwardHalf.face.filled!==s.reversedHalf.face.filled){if(!i[s.startVertex.id]){var r=b.createFromPool(s.startVertex.point);t.vertices.push(r),i[s.startVertex.id]=r}if(!i[s.endVertex.id]){var a=b.createFromPool(s.endVertex.point);t.vertices.push(a),i[s.endVertex.id]=a}var h=i[s.startVertex.id],l=i[s.endVertex.id];t.addEdge(o.createFromPool(s.segment,h,l))}}return t.collapseAdjacentEdges(),t.orderVertexEdges(),t.extractFaces(),t.computeBoundaryTree(),t.fillAlternatingFaces(),t},facesToShape:function(){for(var t=[],e=0;e<this.faces.length;e++){var i=this.faces[e];if(i.filled){t.push(i.boundary.toSubpath());for(var n=0;n<i.holes.length;n++)t.push(i.holes[n].toSubpath())}}return new c.Shape(t)},dispose:function(){for(;this.boundaries.length;)this.boundaries.pop().dispose();for(r(this.innerBoundaries),r(this.outerBoundaries);this.loops.length;)this.loops.pop().dispose();for(;this.faces.length;)this.faces.pop().dispose();for(;this.vertices.length;)this.vertices.pop().dispose();for(;this.edges.length;)this.edges.pop().dispose()},addEdge:function(t){this.edges.push(t),t.startVertex.incidentHalfEdges.push(t.reversedHalf),t.endVertex.incidentHalfEdges.push(t.forwardHalf)},removeEdge:function(t){n(this.edges,t),n(t.startVertex.incidentHalfEdges,t.reversedHalf),n(t.endVertex.incidentHalfEdges,t.forwardHalf)},replaceEdgeInLoops:function(t,e){for(var i=[],n=0;n<e.length;n++)i.push(e[e.length-1-n].getReversed());for(n=0;n<this.loops.length;n++)for(var s=this.loops[n],r=s.halfEdges.length-1;r>=0;r--){var a=s.halfEdges[r];if(a.edge===t){var o=a===t.forwardHalf?e:i;Array.prototype.splice.apply(s.halfEdges,[r,1].concat(o))}}},collapseAdjacentEdges:function(){for(var t=!0;t;){t=!1;t:for(var e=0;e<this.vertices.length;e++){var i=this.vertices[e];if(2===i.incidentHalfEdges.length){var s=i.incidentHalfEdges[0].edge,r=i.incidentHalfEdges[1].edge,a=s.segment,h=r.segment,l=s.getOtherVertex(i),u=r.getOtherVertex(i);if(s.startVertex===i&&(a=a.reversed()),r.endVertex===i&&(h=h.reversed()),a instanceof d&&h instanceof d&&a.tangentAt(0).normalized().distance(h.tangentAt(0).normalized())<1e-6){this.removeEdge(s),this.removeEdge(r),s.dispose(),r.dispose(),n(this.vertices,i),i.dispose();var c=new d(l.point,u.point);this.addEdge(new o(c,l,u)),t=!0;break t}}}}},eliminateOverlap:function(){for(var t=!0;t;){t=!1;t:for(var e=0;e<this.edges.length;e++)for(var n=this.edges[e],s=n.segment,r=e+1;r<this.edges.length;r++){var o=this.edges[r],l=o.segment,u=null;if(s instanceof d&&l instanceof d&&(u=d.getOverlaps),s instanceof p&&l instanceof p&&(u=p.getOverlaps),s instanceof a&&l instanceof a&&(u=a.getOverlaps),s instanceof i&&l instanceof i&&(u=i.getOverlaps),s instanceof h&&l instanceof h&&(u=h.getOverlaps),u){var c=u(s,l);if(c.length)for(var f=0;f<c.length;f++){var m=c[f];if(Math.abs(m.t1-m.t0)>1e-5&&Math.abs(m.qt1-m.qt0)>1e-5){this.splitOverlap(n,o,m),t=!0;break t}}}}}},splitOverlap:function(t,e,i){var n=t.segment,s=e.segment;this.removeEdge(t),this.removeEdge(e);var r=i.t0,a=i.t1,h=i.qt0,l=i.qt1;r<1e-5&&(r=0),a>.99999&&(a=1),h<1e-5&&(h=0),l>.99999&&(l=1);var u=r>0?n.subdivided(r)[0]:null,c=h>0?s.subdivided(h)[0]:null,d=a<1?n.subdivided(a)[1]:null,f=l<1?s.subdivided(l)[1]:null,m=n;r>0&&(m=m.subdivided(r)[1]),a<1&&(m=m.subdivided(E.linear(r,1,0,1,a))[0]);var p;u&&c?(p=b.createFromPool(m.start),this.vertices.push(p)):p=u?i.a>0?e.startVertex:e.endVertex:t.startVertex;var g;d&&f?(g=b.createFromPool(m.end),this.vertices.push(g)):g=d?i.a>0?e.endVertex:e.startVertex:t.endVertex;var v=o.createFromPool(m,p,g);this.addEdge(v);var y,_,S,T;u&&(y=o.createFromPool(u,t.startVertex,p),this.addEdge(y)),d&&(_=o.createFromPool(d,g,t.endVertex),this.addEdge(_)),c&&(S=o.createFromPool(c,e.startVertex,i.a>0?p:g),this.addEdge(S)),f&&(T=o.createFromPool(f,i.a>0?g:p,e.endVertex),this.addEdge(T));for(var C=(u?[y]:[]).concat([v]).concat(d?[_]:[]),x=(c?[S]:[]).concat([v]).concat(f?[T]:[]),w=[],R=[],D=0;D<C.length;D++)w.push(C[D].forwardHalf);for(D=0;D<x.length;D++){var P=x[D]!==v||i.a>0;R.push(P?x[D].forwardHalf:x[D].reversedHalf)}this.replaceEdgeInLoops(t,w),this.replaceEdgeInLoops(e,R),t.dispose(),e.dispose()},eliminateSelfIntersection:function(){for(var t=this.edges.length-1;t>=0;t--){var e=this.edges[t],i=e.segment;if(i instanceof a){var n=i.getSelfIntersection();if(n){var s=i.subdivisions([n.aT,n.bT]),r=b.createFromPool(n.point);this.vertices.push(r);var h=o.createFromPool(s[0],e.startVertex,r),l=o.createFromPool(s[1],r,r),u=o.createFromPool(s[2],r,e.endVertex);this.removeEdge(e),this.addEdge(h),this.addEdge(l),this.addEdge(u),this.replaceEdgeInLoops(e,[h.forwardHalf,l.forwardHalf,u.forwardHalf]),e.dispose()}}}},eliminateIntersection:function(){for(var t=!0;t;){t=!1;t:for(var e=0;e<this.edges.length;e++)for(var i=this.edges[e],n=i.segment,s=e+1;s<this.edges.length;s++){var r=this.edges[s],a=r.segment,o=g.intersect(n,a);if((o=o.filter(function(t){var e=t.aT,i=t.bT;return e>1e-5&&e<.99999||i>1e-5&&i<.99999})).length){var h=o[0];t=this.simpleSplit(i,r,h.aT,h.bT,h.point);break t}}}},simpleSplit:function(t,e,i,n,s){var r=!1,a=i>1e-6&&i<1-1e-6,o=n>1e-6&&n<1-1e-6,h=null;return a?o?(h=b.createFromPool(s),this.vertices.push(h)):h=n<.5?e.startVertex:e.endVertex:h=i<.5?t.startVertex:t.endVertex,a&&h!==t.startVertex&&h!==t.endVertex&&(this.splitEdge(t,i,h),r=!0),o&&h!==e.startVertex&&h!==e.endVertex&&(this.splitEdge(e,n,h),r=!0),r},splitEdge:function(t,e,i){var n=t.segment.subdivided(e),s=o.createFromPool(n[0],t.startVertex,i),r=o.createFromPool(n[1],i,t.endVertex);this.removeEdge(t),this.addEdge(s),this.addEdge(r),this.replaceEdgeInLoops(t,[s.forwardHalf,r.forwardHalf]),t.dispose()},collapseVertices:function(){for(var t=!0;t;){t=!1;t:for(var e=0;e<this.vertices.length;e++)for(var s=this.vertices[e],r=e+1;r<this.vertices.length;r++){var l=this.vertices[r],u=s.point.distance(l.point);if(u<1e-5){var c=b.createFromPool(0===u?s.point:s.point.average(l.point));this.vertices.push(c),n(this.vertices,s),n(this.vertices,l);for(var d=this.edges.length-1;d>=0;d--){var f=this.edges[d],m=f.startVertex===s||f.startVertex===l,p=f.endVertex===s||f.endVertex===l;if(m&&p){if((f.segment.bounds.width>1e-5||f.segment.bounds.height>1e-5)&&(f.segment instanceof a||f.segment instanceof i||f.segment instanceof h)){var g=o.createFromPool(f.segment,c,c);this.addEdge(g),this.replaceEdgeInLoops(f,[g.forwardHalf])}else this.replaceEdgeInLoops(f,[]);this.removeEdge(f),f.dispose()}else m?(f.startVertex=c,c.incidentHalfEdges.push(f.reversedHalf),f.updateReferences()):p&&(f.endVertex=c,c.incidentHalfEdges.push(f.forwardHalf),f.updateReferences())}s.dispose(),l.dispose(),t=!0;break t}}}},markBridges:function(t,e){e.visited=!0,e.visitIndex=e.lowIndex=S++;for(var i=0;i<e.incidentHalfEdges.length;i++){var n=e.incidentHalfEdges[i].edge,s=e.incidentHalfEdges[i].startVertex;s.visited?n.visited||(e.lowIndex=Math.min(e.lowIndex,s.visitIndex)):(n.visited=!0,s.parent=e,this.markBridges(t,s),e.lowIndex=Math.min(e.lowIndex,s.lowIndex),s.lowIndex>e.visitIndex&&t.push(n))}},removeBridges:function(){for(var t=[],e=0;e<this.vertices.length;e++){var i=this.vertices[e];i.visited||this.markBridges(t,i)}for(e=0;e<t.length;e++){var n=t[e];this.removeEdge(n),this.replaceEdgeInLoops(n,[]),n.dispose()}},removeLowOrderVertices:function(){for(var t=!0;t;){t=!1;t:for(var e=this.vertices.length-1;e>=0;e--){var i=this.vertices[e];if(i.incidentHalfEdges.length<2){for(var n=0;n<i.incidentHalfEdges.length;n++){var s=i.incidentHalfEdges[n].edge;this.removeEdge(s),this.replaceEdgeInLoops(s,[]),s.dispose()}this.vertices.splice(e,1),i.dispose(),t=!0;break t}}}},orderVertexEdges:function(){for(var t=0;t<this.vertices.length;t++)this.vertices[t].sortEdges()},extractFaces:function(){for(var t=[],e=0;e<this.edges.length;e++)t.push(this.edges[e].forwardHalf),t.push(this.edges[e].reversedHalf);for(;t.length;){for(var i=[],r=t[0],a=r;r&&(n(t,r),i.push(r),(r=r.getNext())!==a););var o=s.createFromPool(i);(o.signedArea>0?this.innerBoundaries:this.outerBoundaries).push(o),this.boundaries.push(o)}for(e=0;e<this.innerBoundaries.length;e++)this.faces.push(l.createFromPool(this.innerBoundaries[e]))},computeBoundaryTree:function(){for(var t=[],e=new y(m.rotation2(1.5729657)),i=0;i<this.outerBoundaries.length;i++){for(var n=this.outerBoundaries[i],s=n.computeExtremeRay(e),r=null,a=Number.POSITIVE_INFINITY,o=!1,h=0;h<this.edges.length;h++)for(var l=this.edges[h],u=l.segment.intersection(s),c=0;c<u.length;c++){var d=u[c];d.distance<a&&(r=l,a=d.distance,o=d.wind)}if(null===r)t.push(n);else{var f=o<0?r.reversedHalf:r.forwardHalf;this.getBoundaryOfHalfEdge(f).childBoundaries.push(n)}}for(t.forEach(this.unboundedFace.recursivelyAddHoles.bind(this.unboundedFace)),i=0;i<this.faces.length;i++){var p=this.faces[i];null!==p.boundary&&p.boundary.childBoundaries.forEach(p.recursivelyAddHoles.bind(p))}},computeWindingMap:function(){for(var t=this.edges.slice(),e={},i=0;i<this.shapeIds.length;i++)e[this.shapeIds[i]]=0;for(this.unboundedFace.windingMap=e;t.length;)for(var n=t.length-1;n>=0;n--){var s=t[n],r=s.forwardHalf,a=s.reversedHalf,o=r.face,h=a.face,l=null!==o.windingMap,u=null!==h.windingMap;if(l&&u){t.splice(n,1)}else{if(!l&&!u)continue;for(var c=l?o:h,d=l?h:o,f={},m=0;m<this.shapeIds.length;m++){var p=this.shapeIds[m],g=this.computeDifferential(s,p);f[p]=c.windingMap[p]+g*(l?-1:1)}d.windingMap=f}}},computeDifferential:function(t,e){for(var i=0,n=0;n<this.loops.length;n++){var s=this.loops[n];if(s.shapeId===e)for(var r=0;r<s.halfEdges.length;r++){var a=s.halfEdges[r];a===t.forwardHalf?i++:a===t.reversedHalf&&i--}}return i},fillAlternatingFaces:function(){for(var t=0,e=0;e<this.faces.length;e++)this.faces[e].filled=null,t++;for(this.unboundedFace.filled=!1,t--;t;)for(e=0;e<this.edges.length;e++){var i=this.edges[e],n=i.forwardHalf.face,s=i.reversedHalf.face,r=null===n.filled,a=null===s.filled;r&&!a?(n.filled=!s.filled,t--):!r&&a&&(s.filled=!n.filled,t--)}},getBoundaryOfHalfEdge:function(t){for(var e=0;e<this.boundaries.length;e++){var i=this.boundaries[e];if(i.hasHalfEdge(t))return i}throw new Error("Could not find boundary")}}),e.BINARY_NONZERO_UNION=function(t){return 0!==t[0]||0!==t[1]},e.BINARY_NONZERO_INTERSECTION=function(t){return 0!==t[0]&&0!==t[1]},e.BINARY_NONZERO_DIFFERENCE=function(t){return 0!==t[0]&&0===t[1]},e.BINARY_NONZERO_XOR=function(t){return 1==(0!==t[0]^0!==t[1])},e.binaryResult=function(t,i,n){var s=new e;s.addShape(0,t),s.addShape(1,i),s.computeSimplifiedFaces(),s.computeFaceInclusion(n);var r=s.createFilledSubGraph(),a=r.facesToShape();return s.dispose(),r.dispose(),a},e.unionNonZero=function(t){for(var i=new e,n=0;n<t.length;n++)i.addShape(n,t[n]);i.computeSimplifiedFaces(),i.computeFaceInclusion(function(e){for(var i=0;i<t.length;i++)if(0!==e[i])return!0;return!1});var s=i.createFilledSubGraph(),r=s.facesToShape();return i.dispose(),s.dispose(),r},e.intersectionNonZero=function(t){for(var i=new e,n=0;n<t.length;n++)i.addShape(n,t[n]);i.computeSimplifiedFaces(),i.computeFaceInclusion(function(e){for(var i=0;i<t.length;i++)if(0===e[i])return!1;return!0});var s=i.createFilledSubGraph(),r=s.facesToShape();return i.dispose(),s.dispose(),r},e.xorNonZero=function(t){for(var i=new e,n=0;n<t.length;n++)i.addShape(n,t[n]);i.computeSimplifiedFaces(),i.computeFaceInclusion(function(e){for(var i=!1,n=0;n<t.length;n++)0!==e[n]&&(i=!i);return i});var s=i.createFilledSubGraph(),r=s.facesToShape();return i.dispose(),s.dispose(),r},e.simplifyNonZero=function(t){var i=new e;i.addShape(0,t),i.computeSimplifiedFaces(),i.computeFaceInclusion(function(t){return 0!==t[0]});var n=i.createFilledSubGraph(),s=n.facesToShape();return i.dispose(),n.dispose(),s},e.clipShape=function(t,i,n){var s,r,a;n=_.extend({includeExterior:!1,includeBoundary:!0,includeInterior:!0},n);var o=e.simplifyNonZero(t),h=new e;for(h.addShape(0,i,{ensureClosed:!1}),h.addShape(1,o),h.eliminateOverlap(),h.eliminateSelfIntersection(),h.eliminateIntersection(),h.collapseVertices(),s=0;s<h.loops.length;s++)if(1===(a=h.loops[s]).shapeId)for(r=0;r<a.halfEdges.length;r++)a.halfEdges[r].edge.data=!0;var l=[];for(s=0;s<h.loops.length;s++)if(0===(a=h.loops[s]).shapeId){var u=[];for(r=0;r<a.halfEdges.length;r++){var d=a.halfEdges[r];(d.edge.data?n.includeBoundary:o.containsPoint(d.edge.segment.positionAt(.5))?n.includeInterior:n.includeExterior)?u.push(d.getDirectionalSegment()):u.length&&(l.push(new v(u,void 0,a.closed)),u=[])}u.length&&l.push(new v(u,void 0,a.closed))}return h.dispose(),new c.Shape(l)},c.Graph}),i("KITE/parser/svgPath",["require","KITE/kite"],function(t){function e(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var i=t("KITE/kite"),n={parse:function(t,i){function n(t){W<j||(W>j&&(j=W,K=[]),K.push(t))}function s(){var t,e,i,n,a;if(n=W,a=W,null!==(t=r())){for(e=[],i=z();null!==i;)e.push(i),i=z();null!==e&&null!==(i=s())?t=[t,e,i]:(t=null,W=a)}else t=null,W=a;return null!==t&&(t=function(t,e,i){return e.concat(i)}(0,t[0],t[2])),null===t&&(W=n),null===t&&(n=W,null!==(t=r())&&(t=t),null===t&&(W=n)),t}function r(){var t,e,i,n,s;if(n=W,s=W,null!==(t=h())){for(e=[],i=z();null!==i;)e.push(i),i=z();null!==e&&null!==(i=null!==(i=a())?i:"")?t=[t,e,i]:(t=null,W=s)}else t=null,W=s;return null!==t&&(t=function(t,e,i){return i.length?e.concat(i):e}(0,t[0],t[2])),null===t&&(W=n),t}function a(){var t,e,i,n,s;if(n=W,s=W,null!==(t=o())){for(e=[],i=z();null!==i;)e.push(i),i=z();null!==e&&null!==(i=a())?t=[t,e,i]:(t=null,W=s)}else t=null,W=s;return null!==t&&(t=function(t,e,i){return e.concat(i)}(0,t[0],t[2])),null===t&&(W=n),null===t&&(n=W,null!==(t=o())&&(t=t),null===t&&(W=n)),t}function o(){var t;return null===(t=u())&&null===(t=c())&&null===(t=f())&&null===(t=p())&&null===(t=v())&&null===(t=b())&&null===(t=T())&&null===(t=w())&&(t=D()),t}function h(){var e,i,s,r,a;if(r=W,a=W,77===t.charCodeAt(W)?(e="M",W++):(e=null,0===U&&n('"M"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i&&null!==(s=l())?e=[e,i,s]:(e=null,W=a)}else e=null,W=a;if(null!==e&&(e=G(e[2],!1)),null===e&&(W=r),null===e){if(r=W,a=W,109===t.charCodeAt(W)?(e="m",W++):(e=null,0===U&&n('"m"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i&&null!==(s=l())?e=[e,i,s]:(e=null,W=a)}else e=null,W=a;null!==e&&(e=G(e[2],!0)),null===e&&(W=r)}return e}function l(){var t,e,i,n,s;return n=W,s=W,null!==(t=A())&&null!==(e=null!==(e=M())?e:"")&&null!==(i=d())?t=[t,e,i]:(t=null,W=s),null!==t&&(t=function(t,e,i){return[e].concat(i)}(0,t[0],t[2])),null===t&&(W=n),null===t&&(n=W,null!==(t=A())&&(t=[t]),null===t&&(W=n)),t}function u(){var e,i;return i=W,90===t.charCodeAt(W)?(e="Z",W++):(e=null,0===U&&n('"Z"')),null===e&&(122===t.charCodeAt(W)?(e="z",W++):(e=null,0===U&&n('"z"'))),null!==e&&(e={cmd:"close"}),null===e&&(W=i),e}function c(){var e,i,s,r,a;if(r=W,a=W,76===t.charCodeAt(W)?(e="L",W++):(e=null,0===U&&n('"L"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i&&null!==(s=d())?e=[e,i,s]:(e=null,W=a)}else e=null,W=a;if(null!==e&&(e=e[2].map(function(t){return{cmd:"lineTo",args:[t.x,t.y]}})),null===e&&(W=r),null===e){if(r=W,a=W,108===t.charCodeAt(W)?(e="l",W++):(e=null,0===U&&n('"l"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i&&null!==(s=d())?e=[e,i,s]:(e=null,W=a)}else e=null,W=a;null!==e&&(e=e[2].map(function(t){return{cmd:"lineToRelative",args:[t.x,t.y]}})),null===e&&(W=r)}return e}function d(){var t,e,i,n,s;return n=W,s=W,null!==(t=A())&&null!==(e=null!==(e=M())?e:"")&&null!==(i=d())?t=[t,e,i]:(t=null,W=s),null!==t&&(t=function(t,e,i){return[e].concat(i)}(0,t[0],t[2])),null===t&&(W=n),null===t&&(n=W,null!==(t=A())&&(t=[t]),null===t&&(W=n)),t}function f(){var e,i,s,r,a;if(r=W,a=W,72===t.charCodeAt(W)?(e="H",W++):(e=null,0===U&&n('"H"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i&&null!==(s=m())?e=[e,i,s]:(e=null,W=a)}else e=null,W=a;if(null!==e&&(e=e[2].map(function(t){return{cmd:"horizontalLineTo",args:[t]}})),null===e&&(W=r),null===e){if(r=W,a=W,104===t.charCodeAt(W)?(e="h",W++):(e=null,0===U&&n('"h"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i&&null!==(s=m())?e=[e,i,s]:(e=null,W=a)}else e=null,W=a;null!==e&&(e=e[2].map(function(t){return{cmd:"horizontalLineToRelative",args:[t]}})),null===e&&(W=r)}return e}function m(){var t,e,i,n,s;return n=W,s=W,null!==(t=I())&&null!==(e=null!==(e=M())?e:"")&&null!==(i=m())?t=[t,e,i]:(t=null,W=s),null!==t&&(t=function(t,e,i){return[e].concat(i)}(0,t[0],t[2])),null===t&&(W=n),null===t&&(n=W,null!==(t=I())&&(t=[t]),null===t&&(W=n)),t}function p(){var e,i,s,r,a;if(r=W,a=W,86===t.charCodeAt(W)?(e="V",W++):(e=null,0===U&&n('"V"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i&&null!==(s=g())?e=[e,i,s]:(e=null,W=a)}else e=null,W=a;if(null!==e&&(e=e[2].map(function(t){return{cmd:"verticalLineTo",args:[t]}})),null===e&&(W=r),null===e){if(r=W,a=W,118===t.charCodeAt(W)?(e="v",W++):(e=null,0===U&&n('"v"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i&&null!==(s=g())?e=[e,i,s]:(e=null,W=a)}else e=null,W=a;null!==e&&(e=e[2].map(function(t){return{cmd:"verticalLineToRelative",args:[t]}})),null===e&&(W=r)}return e}function g(){var t,e,i,n,s;return n=W,s=W,null!==(t=I())&&null!==(e=null!==(e=M())?e:"")&&null!==(i=g())?t=[t,e,i]:(t=null,W=s),null!==t&&(t=function(t,e,i){return[e].concat(i)}(0,t[0],t[2])),null===t&&(W=n),null===t&&(n=W,null!==(t=I())&&(t=[t]),null===t&&(W=n)),t}function v(){var e,i,s,r,a;if(r=W,a=W,67===t.charCodeAt(W)?(e="C",W++):(e=null,0===U&&n('"C"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i&&null!==(s=y())?e=[e,i,s]:(e=null,W=a)}else e=null,W=a;if(null!==e&&(e=e[2].map(function(t){return{cmd:"cubicCurveTo",args:t}})),null===e&&(W=r),null===e){if(r=W,a=W,99===t.charCodeAt(W)?(e="c",W++):(e=null,0===U&&n('"c"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i&&null!==(s=y())?e=[e,i,s]:(e=null,W=a)}else e=null,W=a;null!==e&&(e=e[2].map(function(t){return{cmd:"cubicCurveToRelative",args:t}})),null===e&&(W=r)}return e}function y(){var t,e,i,n,s;return n=W,s=W,null!==(t=E())&&null!==(e=null!==(e=M())?e:"")&&null!==(i=y())?t=[t,e,i]:(t=null,W=s),null!==t&&(t=function(t,e,i){return[e].concat(i)}(0,t[0],t[2])),null===t&&(W=n),null===t&&(n=W,null!==(t=E())&&(t=[t]),null===t&&(W=n)),t}function E(){var t,e,i,n,s,r,a;return r=W,a=W,null!==(t=A())&&null!==(e=null!==(e=M())?e:"")&&null!==(i=A())&&null!==(n=null!==(n=M())?n:"")&&null!==(s=A())?t=[t,e,i,n,s]:(t=null,W=a),null!==t&&(t=function(t,e,i,n){return[e.x,e.y,i.x,i.y,n.x,n.y]}(0,t[0],t[2],t[4])),null===t&&(W=r),t}function b(){var e,i,s,r,a;if(r=W,a=W,83===t.charCodeAt(W)?(e="S",W++):(e=null,0===U&&n('"S"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i&&null!==(s=_())?e=[e,i,s]:(e=null,W=a)}else e=null,W=a;if(null!==e&&(e=e[2].map(function(t){return{cmd:"smoothCubicCurveTo",args:t}})),null===e&&(W=r),null===e){if(r=W,a=W,115===t.charCodeAt(W)?(e="s",W++):(e=null,0===U&&n('"s"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i&&null!==(s=_())?e=[e,i,s]:(e=null,W=a)}else e=null,W=a;null!==e&&(e=e[2].map(function(t){return{cmd:"smoothCubicCurveToRelative",args:t}})),null===e&&(W=r)}return e}function _(){var t,e,i,n,s;return n=W,s=W,null!==(t=S())&&null!==(e=null!==(e=M())?e:"")&&null!==(i=_())?t=[t,e,i]:(t=null,W=s),null!==t&&(t=function(t,e,i){return[e].concat(i)}(0,t[0],t[2])),null===t&&(W=n),null===t&&(n=W,null!==(t=S())&&(t=[t]),null===t&&(W=n)),t}function S(){var t,e,i,n,s;return n=W,s=W,null!==(t=A())&&null!==(e=null!==(e=M())?e:"")&&null!==(i=A())?t=[t,e,i]:(t=null,W=s),null!==t&&(t=function(t,e,i){return[e.x,e.y,i.x,i.y]}(0,t[0],t[2])),null===t&&(W=n),t}function T(){var e,i,s,r,a;if(r=W,a=W,81===t.charCodeAt(W)?(e="Q",W++):(e=null,0===U&&n('"Q"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i&&null!==(s=C())?e=[e,i,s]:(e=null,W=a)}else e=null,W=a;if(null!==e&&(e=e[2].map(function(t){return{cmd:"quadraticCurveTo",args:t}})),null===e&&(W=r),null===e){if(r=W,a=W,113===t.charCodeAt(W)?(e="q",W++):(e=null,0===U&&n('"q"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i&&null!==(s=C())?e=[e,i,s]:(e=null,W=a)}else e=null,W=a;null!==e&&(e=e[2].map(function(t){return{cmd:"quadraticCurveToRelative",args:t}})),null===e&&(W=r)}return e}function C(){var t,e,i,n,s;return n=W,s=W,null!==(t=x())&&null!==(e=null!==(e=M())?e:"")&&null!==(i=C())?t=[t,e,i]:(t=null,W=s),null!==t&&(t=function(t,e,i){return[e].concat(i)}(0,t[0],t[2])),null===t&&(W=n),null===t&&(n=W,null!==(t=x())&&(t=[t]),null===t&&(W=n)),t}function x(){var t,e,i,n,s;return n=W,s=W,null!==(t=A())&&null!==(e=null!==(e=M())?e:"")&&null!==(i=A())?t=[t,e,i]:(t=null,W=s),null!==t&&(t=function(t,e,i){return[e.x,e.y,i.x,i.y]}(0,t[0],t[2])),null===t&&(W=n),t}function w(){var e,i,s,r,a;if(r=W,a=W,84===t.charCodeAt(W)?(e="T",W++):(e=null,0===U&&n('"T"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i&&null!==(s=R())?e=[e,i,s]:(e=null,W=a)}else e=null,W=a;if(null!==e&&(e=e[2].map(function(t){return{cmd:"smoothQuadraticCurveTo",args:[t.x,t.y]}})),null===e&&(W=r),null===e){if(r=W,a=W,116===t.charCodeAt(W)?(e="t",W++):(e=null,0===U&&n('"t"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i&&null!==(s=R())?e=[e,i,s]:(e=null,W=a)}else e=null,W=a;null!==e&&(e=e[2].map(function(t){return{cmd:"smoothQuadraticCurveToRelative",args:[t.x,t.y]}})),null===e&&(W=r)}return e}function R(){var t,e,i,n,s;return n=W,s=W,null!==(t=A())&&null!==(e=null!==(e=M())?e:"")&&null!==(i=R())?t=[t,e,i]:(t=null,W=s),null!==t&&(t=function(t,e,i){return[e].concat(i)}(0,t[0],t[2])),null===t&&(W=n),null===t&&(n=W,null!==(t=A())&&(t=[t]),null===t&&(W=n)),t}function D(){var e,i,s,r,a;if(r=W,a=W,65===t.charCodeAt(W)?(e="A",W++):(e=null,0===U&&n('"A"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i&&null!==(s=P())?e=[e,i,s]:(e=null,W=a)}else e=null,W=a;if(null!==e&&(e=e[2].map(function(t){return t[2]*=Math.PI/180,{cmd:"ellipticalArcTo",args:t}})),null===e&&(W=r),null===e){if(r=W,a=W,97===t.charCodeAt(W)?(e="a",W++):(e=null,0===U&&n('"a"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i&&null!==(s=P())?e=[e,i,s]:(e=null,W=a)}else e=null,W=a;null!==e&&(e=e[2].map(function(t){return t[2]*=Math.PI/180,{cmd:"ellipticalArcToRelative",args:t}})),null===e&&(W=r)}return e}function P(){var t,e,i,n,s;return n=W,s=W,null!==(t=N())&&null!==(e=null!==(e=M())?e:"")&&null!==(i=P())?t=[t,e,i]:(t=null,W=s),null!==t&&(t=function(t,e,i){return[e].concat(i)}(0,t[0],t[2])),null===t&&(W=n),null===t&&(n=W,null!==(t=N())&&(t=[t]),null===t&&(W=n)),t}function N(){var t,e,i,n,s,r,a,o,h,l,u,c,d;return c=W,d=W,null!==(t=O())&&null!==(e=null!==(e=M())?e:"")&&null!==(i=O())&&null!==(n=null!==(n=M())?n:"")&&null!==(s=I())&&null!==(r=M())&&null!==(a=k())&&null!==(o=null!==(o=M())?o:"")&&null!==(h=k())&&null!==(l=null!==(l=M())?l:"")&&null!==(u=A())?t=[t,e,i,n,s,r,a,o,h,l,u]:(t=null,W=d),null!==t&&(t=function(t,e,i,n,s,r,a){return[e,i,n,s,r,a.x,a.y]}(0,t[0],t[2],t[4],t[6],t[8],t[10])),null===t&&(W=c),t}function A(){var t,e,i,n,s;return n=W,s=W,null!==(t=I())&&null!==(e=null!==(e=M())?e:"")&&null!==(i=I())?t=[t,e,i]:(t=null,W=s),null!==t&&(t={x:t[0],y:t[2]}),null===t&&(W=n),t}function O(){var t,e;return e=W,null!==(t=Y())&&(t=function(t,e){return parseFloat(e)}(0,t)),null===t&&(W=e),null===t&&(e=W,null!==(t=V())&&(t=function(t,e){return parseInt(e,10)}(0,t)),null===t&&(W=e)),t}function I(){var t,e,i,n;return i=W,n=W,t=F(),null!==(t=null!==t?t:"")&&null!==(e=Y())?t=[t,e]:(t=null,W=n),null!==t&&(t=function(t,e,i){return parseFloat(e+i)}(0,t[0],t[1])),null===t&&(W=i),null===t&&(i=W,n=W,null!==(t=null!==(t=F())?t:"")&&null!==(e=V())?t=[t,e]:(t=null,W=n),null!==t&&(t=function(t,e,i){return parseInt(e+i,10)}(0,t[0],t[1])),null===t&&(W=i)),t}function k(){var e,i;return i=W,48===t.charCodeAt(W)?(e="0",W++):(e=null,0===U&&n('"0"')),null!==e&&(e=!1),null===e&&(W=i),null===e&&(i=W,49===t.charCodeAt(W)?(e="1",W++):(e=null,0===U&&n('"1"')),null!==e&&(e=!0),null===e&&(W=i)),e}function M(){var t,e,i,n,s;if(s=W,null!==(e=z()))for(t=[];null!==e;)t.push(e),e=z();else t=null;if(null!==t)if(e=L(),null!==(e=null!==e?e:"")){for(i=[],n=z();null!==n;)i.push(n),n=z();null!==i?t=[t,e,i]:(t=null,W=s)}else t=null,W=s;else t=null,W=s;if(null===t)if(s=W,null!==(t=L())){for(e=[],i=z();null!==i;)e.push(i),i=z();null!==e?t=[t,e]:(t=null,W=s)}else t=null,W=s;return t}function L(){var e;return 44===t.charCodeAt(W)?(e=",",W++):(e=null,0===U&&n('","')),e}function Y(){var t,e,i,n;return i=W,n=W,null!==(t=B())&&null!==(e=null!==(e=H())?e:"")?t=[t,e]:(t=null,W=n),null!==t&&(t=t[0]+t[1]),null===t&&(W=i),null===t&&(i=W,n=W,null!==(t=V())&&null!==(e=H())?t=[t,e]:(t=null,W=n),null!==t&&(t=t[0]+t[1]),null===t&&(W=i)),t}function B(){var e,i,s,r,a;return r=W,a=W,e=V(),null!==(e=null!==e?e:"")?(46===t.charCodeAt(W)?(i=".",W++):(i=null,0===U&&n('"."')),null!==i&&null!==(s=V())?e=[e,i,s]:(e=null,W=a)):(e=null,W=a),null!==e&&(e=e[0]+"."+e[2]),null===e&&(W=r),null===e&&(r=W,a=W,null!==(e=V())?(46===t.charCodeAt(W)?(i=".",W++):(i=null,0===U&&n('"."')),null!==i?e=[e,i]:(e=null,W=a)):(e=null,W=a),null!==e&&(e=e[0]),null===e&&(W=r)),e}function H(){var e,i,s,r,a;return r=W,a=W,101===t.charCodeAt(W)?(e="e",W++):(e=null,0===U&&n('"e"')),null===e&&(69===t.charCodeAt(W)?(e="E",W++):(e=null,0===U&&n('"E"'))),null!==e&&null!==(i=null!==(i=F())?i:"")&&null!==(s=V())?e=[e,i,s]:(e=null,W=a),null!==e&&(e=e[0]+e[1]+e[2]),null===e&&(W=r),e}function F(){var e;return 43===t.charCodeAt(W)?(e="+",W++):(e=null,0===U&&n('"+"')),null===e&&(45===t.charCodeAt(W)?(e="-",W++):(e=null,0===U&&n('"-"'))),e}function V(){var t,e,i,n;return i=W,n=W,null!==(t=X())&&null!==(e=V())?t=[t,e]:(t=null,W=n),null!==t&&(t=t[0]+t[1]),null===t&&(W=i),null===t&&(t=X()),t}function X(){var e;return/^[0-9]/.test(t.charAt(W))?(e=t.charAt(W),W++):(e=null,0===U&&n("[0-9]")),e}function z(){var e;return 32===t.charCodeAt(W)?(e=" ",W++):(e=null,0===U&&n('" "')),null===e&&(9===t.charCodeAt(W)?(e="\t",W++):(e=null,0===U&&n('"\\t"')),null===e&&(13===t.charCodeAt(W)?(e="\r",W++):(e=null,0===U&&n('"\\r"')),null===e&&(10===t.charCodeAt(W)?(e="\n",W++):(e=null,0===U&&n('"\\n"'))))),e}function G(t,e){var i=[{cmd:e?"moveToRelative":"moveTo",args:[t[0].x,t[0].y]}];if(t.length>1)for(var n=1;n<t.length;n++)i.push({cmd:e?"lineToRelative":"lineTo",args:[t[n].x,t[n].y]});return i}var q={svgPath:function(){var t,e,i,n,r,a;for(r=W,a=W,t=[],e=z();null!==e;)t.push(e),e=z();if(null!==t)if(e=s(),null!==(e=null!==e?e:"")){for(i=[],n=z();null!==n;)i.push(n),n=z();null!==i?t=[t,e,i]:(t=null,W=a)}else t=null,W=a;else t=null,W=a;return null!==t&&(t=function(t,e){return e||[]}(0,t[1])),null===t&&(W=r),t},movetoDrawtoCommandGroups:s,movetoDrawtoCommandGroup:r,drawtoCommands:a,drawtoCommand:o,moveto:h,movetoArgumentSequence:l,closepath:u,lineto:c,linetoArgumentSequence:d,horizontalLineto:f,horizontalLinetoArgumentSequence:m,verticalLineto:p,verticalLinetoArgumentSequence:g,curveto:v,curvetoArgumentSequence:y,curvetoArgument:E,smoothCurveto:b,smoothCurvetoArgumentSequence:_,smoothCurvetoArgument:S,quadraticBezierCurveto:T,quadraticBezierCurvetoArgumentSequence:C,quadraticBezierCurvetoArgument:x,smoothQuadraticBezierCurveto:w,smoothQuadraticBezierCurvetoArgumentSequence:R,ellipticalArc:D,ellipticalArcArgumentSequence:P,ellipticalArcArgument:N,coordinatePair:A,nonnegativeNumber:O,number:I,flag:k,commaWsp:M,comma:L,floatingPointConstant:Y,fractionalConstant:B,exponent:H,sign:F,digitSequence:V,digit:X,wsp:z};if(void 0!==i){if(void 0===q[i])throw new Error("Invalid rule name: "+e(i)+".")}else i="svgPath";var W=0,U=0,j=0,K=[],Z=q[i]();if(null===Z||W!==t.length){var Q=Math.max(W,j),J=Q<t.length?t.charAt(Q):null,$=function(){for(var e=1,i=1,n=!1,s=0;s<Math.max(W,j);s++){var r=t.charAt(s);"\n"===r?(n||e++,i=1,n=!1):"\r"===r||"\u2028"===r||"\u2029"===r?(e++,i=1,n=!0):(i++,n=!1)}return{line:e,column:i}}();throw new this.SyntaxError(function(t){t.sort();for(var e=null,i=[],n=0;n<t.length;n++)t[n]!==e&&(i.push(t[n]),e=t[n]);return i}(K),J,Q,$.line,$.column)}return Z},toSource:function(){return this._source}};return n.SyntaxError=function(t,i,n,s,r){this.name="SyntaxError",this.expected=t,this.found=i,this.message=function(t,i){var n,s;switch(t.length){case 0:n="end of input";break;case 1:n=t[0];break;default:n=t.slice(0,t.length-1).join(", ")+" or "+t[t.length-1]}return s=i?e(i):"end of input","Expected "+n+" but "+s+" found."}(t,i),this.offset=n,this.line=s,this.column=r},n.SyntaxError.prototype=Error.prototype,i.register("svgPath",n),i.svgPath}),i("KITE/Shape",["require","KITE/segments/Arc","DOT/Bounds2","KITE/segments/Cubic","KITE/segments/EllipticalArc","AXON/Events","KITE/ops/Graph","PHET_CORE/inherit","KITE/kite","KITE/segments/Line","KITE/util/LineStyles","KITE/segments/Quadratic","DOT/Ray2","KITE/util/Subpath","KITE/parser/svgPath","DOT/Vector2"],function(t){"use strict";function e(t,e){return new v(t,e)}function i(t,e,i,n){return i.copy().subtract(t).multiplyScalar((1-n)/6).add(e)}function n(t,e){var i=this;if(h.call(this),this.subpaths=[],this._bounds=e?e.copy():null,this.resetControlPoints(),this._invalidateListener=this.invalidate.bind(this),this._invalidatingPoints=!1,this._immutable=!1,"object"===(void 0===t?"undefined":_typeof(t)))for(var n=0;n<t.length;n++)this.addSubpath(t[n]);t&&"object"!==(void 0===t?"undefined":_typeof(t))&&_.each(g.parse(t),function(t){i[t.cmd].apply(i,t.args)}),this.invalidate()}var s=t("KITE/segments/Arc"),r=t("DOT/Bounds2"),a=t("KITE/segments/Cubic"),o=t("KITE/segments/EllipticalArc"),h=t("AXON/Events"),l=t("KITE/ops/Graph"),u=t("PHET_CORE/inherit"),c=t("KITE/kite"),d=t("KITE/segments/Line"),f=(t("KITE/util/LineStyles"),t("KITE/segments/Quadratic")),m=t("DOT/Ray2"),p=t("KITE/util/Subpath"),g=t("KITE/parser/svgPath"),v=t("DOT/Vector2"),y=Math.random;return c.register("Shape",n),u(h,n,{resetControlPoints:function(){this.lastQuadraticControlPoint=null,this.lastCubicControlPoint=null},setQuadraticControlPoint:function(t){this.lastQuadraticControlPoint=t,this.lastCubicControlPoint=null},setCubicControlPoint:function(t){this.lastQuadraticControlPoint=null,this.lastCubicControlPoint=t},moveTo:function(t,i){return this.moveToPoint(e(t,i))},moveToRelative:function(t,i){return this.moveToPointRelative(e(t,i))},moveToPointRelative:function(t){return this.moveToPoint(this.getRelativePoint().plus(t))},moveToPoint:function(t){return this.addSubpath((new p).addPoint(t)),this.resetControlPoints(),this},lineTo:function(t,i){return this.lineToPoint(e(t,i))},lineToRelative:function(t,i){return this.lineToPointRelative(e(t,i))},lineToPointRelative:function(t){return this.lineToPoint(this.getRelativePoint().plus(t))},lineToPoint:function(t){if(this.hasSubpaths()){var e=this.getLastSubpath().getLastPoint(),i=t,n=new d(e,i);this.getLastSubpath().addPoint(i),this.addSegmentAndBounds(n)}else this.ensure(t);return this.resetControlPoints(),this},horizontalLineTo:function(t){return this.lineTo(t,this.getRelativePoint().y)},horizontalLineToRelative:function(t){return this.lineToRelative(t,0)},verticalLineTo:function(t){return this.lineTo(this.getRelativePoint().x,t)},verticalLineToRelative:function(t){return this.lineToRelative(0,t)},quadraticCurveTo:function(t,i,n,s){return this.quadraticCurveToPoint(e(t,i),e(n,s))},quadraticCurveToRelative:function(t,i,n,s){return this.quadraticCurveToPointRelative(e(t,i),e(n,s))},quadraticCurveToPointRelative:function(t,e){var i=this.getRelativePoint();return this.quadraticCurveToPoint(i.plus(t),i.plus(e))},smoothQuadraticCurveTo:function(t,i){return this.quadraticCurveToPoint(this.getSmoothQuadraticControlPoint(),e(t,i))},smoothQuadraticCurveToRelative:function(t,i){return this.quadraticCurveToPoint(this.getSmoothQuadraticControlPoint(),e(t,i).plus(this.getRelativePoint()))},quadraticCurveToPoint:function(t,e){var i=this;this.ensure(t);var n=this.getLastSubpath().getLastPoint(),s=new f(n,t,e);this.getLastSubpath().addPoint(e);var r=s.getNondegenerateSegments();return _.each(r,function(t){i.addSegmentAndBounds(t)}),this.setQuadraticControlPoint(t),this},cubicCurveTo:function(t,i,n,s,r,a){return this.cubicCurveToPoint(e(t,i),e(n,s),e(r,a))},cubicCurveToRelative:function(t,i,n,s,r,a){return this.cubicCurveToPointRelative(e(t,i),e(n,s),e(r,a))},cubicCurveToPointRelative:function(t,e,i){var n=this.getRelativePoint();return this.cubicCurveToPoint(n.plus(t),n.plus(e),n.plus(i))},smoothCubicCurveTo:function(t,i,n,s){return this.cubicCurveToPoint(this.getSmoothCubicControlPoint(),e(t,i),e(n,s))},smoothCubicCurveToRelative:function(t,i,n,s){return this.cubicCurveToPoint(this.getSmoothCubicControlPoint(),e(t,i).plus(this.getRelativePoint()),e(n,s).plus(this.getRelativePoint()))},cubicCurveToPoint:function(t,e,i){var n=this;this.ensure(t);var s=this.getLastSubpath().getLastPoint(),r=new a(s,t,e,i).getNondegenerateSegments();return _.each(r,function(t){n.addSegmentAndBounds(t)}),this.getLastSubpath().addPoint(i),this.setCubicControlPoint(e),this},arc:function(t,i,n,s,r,a){return this.arcPoint(e(t,i),n,s,r,a)},arcPoint:function(t,e,i,n,r){void 0===r&&(r=!1);var a=new s(t,e,i,n,r),o=a.getStart(),h=a.getEnd();return this.hasSubpaths()&&this.getLastSubpath().getLength()>0&&!o.equals(this.getLastSubpath().getLastPoint(),0)&&this.addSegmentAndBounds(new d(this.getLastSubpath().getLastPoint(),o)),this.hasSubpaths()||this.addSubpath(new p),this.getLastSubpath().addPoint(o),this.getLastSubpath().addPoint(h),this.addSegmentAndBounds(a),this.resetControlPoints(),this},ellipticalArc:function(t,i,n,s,r,a,o,h){return this.ellipticalArcPoint(e(t,i),n,s,r,a,o,h)},ellipticalArcPoint:function(t,e,i,n,s,r,a){void 0===a&&(a=!1);var h=new o(t,e,i,n,s,r,a),l=h.start,u=h.end;return this.hasSubpaths()&&this.getLastSubpath().getLength()>0&&!l.equals(this.getLastSubpath().getLastPoint(),0)&&this.addSegmentAndBounds(new d(this.getLastSubpath().getLastPoint(),l)),this.hasSubpaths()||this.addSubpath(new p),this.getLastSubpath().addPoint(l),this.getLastSubpath().addPoint(u),this.addSegmentAndBounds(h),this.resetControlPoints(),this},close:function(){if(this.hasSubpaths()){var t=this.getLastSubpath(),e=new p;t.close(),this.addSubpath(e),e.addPoint(t.getFirstPoint())}return this.resetControlPoints(),this},newSubpath:function(){return this.addSubpath(new p),this.resetControlPoints(),this},makeImmutable:function(){return this._immutable=!0,this.notifyInvalidationListeners(),this},isImmutable:function(){return this._immutable},ellipticalArcToRelative:function(t,e,i,n,s,r,a){var o=this.getRelativePoint();return this.ellipticalArcTo(t,e,i,n,s,r+o.x,a+o.y)},ellipticalArcTo:function(t,e,i,n,s,r,a){function h(t,e){return(t.x*e.y-t.y*e.x>0?1:-1)*t.angleBetween(e)}var l=this,u=new v(r,a);this.ensure(u);var c=this.getLastSubpath().getLastPoint();this.getLastSubpath().addPoint(u),t<0&&(t*=-1),e<0&&(e*=-1);var d=t*t,f=e*e,m=c.minus(u).dividedScalar(2).rotated(-i),p=m.x*m.x,g=m.y*m.y,y=new v(t*m.y/e,-e*m.x/t),E=p/d+g/f;E>1&&(d=(t*=Math.sqrt(E))*t,f=(e*=Math.sqrt(E))*e,y=new v(t*m.y/e,-e*m.x/t)),y.multiplyScalar(Math.sqrt(Math.max(0,(d*f-d*g-f*p)/(d*g+f*p)))),n===s&&y.multiplyScalar(-1);var b=c.blend(u,.5).plus(y.rotated(i)),S=new v((m.x-y.x)/t,(m.y-y.y)/e),T=new v((-m.x-y.x)/t,(-m.y-y.y)/e),C=h(v.X_UNIT,S),x=h(S,T)%(2*Math.PI);!s&&x>0&&(x-=2*Math.PI),s&&x<0&&(x+=2*Math.PI);var w=new o(b,t,e,i,C,C+x,!s).getNondegenerateSegments();return _.each(w,function(t){l.addSegmentAndBounds(t)}),this},circle:function(t,i,n){if("object"===(void 0===t?"undefined":_typeof(t))){var s=t;return n=i,this.arcPoint(s,n,0,2*Math.PI,!1).close()}return this.arcPoint(e(t,i),n,0,2*Math.PI,!1).close()},ellipse:function(t,i,n,s,r){if("object"===(void 0===t?"undefined":_typeof(t))){var a=t;return r=s,s=n,n=i,this.ellipticalArcPoint(a,n,s,r||0,0,2*Math.PI,!1).close()}return this.ellipticalArcPoint(e(t,i),n,s,r||0,0,2*Math.PI,!1).close()},rect:function(t,i,n,s){var r=new p;return this.addSubpath(r),r.addPoint(e(t,i)),r.addPoint(e(t+n,i)),r.addPoint(e(t+n,i+s)),r.addPoint(e(t,i+s)),this.addSegmentAndBounds(new d(r.points[0],r.points[1])),this.addSegmentAndBounds(new d(r.points[1],r.points[2])),this.addSegmentAndBounds(new d(r.points[2],r.points[3])),r.close(),this.addSubpath(new p),this.getLastSubpath().addPoint(e(t,i)),this.resetControlPoints(),this},roundRect:function(t,e,i,n,s,r){var a=t+s,o=t+i-s,h=e+r,l=e+n-r;return s===r?this.arc(o,h,s,-Math.PI/2,0,!1).arc(o,l,s,0,Math.PI/2,!1).arc(a,l,s,Math.PI/2,Math.PI,!1).arc(a,h,s,Math.PI,3*Math.PI/2,!1).close():this.ellipticalArc(o,h,s,r,0,-Math.PI/2,0,!1).ellipticalArc(o,l,s,r,0,0,Math.PI/2,!1).ellipticalArc(a,l,s,r,0,Math.PI/2,Math.PI,!1).ellipticalArc(a,h,s,r,0,Math.PI,3*Math.PI/2,!1).close(),this},polygon:function(t){var e=t.length;if(e>0){this.moveToPoint(t[0]);for(var i=1;i<e;i++)this.lineToPoint(t[i])}return this.close()},cardinalSpline:function(t,e){e=_.extend({tension:0,isClosedLineSegments:!1},e);for(var n=t.length,s=e.isClosedLineSegments?n:n-1,r=0;r<s;r++){var a,o=[(a=0!==r||e.isClosedLineSegments?r!==s-1||e.isClosedLineSegments?[t[(r-1+n)%n],t[r%n],t[(r+1)%n],t[(r+2)%n]]:[t[r-1],t[r],t[r+1],t[r+1]]:[t[0],t[0],t[1],t[2]])[1],i(a[0],a[1],a[2],e.tension),i(a[3],a[2],a[1],e.tension),a[2]];0===r&&(this.ensure(o[0]),this.getLastSubpath().addPoint(o[0])),this.cubicCurveToPoint(o[1],o[2],o[3])}return this},copy:function(){return new n(_.map(this.subpaths,function(t){return t.copy()}),this.bounds)},writeToContext:function(t){for(var e=this.subpaths.length,i=0;i<e;i++)this.subpaths[i].writeToContext(t)},getSVGPath:function(){for(var t="",e=this.subpaths.length,i=0;i<e;i++){var n=this.subpaths[i];if(n.isDrawable()){var s=n.segments[0].start;t+="M "+c.svgNumber(s.x)+" "+c.svgNumber(s.y)+" ";for(var r=0;r<n.segments.length;r++)t+=n.segments[r].getSVGPathFragment()+" ";n.isClosed()&&(t+="Z ")}}return t},transformed:function(t){var e=_.map(this.subpaths,function(e){return e.transformed(t)});return new n(e,_.reduce(e,function(t,e){return t.union(e.bounds)},r.NOTHING))},nonlinearTransformed:function(t){t=_.extend({minLevels:0,maxLevels:7,distanceEpsilon:.16,curveEpsilon:t&&t.includeCurvature?.002:null},t);var e=_.map(this.subpaths,function(e){return e.nonlinearTransformed(t)});return new n(e,_.reduce(e,function(t,e){return t.union(e.bounds)},r.NOTHING))},polarToCartesian:function(t){return this.nonlinearTransformed(_.extend({pointMap:function(t){return v.createPolar(t.y,t.x)},methodName:"polarToCartesian"},t))},toPiecewiseLinear:function(t){return this.nonlinearTransformed(t)},containsPoint:function(t){var e=new m(t,v.X_UNIT);return 0!==this.windingIntersection(e)},intersection:function(t){for(var e=[],i=this.subpaths.length,n=0;n<i;n++){var s=this.subpaths[n];if(s.isDrawable()){for(var r=s.segments.length,a=0;a<r;a++){var o=s.segments[a];e=e.concat(o.intersection(t))}s.hasClosingSegment()&&(e=e.concat(s.getClosingSegment().intersection(t)))}}return _.sortBy(e,function(t){return t.distance})},interiorIntersectsLineSegment:function(t,e){var i=t.blend(e,.5);if(this.containsPoint(i))return!0;var n=e.minus(t),s=n.magnitude;if(0===s)return!1;n.normalize();for(var r=this.intersection(new m(t,n)),a=0;a<r.length;a++)if(r[a].distance<=s)return!0;return!1},windingIntersection:function(t){for(var e=0,i=this.subpaths.length,n=0;n<i;n++){var s=this.subpaths[n];if(s.isDrawable()){for(var r=s.segments.length,a=0;a<r;a++)e+=s.segments[a].windingIntersection(t);s.hasClosingSegment()&&(e+=s.getClosingSegment().windingIntersection(t))}}return e},intersectsBounds:function(t){if(this.bounds.intersection(t).equals(this.bounds))return!0;var e,i,n=new m(new v(t.minX,t.minY),new v(1,0)),s=new m(new v(t.minX,t.minY),new v(0,1)),r=new m(new v(t.maxX,t.maxY),new v(-1,0)),a=new m(new v(t.maxX,t.maxY),new v(0,-1)),o=this.intersection(n).concat(this.intersection(r));for(i=0;i<o.length;i++)if((e=o[i].point).x>=t.minX&&e.x<=t.maxX)return!0;var h=this.intersection(s).concat(this.intersection(a));for(i=0;i<h.length;i++)if((e=h[i].point).y>=t.minY&&e.y<=t.maxY)return!0;return!1},getStrokedShape:function(t){for(var e=[],i=r.NOTHING.copy(),s=this.subpaths.length,a=0;a<s;a++){var o=this.subpaths[a].stroked(t);e=e.concat(o)}for(s=e.length,a=0;a<s;a++)i.includeBounds(e[a].bounds);return new n(e,i)},getOffsetShape:function(t){for(var e=[],i=r.NOTHING.copy(),s=this.subpaths.length,a=0;a<s;a++)e.push(this.subpaths[a].offset(t));for(s=e.length,a=0;a<s;a++)i.includeBounds(e[a].bounds);return new n(e,i)},getDashedShape:function(t,e,i){return i=_.extend({distanceEpsilon:1e-10,curveEpsilon:1e-8},i),new n(_.flatten(this.subpaths.map(function(n){return n.dashed(t,e,i.distanceEpsilon,i.curveEpsilon)})))},getBounds:function(){if(null===this._bounds){var t=r.NOTHING.copy();_.each(this.subpaths,function(e){t.includeBounds(e.getBounds())}),this._bounds=t}return this._bounds},get bounds(){return this.getBounds()},getStrokedBounds:function(t){for(var e=!0,i=0;i<this.subpaths.length;i++){var n=this.subpaths[i];if(n.isDrawable()&&!n.isClosed()){e=!1;break}for(var s=0;s<n.segments.length;s++){if(!n.segments[s].areStrokedBoundsDilated()){e=!1;break}}}if(e)return this.bounds.dilated(t.lineWidth/2);var r=this.bounds.copy();for(i=0;i<this.subpaths.length;i++){var a=this.subpaths[i].stroked(t);for(s=0;s<a.length;s++)r.includeBounds(a[s].bounds)}return r},getSimplifiedAreaShape:function(){return l.simplifyNonZero(this)},getBoundsWithTransform:function(t,e){for(var i=r.NOTHING.copy(),n=this.subpaths.length,s=0;s<n;s++){var a=this.subpaths[s];i.includeBounds(a.getBoundsWithTransform(t))}return e&&i.includeBounds(this.getStrokedShape(e).getBoundsWithTransform(t)),i},getApproximateArea:function(t){for(var e=this.bounds.minX,i=this.bounds.minY,n=this.bounds.width,s=this.bounds.height,r=n*s,a=0,o=new v(0,0),h=0;h<t;h++)o.x=e+y()*n,o.y=i+y()*s,this.containsPoint(o)&&a++;return r*a/t},getNonoverlappingArea:function(){return Math.abs(_.sum(this.subpaths.map(function(t){return _.sum(t.getFillSegments().map(function(t){return t.getSignedAreaFragment()}))})))},getArea:function(){return this.getSimplifiedAreaShape().getNonoverlappingArea()},getApproximateCentroid:function(t){for(var e=this.bounds.minX,i=this.bounds.minY,n=this.bounds.width,s=this.bounds.height,r=0,a=new v(0,0),o=new v(0,0),h=0;h<t;h++)o.x=e+y()*n,o.y=i+y()*s,this.containsPoint(o)&&(a.add(o),r++);return a.dividedScalar(r)},invalidatePoints:function(){this._invalidatingPoints=!0;for(var t=this.subpaths.length,e=0;e<t;e++)this.subpaths[e].invalidatePoints();this._invalidatingPoints=!1,this.invalidate()},toString:function(){return"new kite.Shape( '"+this.getSVGPath()+"' )"},invalidate:function(){this._invalidatingPoints||(this._bounds=null,this.notifyInvalidationListeners())},notifyInvalidationListeners:function(){this.trigger0("invalidated")},addSegmentAndBounds:function(t){this.getLastSubpath().addSegment(t),this.invalidate()},ensure:function(t){this.hasSubpaths()||(this.addSubpath(new p),this.getLastSubpath().addPoint(t))},addSubpath:function(t){return this.subpaths.push(t),t.onStatic("invalidated",this._invalidateListener),this.invalidate(),this},hasSubpaths:function(){return this.subpaths.length>0},getLastSubpath:function(){return _.last(this.subpaths)},getLastPoint:function(){return this.hasSubpaths()?this.getLastSubpath().getLastPoint():null},getLastSegment:function(){if(!this.hasSubpaths())return null;var t=this.getLastSubpath();return t.isDrawable()?t.getLastSegment():null},getSmoothQuadraticControlPoint:function(){var t=this.getLastPoint();return this.lastQuadraticControlPoint?t.plus(t.minus(this.lastQuadraticControlPoint)):t},getSmoothCubicControlPoint:function(){var t=this.getLastPoint();return this.lastCubicControlPoint?t.plus(t.minus(this.lastCubicControlPoint)):t},getRelativePoint:function(){var t=this.getLastPoint();return t||v.ZERO},shapeUnion:function(t){return l.binaryResult(this,t,l.BINARY_NONZERO_UNION)},shapeIntersection:function(t){return l.binaryResult(this,t,l.BINARY_NONZERO_INTERSECTION)},shapeDifference:function(t){return l.binaryResult(this,t,l.BINARY_NONZERO_DIFFERENCE)},shapeXor:function(t){return l.binaryResult(this,t,l.BINARY_NONZERO_XOR)},shapeClip:function(t,e){return l.clipShape(t,this,e)},getArcLength:function(t,e,i){for(var n=0,s=0;s<this.subpaths.length;s++)n+=this.subpaths[s].getArcLength(t,e,i);return n},serialize:function(){return{type:"Shape",subpaths:this.subpaths.map(function(t){return t.serialize()})}}}),n.deserialize=function(t){return new n(t.subpaths.map(p.deserialize))},n.rectangle=function(t,e,i,s){return(new n).rect(t,e,i,s)},n.rect=n.rectangle,n.roundRect=function(t,e,i,s,r,a){return(new n).roundRect(t,e,i,s,r,a)},n.roundRectangle=n.roundRect,n.roundedRectangleWithRadii=function(t,e,i,n,s){var r=s&&s.topLeft||0,a=s&&s.topRight||0,o=s&&s.bottomLeft||0,h=s&&s.bottomRight||0,l=new c.Shape,u=t+i,d=e+n;return h>0?l.arc(u-h,d-h,h,0,Math.PI/2,!1):l.moveTo(u,d),o>0?l.arc(t+o,d-o,o,Math.PI/2,Math.PI,!1):l.lineTo(t,d),r>0?l.arc(t+r,e+r,r,Math.PI,3*Math.PI/2,!1):l.lineTo(t,e),a>0?l.arc(u-a,e+a,a,3*Math.PI/2,2*Math.PI,!1):l.lineTo(u,e),l.close(),l},n.boundsOffsetWithRadii=function(t,e,i){var s=t.withOffsets(e.left,e.top,e.right,e.bottom);return n.roundedRectangleWithRadii(s.minX,s.minY,s.width,s.height,i)},n.polygon=function(t){return(new n).polygon(t)},n.bounds=function(t){return(new n).rect(t.minX,t.minY,t.maxX-t.minX,t.maxY-t.minY)},n.lineSegment=function(t,e,i,s){return"number"==typeof t?(new n).moveTo(t,e).lineTo(i,s):(new n).moveToPoint(t).lineToPoint(e)},n.regularPolygon=function(t,e){var i=new n;return _.each(_.range(t),function(n){var s=v.createPolar(e,2*Math.PI*n/t);0===n?i.moveToPoint(s):i.lineToPoint(s)}),i.close()},n.circle=function(t,e,i){return void 0===e?(new n).circle(0,0,t):(new n).circle(t,e,i)},n.ellipse=function(t,e,i,s,r){return void 0===s?(new n).ellipse(0,0,t,e,i):(new n).ellipse(t,e,i,s,r)},n.arc=function(t,e,i,s,r,a){return(new n).arc(t,e,i,s,r,a)},n.union=function(t){return l.unionNonZero(t)},n.intersection=function(t){return l.intersectionNonZero(t)},n.xor=function(t){return l.xorNonZero(t)},n.segments=function(t,e){return new n([new p(t,void 0,!!e)])},n}),i("KITE/main",["KITE/kite","KITE/Shape","KITE/ops/Boundary","KITE/ops/BoundsIntersection","KITE/ops/Edge","KITE/ops/Face","KITE/ops/Graph","KITE/ops/HalfEdge","KITE/ops/Loop","KITE/ops/Vertex","KITE/segments/Arc","KITE/segments/Cubic","KITE/segments/EllipticalArc","KITE/segments/Line","KITE/segments/Quadratic","KITE/segments/Segment","KITE/util/LineStyles","KITE/util/Overlap","KITE/util/SegmentIntersection","KITE/util/Subpath","KITE/parser/svgPath"],function(t){"use strict";return t}),i("PHET_CORE/arrayDifference",["require","PHET_CORE/phetCore"],function(t){"use strict";function e(t,e,i,n,s){i=i||[],n=n||[],s=s||[],Array.prototype.push.apply(i,t),Array.prototype.push.apply(n,e);t:for(var r=0;r<i.length;r++)for(var a=i[r],o=0;o<n.length;o++){if(a===n[o]){if(s.push(a),i.splice(r,1),n.splice(o,1),o=0,r===i.length)break t;r-=1}}return i}return t("PHET_CORE/phetCore").register("arrayDifference",e),e}),i("PHET_CORE/collect",["require","PHET_CORE/phetCore"],function(t){"use strict";function e(t){var e=[];return t(function(t){e.push(t)}),e}return t("PHET_CORE/phetCore").register("collect",e),e}),i("PHET_CORE/detectPrefix",["require","PHET_CORE/phetCore"],function(t){"use strict";function e(t,e){return void 0!==t[e]?e:(e=e.charAt(0).toUpperCase()+e.slice(1),void 0!==t["moz"+e]?"moz"+e:void 0!==t["Moz"+e]?"Moz"+e:void 0!==t["webkit"+e]?"webkit"+e:void 0!==t["ms"+e]?"ms"+e:void 0!==t["o"+e]?"o"+e:void 0)}return t("PHET_CORE/phetCore").register("detectPrefix",e),e}),i("PHET_CORE/detectPrefixEvent",["require","PHET_CORE/phetCore"],function(t){"use strict";function e(t,e,i){return void 0!==t["on"+e]?e:void 0!==t["onmoz"+e]?"moz"+e:void 0!==t["onMoz"+e]?"Moz"+e:void 0!==t["onwebkit"+e]?"webkit"+e:void 0!==t["onms"+e]?"ms"+e:void 0!==t["ono"+e]?"o"+e:void 0}return t("PHET_CORE/phetCore").register("detectPrefixEvent",e),e}),i("PHET_CORE/dimensionForEach",["require","PHET_CORE/phetCore"],function(t){"use strict";function e(t,e,i){function n(t,e){return e.forEach(function(e,r){s.push(r),1===t?i.apply(null,[e].concat(s)):n(t-1,e),s.pop()})}var s=[];return n(t,e)}return t("PHET_CORE/phetCore").register("dimensionForEach",e),e}),i("PHET_CORE/dimensionMap",["require","PHET_CORE/phetCore"],function(t){"use strict";function e(t,e,i){function n(t,e){return e.map(function(e,r){s.push(r);var a=1===t?i.apply(null,[e].concat(s)):n(t-1,e);return s.pop(),a})}var s=[];return n(t,e)}return t("PHET_CORE/phetCore").register("dimensionMap",e),e}),i("PHET_CORE/escapeHTML",["require","PHET_CORE/phetCore"],function(t){"use strict";function e(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/\'/g,"&#x27;").replace(/\//g,"&#x2F;")}return t("PHET_CORE/phetCore").register("escapeHTML",e),e}),i("PHET_CORE/EventTimer",["require","PHET_CORE/inherit","PHET_CORE/phetCore"],function(t){"use strict";function e(t,e){this.eventModel=t,this.eventCallback=e,this.period=this.eventModel.getPeriodBeforeNextEvent(),this.timeBeforeNextEvent=this.period}var i=t("PHET_CORE/inherit");return t("PHET_CORE/phetCore").register("EventTimer",e),i(Object,e,{step:function(t){for(;t>=this.timeBeforeNextEvent;)t-=this.timeBeforeNextEvent,this.period=this.eventModel.getPeriodBeforeNextEvent(),this.timeBeforeNextEvent=this.period,this.eventCallback(t);this.timeBeforeNextEvent-=t},getRatio:function(){return(this.period-this.timeBeforeNextEvent)/this.period}}),e.ConstantEventModel=i(Object,function(t){this.rate=t},{getPeriodBeforeNextEvent:function(){return 1/this.rate}}),e.UniformEventModel=i(Object,function(t,e){this.rate=t,this.pseudoRandomNumberSource=e},{getPeriodBeforeNextEvent:function(){var t=this.pseudoRandomNumberSource();return 2*t/this.rate}}),e.PoissonEventModel=i(Object,function(t,e){this.rate=t,this.pseudoRandomNumberSource=e},{getPeriodBeforeNextEvent:function(){var t=this.pseudoRandomNumberSource();return-Math.log(t)/this.rate}}),e}),i("PHET_CORE/extendDefined",["require","PHET_CORE/phetCore"],function(t){"use strict";function e(t){return _.each(Array.prototype.slice.call(arguments,1),function(e){if(e)for(var i in e){var n=Object.getOwnPropertyDescriptor(e,i);!n||"function"!=typeof n.get&&void 0===e[i]||Object.defineProperty(t,i,n)}}),t}return t("PHET_CORE/phetCore").register("extendDefined",e),e}),i("PHET_CORE/inheritance",["require","PHET_CORE/phetCore"],function(t){"use strict";function e(t){for(var e=[t],i=t.prototype;i&&(i=Object.getPrototypeOf(i));)i.constructor&&e.push(i.constructor);return e}return t("PHET_CORE/phetCore").register("inheritance",e),e}),i("PHET_CORE/interleave",["require","PHET_CORE/phetCore"],function(t){"use strict";function e(t,e){for(var i=[],n=2*t.length-1,s=0;s<n;s++)s%2==0?i.push(t[s/2]):i.push(e((s-1)/2));return i}return t("PHET_CORE/phetCore").register("interleave",e),e}),i("PHET_CORE/loadScript",["require","PHET_CORE/phetCore"],function(t){"use strict";function e(t){"string"==typeof t&&(t={src:t});var e=t.src,i=t.callback,n=void 0===t.async||t.async,s=void 0!==t.cacheBuster&&t.cacheBuster,r=!1,a=document.createElement("script");a.type="text/javascript",a.async=n,a.onload=a.onreadystatechange=function(){var t=this.readyState;t&&"complete"!==t&&"loaded"!==t||r||(r=!0,i&&i())},a.src=e+(s?"?random="+Math.random().toFixed(10):"");var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(a,o)}return t("PHET_CORE/phetCore").register("loadScript",e),e}),i("PHET_CORE/mixedWith",["require","PHET_CORE/inherit","PHET_CORE/phetCore"],function(t){"use strict";function e(t,e){e=Array.prototype.slice.call(arguments,1);var n=t.name;e.forEach(function(t){n=n+"_"+t.name.replace(/bound /g,"_")});var s=[],r=new Function("return function( suptype, inits ) {  return function "+n+"() {    var self = this;    var args = Array.prototype.slice.call( arguments );    suptype.apply( this, args );    inits.forEach( function( init ) { init.apply( self, args ); } );  };};")()(t,s);return i(t,r),e.forEach(function(t){var e=t(r);"function"==typeof e&&s.push(e)}),r}var i=t("PHET_CORE/inherit");return t("PHET_CORE/phetCore").register("mixedWith",e),e}),i("PHET_CORE/pairs",["require","PHET_CORE/phetCore"],function(t){"use strict";function e(t){var e=[],i=t.length;if(i>1)for(var n=0;n<i-1;n++)for(var s=t[n],r=n+1;r<i;r++)e.push([s,t[r]]);return e}return t("PHET_CORE/phetCore").register("pairs",e),e}),i("PHET_CORE/partition",["require","PHET_CORE/phetCore"],function(t){"use strict";function e(t,e){for(var i=[],n=[],s=t.length,r=0;r<s;r++)e(t[r])?i.push(t[r]):n.push(t[r]);return[i,n]}return t("PHET_CORE/phetCore").register("partition",e),e}),i("PHET_CORE/platform",["require","PHET_CORE/phetCore"],function(t){"use strict";function e(t){return n()===t}function i(){return!(!r.match(/(iPod|iPhone|iPad)/)||!r.match(/AppleWebKit/))}function n(){var t=-1;return"Microsoft Internet Explorer"===navigator.appName?null!==new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(r)&&(t=parseFloat(RegExp.$1)):"Netscape"===navigator.appName&&null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(r)&&(t=parseFloat(RegExp.$1)),t}var s=t("PHET_CORE/phetCore"),r=navigator.userAgent,a={firefox:r.toLowerCase().indexOf("firefox")>-1,mobileSafari:i(),safari5:!!(r.match(/Version\/5\./)&&r.match(/Safari\//)&&r.match(/AppleWebKit/)),safari6:!!(r.match(/Version\/6\./)&&r.match(/Safari\//)&&r.match(/AppleWebKit/)),safari7:!!(r.match(/Version\/7\./)&&r.match(/Safari\//)&&r.match(/AppleWebKit/)),safari10:!!(r.match(/Version\/10\./)&&r.match(/Safari\//)&&r.match(/AppleWebKit/)),safari11:!!(r.match(/Version\/11\./)&&r.match(/Safari\//)&&r.match(/AppleWebKit/)),safari9:!!(r.match(/Version\/9\./)&&r.match(/Safari\//)&&r.match(/AppleWebKit/)),safari:i()||!!(r.match(/Version\//)&&r.match(/Safari\//)&&r.match(/AppleWebKit/)),ie:-1!==n(),ie9:e(9),ie10:e(10),ie11:e(11),android:r.indexOf("Android")>0,edge:!!r.match(/Edge\//),chromium:/chrom(e|ium)/.test(r.toLowerCase())&&!r.match(/Edge\//)};return s.register("platform",a),a}),i("PHET_CORE/main",["PHET_CORE/phetCore","PHET_CORE/arrayDifference","PHET_CORE/arrayRemove","PHET_CORE/cleanArray","PHET_CORE/collect","PHET_CORE/detectPrefix","PHET_CORE/detectPrefixEvent","PHET_CORE/dimensionForEach","PHET_CORE/dimensionMap","PHET_CORE/Enumeration","PHET_CORE/escapeHTML","PHET_CORE/EventTimer","PHET_CORE/extend","PHET_CORE/extendDefined","PHET_CORE/inherit","PHET_CORE/inheritance","PHET_CORE/interleave","PHET_CORE/isArray","PHET_CORE/loadScript","PHET_CORE/mixedWith","PHET_CORE/Namespace","PHET_CORE/pairs","PHET_CORE/partition","PHET_CORE/platform","PHET_CORE/Poolable"],function(t){"use strict";return t}),i("SCENERY/scenery",["require","AXON/axon","DOT/dot","PHET_CORE/extend","PHET_CORE/inheritance","KITE/kite","PHET_CORE/Namespace"],function(t){"use strict";function e(t){d.logString+=t.replace(/%c/g,"")+"\n"}function i(){window.console&&window.console.log&&window.console.log.apply(window.console,Array.prototype.slice.call(arguments,0))}var n=t("AXON/axon"),s=t("DOT/dot"),r=t("PHET_CORE/extend"),a=t("PHET_CORE/inheritance"),o=t("KITE/kite"),h=t("PHET_CORE/Namespace");window.sceneryLog=null,window.sceneryAccessibilityLog=null;var l=document.createElement("canvas"),u=l.getContext("2d"),c="",d=new h("scenery");d.register("scratchCanvas",l),d.register("scratchContext",u),d.register("svgns","http://www.w3.org/2000/svg"),d.register("xlinkns","http://www.w3.org/1999/xlink");var f={dirty:{name:"dirty",style:"color: #888;"},bounds:{name:"bounds",style:"color: #888;"},hitTest:{name:"hitTest",style:"color: #888;"},hitTestInternal:{name:"hitTestInternal",style:"color: #888;"},PerfCritical:{name:"Perf",style:"color: #f00;"},PerfMajor:{name:"Perf",style:"color: #aa0;"},PerfMinor:{name:"Perf",style:"color: #088;"},PerfVerbose:{name:"Perf",style:"color: #888;"},Cursor:{name:"Cursor",style:""},Stitch:{name:"Stitch",style:""},StitchDrawables:{name:"Stitch",style:""},GreedyStitcher:{name:"Greedy",style:"color: #088;"},GreedyVerbose:{name:"Greedy",style:"color: #888;"},RelativeTransform:{name:"RelativeTransform",style:"color: #606;"},BackboneDrawable:{name:"Backbone",style:"color: #a00;"},CanvasBlock:{name:"Canvas",style:""},WebGLBlock:{name:"WebGL",style:""},Display:{name:"Display",style:""},DOMBlock:{name:"DOM",style:""},Drawable:{name:"",style:""},FittedBlock:{name:"FittedBlock",style:""},Instance:{name:"Instance",style:""},InstanceTree:{name:"InstanceTree",style:""},ChangeInterval:{name:"ChangeInterval",style:"color: #0a0;"},SVGBlock:{name:"SVG",style:""},SVGGroup:{name:"SVGGroup",style:""},ImageSVGDrawable:{name:"ImageSVGDrawable",style:""},Paints:{name:"Paints",style:""},AlignBox:{name:"AlignBox",style:""},AlignGroup:{name:"AlignGroup",style:""},RichText:{name:"RichText",style:""},Accessibility:{name:"Accessibility",style:""},AccessibleInstance:{name:"AccessibleInstance",style:""},AccessibilityTree:{name:"AccessibilityTree",style:""},AccessibleDisplaysInfo:{name:"AccessibleDisplaysInfo",style:""},KeyboardFuzzer:{name:"KeyboardFuzzer",style:""},InputListener:{name:"InputListener",style:""},InputEvent:{name:"InputEvent",style:""},OnInput:{name:"OnInput",style:""},Pointer:{name:"Pointer",style:""},Input:{name:"Input",style:""},EventDispatch:{name:"EventDispatch",style:""}};return r(d,{logString:"",logFunction:function(){window.console&&window.console.log&&window.console.log.apply(window.console,Array.prototype.slice.call(arguments,0))},switchLogToConsole:function(){d.logFunction=i},switchLogToString:function(){window.console&&window.console.log("switching to string log"),d.logFunction=e},enableIndividualLog:function(t){return"stitch"===t?(this.enableIndividualLog("Stitch"),this.enableIndividualLog("StitchDrawables"),this.enableIndividualLog("GreedyStitcher"),void this.enableIndividualLog("GreedyVerbose")):"perf"===t?(this.enableIndividualLog("PerfCritical"),this.enableIndividualLog("PerfMajor"),this.enableIndividualLog("PerfMinor"),void this.enableIndividualLog("PerfVerbose")):"input"===t?(this.enableIndividualLog("InputListener"),this.enableIndividualLog("InputEvent"),this.enableIndividualLog("OnInput"),this.enableIndividualLog("Pointer"),this.enableIndividualLog("Input"),void this.enableIndividualLog("EventDispatch")):"a11y"===t?(this.enableIndividualLog("Accessibility"),this.enableIndividualLog("AccessibleInstance"),this.enableIndividualLog("AccessibilityTree"),void this.enableIndividualLog("AccessibleDisplaysInfo")):void(t&&(window.sceneryLog[t]=window.sceneryLog[t]||function(e,i){var n=f[t],s=n.name?"["+n.name+"] ":"";d.logFunction("%c"+c+"%c"+s+e,"color: #ddd;",i||n.style)}))},disableIndividualLog:function(t){t&&delete window.sceneryLog[t]},enableLogging:function(t){window.sceneryLog=function(t){d.logFunction(t)},window.sceneryLog.push=function(){c+="| "},window.sceneryLog.pop=function(){c=c.slice(0,-2)},window.sceneryLog.getDepth=function(){return c.length/2};for(var e=0;e<t.length;e++)this.enableIndividualLog(t[e])},disableLogging:function(){window.sceneryLog=null},isLoggingPerformance:function(){return window.sceneryLog.PerfCritical||window.sceneryLog.PerfMajor||window.sceneryLog.PerfMinor||window.sceneryLog.PerfVerbose},copy:function(t){return d.deserialize(d.serialize(t))},serialize:function(t){if(t instanceof s.Vector2)return{type:"Vector2",x:t.x,y:t.y};if(t instanceof s.Matrix3)return{type:"Matrix3",m00:t.m00(),m01:t.m01(),m02:t.m02(),m10:t.m10(),m11:t.m11(),m12:t.m12(),m20:t.m20(),m21:t.m21(),m22:t.m22()};if(t instanceof s.Bounds2)return{type:"Bounds2",maxX:t.maxX,maxY:t.maxY,minX:t.minX,minY:t.minY};if(t instanceof o.Shape)return{type:"Shape",path:t.getSVGPath()};if(Array.isArray(t))return{type:"Array",value:t.map(d.serialize)};if(t instanceof d.Color)return{type:"Color",red:t.red,green:t.green,blue:t.blue,alpha:t.alpha};if(t instanceof n.Property)return{type:"Property",value:d.serialize(t.value)};if(d.Paint&&t instanceof d.Paint){var e={};return t.transformMatrix&&(e.transformMatrix=d.serialize(t.transformMatrix)),d.Gradient&&t instanceof d.Gradient&&(e.stops=t.stops.map(function(t){return{ratio:t.ratio,stop:d.serialize(t.color)}}),e.start=d.serialize(t.start),e.end=d.serialize(t.end),d.LinearGradient&&t instanceof d.LinearGradient?e.type="LinearGradient":d.RadialGradient&&t instanceof d.RadialGradient&&(e.type="RadialGradient",e.startRadius=t.startRadius,e.endRadius=t.endRadius)),d.Pattern&&t instanceof d.Pattern&&(e.type="Pattern",e.url=t.image.src),e}if(t instanceof d.Node){var i=t,r={},h={};["visible","opacity","pickable","inputEnabled","cursor","transformBounds","renderer","usesOpacity","layerSplit","cssTransform","excludeInvisible","webglScale","preventFit"].forEach(function(t){i[t]!==d.Node.DEFAULT_OPTIONS[t]&&(r[t]=i[t])}),["maxWidth","maxHeight","clipArea","mouseArea","touchArea"].forEach(function(t){i[t]!==d.Node.DEFAULT_OPTIONS[t]&&(h[t]=d.serialize(i[t]))}),i.matrix.isIdentity()||(h.matrix=d.serialize(i.matrix)),i._localBoundsOverridden&&(h.localBounds=d.serialize(i.localBounds)),h.children=i.children.map(function(t){return t.id}),h.hasInputListeners=i.inputListeners.length>0;var l={id:i.id,type:"Node",types:a(i.constructor).map(function(t){return t.name}).filter(function(t){return t&&"Object"!==t&&"Node"!==t}),name:i.constructor.name,options:r,setup:h};if(d.Path&&i instanceof d.Path&&(l.type="Path",h.path=d.serialize(i.shape),i.boundsMethod!==d.Path.DEFAULT_OPTIONS.boundsMethod&&(r.boundsMethod=i.boundsMethod)),d.Circle&&i instanceof d.Circle&&(l.type="Circle",r.radius=i.radius),d.Line&&i instanceof d.Line&&(l.type="Line",r.x1=i.x1,r.y1=i.y1,r.x2=i.x2,r.y2=i.y2),d.Rectangle&&i instanceof d.Rectangle&&(l.type="Rectangle",r.rectX=i.rectX,r.rectY=i.rectY,r.rectWidth=i.rectWidth,r.rectHeight=i.rectHeight,r.cornerXRadius=i.cornerXRadius,r.cornerYRadius=i.cornerYRadius),d.Text&&i instanceof d.Text&&(l.type="Text","hybrid"!==i.boundsMethod&&(r.boundsMethod=i.boundsMethod),r.text=i.text,r.font=i.font),d.HTMLText&&i instanceof d.HTMLText&&(l.type="HTMLText"),d.Image&&i instanceof d.Image&&(l.type="Image",["imageOpacity","initialWidth","initialHeight","mipmapBias","mipmapInitialLevel","mipmapMaxLevel"].forEach(function(t){i[t]!==d.Image.DEFAULT_OPTIONS[t]&&(r[t]=i[t])}),h.width=i.imageWidth,h.height=i.imageHeight,i._mipmapData?(h.imageType="mipmapData",h.mipmapData=i._mipmapData.map(function(t){return{url:t.url,width:t.width,height:t.height}})):(i._mipmap&&(h.generateMipmaps=!0),i._image instanceof HTMLImageElement?(h.imageType="image",h.src=i._image.src):i._image instanceof HTMLCanvasElement&&(h.imageType="canvas",h.src=i._image.toDataURL()))),d.CanvasNode&&i instanceof d.CanvasNode||d.WebGLNode&&i instanceof d.WebGLNode){l.type=d.CanvasNode&&i instanceof d.CanvasNode?"CanvasNode":"WebGLNode",h.canvasBounds=d.serialize(i.canvasBounds);Math.min(5,i._drawables.length?1/_.mean(i._drawables.map(function(t){var e=t.instance.trail.getMatrix().getScaleVector();return(e.x+e.y)/2})):1);1;var u=document.createElement("canvas");u.width=Math.ceil(1*i.canvasBounds.width),u.height=Math.ceil(1*i.canvasBounds.height);var c=u.getContext("2d"),f=new d.CanvasContextWrapper(u,c),m=s.Matrix3.scale(1);f.context.setTransform(1,0,0,1,-i.canvasBounds.left,-i.canvasBounds.top),i.renderToCanvasSelf(f,m),h.url=u.toDataURL(),h.scale=1,h.offset=d.serialize(i.canvasBounds.leftTop)}return d.DOM&&i instanceof d.DOM&&(l.type="DOM",h.element=(new window.XMLSerializer).serializeToString(i.element)),(d.Path&&i instanceof d.Path||d.Text&&i instanceof d.Text)&&(["fillPickable","strokePickable","lineWidth","lineCap","lineJoin","lineDashOffset","miterLimit"].forEach(function(t){i[t]!==d.Paintable.DEFAULT_OPTIONS[t]&&(r[t]=i[t])}),i.fill!==d.Paintable.DEFAULT_OPTIONS.fill&&(h.fill=d.serialize(i.fill)),i.stroke!==d.Paintable.DEFAULT_OPTIONS.stroke&&(h.stroke=d.serialize(i.stroke)),i.lineDash.length&&(h.lineDash=d.serialize(i.lineDash))),l}return t instanceof d.Display?{type:"Display",width:t.width,height:t.height,backgroundColor:d.serialize(t.backgroundColor),tree:{type:"Subtree",rootNodeId:t.rootNode.id,nodes:d.serializeConnectedNodes(t.rootNode)}}:{type:"value",value:t}},deserialize:function(t){if("Vector2"===t.type)return new s.Vector2(t.x,t.y);if("Matrix3"===t.type)return(new s.Matrix3).rowMajor(t.m00,t.m01,t.m02,t.m10,t.m11,t.m12,t.m20,t.m21,t.m22);if("Bounds2"===t.type)return new s.Bounds2(t.minX,t.minY,t.maxX,t.maxY);if("Shape"===t.type)return new o.Shape(t.path);if("Array"===t.type)return t.value.map(d.deserialize);if("Color"===t.type)return new d.Color(t.red,t.green,t.blue,t.alpha);if("Property"===t.type)return new n.Property(d.deserialize(t.value));if("Pattern"===t.type||"LinearGradient"===t.type||"RadialGradient"===t.type){var e;if("Pattern"===t.type){var i=new window.Image;i.src=t.url,e=new d.Pattern(i)}else{var r=d.deserialize(t.start),a=d.deserialize(t.end);"LinearGradient"===t.type?e=new d.LinearGradient(r.x,r.y,a.x,a.y):"RadialGradient"===t.type&&(e=new d.RadialGradient(r.x,r.y,t.startRadius,a.x,a.y,t.endRadius)),t.stops.forEach(function(t){e.addColorStop(t.ratio,d.deserialize(t.stop))})}return t.transformMatrix&&e.setTransformMatrix(d.deserialize(t.transformMatrix)),e}if(_.includes(["Node","Path","Circle","Line","Rectangle","Text","HTMLText","Image","CanvasNode","WebGLNode","DOM"],t.type)){var h,l=t.setup;if("Node"===t.type)h=new d.Node;else if("Path"===t.type)h=new d.Path(d.deserialize(l.path));else if("Circle"===t.type)h=new d.Circle({});else if("Line"===t.type)h=new d.Line({});else if("Rectangle"===t.type)h=new d.Rectangle({});else if("Text"===t.type)h=new d.Text("");else if("HTMLText"===t.type)h=new d.HTMLText("");else if("Image"===t.type){if("image"===l.imageType||"canvas"===l.imageType)h=new d.Image(l.src),l.generateMipmaps&&(h.mipmaps=!0);else if("mipmapData"===l.imageType){var u=l.mipmapData.map(function(t){var e={width:t.width,height:t.height,url:t.url};e.img=new window.Image,e.img.src=t.url,e.canvas=document.createElement("canvas"),e.canvas.width=t.width,e.canvas.height=t.height;var i=e.canvas.getContext("2d");return e.updateCanvas=function(){e.img.complete&&(void 0===e.img.naturalWidth||e.img.naturalWidth>0)&&(i.drawImage(e.img,0,0),delete e.updateCanvas)},e});h=new d.Image(u)}h.initialWidth=l.width,h.initialHeight=l.height}else if("CanvasNode"===t.type||"WebGLNode"===t.type)h=new d.Node({children:[new d.Image(l.url,{translation:d.deserialize(l.offset),scale:1/l.scale})]});else if("DOM"===t.type){var c=document.createElement("div");c.innerHTML=t.element;var f=c.childNodes[0];c.removeChild(f),h=new d.DOM(f)}return l.clipArea&&(h.clipArea=d.deserialize(l.clipArea)),l.mouseArea&&(h.mouseArea=d.deserialize(l.mouseArea)),l.touchArea&&(h.touchArea=d.deserialize(l.touchArea)),l.matrix&&(h.matrix=d.deserialize(l.matrix)),l.localBounds&&(h.localBounds=d.deserialize(l.localBounds)),l.fill&&(h.fill=d.deserialize(l.fill)),l.stroke&&(h.stroke=d.deserialize(l.stroke)),l.lineDash&&(h.lineDash=d.deserialize(l.lineDash)),h.mutate(t.options),h._serialization=t,h}if("Subtree"===t.type){var m={},p=t.nodes.map(d.deserialize);return p.forEach(function(t){m[t._serialization.id]=t}),p.forEach(function(t){t._serialization.setup.children.forEach(function(e){t.addChild(m[e])})}),m[t.rootNodeId]}return"value"===t.type?t.value:void 0},serializeConnectedNodes:function(t){return t.getSubtreeNodes().map(d.serialize)}}),d}),i("SCENERY/util/SceneryStyle",["require","SCENERY/scenery"],function(t){"use strict";var e=t("SCENERY/scenery"),i=document.createElement("style");i.type="text/css",document.head.appendChild(i);var n=document.styleSheets[document.styleSheets.length-1];return e.register("SceneryStyle",{stylesheet:n,styleElement:i,addRule:function(t){this.stylesheet.insertRule(t,0)}})}),i("SCENERY/accessibility/AccessibleSiblingStyle",["require","SCENERY/util/SceneryStyle","SCENERY/scenery"],function(t){"use strict";var e=t("SCENERY/util/SceneryStyle"),i=t("SCENERY/scenery");e.addRule(".a11y-sibling{position: fixed;pointer-events: none;top: 0px;left: 0px;transform-origin: left top 0px;border-width: 0px;border: 0px;padding: 1px 1px;margin: 0px;white-space: nowrap;outline: none;box-shadow:none;border-color:transparent;font-size: 1px;color: transparent;background-color: transparent;}"),e.addRule(".a11y-root{position: relative;opacity: 0.0001;}");var n={SIBLING_CLASS_NAME:"a11y-sibling",ROOT_CLASS_NAME:"a11y-root"};return i.register("AccessibleSiblingStyle",n)}),i("SCENERY/accessibility/AccessibilityUtil",["require","SCENERY/accessibility/AccessibleSiblingStyle","DOT/Random","SCENERY/scenery"],function(t){"use strict";function e(t){for(var e=t.getElementsByTagName("*"),i=[],n=0;n<e.length;n++)e[n].nodeType===Node.ELEMENT_NODE&&(i[n]=e[n]);return i}function i(t){return!!t.hidden||t!==document.body&&i(t.parentElement)}function n(t,i){for(var n=e(i||document.body),s=document.activeElement,r=n.indexOf(s),a=t===l?1:-1,o=r+a;o<n.length&&o>=0;){var h=n[o];if(o+=a,f.isElementFocusable(h))return h}return s}function s(t){return t.replace(/^\s+/,"")}function r(t){return!_.includes(d,t.toUpperCase())}var a=t("SCENERY/accessibility/AccessibleSiblingStyle"),o=t("DOT/Random"),h=t("SCENERY/scenery"),l="NEXT",u=["A","AREA","INPUT","SELECT","TEXTAREA","BUTTON","IFRAME"],c=["B","STRONG","I","EM","MARK","SMALL","DEL","INS","SUB","SUP","BR"],d=["INPUT"],f={getNextFocusable:function(t){return n(l,t)},getPreviousFocusable:function(t){return n("PREVIOUS",t)},getRandomFocusable:function(t){t=t||new o;for(var i=e(document.body),n=[],s=0;s<i.length;s++)f.isElementFocusable(i[s])&&n.push(i[s]);return n[t.nextInt(n.length)]},usesExclusivelyFormattingTags:function(t){if(null===t)return!1;for(var e=0,i=[],n=[];e<t.length;){var r=t.indexOf("<",e),a=t.indexOf(">",e);r>-1&&(i.push(r),e=r+1),a>-1?(n.push(a),e=a+1):e++}for(var o=!0,h=t.toUpperCase(),l=0;l<i.length;l++){var u=h.substring(i[l]+1,n[l]),d=s(u=u.replace("/",""));u.length-d.length>0||(_.includes(c,u)||(o=!1))}return o},setTextContent:function(t,e){r(t.tagName)&&(f.usesExclusivelyFormattingTags(e)?t.innerHTML=e:t.textContent=e)},tagIsDefaultFocusable:function(t){return _.includes(u,t.toUpperCase())},isElementFocusable:function(t){return!!document.body.contains(t)&&(!i(t)&&(!_.includes(c,t.tagName)&&"true"===t.getAttribute("data-focusable")))},tagNameSupportsContent:function(t){return r(t)},removeElements:function(t,e){for(var i=0;i<e.length;i++){var n=e[i];t.removeChild(n)}},insertElements:function(t,e,i){for(var n=0;n<e.length;n++){var s=e[n];t.insertBefore(s,i||null)}},validateAssociationObject:function(t){for(var e=Object.keys(t),i=0;i<e.length;i++)e[i]},createElement:function(t,e,i){var n=(i=_.extend({namespace:null},i)).namespace?document.createElementNS(i.namespace,t):document.createElement(t);return f.overrideFocusWithTabIndex(n,e),n.className=a.SIBLING_CLASS_NAME,n},overrideFocusWithTabIndex:function(t,e){f.tagIsDefaultFocusable(t.tagName)!==e?t.tabIndex=e?0:-1:t.removeAttribute("tabindex"),t.setAttribute("data-focusable",e)},TAGS:{INPUT:"INPUT",LABEL:"LABEL",BUTTON:"BUTTON",TEXTAREA:"TEXTAREA",SELECT:"SELECT",OPTGROUP:"OPTGROUP",DATALIST:"DATALIST",OUTPUT:"OUTPUT",DIV:"DIV",A:"A",P:"P",B:"B",STRONG:"STRONG",I:"I",EM:"EM",MARK:"MARK",SMALL:"SMALL",DEL:"DEL",INS:"INS",SUB:"SUB",SUP:"SUP"},FORM_ELEMENTS:["INPUT","BUTTON","TEXTAREA","SELECT","OPTGROUP","DATALIST","OUTPUT","A"],DEFAULT_CONTAINER_TAG_NAME:"DIV",DEFAULT_DESCRIPTION_TAG_NAME:"P",DEFAULT_LABEL_TAG_NAME:"P",ASSOCIATION_ATTRIBUTES:["aria-labelledby","aria-describedby","aria-activedescendant"],INPUT_TYPES_THAT_SUPPORT_CHECKED:["RADIO","CHECKBOX"],DOM_EVENTS:["focusin","focusout","input","change","click","keydown","keyup"],DATA_TRAIL_ID:"data-trail-id"};return h.register("AccessibilityUtil",f),f}),i("SCENERY/util/FullScreen",["require","PHET_CORE/detectPrefix","PHET_CORE/detectPrefixEvent","PHET_CORE/platform","AXON/Property","SCENERY/scenery"],function(t){"use strict";var e=t("PHET_CORE/detectPrefix"),i=t("PHET_CORE/detectPrefixEvent"),n=t("PHET_CORE/platform"),s=t("AXON/Property"),r=t("SCENERY/scenery"),a=e(document,"exitFullscreen")||e(document,"cancelFullScreen"),o=e(document,"fullscreenElement")||e(document,"fullScreenElement"),h=e(document,"fullscreenEnabled")||e(document,"fullScreenEnabled"),l=i(document,"fullscreenchange");"msfullscreenchange"===l&&(l="MSFullscreenChange");var u={isFullScreen:function(){return!!document[o]},isFullScreenEnabled:function(){return document[h]&&!n.safari7},enterFullScreen:function(t){var i=e(document.body,"requestFullscreen")||e(document.body,"requestFullScreen");if(n.ie9||n.ie10){if(void 0!==window.ActiveXObject){var s=new window.ActiveXObject("WScript.Shell");null!==s&&s.SendKeys("{F11}")}}else t.domElement[i]&&t.domElement[i]()},exitFullScreen:function(){document[a]&&document[a]()},toggleFullScreen:function(t){u.isFullScreen()?u.exitFullScreen():u.enterFullScreen(t)},isFullScreenProperty:new s(!1)};return document.addEventListener(l,function(t){u.isFullScreenProperty.set(u.isFullScreen())}),r.register("FullScreen",u),u}),i("SCENERY/accessibility/AccessiblePeer",["require","SCENERY/accessibility/AccessibleSiblingStyle","SCENERY/accessibility/AccessibilityUtil","PHET_CORE/arrayRemove","DOT/Bounds2","SCENERY/util/FullScreen","PHET_CORE/inherit","DOT/Matrix3","PHET_CORE/platform","PHET_CORE/Poolable","SCENERY/scenery"],function(t){"use strict";function e(t,e){this.initializeAccessiblePeer(t,e)}function i(t,e,i,n,s){return S.setToTranslation(n.minX,n.minY),T.setToScale(n.width/e,n.height/i),C.setToScale(s.x,s.y),S.multiplyMatrix(T).multiplyMatrix(C)}function n(t){var e=t.clientWidth,i=t.clientHeight;if(0===e&&0===i){var n=t.getBoundingClientRect();e=n.width,i=n.height}return{width:e,height:i}}function s(t,e){t.style.top=e.top+"px",t.style.left=e.left+"px",t.style.width=e.width+"px",t.style.height=e.height+"px"}var r=t("SCENERY/accessibility/AccessibleSiblingStyle"),a=t("SCENERY/accessibility/AccessibilityUtil"),o=t("PHET_CORE/arrayRemove"),h=t("DOT/Bounds2"),l=t("SCENERY/util/FullScreen"),u=t("PHET_CORE/inherit"),c=t("DOT/Matrix3"),d=t("PHET_CORE/platform"),f=t("PHET_CORE/Poolable"),m=t("SCENERY/scenery"),p=a.TAGS.LABEL,g=a.TAGS.INPUT,v={attributes:!1,childList:!0,characterData:!0},y=1,E=new h(0,0,0,0),b=new h(0,0,0,0),S=new c,T=new c,C=new c;return m.register("AccessiblePeer",e),u(Object,e,{initializeAccessiblePeer:function(t,e){return e=_.extend({primarySibling:null},e),this.id=this.id||y++,this.accessibleInstance=t,this.node=this.accessibleInstance.node,this.display=t.display,this.trail=t.trail,this.visible=null,this.focusable=null,this._labelSibling=null,this._descriptionSibling=null,this._containerParent=null,this.topLevelElements=[],this.positionDirty=!1,this.childPositionDirty=!1,this.mutationObserver=this.mutationObserver||new MutationObserver(this.invalidateCSSPositioning.bind(this)),this.transformListener=this.transformListener||this.invalidateCSSPositioning.bind(this),this.accessibleInstance.transformTracker.addListener(this.transformListener),this.isDisposed=!1,this.accessibleInstance.isRootInstance&&(this._primarySibling=e.primarySibling,this._primarySibling.className=r.ROOT_CLASS_NAME),this},update:function(){var t=this.accessibleInstance.trail.getUniqueId(),i=this.node.getBaseOptions();null!==this.node.accessibleName&&(i=this.node.accessibleNameBehavior(this.node,i,this.node.accessibleName)),null!==this.node.accessibleHeading&&(i=this.node.accessibleHeadingBehavior(this.node,i,this.node.accessibleHeading)),null!==this.node.helpText&&(i=this.node.helpTextBehavior(this.node,i,this.node.helpText)),this._primarySibling=a.createElement(i.tagName,this.node.focusable,{namespace:i.accessibleNamespace}),this._primarySibling.id=t,this.setAttributeToElement(a.DATA_TRAIL_ID,t),i.containerTagName&&(this._containerParent=a.createElement(i.containerTagName,!1),this._containerParent.id="container-"+t),i.labelTagName&&(this._labelSibling=a.createElement(i.labelTagName,!1),this._labelSibling.id="label-"+t,this.setAttributeToElement(a.DATA_TRAIL_ID,t,{elementName:e.LABEL_SIBLING})),i.descriptionTagName&&(this._descriptionSibling=a.createElement(i.descriptionTagName,!1),this._descriptionSibling.id="description-"+t),this.orderElements(i),this.mutationObserver.disconnect(),this.mutationObserver.observe(this._primarySibling,v),i.labelContent&&null!==i.labelTagName&&this.setLabelSiblingContent(i.labelContent),i.innerContent&&null!==i.tagName&&this.setPrimarySiblingContent(i.innerContent),i.descriptionContent&&null!==i.descriptionTagName&&this.setDescriptionSiblingContent(i.descriptionContent),i.tagName.toUpperCase()===g&&i.inputType&&this.setAttributeToElement("type",i.inputType),this.setFocusable(this.node.focusable),this.onAriaLabelledbyAssociationChange(),this.onAriaDescribedbyAssociationChange(),this.onActiveDescendantAssociationChange(),this.onAttributeChange(i),this.onInputValueChange(),this.node.updateOtherNodesAriaLabelledby(),this.node.updateOtherNodesAriaDescribedby(),this.node.updateOtherNodesActiveDescendant()},orderElements:function(t){this._containerParent?(this._containerParent.insertBefore(this._primarySibling,this._containerParent.children[0]||null),this.topLevelElements=[this._containerParent]):this.topLevelElements=[this._labelSibling,this._descriptionSibling,this._primarySibling].filter(_.identity),this._labelSibling&&this.arrangeContentElement(this._labelSibling,t.appendLabel),this._descriptionSibling&&this.arrangeContentElement(this._descriptionSibling,t.appendDescription)},getPrimarySibling:function(){return this._primarySibling},get primarySibling(){return this.getPrimarySibling()},getLabelSibling:function(){return this._labelSibling},get labelSibling(){return this.getLabelSibling()},getDescriptionSibling:function(){return this._descriptionSibling},get descriptionSibling(){return this.getDescriptionSibling()},getContainerParent:function(){return this._containerParent},get containerParent(){return this.getContainerParent()},onAriaLabelledbyAssociationChange:function(){this.removeAttributeFromAllElements("aria-labelledby");for(var t=0;t<this.node.ariaLabelledbyAssociations.length;t++){var e=this.node.ariaLabelledbyAssociations[t];this.setAssociationAttribute("aria-labelledby",e)}},onAriaDescribedbyAssociationChange:function(){this.removeAttributeFromAllElements("aria-describedby");for(var t=0;t<this.node.ariaDescribedbyAssociations.length;t++){var e=this.node.ariaDescribedbyAssociations[t];this.setAssociationAttribute("aria-describedby",e)}},onActiveDescendantAssociationChange:function(){this.removeAttributeFromAllElements("aria-activedescendant");for(var t=0;t<this.node.activeDescendantAssociations.length;t++){var e=this.node.activeDescendantAssociations[t];this.setAssociationAttribute("aria-activedescendant",e)}},onAttributeChange:function(t){for(var e=0;e<this.node.accessibleAttributes.length;e++){var i=this.node.accessibleAttributes[e],n=i.attribute,s=i.value;"aria-label"===n&&t&&"string"==typeof t.ariaLabel&&"PRIMARY_SIBLING"===i.options.elementName&&(s=t.ariaLabel),this.setAttributeToElement(n,s,i.options)}},onInputValueChange:function(){if(null===this.node.inputValue)this.removeAttributeFromElement("value");else{var t=this.node.inputValue+"";this.setAttributeToElement("value",t,{asProperty:!0})}},getElementByName:function(t){return t===e.PRIMARY_SIBLING?this._primarySibling:t===e.LABEL_SIBLING?this._labelSibling:t===e.DESCRIPTION_SIBLING?this._descriptionSibling:t===e.CONTAINER_PARENT?this._containerParent:void 0},setAttributeToElement:function(t,e,i){var n=(i=_.extend({namespace:null,asProperty:!1,elementName:"PRIMARY_SIBLING",element:null},i)).element||this.getElementByName(i.elementName);i.namespace?n.setAttributeNS(i.namespace,t,e):i.asProperty?n[t]=e:n.setAttribute(t,e)},removeAttributeFromElement:function(t,e){var i=(e=_.extend({namespace:null,elementName:"PRIMARY_SIBLING",element:null},e)).element||this.getElementByName(e.elementName);e.namespace?i.removeAttributeNS(e.namespace,t):i.removeAttribute(t)},removeAttributeFromAllElements:function(t){this._primarySibling&&this._primarySibling.removeAttribute(t),this._labelSibling&&this._labelSibling.removeAttribute(t),this._descriptionSibling&&this._descriptionSibling.removeAttribute(t),this._containerParent&&this._containerParent.removeAttribute(t)},setAssociationAttribute:function(t,e){var i=e.otherNode.getAccessibleInstances();if(i.length>0){var n=i[0];n===this.accessibleInstance&&(n.peer=this);var s=n.peer.getElementByName(e.otherElementName),r=this.getElementByName(e.thisElementName);if(r&&s){var a=r.getAttribute(t)||"",o=[a.trim(),s.id].join(" ").trim();this.setAttributeToElement(t,o,{elementName:e.thisElementName})}}},arrangeContentElement:function(t,e){if(this.topLevelElements[0]===this._containerParent)e?this._containerParent.appendChild(t):this._containerParent.insertBefore(t,this._primarySibling);else{o(this.topLevelElements,t);var i=this.topLevelElements.indexOf(this._primarySibling),n=e?this.topLevelElements.length:i;this.topLevelElements.splice(n,0,t)}},isVisible:function(){return null===this.visible||this.visible},setVisible:function(t){if(this.visible!==t){this.visible=t;for(var e=0;e<this.topLevelElements.length;e++){var i=this.topLevelElements[e];t?this.removeAttributeFromElement("hidden",{element:i}):this.setAttributeToElement("hidden","",{element:i})}this.invalidateCSSPositioning()}},isFocused:function(){return document.activeElement===this._primarySibling},focus:function(){this._primarySibling.focus()},blur:function(){if(document.activeElement===this._primarySibling){var t=this;d.ie11&&l.isFullScreen()?window.setTimeout(function(){t._primarySibling&&t._primarySibling.blur()},0):this._primarySibling.blur()}},setFocusable:function(t){this.focusable!==t&&(this.focusable=t,a.overrideFocusWithTabIndex(this.primarySibling,t),this.invalidateCSSPositioning())},setLabelSiblingContent:function(t){this._labelSibling&&(a.setTextContent(this._labelSibling,t),this._labelSibling.tagName.toUpperCase()===p&&this.setAttributeToElement("for",this._primarySibling.id,{elementName:e.LABEL_SIBLING}))},setDescriptionSiblingContent:function(t){this._descriptionSibling&&a.setTextContent(this._descriptionSibling,t)},setPrimarySiblingContent:function(t){this._primarySibling&&a.setTextContent(this._primarySibling,t)},invalidateCSSPositioning:function(){if(!this.positionDirty&&this.focusable){this.positionDirty=!0;for(var t=this.accessibleInstance.parent;t;)t.peer.childPositionDirty=!0,t=t.parent}},positionElements:function(){if(this.node.focusable&&(E.set(this.node.localBounds),E.isFinite())){E.transform(this.accessibleInstance.transformTracker.getMatrix());var t=this.node.getScaleVector(),e=n(this._primarySibling),r=e.width,a=e.height;r>0&&a>0&&(b.setMinMax(0,0,r,a),b.transform(i(this._primarySibling,r,a,E,t)),s(this._primarySibling,b)),this.labelSibling&&(r=(e=n(this._labelSibling)).width,(a=e.height)>0&&r>0&&(b.setMinMax(0,0,r,a),b.transform(i(this.labelSibling,r,a,E,t)),s(this._labelSibling,b)))}this.positionDirty=!1},updateSubtreePositioning:function(){this.childPositionDirty=!1,this.positionDirty&&this.positionElements();for(var t=0;t<this.accessibleInstance.children.length;t++){var e=this.accessibleInstance.children[t].peer;(e.positionDirty||e.childPositionDirty)&&this.accessibleInstance.children[t].peer.updateSubtreePositioning()}},dispose:function(){this.isDisposed=!0,this.blur(),this._primarySibling.removeEventListener("blur",this.blurEventListener),this._primarySibling.removeEventListener("focus",this.focusEventListener),this.accessibleInstance.transformTracker.removeListener(this.transformListener),this.mutationObserver.disconnect(),this.accessibleInstance=null,this.node=null,this.display=null,this.trail=null,this._primarySibling=null,this._labelSibling=null,this._descriptionSibling=null,this._containerParent=null,this.focusable=null,this.freeToPool()}},{PRIMARY_SIBLING:"PRIMARY_SIBLING",LABEL_SIBLING:"LABEL_SIBLING",DESCRIPTION_SIBLING:"DESCRIPTION_SIBLING",CONTAINER_PARENT:"CONTAINER_PARENT"}),f.mixInto(e,{initalize:e.prototype.initializeAccessiblePeer}),e}),i("SCENERY/util/TransformTracker",["require","PHET_CORE/inherit","DOT/Matrix3","SCENERY/scenery"],function(t){"use strict";function e(t,e){var i=this;e=_.extend({isStatic:!1},e),this._isStatic=e.isStatic,this.trail=t,this._matrices=null,this._dirtyIndex=0,this._listeners=[],this._nodeTransformListeners=[];for(var n=1;n<this.trail.length;n++){var s=function(t){return function(){i.onTransformChange(t)}}(n-1);this._nodeTransformListeners.push(s),this._isStatic?t.nodes[n].onStatic("transform",s):t.nodes[n].on("transform",s)}}var i=t("PHET_CORE/inherit"),n=t("DOT/Matrix3");return t("SCENERY/scenery").register("TransformTracker",e),i(Object,e,{dispose:function(){for(var t=1;t<this.trail.length;t++){var e=this._nodeTransformListeners[t-1];this._isStatic?this.trail.nodes[t].offStatic("transform",e):this.trail.nodes[t].off("transform",e)}},addListener:function(t){this._listeners.push(t)},removeListener:function(t){var e=_.indexOf(this._listeners,t);this._listeners.splice(e,1)},notifyListeners:function(){var t=this._listeners;this._isStatic||(t=t.slice());for(var e=t.length,i=0;i<e;i++)t[i]()},onTransformChange:function(t){this._dirtyIndex=Math.min(this._dirtyIndex,t),this.notifyListeners()},getMatrix:function(){if(null===this._matrices){this._matrices=[];for(var t=1;t<this.trail.length;t++)this._matrices.push(new n)}if(this._matrices.length<=0)return n.IDENTITY;for(var e=this._matrices.length,i=this._dirtyIndex;i<e;i++){var s=this.trail.nodes[i+1].matrix;0===i?this._matrices[i].set(s):(this._matrices[i].set(this._matrices[i-1]),this._matrices[i].multiplyMatrix(s))}return this._dirtyIndex=e,this._matrices[e-1]},get matrix(){return this.getMatrix()}}),e}),i("SCENERY/accessibility/AccessibleInstance",["require","SCENERY/accessibility/AccessibilityUtil","SCENERY/accessibility/AccessiblePeer","PHET_CORE/cleanArray","AXON/Events","PHET_CORE/inherit","PHET_CORE/platform","PHET_CORE/Poolable","SCENERY/scenery","SCENERY/util/TransformTracker"],function(t){"use strict";function e(t,e,i){this.initializeAccessibleInstance(t,e,i)}var i=t("SCENERY/accessibility/AccessibilityUtil"),n=t("SCENERY/accessibility/AccessiblePeer"),s=t("PHET_CORE/cleanArray"),r=t("AXON/Events"),a=t("PHET_CORE/inherit"),o=t("PHET_CORE/platform"),h=t("PHET_CORE/Poolable"),l=t("SCENERY/scenery"),u=t("SCENERY/util/TransformTracker"),c=1;return l.register("AccessibleInstance",e),a(r,e,{initializeAccessibleInstance:function(t,i,a){if(r.call(this),this.id=this.id||c++,this.parent=t,this.display=i,this.trail=a,this.isRootInstance=null===t,this.node=this.isRootInstance?null:a.lastNode(),this.children=s(this.children),this.node&&this.node.addAccessibleInstance(this),this.peer=null,this.invisibleCount=0,this.relativeNodes=[],this.relativeVisibilities=[],this.relativeListeners=[],this.transformTracker=new u(e.guessVisualTrail(this.trail,this.display.rootNode)),this.isDisposed=!1,this.isRootInstance){var o=document.createElement("div");this.peer=n.createFromPool(this,{primarySibling:o})}else{this.peer=n.createFromPool(this),this.peer.update();for(var h=this.parent.trail,l=h.length;l<a.length;l++){var d=a.nodes[l];this.relativeNodes.push(d);var f=d._accessibleDisplaysInfo.accessibleDisplays,m=_.includes(f,i);this.relativeVisibilities.push(m),m||this.invisibleCount++;var p=this.checkAccessibleDisplayVisibility.bind(this,l-h.length);d.onStatic("accessibleDisplays",p),this.relativeListeners.push(p)}this.updateVisibility()}return this},addConsecutiveInstances:function(t){var e=this.children.length>0;Array.prototype.push.apply(this.children,t);for(var n=0;n<t.length;n++)i.insertElements(this.peer.primarySibling,t[n].peer.topLevelElements);e&&this.sortChildren()},removeInstancesForTrail:function(t){for(var e=0;e<this.children.length;e++){var i=this.children[e],n=i.trail,s=n.length<t.length;if(!s)for(var r=this.trail.length;r<t.length;r++)if(t.nodes[r]!==n.nodes[r]){s=!0;break}s||(this.children.splice(e,1),i.dispose(),e-=1)}},removeAllChildren:function(){for(;this.children.length;)this.children.pop().dispose()},findChildWithTrail:function(t){for(var e=0;e<this.children.length;e++){var i=this.children[e];if(i.trail.equals(t))return i}return null},removeSubtree:function(t){for(var e=this.children.length-1;e>=0;e--){var i=this.children[e];i.trail.isExtensionOf(t,!0)&&(this.children.splice(e,1),i.dispose())}},checkAccessibleDisplayVisibility:function(t){var e=_.includes(this.relativeNodes[t]._accessibleDisplaysInfo.accessibleDisplays,this.display);if(e!==this.relativeVisibilities[t]){this.relativeVisibilities[t]=e;var i=0===this.invisibleCount;this.invisibleCount+=e?-1:1;0===this.invisibleCount!==i&&this.updateVisibility()}},updateVisibility:function(){this.peer.setVisible(this.invisibleCount<=0),this.peer.isVisible()||this.peer.primarySibling.contains(document.activeElement)&&(l.Display.focus=null),o.edge&&(this.display.getAccessibleDOMElement().style.display="none",this.display.getAccessibleDOMElement().style.display="block")},isGloballyVisible:function(){return!!this.peer.isVisible()&&(!this.parent||this.parent.isGloballyVisible())},getChildOrdering:function(t){var e,i=t.lastNode(),n=i.getEffectiveChildren(),s=[];if(i.accessibleContent&&i!==this.node){var r=i.accessibleInstances;t:for(e=0;e<r.length;e++){var a=r[e];if(a.parent===this){for(var o=0;o<t.length;o++)if(t.nodes[o]!==a.trail.nodes[o+a.trail.length-t.length])continue t;s.push(a)}}}else for(e=0;e<n.length;e++)t.addDescendant(n[e],e),Array.prototype.push.apply(s,this.getChildOrdering(t)),t.removeDescendant();return s},sortChildren:function(){var t=this.getChildOrdering(new l.Trail(this.isRootInstance?this.display.rootNode:this.node));this.children=t;for(var e=this.peer.primarySibling,i=e.childNodes.length-1,n=this.children.length-1;n>=0;n--)for(var s=this.children[n].peer,r=s.topLevelElements.length-1;r>=0;r--){var a=s.topLevelElements[r];e.childNodes[i]!==a&&e.insertBefore(a,e.childNodes[i+1]),i--}},dispose:function(){if(!this.isRootInstance){i.removeElements(this.parent.peer.primarySibling,this.peer.topLevelElements);for(var t=0;t<this.relativeNodes.length;t++)this.relativeNodes[t].offStatic("accessibleDisplays",this.relativeListeners[t])}for(;this.children.length;)this.children.pop().dispose();this.peer.dispose(),this.transformTracker.dispose(),this.node&&this.node.removeAccessibleInstance(this),this.relativeNodes=null,this.display=null,this.trail=null,this.node=null,this.peer=null,this.isDisposed=!0,this.freeToPool()},toString:function(){return this.id+"#{"+this.trail.toString()+"}"},auditRoot:function(){return}},{guessVisualTrail:function(t,e){t.reindex();var i=t.indices.lastIndexOf(-1);if(i<0)return t;var n=i+1,s=t.nodes[n].getTrailsTo(e);if(0===s.length)return t;for(var r=s[0],a=n+1;a<t.length;a++)r.addDescendant(t.nodes[a]);return r},createFakeAccessibleTree:function(t){function e(t){var i=_.flatten(t.getEffectiveChildren().map(e));return t.accessibleContent&&(i=[{node:t,children:i}]),i}return{node:null,children:e(t)}}}),h.mixInto(e,{initialize:e.prototype.initializeAccessibleInstance}),e}),i("SCENERY/accessibility/PartialAccessibleTrail",["require","PHET_CORE/inherit","SCENERY/scenery"],function(t){"use strict";function e(t,e,i){this.accessibleInstance=t,this.trail=e,this.isRoot=i,this.fullTrail=this.accessibleInstance.trail.copy();for(var n=this.isRoot?0:1;n<this.trail.length;n++)this.fullTrail.addDescendant(this.trail.nodes[n])}var i=t("PHET_CORE/inherit");return t("SCENERY/scenery").register("PartialAccessibleTrail",e),i(Object,e)}),i("SCENERY/accessibility/AccessibilityTree",["require","SCENERY/accessibility/AccessibleInstance","PHET_CORE/arrayDifference","SCENERY/accessibility/PartialAccessibleTrail","SCENERY/scenery"],function(t){"use strict";var e=t("SCENERY/accessibility/AccessibleInstance"),i=t("PHET_CORE/arrayDifference"),n=t("SCENERY/accessibility/PartialAccessibleTrail"),s=t("SCENERY/scenery"),r=null,a={addChild:function(t,e){var i=a.beforeOp(e);e._accessibleParent||a.addTree(t,e),a.afterOp(i)},removeChild:function(t,e){var i=a.beforeOp(e);e._accessibleParent||a.removeTree(t,e),a.afterOp(i)},childrenOrderChange:function(t){var e=a.beforeOp(t);a.reorder(t),a.afterOp(e)},accessibleOrderChange:function(t,e,n){var s=a.beforeOp(t),r=[],o=[];i(e||[],n||[],r,o);var h,l,u=a.findAccessibleTrails(t);for(h=0;h<r.length;h++){var c=r[h];c&&(a.removeTree(t,c,u),c._accessibleParent=null)}for(h=0;h<o.length;h++){var d=o[h];if(d){var f=d._parents;for(l=0;l<f.length;l++)a.removeTree(f[l],d);d._accessibleParent=t}}for(h=0;h<r.length;h++){var m=r[h];if(m){var p=m._parents;for(l=0;l<p.length;l++)a.addTree(p[l],m)}}for(h=0;h<o.length;h++){var g=o[h];g&&a.addTree(t,g,u)}a.reorder(t,u),a.afterOp(s)},accessibleContentChange:function(t){var e,i=a.beforeOp(t),n=t._accessibleParent?[t._accessibleParent]:t._parents,s=[];for(e=0;e<n.length;e++){var r=n[e],o=a.findAccessibleTrails(r);s.push(o),a.removeTree(r,t,o)}for(e=0;e<n.length;e++)a.addTree(n[e],t,s[e]);for(e=0;e<t._rootedDisplays.length;e++){var h=t._rootedDisplays[e];h._accessible&&a.rebuildInstanceTree(h._rootAccessibleInstance)}a.afterOp(i)},rebuildInstanceTree:function(t){var e=t.display.rootNode;t.removeAllChildren(),t.addConsecutiveInstances(a.createTree(new s.Trail(e),t.display,t))},addTree:function(t,e,i){i=i||a.findAccessibleTrails(t);for(var n=0;n<i.length;n++){var s=i[n],r=s.accessibleInstance;s.fullTrail.addDescendant(e);var o=a.createTree(s.fullTrail,r.display,r);s.fullTrail.removeDescendant(e),r.addConsecutiveInstances(o)}},removeTree:function(t,e,i){i=i||a.findAccessibleTrails(t);for(var n=0;n<i.length;n++){var s=i[n];s.fullTrail.addDescendant(e),s.accessibleInstance.removeInstancesForTrail(s.fullTrail),s.fullTrail.removeDescendant(e)}},reorder:function(t,e){e=e||a.findAccessibleTrails(t);for(var i=0;i<e.length;i++){e[i].accessibleInstance.sortChildren()}},createTree:function(t,i,n){var s,r=t.lastNode(),o=r.getEffectiveChildren(),h=!1;r.accessibleContent&&((s=n.findChildWithTrail(t))?h=!0:s=e.createFromPool(n,i,t.copy()),n=s);for(var l=[],u=0;u<o.length;u++)t.addDescendant(o[u],u),Array.prototype.push.apply(l,a.createTree(t,i,n)),t.removeDescendant();return s?(s.addConsecutiveInstances(l),h?[]:[s]):l},beforeOp:function(t){r=s.Display&&s.Display.focusedNode;for(var e=[],i=this.findAccessibleTrails(t),n=0;n<i.length;n++){var a=i[n].accessibleInstance.display;a.blockFocusCallbacks=!0,e.push(a)}return e},afterOp:function(t){r&&r.focus();for(var e=0;e<t.length;e++)t[e].blockFocusCallbacks=!1},findAccessibleTrails:function(t){var e=[];return a.recursiveAccessibleTrailSearch(e,new s.Trail(t)),e},recursiveAccessibleTrailSearch:function(t,e){var i,s=e.rootNode();if(s.accessibleContent){var r=s.accessibleInstances;for(i=0;i<r.length;i++)t.push(new n(r[i],e.copy(),!1))}else{var o=s.rootedDisplays;for(i=0;i<o.length;i++){var h=o[i];h._accessible&&t.push(new n(h._rootAccessibleInstance,e.copy(),!0))}var l=s._accessibleParent?[s._accessibleParent]:s._parents,u=l.length;for(i=0;i<u;i++){var c=l[i];e.addAncestor(c),a.recursiveAccessibleTrailSearch(t,e),e.removeAncestor()}}},auditAccessibleDisplays:function(t){},auditNodeForAccessibleCycles:function(t){},debugOrder:function(t){return null===t?"null":"["+t.map(function(t){return null===t?"null":t._id}).join(",")+"]"}};return s.register("AccessibilityTree",a),a}),i("SCENERY/accessibility/KeyboardUtil",["require","SCENERY/scenery"],function(t){"use strict";var e={KEY_SPACE:32,KEY_ENTER:13,KEY_TAB:9,KEY_RIGHT_ARROW:39,KEY_LEFT_ARROW:37,KEY_UP_ARROW:38,KEY_DOWN_ARROW:40,KEY_SHIFT:16,KEY_CTRL:17,KEY_ALT:18,KEY_ESCAPE:27,KEY_DELETE:46,KEY_BACKSPACE:8,KEY_PAGE_UP:33,KEY_PAGE_DOWN:34,KEY_END:35,KEY_HOME:36,KEY_PRINT_SCREEN:44,KEY_S:83,KEY_W:87,KEY_A:65,KEY_D:68,KEY_J:74,KEY_C:67,KEY_N:78,KEY_0:48,KEY_9:57,ARROW_KEYS:[39,37,39,40],isArrowKey:function(t){return t===e.KEY_RIGHT_ARROW||t===e.KEY_LEFT_ARROW||t===e.KEY_UP_ARROW||t===e.KEY_DOWN_ARROW},isRangeKey:function(t){return t>=e.KEY_PAGE_UP&&t<=e.KEY_DOWN_ARROW},isNumberKey:function(t){return t>e.KEY_0&&t<e.KEY_9},isWASDKey:function(t){return t===e.KEY_W||t===e.KEY_A||t===e.KEY_S||t===e.KEY_D}};return t("SCENERY/scenery").register("KeyboardUtil",e),e}),i("AXON/timer",["require","AXON/Emitter","AXON/axon"],function(t){"use strict";var e=t("AXON/Emitter"),i=t("AXON/axon"),n=function(t){function i(){return _classCallCheck(this,i),_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return _inherits(i,e),_createClass(i,[{key:"setTimeout",value:function(t,e){var i=this,n=0,s=function s(r){1e3*(n+=r)>=e&&(t(),i.removeListener(s))};return this.addListener(s),s}},{key:"clearTimeout",value:function(t){this.hasListener(t)&&this.removeListener(t)}},{key:"setInterval",value:function(t,e){var i=this,n=0,s=function s(r){for(n+=r;1e3*n>=e&&-1!==i.hasListener(s);)t(),n-=e/1e3};return this.addListener(s),s}},{key:"clearInterval",value:function(t){this.hasListener(t)&&this.removeListener(t)}}]),i}();return i.register("timer",new n({validators:[{valueType:"number"}]}))}),i("SCENERY/accessibility/KeyStateTracker",["require","SCENERY/accessibility/KeyboardUtil","SCENERY/scenery","AXON/timer"],function(t){"use strict";var e=t("SCENERY/accessibility/KeyboardUtil"),i=t("SCENERY/scenery"),n=t("AXON/timer"),s=function(){function t(){_classCallCheck(this,t),this.keyState={};var e=this.step.bind(this);n.addListener(e),this._disposeKeystateTracker=function(){n.removeListener(e)}}return _createClass(t,[{key:"keydownUpdate",value:function(t){var e=t.domEvent;this.correctModifierKeys(e),this.isKeyDown(e.keyCode)||(this.keyState[e.keyCode]={keyDown:!0,keyCode:e.keyCode,timeDown:0})}},{key:"correctModifierKeys",value:function(t){t.shiftKey&&!this.shiftKeyDown&&(this.keyState[e.KEY_SHIFT]={keyDown:!0,keyCode:t.keyCode,timeDown:0}),t.altKey&&!this.altKeyDown&&(this.keyState[e.KEY_ALT]={keyDown:!0,keyCode:t.keyCode,timeDown:0}),t.ctrlKey&&!this.ctrlKeyDown&&(this.keyState[e.KEY_CTRL]={keyDown:!0,keyCode:t.keyCode,timeDown:0}),!t.shiftKey&&this.shiftKeyDown&&delete this.keyState[e.KEY_SHIFT],!t.altKey&&this.altKeyDown&&delete this.keyState[e.KEY_ALT],!t.ctrlKey&&this.ctrlKeyDown&&delete this.keyState[e.KEY_CTRL]}},{key:"keyupUpdate",value:function(t){var e=t.domEvent,i=e.keyCode;this.correctModifierKeys(e),this.isKeyDown(i)&&delete this.keyState[i]}},{key:"isKeyDown",value:function(t){return!!this.keyState[t]&&this.keyState[t].keyDown}},{key:"isAnyKeyInListDown",value:function(t){for(var e=0;e<t.length;e++)if(this.isKeyDown(t[e]))return!0;return!1}},{key:"areKeysDown",value:function(t){for(var e=0;e<t.length;e++)if(!this.isKeyDown(t[e]))return!1;return!0}},{key:"keysAreDown",value:function(){return!!Object.keys(this.keyState).length>0}},{key:"timeDownForKey",value:function(t){return this.keyState[t].timeDown}},{key:"clearState",value:function(){this.keyState={}}},{key:"step",value:function(t){if(this.keysAreDown()){var e=1e3*t;for(var i in this.keyState)this.keyState.hasOwnProperty(i)&&this.keyState[i].keyDown&&(this.keyState[i].timeDown+=e)}}},{key:"dispose",value:function(){this._disposeKeystateTracker()}},{key:"movementKeysDown",get:function(){return this.rightMovementKeysDown()||this.leftMovementKeysDown()||this.upMovementKeysDown()||this.downMovementKeysDown()}},{key:"enterKeyDown",get:function(){return this.isKeyDown(e.KEY_ENTER)}},{key:"shiftKeyDown",get:function(){return this.isKeyDown(e.KEY_SHIFT)}},{key:"altKeyDown",get:function(){return this.isKeyDown(e.KEY_ALT)}},{key:"ctrlKeyDown",get:function(){return this.isKeyDown(e.KEY_CTRL)}}]),t}();return i.register("KeyStateTracker",s)}),i("SCENERY/util/Features",["require","PHET_CORE/detectPrefix","SCENERY/scenery"],function(t){"use strict";function e(t){try{var e=document.createElement("canvas");e.width=1,e.height=1;var i=e.getContext("2d");i.fillStyle="black",i.fillRect(0,0,1,1);var n="data:"+t;return e.toDataURL([t]).slice(0,n.length)===n}catch(t){return!1}}function i(t,e){var i=document.createElement("canvas");i.width=1,i.height=1;var n=i.getContext("2d"),r=document.createElement("img");r.crossOrigin="Anonymous";var a=function(){try{n.drawImage(r,0,0),i.toDataURL(),s[t]=!0}catch(e){s[t]=!1}};r.onload=a;try{r.src=e,r.complete&&a()}catch(e){s[t]=!1}}var n=t("PHET_CORE/detectPrefix"),s={};t("SCENERY/scenery").register("Features",s),s.canvasPNGOutput=e("image/png"),s.canvasJPEGOutput=e("image/jpeg"),s.canvasGIFOutput=e("image/gif"),s.canvasICONOutput=e("image/x-icon"),i("canvasPNGInput","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQIW2NkYGD4DwABCQEBtxmN7wAAAABJRU5ErkJggg=="),i("canvasJPEGInput","data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAMCAgICAgMCAgIDAwMDBAYEBAQEBAgGBgUGCQgKCgkICQkKDA8MCgsOCwkJDRENDg8QEBEQCgwSExIQEw8QEBD/2wBDAQMDAwQDBAgEBAgQCwkLEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBD/wAARCAABAAEDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD8qqKKKAP/2Q=="),i("canvasSVGInput","data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIj8+DQo8c3ZnIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3cG9ydD0iMCAwIDEgMSIgd2lkdGg9IjEiIGhlaWdodD0iMSIgPg0KICA8cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMSIgaGVpZ2h0PSIxIiByeD0iMCIgcnk9IjAiIHN0eWxlPSJmaWxsOiBibGFjazsgc3Ryb2tlOiBub25lOyI+PC9yZWN0Pg0KPC9zdmc+DQo="),i("canvasGIFInput","data:image/gif;base64,R0lGODlhAQABAJEAAAAAAP///////wAAACH5BAEAAAIALAAAAAABAAEAAAICRAEAOw==");var r=document.createElement("canvas"),a=r.getContext("2d");s.toDataURLHD=n(r,"toDataURLHD"),s.createImageDataHD=n(a,"createImageDataHD"),s.getImageDataHD=n(a,"getImageDataHD"),s.putImageDataHD=n(a,"putImageDataHD"),s.currentTransform=n(a,"currentTransform");var o=document.createElement("span"),h=document.createElement("div");return s.textStroke=n(o.style,"textStroke"),s.textStrokeColor=n(o.style,"textStrokeColor"),s.textStrokeWidth=n(o.style,"textStrokeWidth"),s.transform=n(h.style,"transform"),s.transformOrigin=n(h.style,"transformOrigin"),s.backfaceVisibility=n(h.style,"backfaceVisibility"),s.borderRadius=n(h.style,"borderRadius"),s.userSelect=n(h.style,"userSelect"),s.touchAction=n(h.style,"touchAction"),s.touchCallout=n(h.style,"touchCallout"),s.userDrag=n(h.style,"userDrag"),s.tapHighlightColor=n(h.style,"tapHighlightColor"),s.fontSmoothing=n(h.style,"fontSmoothing"),s.requestAnimationFrame=n(window,"requestAnimationFrame"),s.cancelAnimationFrame=n(window,"cancelAnimationFrame"),s.setStyle=function(t,e,i){void 0!==e&&(t.style[e]=i)},s.passive=!1,window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){s.passive=!0}})),s}),i("SCENERY/accessibility/A11yBehaviorFunctionDef",["require","SCENERY/scenery"],function(t){"use strict";var e=t("SCENERY/scenery"),i={validateA11yBehaviorFunctionDef:function(t){}};return e.register("A11yBehaviorFunctionDef",i),i}),i("SCENERY/display/Renderer",["require","SCENERY/scenery"],function(t){"use strict";var e={};t("SCENERY/scenery").register("Renderer",e),e.numActiveRenderers=4,e.bitsPerRenderer=5,e.bitmaskRendererArea=255,e.bitmaskCurrentRendererArea=15,e.bitmaskLacksOffset=65536,e.bitmaskLacksShift=16,e.bitmaskNodeDefault=e.bitmaskRendererArea,e.bitmaskCanvas=1,e.bitmaskSVG=2,e.bitmaskDOM=4,e.bitmaskWebGL=8,e.bitmaskSingleCanvas=256,e.bitmaskSingleSVG=512,e.bitmaskNotPainted=4096,e.bitmaskBoundsValid=8192,e.bitmaskNotAccessible=16384,e.bitmaskLacksCanvas=e.bitmaskCanvas<<e.bitmaskLacksShift,e.bitmaskLacksSVG=e.bitmaskSVG<<e.bitmaskLacksShift,e.bitmaskLacksDOM=e.bitmaskDOM<<e.bitmaskLacksShift,e.bitmaskLacksWebGL=e.bitmaskWebGL<<e.bitmaskLacksShift,e.isCanvas=function(t){return 0!=(t&e.bitmaskCanvas)},e.isSVG=function(t){return 0!=(t&e.bitmaskSVG)},e.isDOM=function(t){return 0!=(t&e.bitmaskDOM)},e.isWebGL=function(t){return 0!=(t&e.bitmaskWebGL)};var i={canvas:e.bitmaskCanvas,svg:e.bitmaskSVG,dom:e.bitmaskDOM,webgl:e.bitmaskWebGL};return e.fromName=function(t){return i[t]},e.stripBitmask=function(t){return t&e.bitmaskRendererArea},e.createOrderBitmask=function(t,e,i,n){return t=t||0,e=e||0,i=i||0,n=n||0,t|e<<5|i<<10|n<<15},e.bitmaskOrder=function(t,i){return i>0&&(t>>=5*i),t&e.bitmaskCurrentRendererArea},e.bitmaskOrderFirst=function(t){return t&e.bitmaskCurrentRendererArea},e.bitmaskOrderSecond=function(t){return t>>5&e.bitmaskCurrentRendererArea},e.bitmaskOrderThird=function(t){return t>>10&e.bitmaskCurrentRendererArea},e.bitmaskOrderFourth=function(t){return t>>15&e.bitmaskCurrentRendererArea},e.pushOrderBitmask=function(t,i){for(var n=i,s=e.bitsPerRenderer*e.numActiveRenderers,r=0;r<=s;r+=e.bitsPerRenderer){var a=t>>r&e.bitmaskCurrentRendererArea;if(a===n)return t;if(0===a)return t|=n<<r;if(t&=~(e.bitmaskCurrentRendererArea<<r),t|=n<<r,(n=a)===i)return t}throw new Error("pushOrderBitmask overflow")},e.createSelfDrawable=function(t,i,n,s){var r;if(e.isCanvas(n))r=i.createCanvasDrawable(n,t);else if(e.isSVG(n))r=i.createSVGDrawable(n,t);else if(e.isDOM(n))r=i.createDOMDrawable(n,t);else{if(!e.isWebGL(n))throw new Error("Unrecognized renderer: "+n);r=i.createWebGLDrawable(n,t)}return r.setFittable(s),r},e.webglCustom=1,e.webglTexturedTriangles=2,e.webglVertexColorPolygons=3,e}),i("SCENERY/accessibility/AccessibleDisplaysInfo",["require","PHET_CORE/inherit","SCENERY/display/Renderer","SCENERY/scenery"],function(t){"use strict";function e(t){this.node=t,this.accessibleDisplays=[]}var i=t("PHET_CORE/inherit"),n=t("SCENERY/display/Renderer");return t("SCENERY/scenery").register("AccessibleDisplaysInfo",e),i(Object,e,{onAddChild:function(t){t._accessibleDisplaysInfo.canHaveAccessibleDisplays()&&t._accessibleDisplaysInfo.addAccessibleDisplays(this.accessibleDisplays)},onRemoveChild:function(t){t._accessibleDisplaysInfo.canHaveAccessibleDisplays()&&t._accessibleDisplaysInfo.removeAccessibleDisplays(this.accessibleDisplays)},onSummaryChange:function(t,e){if(this.node.visible&&this.node.accessibleVisible){var i=!(n.bitmaskNotAccessible&t),s=!(n.bitmaskNotAccessible&e);s&&!i&&this.addAllAccessibleDisplays(),!s&&i&&this.removeAllAccessibleDisplays()}},onVisibilityChange:function(t){this.node.accessibleVisible&&!this.node._rendererSummary.isNotAccessible()&&(t?this.addAllAccessibleDisplays():this.removeAllAccessibleDisplays())},onAccessibleVisibilityChange:function(t){this.node.visible&&!this.node._rendererSummary.isNotAccessible()&&(t?this.addAllAccessibleDisplays():this.removeAllAccessibleDisplays())},onAddedRootedDisplay:function(t){t._accessible&&this.canHaveAccessibleDisplays()&&this.addAccessibleDisplays([t])},onRemovedRootedDisplay:function(t){t._accessible&&this.canHaveAccessibleDisplays()&&this.removeAccessibleDisplays([t])},canHaveAccessibleDisplays:function(){return this.node.visible&&this.node.accessibleVisible&&!this.node._rendererSummary.isNotAccessible()},addAllAccessibleDisplays:function(){var t,e=[];for(t=0;t<this.node._parents.length;t++)Array.prototype.push.apply(e,this.node._parents[t]._accessibleDisplaysInfo.accessibleDisplays);for(t=0;t<this.node._rootedDisplays.length;t++){var i=this.node._rootedDisplays[t];i._accessible&&e.push(i)}this.addAccessibleDisplays(e)},removeAllAccessibleDisplays:function(){this.removeAccessibleDisplays(this.accessibleDisplays.slice())},addAccessibleDisplays:function(t){if(0!==t.length){Array.prototype.push.apply(this.accessibleDisplays,t);for(var e=0;e<this.node._children.length;e++){this.node._children[e]._accessibleDisplaysInfo.canHaveAccessibleDisplays()&&this.node._children[e]._accessibleDisplaysInfo.addAccessibleDisplays(t)}this.node.trigger0("accessibleDisplays")}},removeAccessibleDisplays:function(t){if(0!==t.length){var e;for(e=t.length-1;e>=0;e--){this.accessibleDisplays.lastIndexOf(t[e]);this.accessibleDisplays.splice(e,1)}for(e=0;e<this.node._children.length;e++){var i=this.node._children[e];i._accessibleDisplaysInfo.canHaveAccessibleDisplays()&&!i._isGettingRemovedFromParent&&i._accessibleDisplaysInfo.removeAccessibleDisplays(t)}this.node.trigger0("accessibleDisplays")}}})}),i("SCENERY/accessibility/Accessibility",["require","SCENERY/accessibility/A11yBehaviorFunctionDef","SCENERY/accessibility/AccessibilityTree","SCENERY/accessibility/AccessibilityUtil","SCENERY/accessibility/AccessibleDisplaysInfo","SCENERY/accessibility/AccessiblePeer","PHET_CORE/arrayDifference","AXON/Emitter","PHET_CORE/extend","SCENERY/scenery","KITE/Shape"],function(t){"use strict";t("SCENERY/accessibility/A11yBehaviorFunctionDef");var e=t("SCENERY/accessibility/AccessibilityTree"),i=t("SCENERY/accessibility/AccessibilityUtil"),n=t("SCENERY/accessibility/AccessibleDisplaysInfo"),s=t("SCENERY/accessibility/AccessiblePeer"),r=t("PHET_CORE/arrayDifference"),a=t("AXON/Emitter"),o=t("PHET_CORE/extend"),h=t("SCENERY/scenery"),l=(t("KITE/Shape"),i.TAGS.INPUT,i.TAGS.P),u=l,c=l,d=function(t,e,n){return"input"===t.tagName?(e.labelTagName="label",e.labelContent=n):i.tagNameSupportsContent(t.tagName)?e.innerContent=n:e.ariaLabel=n,e},f=function(t,e,n){return e.descriptionTagName=i.DEFAULT_DESCRIPTION_TAG_NAME,e.descriptionContent=n,e.appendDescription=!0,e},m=function(t,e,i){return e.labelTagName="h"+t.headingLevel,e.labelContent=i,e},p=(i.FORM_ELEMENTS,i.INPUT_TYPES_THAT_SUPPORT_CHECKED,i.ASSOCIATION_ATTRIBUTES,["focusable","tagName","accessibleName","helpText","helpTextBehavior","accessibleHeading","accessibleHeadingBehavior","containerTagName","containerAriaRole","innerContent","inputType","inputValue","accessibleChecked","accessibleNamespace","ariaLabel","ariaRole","labelTagName","labelContent","appendLabel","descriptionTagName","descriptionContent","appendDescription","focusHighlight","focusHighlightLayerable","groupFocusHighlight","accessibleVisible","accessibleOrder","ariaLabelledbyAssociations","ariaDescribedbyAssociations","activeDescendantAssociations"]),g={compose:function(t){var l=t.prototype;o(l,{_mutatorKeys:p.concat(l._mutatorKeys),initializeAccessibility:function(){this._tagName=null,this._containerTagName=null,this._labelTagName=null,this._descriptionTagName=null,this._inputType=null,this._inputValue=null,this._accessibleChecked=!1,this._appendLabel=!1,this._appendDescription=!1,this._accessibleAttributes=[],this._labelContent=null,this._innerContent=null,this._descriptionContent=null,this._accessibleNamespace=null,this._ariaLabel=null,this._ariaRole=null,this._containerAriaRole=null,this._ariaLabelledbyAssociations=[],this._nodesThatAreAriaLabelledbyThisNode=[],this._ariaDescribedbyAssociations=[],this._nodesThatAreAriaDescribedbyThisNode=[],this._activeDescendantAssociations=[],this._nodesThatAreActiveDescendantToThisNode=[],this._focusableOverride=null,this._focusHighlight=null,this._focusHighlightLayerable=!1,this._groupFocusHighlight=!1,this._accessibleVisible=!0,this.focusChangedEmitter=new a({validationEnabled:!1}),this._accessibleOrder=null,this._accessibleParent=null,this._accessibleDisplaysInfo=new n(this),this._accessibleInstances=[],this._accessibleName=null,this._accessibleNameBehavior=d,this._helpText=null,this._helpTextBehavior=f,this._accessibleHeading=null,this._headingLevel=null,this._accessibleHeadingBehavior=m},disposeAccessibility:function(){this.accessibleOrder=null,this.setAriaLabelledbyAssociations([]),this.setAriaDescribedbyAssociations([]),this.setActiveDescendantAssociations([])},isFocused:function(){for(var t=0;t<this._accessibleInstances.length;t++){if(this._accessibleInstances[t].peer.isFocused())return!0}return!1},get focused(){return this.isFocused()},focus:function(){if(this._accessibleInstances.length>0){var t=this._accessibleInstances[0].peer;t.focus()}},blur:function(){if(this._accessibleInstances.length>0){var t=this._accessibleInstances[0].peer;t.blur(),this.interruptInput()}},accessibleAudit:function(){this.accessibleContent;for(var t=0;t<this.children.length;t++)this.children[t].accessibleAudit()},setAccessibleName:function(t){this._accessibleName!==t&&(this._accessibleName=t,this.onAccessibleContentChange())},set accessibleName(t){this.setAccessibleName(t)},getAccessibleName:function(){return this._accessibleName},get accessibleName(){return this.getAccessibleName()},setAccessibleNameBehavior:function(t){this._accessibleNameBehavior!==t&&(this._accessibleNameBehavior=t,this.onAccessibleContentChange())},set accessibleNameBehavior(t){this.setAccessibleNameBehavior(t)},getAccessibleNameBehavior:function(){return this._accessibleNameBehavior},get accessibleNameBehavior(){return this.getAccessibleNameBehavior()},setAccessibleHeading:function(t){this._accessibleHeading!==t&&(this._accessibleHeading=t,this.onAccessibleContentChange())},set accessibleHeading(t){this.setAccessibleHeading(t)},getAccessibleHeading:function(){return this._accessibleHeading},get accessibleHeading(){return this.getAccessibleHeading()},setAccessibleHeadingBehavior:function(t){this._accessibleHeadingBehavior!==t&&(this._accessibleHeadingBehavior=t,this.onAccessibleContentChange())},set accessibleHeadingBehavior(t){this.setAccessibleHeadingBehavior(t)},getAccessibleHeadingBehavior:function(){return this._accessibleHeadingBehavior},get accessibleHeadingBehavior(){return this.getAccessibleHeadingBehavior()},getHeadingLevel:function(){return this._headingLevel},get headingLevel(){return this.getHeadingLevel()},computeHeadingLevel:function(){if(!this._accessibleParent)return this._accessibleHeading?(this._headingLevel=1,1):0;if(this._accessibleHeading){var t=this._accessibleParent.computeHeadingLevel()+1;return this._headingLevel=t,t}return this._accessibleParent.computeHeadingLevel()},setHelpText:function(t){this._helpText!==t&&(this._helpText=t,this.onAccessibleContentChange())},set helpText(t){this.setHelpText(t)},getHelpText:function(){return this._helpText},get helpText(){return this.getHelpText()},setHelpTextBehavior:function(t){this._helpTextBehavior!==t&&(this._helpTextBehavior=t,this.onAccessibleContentChange())},set helpTextBehavior(t){this.setHelpTextBehavior(t)},getHelpTextBehavior:function(){return this._helpTextBehavior},get helpTextBehavior(){return this.getHelpTextBehavior()},setTagName:function(t){t!==this._tagName&&(this._tagName=t,this.onAccessibleContentChange())},set tagName(t){this.setTagName(t)},getTagName:function(){return this._tagName},get tagName(){return this.getTagName()},setLabelTagName:function(t){t!==this._labelTagName&&(this._labelTagName=t,this.onAccessibleContentChange())},set labelTagName(t){this.setLabelTagName(t)},getLabelTagName:function(){return this._labelTagName},get labelTagName(){return this.getLabelTagName()},setDescriptionTagName:function(t){t!==this._descriptionTagName&&(this._descriptionTagName=t,this.onAccessibleContentChange())},set descriptionTagName(t){this.setDescriptionTagName(t)},getDescriptionTagName:function(){return this._descriptionTagName},get descriptionTagName(){return this.getDescriptionTagName()},setInputType:function(t){if(t!==this._inputType){this._inputType=t;for(var e=0;e<this._accessibleInstances.length;e++){var i=this._accessibleInstances[e].peer;null===t?i.removeAttributeFromElement("type"):i.setAttributeToElement("type",t)}}},set inputType(t){this.setInputType(t)},getInputType:function(){return this._inputType},get inputType(){return this.getInputType()},setAppendLabel:function(t){this._appendLabel!==t&&(this._appendLabel=t,this.onAccessibleContentChange())},set appendLabel(t){this.setAppendLabel(t)},getAppendLabel:function(){return this._appendLabel},get appendLabel(){return this.getAppendLabel()},setAppendDescription:function(t){this._appendDescription!==t&&(this._appendDescription=t,this.onAccessibleContentChange())},set appendDescription(t){this.setAppendDescription(t)},getAppendDescription:function(){return this._appendDescription},get appendDescription(){return this.getAppendDescription()},setContainerTagName:function(t){this._containerTagName!==t&&(this._containerTagName=t,this.onAccessibleContentChange())},set containerTagName(t){this.setContainerTagName(t)},getContainerTagName:function(){return this._containerTagName},get containerTagName(){return this.getContainerTagName()},setLabelContent:function(t){if(this._labelContent!==t){this._labelContent=t,this._labelTagName||this.setLabelTagName(c);for(var e=0;e<this._accessibleInstances.length;e++){this._accessibleInstances[e].peer.setLabelSiblingContent(this._labelContent)}}},set labelContent(t){this.setLabelContent(t)},getLabelContent:function(){return this._labelContent},get labelContent(){return this.getLabelContent()},setInnerContent:function(t){if(this._innerContent!==t){this._innerContent=t;for(var e=0;e<this._accessibleInstances.length;e++){this._accessibleInstances[e].peer.setPrimarySiblingContent(this._innerContent)}}},set innerContent(t){this.setInnerContent(t)},getInnerContent:function(){return this._innerContent},get innerContent(){return this.getInnerContent()},setDescriptionContent:function(t){if(this._descriptionContent!==t){this._descriptionContent=t,this._descriptionTagName||this.setDescriptionTagName(u);for(var e=0;e<this._accessibleInstances.length;e++){this._accessibleInstances[e].peer.setDescriptionSiblingContent(this._descriptionContent)}}},set descriptionContent(t){this.setDescriptionContent(t)},getDescriptionContent:function(){return this._descriptionContent},get descriptionContent(){return this.getDescriptionContent()},setAriaRole:function(t){this._ariaRole!==t&&(this._ariaRole=t,null!==t?this.setAccessibleAttribute("role",t):this.removeAccessibleAttribute("role"))},set ariaRole(t){this.setAriaRole(t)},getAriaRole:function(){return this._ariaRole},get ariaRole(){return this.getAriaRole()},setContainerAriaRole:function(t){this._containerAriaRole!==t&&(this._containerAriaRole=t,null===this._containerAriaRole?this.removeAccessibleAttribute("role",{elementName:s.CONTAINER_PARENT}):this.setAccessibleAttribute("role",t,{elementName:s.CONTAINER_PARENT}))},set containerAriaRole(t){this.setContainerAriaRole(t)},getContainerAriaRole:function(){return this._containerAriaRole},get containerAriaRole(){return this.getContainerAriaRole()},setAccessibleNamespace:function(t){return this._accessibleNamespace!==t&&(this._accessibleNamespace=t,this.onAccessibleContentChange()),this},set accessibleNamespace(t){this.setAccessibleNamespace(t)},getAccessibleNamespace:function(){return this._accessibleNamespace},get accessibleNamespace(){return this.getAccessibleNamespace()},setAriaLabel:function(t){this._ariaLabel!==t&&(this._ariaLabel=t,null===this._ariaLabel?this.removeAccessibleAttribute("aria-label"):this.setAccessibleAttribute("aria-label",t))},set ariaLabel(t){this.setAriaLabel(t)},getAriaLabel:function(){return this._ariaLabel},get ariaLabel(){return this.getAriaLabel()},setFocusHighlight:function(t){this._focusHighlight!==t&&(this._focusHighlight=t,this._focusHighlightLayerable&&(t.visible=this.focused),this.trigger("focusHighlightChanged"))},set focusHighlight(t){this.setFocusHighlight(t)},getFocusHighlight:function(){return this._focusHighlight},get focusHighlight(){return this.getFocusHighlight()},setFocusHighlightLayerable:function(t){this._focusHighlightLayerable!==t&&(this._focusHighlightLayerable=t,this._focusHighlight&&(this._focusHighlight.visible=this.focused))},set focusHighlightLayerable(t){this.setFocusHighlightLayerable(t)},getFocusHighlightLayerable:function(){return this._focusHighlightLayerable},get focusHighlightLayerable(){return this.getFocusHighlightLayerable()},setGroupFocusHighlight:function(t){this._groupFocusHighlight=t},set groupFocusHighlight(t){this.setGroupFocusHighlight(t)},getGroupFocusHighlight:function(){return this._groupFocusHighlight},get groupFocusHighlight(){return this.getGroupFocusHighlight()},setAriaLabelledbyAssociations:function(t){var e,i;if(!_.isEqual(t,this._ariaLabelledbyAssociations)){var n=[],s=[],a=[];for(r(t,this._ariaLabelledbyAssociations,s,n,a),i=0;i<n.length;i++)e=n[i],this.removeAriaLabelledbyAssociation(e);for(i=0;i<s.length;i++){var o=t[i];this.addAriaLabelledbyAssociation(o)}}},set ariaLabelledbyAssociations(t){return this.setAriaLabelledbyAssociations(t)},getAriaLabelledbyAssociations:function(){return this._ariaLabelledbyAssociations},get ariaLabelledbyAssociations(){return this.getAriaLabelledbyAssociations()},addAriaLabelledbyAssociation:function(t){this._ariaLabelledbyAssociations.push(t),t.otherNode._nodesThatAreAriaLabelledbyThisNode.push(this),this.updateAriaLabelledbyAssociationsInPeers()},removeAriaLabelledbyAssociation:function(t){this._ariaLabelledbyAssociations.splice(_.indexOf(this._ariaLabelledbyAssociations,t),1)[0].otherNode.removeNodeThatIsAriaLabelledByThisNode(this),this.updateAriaLabelledbyAssociationsInPeers()},removeNodeThatIsAriaLabelledByThisNode:function(t){var e=_.indexOf(this._nodesThatAreAriaLabelledbyThisNode,t);this._nodesThatAreAriaLabelledbyThisNode.splice(e,1)},updateAriaLabelledbyAssociationsInPeers:function(){for(var t=0;t<this.accessibleInstances.length;t++){this.accessibleInstances[t].peer.onAriaLabelledbyAssociationChange()}},updateOtherNodesAriaLabelledby:function(){for(var t=0;t<this._nodesThatAreAriaLabelledbyThisNode.length;t++){this._nodesThatAreAriaLabelledbyThisNode[t].updateAriaLabelledbyAssociationsInPeers()}},getNodesThatAreAriaLabelledbyThisNode:function(){return this._nodesThatAreAriaLabelledbyThisNode},get nodesThatAreAriaLabelledbyThisNode(){return this.getNodesThatAreAriaLabelledbyThisNode()},setAriaDescribedbyAssociations:function(t){var e;if(!_.isEqual(t,this._ariaDescribedbyAssociations)){var i,n=[],s=[],a=[];for(r(t,this._ariaDescribedbyAssociations,s,n,a),i=0;i<n.length;i++)e=n[i],this.removeAriaDescribedbyAssociation(e);for(i=0;i<s.length;i++){var o=t[i];this.addAriaDescribedbyAssociation(o)}}},set ariaDescribedbyAssociations(t){return this.setAriaDescribedbyAssociations(t)},getAriaDescribedbyAssociations:function(){return this._ariaDescribedbyAssociations},get ariaDescribedbyAssociations(){return this.getAriaDescribedbyAssociations()},addAriaDescribedbyAssociation:function(t){this._ariaDescribedbyAssociations.push(t),t.otherNode._nodesThatAreAriaDescribedbyThisNode.push(this),this.updateAriaDescribedbyAssociationsInPeers()},removeAriaDescribedbyAssociation:function(t){this._ariaDescribedbyAssociations.splice(_.indexOf(this._ariaDescribedbyAssociations,t),1)[0].otherNode.removeNodeThatIsAriaDescribedByThisNode(this),this.updateAriaDescribedbyAssociationsInPeers()},removeNodeThatIsAriaDescribedByThisNode:function(t){var e=_.indexOf(this._nodesThatAreAriaDescribedbyThisNode,t);this._nodesThatAreAriaDescribedbyThisNode.splice(e,1)},updateAriaDescribedbyAssociationsInPeers:function(){for(var t=0;t<this.accessibleInstances.length;t++){this.accessibleInstances[t].peer.onAriaDescribedbyAssociationChange()}},updateOtherNodesAriaDescribedby:function(){for(var t=0;t<this._nodesThatAreAriaDescribedbyThisNode.length;t++){this._nodesThatAreAriaDescribedbyThisNode[t].updateAriaDescribedbyAssociationsInPeers()}},getNodesThatAreAriaDescribedbyThisNode:function(){return this._nodesThatAreAriaDescribedbyThisNode},get nodesThatAreAriaDescribedbyThisNode(){return this.getNodesThatAreAriaDescribedbyThisNode()},setActiveDescendantAssociations:function(t){var e;if(!_.isEqual(t,this._activeDescendantAssociations)){var i,n=[],s=[],a=[];for(r(t,this._activeDescendantAssociations,s,n,a),i=0;i<n.length;i++)e=n[i],this.removeActiveDescendantAssociation(e);for(i=0;i<s.length;i++){var o=t[i];this.addActiveDescendantAssociation(o)}}},set activeDescendantAssociations(t){return this.setActiveDescendantAssociations(t)},getActiveDescendantAssociations:function(){return this._activeDescendantAssociations},get activeDescendantAssociations(){return this.getActiveDescendantAssociations()},addActiveDescendantAssociation:function(t){this._activeDescendantAssociations.push(t),t.otherNode._nodesThatAreActiveDescendantToThisNode.push(this),this.updateActiveDescendantAssociationsInPeers()},removeActiveDescendantAssociation:function(t){this._activeDescendantAssociations.splice(_.indexOf(this._activeDescendantAssociations,t),1)[0].otherNode.removeNodeThatIsActiveDescendantThisNode(this),this.updateActiveDescendantAssociationsInPeers()},removeNodeThatIsActiveDescendantThisNode:function(t){var e=_.indexOf(this._nodesThatAreActiveDescendantToThisNode,t);this._nodesThatAreActiveDescendantToThisNode.splice(e,1)},updateActiveDescendantAssociationsInPeers:function(){for(var t=0;t<this.accessibleInstances.length;t++){this.accessibleInstances[t].peer.onActiveDescendantAssociationChange()}},updateOtherNodesActiveDescendant:function(){for(var t=0;t<this._nodesThatAreActiveDescendantToThisNode.length;t++){this._nodesThatAreActiveDescendantToThisNode[t].updateActiveDescendantAssociationsInPeers()}},getNodesThatAreActiveDescendantToThisNode:function(){return this._nodesThatAreActiveDescendantToThisNode},get nodesThatAreActiveDescendantToThisNode(){return this.getNodesThatAreActiveDescendantToThisNode()},setAccessibleOrder:function(t){if(this._accessibleOrder!==t){var i=this._accessibleOrder;this._accessibleOrder=null===t?null:t.slice(),e.accessibleOrderChange(this,i,t),this.trigger0("accessibleOrder")}},set accessibleOrder(t){this.setAccessibleOrder(t)},getAccessibleOrder:function(){return this._accessibleOrder},get accessibleOrder(){return this.getAccessibleOrder()},hasAccessibleOrder:function(){return null!==this._accessibleOrder&&0!==this._accessibleOrder.length&&(this._accessibleOrder.length>1||null!==this._accessibleOrder[0])},getAccessibleParent:function(){return this._accessibleParent},get accessibleParent(){return this.getAccessibleParent()},getEffectiveChildren:function(){for(var t=[],e=0;e<this._children.length;e++){var i=this._children[e];i._accessibleParent||t.push(i)}if(this.hasAccessibleOrder()){var n=this.accessibleOrder.slice(),s=n.indexOf(null);return s>=0?(t.unshift(s,1),Array.prototype.splice.apply(n,t)):Array.prototype.push.apply(n,t),n}return t},setAccessibleVisible:function(t){this._accessibleVisible!==t&&(this._accessibleVisible=t,this._accessibleDisplaysInfo.onAccessibleVisibilityChange(t))},set accessibleVisible(t){this.setAccessibleVisible(t)},getAccessibleVisible:function(){return this._accessibleVisible},get accessibleVisible(){return this.getAccessibleVisible()},setInputValue:function(t){if((t=""+t)!==this._inputValue){this._inputValue=t;for(var e=0;e<this.accessibleInstances.length;e++){this.accessibleInstances[e].peer.onInputValueChange()}}},set inputValue(t){this.setInputValue(t)},getInputValue:function(){return this._inputValue},get inputValue(){return this.getInputValue()},setAccessibleChecked:function(t){this._tagName,this._inputType,this._accessibleChecked!==t&&(this._accessibleChecked=t,this.setAccessibleAttribute("checked",t,{asProperty:!0}))},set accessibleChecked(t){this.setAccessibleChecked(t)},getAccessibleChecked:function(){return this._accessibleChecked},get accessibleChecked(){return this.getAccessibleChecked()},getAccessibleAttributes:function(){return this._accessibleAttributes.slice(0)},get accessibleAttributes(){return this.getAccessibleAttributes()},setAccessibleAttribute:function(t,e,i){i=_.extend({namespace:null,asProperty:!1,elementName:s.PRIMARY_SIBLING},i);for(var n=0;n<this._accessibleAttributes.length;n++){var r=this._accessibleAttributes[n];r.attribute===t&&r.options.namespace===i.namespace&&r.options.asProperty===i.asProperty&&r.options.elementName===i.elementName&&this._accessibleAttributes.splice(n,1)}this._accessibleAttributes.push({attribute:t,value:e,options:i});for(var a=0;a<this._accessibleInstances.length;a++){this._accessibleInstances[a].peer.setAttributeToElement(t,e,i)}},removeAccessibleAttribute:function(t,e){e=_.extend({namespace:null,elementName:s.PRIMARY_SIBLING},e);for(var i=0;i<this._accessibleAttributes.length;i++)this._accessibleAttributes[i].attribute===t&&this._accessibleAttributes[i].options.namespace===e.namespace&&this._accessibleAttributes[i].options.elementName===e.elementName&&(this._accessibleAttributes.splice(i,1),!0);for(var n=0;n<this._accessibleInstances.length;n++){this._accessibleInstances[n].peer.removeAttributeFromElement(t,e)}},removeAccessibleAttributes:function(){for(var t=this.getAccessibleAttributes(),e=0;e<t.length;e++){var i=t[e].attribute;this.removeAccessibleAttribute(i)}},hasAccessibleAttribute:function(t,e){e=_.extend({namespace:null,elementName:s.PRIMARY_SIBLING},e);for(var i=!1,n=0;n<this._accessibleAttributes.length;n++)this._accessibleAttributes[n].attribute===t&&this._accessibleAttributes[n].options.namespace===e.namespace&&this._accessibleAttributes[n].options.elementName===e.elementName&&(i=!0);return i},setFocusable:function(t){if(this._focusableOverride!==t){this._focusableOverride=t;for(var e=0;e<this._accessibleInstances.length;e++)this._accessibleInstances[e].peer.setFocusable(this.focusable)}},set focusable(t){this.setFocusable(t)},isFocusable:function(){return null!==this._focusableOverride?this._focusableOverride:null!==this._tagName&&i.tagIsDefaultFocusable(this._tagName)},get focusable(){return this.isFocusable()},getBaseOptions:function(){for(var t={},e=0;e<p.length;e++){var i=p[e];t[i]=this[i]}return t},getNestedAccessibleOrder:function(){function t(n,r){var a=0;if(_.each(i,function(t){n===t&&a++}),!(a>1||1===a&&!r)){if(n.accessibleContent){var o={trail:e.copy(),children:[]};s[s.length-1].push(o),s.push(o.children)}var h=null===n._accessibleOrder?[]:n._accessibleOrder;i=i.concat(h),_.each(h,function(i){_.each(n.getLeafTrailsTo(i),function(n){n.removeAncestor(),e.addDescendantTrail(n),t(i,!0),e.removeDescendantTrail(n)})});for(var l=n._children.length,u=0;u<l;u++){var c=n._children[u];e.addDescendant(c,u),t(c,!1),e.removeDescendant()}_.each(h,function(){i.pop()}),n.accessibleContent&&s.pop()}}var e=new h.Trail(this),i=[],n=[],s=[n];return t(this,!1),n},onAccessibleContentChange:function(){e.accessibleContentChange(this),this._accessibleHeading&&this.computeHeadingLevel(),this.trigger0("accessibleContent")},hasAccessibleContent:function(){return!!this._tagName},get accessibleContent(){return this.hasAccessibleContent()},onAccessibleAddChild:function(t){this._accessibleDisplaysInfo.onAddChild(t),e.addChild(this,t)},onAccessibleRemoveChild:function(t){this._accessibleDisplaysInfo.onRemoveChild(t),e.removeChild(this,t),t.updateOtherNodesAriaLabelledby(),t.updateOtherNodesAriaDescribedby(),t.updateOtherNodesActiveDescendant()},onAccessibleReorderedChildren:function(){e.childrenOrderChange(this)},getAccessibleInstances:function(){return this._accessibleInstances},get accessibleInstances(){return this.getAccessibleInstances()},addAccessibleInstance:function(t){this._accessibleInstances.push(t)},removeAccessibleInstance:function(t){var e=_.indexOf(this._accessibleInstances,t);this._accessibleInstances.splice(e,1)}})}};return h.register("Accessibility",g),g}),i("SCENERY/input/Pointer",["require","AXON/BooleanProperty","PHET_CORE/inherit","SCENERY/scenery","DOT/Vector2"],function(t){"use strict";function e(t,e,n){this.point=t,this.type=n,this.trail=null,this.isDownProperty=new i(e),this.attachedProperty=new i(!1),this._listeners=[],this._attachedListener=null,this._cursor=null,this.lastDOMEvent=null}var i=t("AXON/BooleanProperty"),n=t("PHET_CORE/inherit"),s=t("SCENERY/scenery");t("DOT/Vector2");return s.register("Pointer",e),n(Object,e,{setCursor:function(t){return this._cursor=t,this},set cursor(t){return this.setCursor(t)},getCursor:function(){return this._cursor},get cursor(){return this.getCursor()},getListeners:function(){return this._listeners.slice()},get listeners(){return this.getListeners()},addInputListener:function(t,e){this._listeners.push(t),e&&this.attach(t)},removeInputListener:function(t){var e=_.indexOf(this._listeners,t);this.isAttached()&&t===this._attachedListener&&this.detach(t),this._listeners.splice(e,1)},isAttached:function(){return this.attachedProperty.value},set isDown(t){this.isDownProperty.value=t},get isDown(){return this.isDownProperty.value},interruptAttached:function(){this.isAttached()&&this._attachedListener.interrupt()},interruptAll:function(){for(var t=this._listeners.slice(),e=0;e<t.length;e++){var i=t[e];i.interrupt&&i.interrupt()}},attach:function(t){this.attachedProperty.value=!0,this._attachedListener=t},detach:function(t){this.attachedProperty.value=!1,this._attachedListener=null},hasPointChanged:function(t){return!(this.point===t||t&&this.point&&this.point.equals(t))},dispose:function(){}}),e}),i("SCENERY/input/Mouse",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/input/Pointer","DOT/Vector3"],function(t){"use strict";function e(){s.call(this,null,!1,"mouse"),this.leftDown=!1,this.middleDown=!1,this.rightDown=!1,this.wheelDelta=new r(0,0,0),this.wheelDeltaMode=0}var i=t("PHET_CORE/inherit"),n=t("SCENERY/scenery"),s=t("SCENERY/input/Pointer"),r=t("DOT/Vector3");return n.register("Mouse",e),i(s,e,{down:function(t,e){var i=this.hasPointChanged(t);switch(t&&!1&&(!1).InputEvent&&(!1).InputEvent("mouse down at "+t.toString()),this.point=t,this.isDown=!0,e.button){case 0:this.leftDown=!0;break;case 1:this.middleDown=!0;break;case 2:this.rightDown=!0}return i},up:function(t,e){var i=this.hasPointChanged(t);switch(t&&!1&&(!1).InputEvent&&(!1).InputEvent("mouse up at "+t.toString()),this.point=t,this.isDown=!1,e.button){case 0:this.leftDown=!1;break;case 1:this.middleDown=!1;break;case 2:this.rightDown=!1}return i},move:function(t,e){var i=this.hasPointChanged(t);return t&&!1&&(!1).InputEvent&&(!1).InputEvent("mouse move at "+t.toString()),this.point=t,i},over:function(t,e){var i=this.hasPointChanged(t);return t&&!1&&(!1).InputEvent&&(!1).InputEvent("mouse over at "+t.toString()),this.point=t,i},out:function(t,e){var i=this.hasPointChanged(t);return t&&!1&&(!1).InputEvent&&(!1).InputEvent("mouse out at "+t.toString()),this.point=null,i},wheel:function(t){this.wheelDelta.setXYZ(t.deltaX,t.deltaY,t.deltaZ),this.wheelDeltaMode=t.deltaMode},toString:function(){return"Mouse"}}),e}),i("SCENERY/input/Pen",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/input/Pointer"],function(t){"use strict";function e(t,e,i){s.call(this,e,!0,"pen"),this.id=t}var i=t("PHET_CORE/inherit"),n=t("SCENERY/scenery"),s=t("SCENERY/input/Pointer");return n.register("Pen",e),i(s,e,{move:function(t,e){var i=this.hasPointChanged(t);return this.point=t,i},end:function(t,e){var i=this.hasPointChanged(t);return this.point=t,this.isDown=!1,i},cancel:function(t,e){var i=this.hasPointChanged(t);return this.point=t,this.isDown=!1,i},toString:function(){return"Pen#"+this.id}}),e}),i("SCENERY/util/Picker",["require","DOT/Bounds2","PHET_CORE/inherit","SCENERY/scenery","DOT/Vector2"],function(t){"use strict";function e(t){this.node=t,this.selfPruned=!1,this.selfInclusive=!1,this.subtreePrunable=!0,this.subtreePickableCount=0,this.mouseInclusiveBounds=i.NOTHING.copy(),this.mouseExclusiveBounds=i.NOTHING.copy(),this.touchInclusiveBounds=i.NOTHING.copy(),this.touchExclusiveBounds=i.NOTHING.copy(),this.mouseInclusiveDirty=!0,this.mouseExclusiveDirty=!0,this.touchInclusiveDirty=!0,this.touchExclusiveDirty=!0,this.scratchVector=new r(0,0)}var i=t("DOT/Bounds2"),n=t("PHET_CORE/inherit"),s=t("SCENERY/scenery"),r=t("DOT/Vector2");return s.register("Picker",e),n(Object,e,{hitTest:function(t,e,i){var n=this.selfInclusive;return e?n?this.validateMouseInclusive():this.validateMouseExclusive():i?n?this.validateTouchInclusive():this.validateTouchExclusive():this.node.validateBounds(),this.recursiveHitTest(t,e,i,!1)},recursiveHitTest:function(t,e,i,n){if(n=n||this.selfInclusive,this.selfPruned||!n&&this.subtreePrunable)return null;if(!(e?n?this.mouseInclusiveBounds:this.mouseExclusiveBounds:i?n?this.touchInclusiveBounds:this.touchExclusiveBounds:this.node._bounds).containsPoint(t))return null;var r=this.node._transform.getInverse().multiplyVector2(this.scratchVector.set(t));if(this.node.hasClipArea()&&!this.node._clipArea.containsPoint(r))return null;for(var a=this.node._children.length-1;a>=0;a--){var o=this.node._children[a]._picker.recursiveHitTest(r,e,i,n);if(o)return o.addAncestor(this.node,a)}return e&&this.node._mouseArea?this.node._mouseArea.containsPoint(r)?new s.Trail(this.node):null:i&&this.node._touchArea?this.node._touchArea.containsPoint(r)?new s.Trail(this.node):null:this.node.selfBounds.containsPoint(r)&&this.node.containsPointSelf(r)?new s.Trail(this.node):null},invalidate:function(t,e){var i=!!e||!this.mouseInclusiveDirty||!this.touchInclusiveDirty;if(this.mouseInclusiveDirty=!0,this.touchInclusiveDirty=!0,t&&(i=i||!this.mouseExclusiveDirty||!this.touchExclusiveDirty,this.mouseExclusiveDirty=!0,this.touchExclusiveDirty=!0),!this.selfPruned&&i)for(var n=this.node._parents,s=0;s<n.length;s++)n[s]._picker.invalidate(t||this.selfInclusive,!1)},validateMouseInclusive:function(){if(this.mouseInclusiveDirty){this.mouseInclusiveBounds.set(this.node.selfBounds);for(var t=this.node._children,e=0;e<t.length;e++){var i=t[e]._picker;i.selfPruned||(i.validateMouseInclusive(),this.mouseInclusiveBounds.includeBounds(i.mouseInclusiveBounds))}this.applyAreasAndTransform(this.mouseInclusiveBounds,this.node._mouseArea),this.mouseInclusiveDirty=!1}},validateMouseExclusive:function(){if(this.mouseExclusiveDirty){this.mouseExclusiveBounds.set(this.node.selfBounds);for(var t=this.node._children,e=0;e<t.length;e++){var i=t[e]._picker;i.subtreePrunable||(i.selfInclusive?(i.validateMouseInclusive(),this.mouseExclusiveBounds.includeBounds(i.mouseInclusiveBounds)):(i.validateMouseExclusive(),this.mouseExclusiveBounds.includeBounds(i.mouseExclusiveBounds)))}this.applyAreasAndTransform(this.mouseExclusiveBounds,this.node._mouseArea),this.mouseExclusiveDirty=!1}},validateTouchInclusive:function(){if(this.touchInclusiveDirty){this.touchInclusiveBounds.set(this.node.selfBounds);for(var t=this.node._children,e=0;e<t.length;e++){var i=t[e]._picker;i.selfPruned||(i.validateTouchInclusive(),this.touchInclusiveBounds.includeBounds(i.touchInclusiveBounds))}this.applyAreasAndTransform(this.touchInclusiveBounds,this.node._touchArea),this.touchInclusiveDirty=!1}},validateTouchExclusive:function(){if(this.touchExclusiveDirty){this.touchExclusiveBounds.set(this.node.selfBounds);for(var t=this.node._children,e=0;e<t.length;e++){var i=t[e]._picker;i.subtreePrunable||(i.selfInclusive?(i.validateTouchInclusive(),this.touchExclusiveBounds.includeBounds(i.touchInclusiveBounds)):(i.validateTouchExclusive(),this.touchExclusiveBounds.includeBounds(i.touchExclusiveBounds)))}this.applyAreasAndTransform(this.touchExclusiveBounds,this.node._touchArea),this.touchExclusiveDirty=!1}},applyAreasAndTransform:function(t,e){if(e&&t.includeBounds(e.isBounds?e:e.bounds),this.node.hasClipArea()){var i=this.node._clipArea.bounds;t.minX=Math.max(t.minX,i.minX),t.minY=Math.max(t.minY,i.minY),t.maxX=Math.min(t.maxX,i.maxX),t.maxY=Math.min(t.maxY,i.maxY)}this.node.transformBoundsFromLocalToParent(t)},onInsertChild:function(t){if(!t._picker.selfPruned){var e=t._picker.subtreePickableCount>0;e&&this.changePickableCount(1),this.invalidate(e,!0)}},onRemoveChild:function(t){if(!t._picker.selfPruned){var e=t._picker.subtreePickableCount>0;e&&this.changePickableCount(-1),this.invalidate(e,!0)}},onAddInputListener:function(){this.checkSelfInclusive(),this.checkSubtreePrunable(),this.changePickableCount(1)},onRemoveInputListener:function(){this.checkSelfInclusive(),this.checkSubtreePrunable(),this.changePickableCount(-1)},onPickableChange:function(t,e){this.checkSelfPruned(),this.checkSelfInclusive(),this.checkSubtreePrunable();var i=(!0===t?-1:0)+(!0===e?1:0);i&&this.changePickableCount(i)},onVisibilityChange:function(){this.checkSelfPruned(),this.checkSubtreePrunable()},onMouseAreaChange:function(){this.invalidate(!0)},onTouchAreaChange:function(){this.invalidate(!0)},onTransformChange:function(){this.invalidate(!0)},onSelfBoundsDirty:function(){this.invalidate(!0)},onClipAreaChange:function(){this.invalidate(!0)},checkSelfPruned:function(){var t=!1===this.node._pickable||!this.node.isVisible();if(this.selfPruned!==t){this.selfPruned=t;for(var e=this.node._parents,i=0;i<e.length;i++){var n=e[i]._picker;this.subtreePickableCount>0?(n.invalidate(!0,!0),n.changePickableCount(this.selfPruned?-1:1)):n.invalidate(!1,!0)}}},checkSelfInclusive:function(){var t=!0===this.node._pickable||this.node._inputListeners.length>0;this.selfInclusive!==t&&(this.selfInclusive=t,this.invalidate(!0,!0))},checkSubtreePrunable:function(){var t=!1===this.node._pickable||!this.node.isVisible()||!0!==this.node._pickable&&0===this.subtreePickableCount;this.subtreePrunable!==t&&(this.subtreePrunable=t,this.invalidate(!0,!0))},changePickableCount:function(t){if(0!==t){var e=0===this.subtreePickableCount;this.subtreePickableCount+=t;var i=0===this.subtreePickableCount;if(this.checkSubtreePrunable(),!this.selfPruned&&e!==i)for(var n=this.node._parents.length,s=0;s<n;s++)this.node._parents[s]._picker.changePickableCount(e?1:-1)}},audit:function(){}}),e}),i("SCENERY/util/RendererSummary",["require","PHET_CORE/inherit","SCENERY/display/Renderer","SCENERY/scenery"],function(t){"use strict";function e(t){this.node=t,this._counts={};for(var i=0;i<a;i++)this._counts[r[i]]=0;this.bitmask=o,this.selfBitmask=e.summaryBitmaskForNodeSelf(t),this.summaryChange(this.bitmask,this.selfBitmask);var n=this.selfChange.bind(this);this.node.onStatic("opacity",n),this.node.onStatic("hint",n),this.node.onStatic("clip",n),this.node.onStatic("selfBoundsValid",n),this.node.onStatic("accessibleContent",n),this.node.onStatic("accessibleOrder",n)}for(var i=t("PHET_CORE/inherit"),n=t("SCENERY/display/Renderer"),s=t("SCENERY/scenery"),r=[n.bitmaskCanvas,n.bitmaskSVG,n.bitmaskDOM,n.bitmaskWebGL,n.bitmaskSingleCanvas,n.bitmaskSingleSVG,n.bitmaskNotPainted,n.bitmaskBoundsValid,n.bitmaskNotAccessible,n.bitmaskLacksCanvas,n.bitmaskLacksSVG,n.bitmaskLacksDOM,n.bitmaskLacksWebGL],a=r.length,o=0,h=0;h<a;h++)o|=r[h];return s.register("RendererSummary",e),i(Object,e,{summaryChange:function(t,e){for(var i=t^e,n=0,s=0,o=0;o<a;o++){var h=r[o];h&i&&(h&e?(this._counts[h]--,0===this._counts[h]&&(s|=h)):(this._counts[h]++,1===this._counts[h]&&(n|=h)))}if(n||s){for(var l=this.bitmask,u=0;u<a;u++){var c=r[u];s&c&&(this.bitmask|=c),n&c&&(this.bitmask^=c)}this.node.trigger0("rendererSummary"),this.node.onSummaryChange(l,this.bitmask);for(var d=this.node._parents.length,f=0;f<d;f++)this.node._parents[f]._rendererSummary.summaryChange(n,s)}},selfChange:function(){var t=this.selfBitmask,i=e.summaryBitmaskForNodeSelf(this.node);t!==i&&(this.summaryChange(t,i),this.selfBitmask=i)},computeBitmask:function(){for(var t=0,e=0;e<a;e++)0===this._counts[r[e]]&&(t|=r[e]);return t},isSubtreeFullyCompatible:function(t){return!!(t&this.bitmask)},isSubtreeContainingCompatible:function(t){return!(t<<n.bitmaskLacksShift&this.bitmask)},isSingleCanvasSupported:function(){return!!(n.bitmaskSingleCanvas&this.bitmask)},isSingleSVGSupported:function(){return!!(n.bitmaskSingleSVG&this.bitmask)},isNotPainted:function(){return!!(n.bitmaskNotPainted&this.bitmask)},isNotAccessible:function(){return!!(n.bitmaskNotAccessible&this.bitmask)},areBoundsValid:function(){return!!(n.bitmaskBoundsValid&this.bitmask)},isSubtreeRenderedExclusivelySVG:function(t){if(!this.isSingleSVGSupported())return!1;for(var e=0;e<n.numActiveRenderers;e++){var i=n.bitmaskOrder(t,e);if(n.bitmaskSVG&i)return!0;if(this.isSubtreeContainingCompatible(i))return!1}return!1},isSubtreeRenderedExclusivelyCanvas:function(t){if(!this.isSingleCanvasSupported())return!1;for(var e=0;e<n.numActiveRenderers;e++){var i=n.bitmaskOrder(t,e);if(n.bitmaskCanvas&i)return!0;if(this.isSubtreeContainingCompatible(i))return!1}return!1},audit:function(){},toString:function(){for(var t=e.bitmaskToString(this.bitmask),i=0;i<a;i++){var n=r[i],s=this._counts[n];0!==s&&(t+=" "+e.bitToString(n)+":"+s)}return t}},{bitmaskAll:o,summaryBitmaskForNodeSelf:function(t){var e=t._rendererBitmask;t.isPainted()?e|=(t._rendererBitmask&n.bitmaskCurrentRendererArea^n.bitmaskCurrentRendererArea)<<n.bitmaskLacksShift:e|=n.bitmaskCurrentRendererArea<<n.bitmaskLacksShift;var i=t._hints.requireElement||t._hints.cssTransform||t._hints.layerSplit,s=t._hints.renderer;return i||!n.isSVG(t._rendererBitmask)||s&&!n.isSVG(s)||(e|=n.bitmaskSingleSVG),i||!n.isCanvas(t._rendererBitmask)||s&&!n.isCanvas(s)||(e|=n.bitmaskSingleCanvas),t.isPainted()||(e|=n.bitmaskNotPainted),t.areSelfBoundsValid()&&(e|=n.bitmaskBoundsValid),t.accessibleContent||t.hasAccessibleOrder()||(e|=n.bitmaskNotAccessible),e},bitToString:function(t){return t===n.bitmaskCanvas?"Canvas":t===n.bitmaskSVG?"SVG":t===n.bitmaskDOM?"DOM":t===n.bitmaskWebGL?"WebGL":t===n.bitmaskLacksCanvas?"(-Canvas)":t===n.bitmaskLacksSVG?"(-SVG)":t===n.bitmaskLacksDOM?"(-DOM)":t===n.bitmaskLacksWebGL?"(-WebGL)":t===n.bitmaskSingleCanvas?"SingleCanvas":t===n.bitmaskSingleSVG?"SingleSVG":t===n.bitmaskNotPainted?"NotPainted":t===n.bitmaskBoundsValid?"BoundsValid":t===n.bitmaskNotAccessible?"NotAccessible":"?"},bitmaskToString:function(t){for(var i="",n=0;n<a;n++){var s=r[n];t&s&&(i+=e.bitToString(s)+" ")}return i}}),e}),i("SCENERY/input/Touch",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/input/Pointer"],function(t){"use strict";function e(t,e,i){s.call(this,e,!0,"touch"),this.id=t}var i=t("PHET_CORE/inherit"),n=t("SCENERY/scenery"),s=t("SCENERY/input/Pointer");return n.register("Touch",e),i(s,e,{move:function(t,e){var i=this.hasPointChanged(t);return this.point=t,i},end:function(t,e){var i=this.hasPointChanged(t);return this.point=t,this.isDown=!1,i},cancel:function(t,e){var i=this.hasPointChanged(t);return this.point=t,this.isDown=!1,i},toString:function(){return"Touch#"+this.id}}),e}),i("SCENERY/util/CanvasContextWrapper",["require","PHET_CORE/inherit","AXON/Property","SCENERY/scenery"],function(t){"use strict";function e(t,e){this.canvas=t,this.context=e,this.resetStyles()}var i=t("PHET_CORE/inherit"),n=t("AXON/Property");return t("SCENERY/scenery").register("CanvasContextWrapper",e),i(Object,e,{resetStyles:function(){this.fillStyle=void 0,this.strokeStyle=void 0,this.lineWidth=void 0,this.lineCap=void 0,this.lineJoin=void 0,this.lineDash=void 0,this.lineDashOffset=void 0,this.miterLimit=void 0,this.font=void 0,this.direction=void 0},setDimensions:function(t,e){this.canvas.width=t,this.canvas.height=e,this.resetStyles()},setFillStyle:function(t){t&&t instanceof n&&(t=t.value),t&&t.getCanvasStyle&&(t=t.getCanvasStyle()),this.fillStyle!==t&&(this.fillStyle=t,this.context.fillStyle=t)},setStrokeStyle:function(t){t&&t instanceof n&&(t=t.value),t&&t.getCanvasStyle&&(t=t.getCanvasStyle()),this.strokeStyle!==t&&(this.strokeStyle=t,this.context.strokeStyle=t)},setLineWidth:function(t){this.lineWidth!==t&&(this.lineWidth=t,this.context.lineWidth=t)},setLineCap:function(t){this.lineCap!==t&&(this.lineCap=t,this.context.lineCap=t)},setLineJoin:function(t){this.lineJoin!==t&&(this.lineJoin=t,this.context.lineJoin=t)},setMiterLimit:function(t){this.miterLimit!==t&&(this.miterLimit=t,this.context.miterLimit=t)},setLineDash:function(t){this.lineDash!==t&&(this.lineDash=t,this.context.setLineDash?this.context.setLineDash(null===t?[]:t):void 0!==this.context.mozDash?this.context.mozDash=t:void 0!==this.context.webkitLineDash&&(this.context.webkitLineDash=t||[]))},setLineDashOffset:function(t){this.lineDashOffset!==t&&(this.lineDashOffset=t,void 0!==this.context.lineDashOffset?this.context.lineDashOffset=t:void 0!==this.context.webkitLineDashOffset&&(this.context.webkitLineDashOffset=t))},setFont:function(t){this.font!==t&&(this.font=t,this.context.font=t)},setDirection:function(t){this.direction!==t&&(this.direction=t,this.context.direction=t)}}),e}),i("SCENERY/util/NodeProperty",["require","AXON/Property","SCENERY/scenery"],function(t){"use strict";var e=t("AXON/Property"),i=t("SCENERY/scenery"),n=function(t){function i(t,e,n,s){_classCallCheck(this,i);var r=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t[n],s));return r.node=t,r.trigger=e,r.attribute=n,r.changeListener=function(){return r.set(t[n])},t.onStatic(e,r.changeListener),r}return _inherits(i,e),_createClass(i,[{key:"dispose",value:function(){this.node.offStatic(this.trigger,this.changeListener),_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"dispose",this).call(this),this.node=null}},{key:"setValueAndNotifyListeners",value:function(t){this.node[this.attribute]=t,_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"setValueAndNotifyListeners",this).call(this,t)}}]),i}();return i.register("NodeProperty",n)}),i("TANDEM/types/NullableIO",["require","AXON/ValidatorDef","TANDEM/types/ObjectIO","TANDEM/phetioInherit","TANDEM/tandemNamespace"],function(t){"use strict";function e(t){return s(n,"NullableIO",function(t,e){n.call(this,t,e)},{},{parameterTypes:[t],documentation:"A wrapper to wrap another IOType, adding support for null.",validator:{isValidValue:function(e){return null===e||i.isValueValid(e,t.validator)}},toStateObject:function(e){return null===e?null:t.toStateObject(e)},fromStateObject:function(e){return null===e?null:t.fromStateObject(e)}})}var i=t("AXON/ValidatorDef"),n=t("TANDEM/types/ObjectIO"),s=t("TANDEM/phetioInherit");return t("TANDEM/tandemNamespace").register("NullableIO",e),e}),i("SCENERY/nodes/NodeIO",["require","TANDEM/types/BooleanIO","SCENERY/util/NodeProperty","TANDEM/types/NullableIO","AXON/NumberProperty","TANDEM/types/ObjectIO","TANDEM/phetioInherit","AXON/PropertyIO","DOT/Range","SCENERY/scenery"],function(t){"use strict";function e(t,e){a.call(this,t,e);var o=new n(t,"visibility","visible",_.extend({phetioReadOnly:t.phetioReadOnly,phetioState:t.phetioState,phetioType:h(i),tandem:t.tandem.createTandem("visibleProperty"),phetioDocumentation:"Controls whether the Node will be visible (and interactive), see the NodeIO documentation for more details."},t.phetioComponentOptions.visibleProperty)),u=new n(t,"pickability","pickable",_.extend({phetioReadOnly:t.phetioReadOnly,phetioState:t.phetioState,tandem:t.tandem.createTandem("pickableProperty"),phetioType:h(s(i)),phetioDocumentation:"Sets whether the node will be pickable (and hence interactive), see the NodeIO documentation for more details"},t.phetioComponentOptions.pickableProperty)),c=new r(t.opacity,_.extend({phetioReadOnly:t.phetioReadOnly,phetioState:t.phetioState,tandem:t.tandem.createTandem("opacityProperty"),range:new l(0,1),phetioDocumentation:"Opacity of the parent NodeIO, between 0 (invisible) and 1 (fully visible)"},t.phetioComponentOptions.opacityProperty));c.link(function(e){t.opacity=e}),t.on("opacity",function(){c.value=t.opacity}),this.disposeNodeIO=function(){o.dispose(),u.dispose(),c.dispose()}}var i=t("TANDEM/types/BooleanIO"),n=t("SCENERY/util/NodeProperty"),s=t("TANDEM/types/NullableIO"),r=t("AXON/NumberProperty"),a=t("TANDEM/types/ObjectIO"),o=t("TANDEM/phetioInherit"),h=t("AXON/PropertyIO"),l=t("DOT/Range"),u=t("SCENERY/scenery");return o(a,"NodeIO",e,{dispose:function(){this.disposeNodeIO()}},{toStateObject:function(){},fromStateObject:function(t){return t},validator:{valueType:u.Node},documentation:'The base type for graphical and potentially interactive objects.  NodeIO has nested PropertyIO values for visibility, pickability and opacity.<br><br>Pickable can take one of three values:<br><ul><li>null: pass-through behavior. Nodes with input listeners are pickable, but nodes without input listeners won\'t block events for nodes behind it.</li><li>false: The node cannot be interacted with, and it blocks events for nodes behind it.</li><li>true: The node can be interacted with (if it has an input listener).</li></ul>For more about Scenery node pickability, please see <a href="http://phetsims.github.io/scenery/doc/implementation-notes#pickability">http://phetsims.github.io/scenery/doc/implementation-notes#pickability</a>'}),u.register("NodeIO",e),e}),i("SCENERY/nodes/Node",["require","SCENERY/accessibility/Accessibility","PHET_CORE/arrayDifference","DOT/Bounds2","AXON/Events","PHET_CORE/extend","PHET_CORE/inherit","DOT/Matrix3","SCENERY/input/Mouse","SCENERY/input/Pen","TANDEM/PhetioObject","SCENERY/util/Picker","SCENERY/display/Renderer","SCENERY/util/RendererSummary","SCENERY/scenery","KITE/Shape","SCENERY/input/Touch","DOT/Transform3","DOT/Util","DOT/Vector2","SCENERY/util/CanvasContextWrapper","SCENERY/nodes/NodeIO"],function(t){"use strict";function e(t){r.call(this),this._id=T++,this._instances=[],this._rootedDisplays=[],this._drawables=[],this._visible=R.visible,this._opacity=R.opacity,this._pickable=R.pickable,this._inputEnabled=R.inputEnabled,this._clipArea=R.clipArea,this._mouseArea=R.mouseArea,this._touchArea=R.touchArea,this._cursor=R.cursor,this._children=[],this._parents=[],this._transformBounds=R.transformBounds,this._transform=new v,this._transformListener=this.onTransformChange.bind(this),this._transform.onStatic("change",this._transformListener),this._maxWidth=R.maxWidth,this._maxHeight=R.maxHeight,this._appliedScaleFactor=1,this._inputListeners=[],this._bounds=s.NOTHING.copy(),this._localBounds=s.NOTHING.copy(),this._selfBounds=s.NOTHING.copy(),this._childBounds=s.NOTHING.copy(),this._localBoundsOverridden=!1,this._boundsDirty=!0,this._localBoundsDirty=!0,this._selfBoundsDirty=!0,this._childBoundsDirty=!0,this._hints={renderer:null===R.renderer?0:f.fromName(R.renderer),usesOpacity:R.usesOpacity,layerSplit:R.layerSplit,cssTransform:R.cssTransform,fullResolution:!1,excludeInvisible:R.excludeInvisible,webglScale:R.webglScale,preventFit:R.preventFit},this.initializeAccessibility(),this._rendererBitmask=f.bitmaskNodeDefault,this._rendererSummary=new m(this),this._boundsEventCount=0,this._boundsEventSelfCount=0,this._picker=new d(this),this._isGettingRemovedFromParent=!1,c.call(this),t&&this.mutate(t)}var i=t("SCENERY/accessibility/Accessibility"),n=t("PHET_CORE/arrayDifference"),s=t("DOT/Bounds2"),r=t("AXON/Events"),a=t("PHET_CORE/extend"),o=t("PHET_CORE/inherit"),h=t("DOT/Matrix3"),l=t("SCENERY/input/Mouse"),u=t("SCENERY/input/Pen"),c=t("TANDEM/PhetioObject"),d=t("SCENERY/util/Picker"),f=t("SCENERY/display/Renderer"),m=t("SCENERY/util/RendererSummary"),p=t("SCENERY/scenery"),g=(t("KITE/Shape"),t("SCENERY/input/Touch")),v=t("DOT/Transform3"),y=t("DOT/Util"),E=t("DOT/Vector2");t("SCENERY/util/CanvasContextWrapper");var b=t("SCENERY/nodes/NodeIO"),S=y.clamp,T=1,C={childBounds:!0,localBounds:!0,bounds:!0},x=s.NOTHING.copy(),w=new h,R={visible:!0,opacity:1,pickable:null,inputEnabled:!0,clipArea:null,mouseArea:null,touchArea:null,cursor:null,transformBounds:!1,maxWidth:null,maxHeight:null,renderer:null,usesOpacity:!1,layerSplit:!1,cssTransform:!1,excludeInvisible:!1,webglScale:null,preventFit:!1};return p.register("Node",e),o(c,e,a({_mutatorKeys:["children","cursor","visible","pickable","inputEnabled","inputListeners","opacity","matrix","translation","x","y","rotation","scale","localBounds","maxWidth","maxHeight","leftTop","centerTop","rightTop","leftCenter","center","rightCenter","leftBottom","centerBottom","rightBottom","left","right","top","bottom","centerX","centerY","renderer","layerSplit","usesOpacity","cssTransform","excludeInvisible","webglScale","preventFit","mouseArea","touchArea","clipArea","transformBounds"],drawableMarkFlags:[],insertChild:function(t,e,i){return this._picker.onInsertChild(e),this.changeBoundsEventCount(e._boundsEventCount>0?1:0),this._rendererSummary.summaryChange(m.bitmaskAll,e._rendererSummary.bitmask),e._parents.push(this),this._children.splice(t,0,e),e._rendererSummary.isNotAccessible()||this.onAccessibleAddChild(e),e.invalidateBounds(),this._boundsDirty=!0,this.trigger2("childInserted",e,t),!i&&this.trigger0("childrenChanged"),this},addChild:function(t,e){return this.insertChild(this._children.length,t,e),this},removeChild:function(t,e){var i=_.indexOf(this._children,t);return this.removeChildWithIndex(t,i,e),this},removeChildAt:function(t,e){var i=this._children[t];return this.removeChildWithIndex(i,t,e),this},removeChildWithIndex:function(t,e,i){var n=_.indexOf(t._parents,this);t._isGettingRemovedFromParent=!0,t._rendererSummary.isNotAccessible()||this.onAccessibleRemoveChild(t),this._picker.onRemoveChild(t),this.changeBoundsEventCount(t._boundsEventCount>0?-1:0),this._rendererSummary.summaryChange(t._rendererSummary.bitmask,m.bitmaskAll),t._parents.splice(n,1),this._children.splice(e,1),t._isGettingRemovedFromParent=!1,this.invalidateBounds(),this._childBoundsDirty=!0,this.trigger2("childRemoved",t,e),!i&&this.trigger0("childrenChanged")},moveChildToIndex:function(t,e){var i=this.indexOfChild(t);return this._children[e]!==t&&(this._children.splice(i,1),this._children.splice(e,0,t),this._rendererSummary.isNotAccessible()||this.onAccessibleReorderedChildren(),this.trigger2("childrenReordered",Math.min(i,e),Math.max(i,e)),this.trigger0("childrenChanged")),this},removeAllChildren:function(){return this.setChildren([]),this},setChildren:function(t){var e,i=[],s=[],r=[];for(n(t,this._children,s,i,r),e=i.length-1;e>=0;e--)this.removeChild(i[e],!0);var a=-1,o=-1;for(e=0;e<r.length;e++){var h=r[e];this._children[e]!==h&&(this._children[e]=h,-1===a&&(a=e),o=e)}var l=-1!==a;if(l&&(this._rendererSummary.isNotAccessible()||this.onAccessibleReorderedChildren(),this.trigger2("childrenReordered",a,o)),s.length){var u=0,c=s[u];for(e=0;e<t.length;e++)t[e]===c&&(this.insertChild(e,c,!0),c=s[++u])}(0!==i.length||0!==s.length||l)&&this.trigger0("childrenChanged");return this},set children(t){this.setChildren(t)},getChildren:function(){return this._children.slice(0)},get children(){return this.getChildren()},getChildrenCount:function(){return this._children.length},getParents:function(){return this._parents.slice(0)},get parents(){return this.getParents()},getParent:function(){return this._parents.length?this._parents[0]:null},get parent(){return this.getParent()},getChildAt:function(t){return this._children[t]},indexOfParent:function(t){return _.indexOf(this._parents,t)},indexOfChild:function(t){return _.indexOf(this._children,t)},moveToFront:function(){var t=this;return _.each(this._parents.slice(),function(e){e.moveChildToFront(t)}),this},moveChildToFront:function(t){return this.moveChildToIndex(t,this._children.length-1)},moveToBack:function(){var t=this;return _.each(this._parents.slice(),function(e){e.moveChildToBack(t)}),this},moveChildToBack:function(t){return this.moveChildToIndex(t,0)},replaceChild:function(t,e){var i=this.indexOfChild(t),n=t.focused;return this.removeChild(t,!0),this.insertChild(i,e,!0),this.trigger0("childrenChanged"),n&&e.focusable&&e.focus(),this},detach:function(){var t=this;return _.each(this._parents.slice(0),function(e){e.removeChild(t)}),this},changeBoundsEventCount:function(t){if(0!==t){var e=0===this._boundsEventCount;this._boundsEventCount+=t;if(e!==(0===this._boundsEventCount))for(var i=e?1:-1,n=this._parents.length,s=0;s<n;s++)this._parents[s].changeBoundsEventCount(i)}},validateSelfBounds:function(){if(this._selfBoundsDirty){var t=this.updateSelfBounds();return this._selfBoundsDirty=!1,t&&this.trigger0("selfBounds"),!0}return!1},validateBounds:function(){var t,e=this.validateSelfBounds();if(this._childBoundsDirty){for(e=!0,t=this._children.length;t--;)this._children[t].validateBounds();var i=x.set(this._childBounds);for(this._childBounds.set(s.NOTHING),t=this._children.length;t--;)this._childBounds.includeBounds(this._children[t]._bounds);this._childBoundsDirty=!1,this._childBounds.equals(i)||this._childBounds.equalsEpsilon(i,1e-13)||this.trigger0("childBounds")}if(this._localBoundsDirty&&!this._localBoundsOverridden){e=!0,this._localBoundsDirty=!1;var n=x.set(this._localBounds);this._localBounds.set(this._selfBounds).includeBounds(this._childBounds),this.hasClipArea()&&this._localBounds.constrainBounds(this._clipArea.bounds),this._localBounds.equals(n)||(this._localBounds.equalsEpsilon(n,1e-13)||this.trigger0("localBounds"),this._boundsDirty=!0),null===this._maxWidth&&null===this._maxHeight||this.updateMaxDimension(this._localBounds)}if(this._boundsDirty){e=!0,this._boundsDirty=!1;var r=x.set(this._bounds);if(this._transformBounds&&!this._transform.getMatrix().isAxisAligned()){var a=w.set(this.getMatrix());this._bounds.set(s.NOTHING),this._includeTransformedSubtreeBounds(a,this._bounds),this.hasClipArea()&&this._bounds.constrainBounds(this._clipArea.getBoundsWithTransform(a))}else this._bounds.set(this._localBounds),this.transformBoundsFromLocalToParent(this._bounds);if(!this._bounds.equals(r)){for(t=this._parents.length;t--;)this._parents[t].invalidateBounds();this._bounds.equalsEpsilon(r,1e-13)||this.trigger0("bounds")}}return(this._childBoundsDirty||this._boundsDirty)&&this.validateBounds(),e},_includeTransformedSubtreeBounds:function(t,e){this.selfBounds.isEmpty()||e.includeBounds(this.getTransformedSelfBounds(t));for(var i=this._children.length,n=0;n<i;n++){var s=this._children[n];t.multiplyMatrix(s._transform.getMatrix()),s._includeTransformedSubtreeBounds(t,e),t.multiplyMatrix(s._transform.getInverse())}return e},validateWatchedBounds:function(){for(;this.watchedBoundsScan(););},watchedBoundsScan:function(){if(0!==this._boundsEventSelfCount)return this.validateBounds();if(this._boundsEventCount>0&&this._childBoundsDirty){for(var t=!1,e=this._children.length,i=0;i<e;i++)t=this._children[i].watchedBoundsScan()||t;return t}return!1},invalidateBounds:function(){this._boundsDirty=!0,this._localBoundsDirty=!0;for(var t=this._parents.length;t--;)this._parents[t].invalidateChildBounds()},invalidateChildBounds:function(){if(!this._childBoundsDirty){this._childBoundsDirty=!0,this._localBoundsDirty=!0;for(var t=this._parents.length;t--;)this._parents[t].invalidateChildBounds()}},invalidateSelf:function(t){t?(this._selfBoundsDirty=!1,this._selfBounds.equals(t)||(this.invalidateBounds(),this._picker.onSelfBoundsDirty(),this._selfBounds.set(t),this.trigger0("selfBounds"))):(this._selfBoundsDirty=!0,this.invalidateBounds(),this._picker.onSelfBoundsDirty())},updateSelfBounds:function(){return!1},hasChild:function(t){var e=_.includes(this._children,t);return e},getSelfBounds:function(){return this.validateSelfBounds(),this._selfBounds},get selfBounds(){return this.getSelfBounds()},getSafeSelfBounds:function(){return this.validateSelfBounds(),this._selfBounds},get safeSelfBounds(){return this.getSafeSelfBounds()},getChildBounds:function(){return this.validateBounds(),this._childBounds},get childBounds(){return this.getChildBounds()},getLocalBounds:function(){return this.validateBounds(),this._localBounds},get localBounds(){return this.getLocalBounds()},setLocalBounds:function(t){if(null===t)this._localBoundsOverridden&&(this._localBoundsOverridden=!1,this.trigger1("localBoundsOverride",!1),this.invalidateBounds());else{var e=!t.equals(this._localBounds)||!this._localBoundsOverridden;e&&this._localBounds.set(t),this._localBoundsOverridden||(this._localBoundsOverridden=!0,this.trigger1("localBoundsOverride",!0)),e&&this.invalidateBounds()}return this},set localBounds(t){return this.setLocalBounds(t)},getTransformedSelfBounds:function(t){return this.selfBounds.transformed(t)},getTransformedSafeSelfBounds:function(t){return this.safeSelfBounds.transformed(t)},getSafeTransformedVisibleBounds:function(t){var e=(t||h.IDENTITY).timesMatrix(this.matrix),i=s.NOTHING.copy();if(this._visible&&(this.selfBounds.isEmpty()||i.includeBounds(this.getTransformedSafeSelfBounds(e)),this._children.length))for(var n=0;n<this._children.length;n++)i.includeBounds(this._children[n].getSafeTransformedVisibleBounds(e));return i},get safeTransformedVisibleBounds(){return this.getSafeTransformedVisibleBounds()},setTransformBounds:function(t){return this._transformBounds!==t&&(this._transformBounds=t,this.invalidateBounds()),this},set transformBounds(t){return this.setTransformBounds(t)},getTransformBounds:function(){return this._transformBounds},get transformBounds(){return this.getTransformBounds()},getBounds:function(){return this.validateBounds(),this._bounds},get bounds(){return this.getBounds()},getVisibleLocalBounds:function(){for(var t=this.selfBounds.copy(),e=this._children.length;e--;){var i=this._children[e];i.isVisible()&&t.includeBounds(i.getVisibleBounds())}return t},get visibleLocalBounds(){return this.getVisibleLocalBounds()},getVisibleBounds:function(){return this.getVisibleLocalBounds().transform(this.getMatrix())},get visibleBounds(){return this.getVisibleBounds()},hitTest:function(t,e,i){return this._picker.hitTest(t,!!e,!!i)},trailUnderPointer:function(t){return this.hitTest(t.point,t instanceof l,t instanceof g||t instanceof u)},containsPoint:function(t){return null!==this.hitTest(t)},containsPointSelf:function(t){return this.selfBounds.containsPoint(t)},intersectsBoundsSelf:function(t){return this.selfBounds.intersectsBounds(t)},isPainted:function(){return!1},areSelfBoundsValid:function(){return!0},hasParent:function(){return 0!==this._parents.length},hasChildren:function(){return this._children.length>0},walkDepthFirst:function(t){t(this);for(var e=this._children.length,i=0;i<e;i++)this._children[i].walkDepthFirst(t)},getChildrenWithinBounds:function(t){for(var e=[],i=this._children.length,n=0;n<i;n++){var s=this._children[n];s._bounds.intersection(t).isEmpty()||e.push(s)}return e},addInputListener:function(t){return _.includes(this._inputListeners,t)||(this._inputListeners.push(t),this._picker.onAddInputListener()),this},removeInputListener:function(t){var e=_.indexOf(this._inputListeners,t);return e>=0&&(this._inputListeners.splice(e,1),this._picker.onRemoveInputListener()),this},hasInputListener:function(t){for(var e=0;e<this._inputListeners.length;e++)if(this._inputListeners[e]===t)return!0;return!1},interruptInput:function(){for(var t=this.inputListeners,e=0;e<t.length;e++){var i=t[e];i.interrupt&&i.interrupt()}return this},interruptSubtreeInput:function(){this.interruptInput();for(var t=this._children.slice(),e=0;e<t.length;e++)t[e].interruptSubtreeInput();return this},translate:function(t,e,i){if("number"==typeof t){if(!t&&!e)return;i?this.prependTranslation(t,e):this.appendMatrix(w.setToTranslation(t,e))}else{var n=t;if(!n.x&&!n.y)return;this.translate(n.x,n.y,e)}},scale:function(t,e,i){if("number"==typeof t)if(void 0===e||"boolean"==typeof e)this.scale(t,t,e);else{if(1===t&&1===e)return;i?this.prependMatrix(h.scaling(t,e)):this.appendMatrix(h.scaling(t,e))}else{var n=t;this.scale(n.x,n.y,e)}},rotate:function(t,e){t%(2*Math.PI)!=0&&(e?this.prependMatrix(h.rotation2(t)):this.appendMatrix(h.rotation2(t)))},rotateAround:function(t,e){var i=h.translation(-t.x,-t.y);return i=h.rotation2(e).timesMatrix(i),i=h.translation(t.x,t.y).timesMatrix(i),this.prependMatrix(i),this},setX:function(t){return this.translate(t-this.getX(),0,!0),this},set x(t){this.setX(t)},getX:function(){return this._transform.getMatrix().m02()},get x(){return this.getX()},setY:function(t){return this.translate(0,t-this.getY(),!0),this},set y(t){this.setY(t)},getY:function(){return this._transform.getMatrix().m12()},get y(){return this.getY()},setScaleMagnitude:function(t,e){var i=this.getScaleVector();return"number"==typeof t?(void 0===e&&(e=t),this.appendMatrix(h.scaling(t/i.x,e/i.y))):this.appendMatrix(h.scaling(t.x/i.x,t.y/i.y)),this},getScaleVector:function(){return this._transform.getMatrix().getScaleVector()},setRotation:function(t){return this.appendMatrix(w.setToRotationZ(t-this.getRotation())),this},set rotation(t){this.setRotation(t)},getRotation:function(){return this._transform.getMatrix().getRotation()},get rotation(){return this.getRotation()},setTranslation:function(t,e){var i,n,s=this._transform.getMatrix(),r=s.m02(),a=s.m12();return"number"==typeof t?(i=t-r,n=e-a):(i=t.x-r,n=t.y-a),this.translate(i,n,!0),this},set translation(t){this.setTranslation(t)},getTranslation:function(){var t=this._transform.getMatrix();return new E(t.m02(),t.m12())},get translation(){return this.getTranslation()},appendMatrix:function(t){this._transform.append(t)},prependMatrix:function(t){this._transform.prepend(t)},prependTranslation:function(t,e){(t||e)&&this._transform.prependTranslation(t,e)},setMatrix:function(t){this._transform.setMatrix(t)},set matrix(t){this.setMatrix(t)},getMatrix:function(){return this._transform.getMatrix()},get matrix(){return this.getMatrix()},getTransform:function(){return this._transform},get transform(){return this.getTransform()},resetTransform:function(){this.setMatrix(h.IDENTITY)},onTransformChange:function(){this.invalidateBounds(),this._picker.onTransformChange(),this.trigger0("transform")},onSummaryChange:function(t,e){this._accessibleDisplaysInfo.onSummaryChange(t,e)},updateMaxDimension:function(t){var e=this._appliedScaleFactor,i=1;if(null!==this._maxWidth){var n=t.width;n>this._maxWidth&&(i=Math.min(i,this._maxWidth/n))}if(null!==this._maxHeight){var s=t.height;s>this._maxHeight&&(i=Math.min(i,this._maxHeight/s))}var r=i/e;1!==r&&(this.scale(r),this._appliedScaleFactor=i)},onMaxDimensionChange:function(t,e){null===t&&null!==e?(this.changeBoundsEventCount(1),this._boundsEventSelfCount++):null!==t&&null===e&&(this.changeBoundsEventCount(-1),this._boundsEventSelfCount--)},setMaxWidth:function(t){this._maxWidth!==t&&(this.onMaxDimensionChange(this._maxWidth,t),this._maxWidth=t,this.updateMaxDimension(this._localBounds))},set maxWidth(t){this.setMaxWidth(t)},getMaxWidth:function(){return this._maxWidth},get maxWidth(){return this.getMaxWidth()},setMaxHeight:function(t){this._maxHeight!==t&&(this.onMaxDimensionChange(this._maxHeight,t),this._maxHeight=t,this.updateMaxDimension(this._localBounds))},set maxHeight(t){this.setMaxHeight(t)},getMaxHeight:function(){return this._maxHeight},get maxHeight(){return this.getMaxHeight()},setLeft:function(t){return this.translate(t-this.getLeft(),0,!0),this},set left(t){this.setLeft(t)},getLeft:function(){return this.getBounds().minX},get left(){return this.getLeft()},setRight:function(t){return this.translate(t-this.getRight(),0,!0),this},set right(t){this.setRight(t)},getRight:function(){return this.getBounds().maxX},get right(){return this.getRight()},setCenterX:function(t){return this.translate(t-this.getCenterX(),0,!0),this},set centerX(t){this.setCenterX(t)},getCenterX:function(){return this.getBounds().getCenterX()},get centerX(){return this.getCenterX()},setCenterY:function(t){return this.translate(0,t-this.getCenterY(),!0),this},set centerY(t){this.setCenterY(t)},getCenterY:function(){return this.getBounds().getCenterY()},get centerY(){return this.getCenterY()},setTop:function(t){return this.translate(0,t-this.getTop(),!0),this},set top(t){this.setTop(t)},getTop:function(){return this.getBounds().minY},get top(){return this.getTop()},setBottom:function(t){return this.translate(0,t-this.getBottom(),!0),this},set bottom(t){this.setBottom(t)},getBottom:function(){return this.getBounds().maxY},get bottom(){return this.getBottom()},setLeftTop:function(t){return this.translate(t.minus(this.getLeftTop()),!0),this},set leftTop(t){this.setLeftTop(t)},getLeftTop:function(){return this.getBounds().getLeftTop()},get leftTop(){return this.getLeftTop()},setCenterTop:function(t){return this.translate(t.minus(this.getCenterTop()),!0),this},set centerTop(t){this.setCenterTop(t)},getCenterTop:function(){return this.getBounds().getCenterTop()},get centerTop(){return this.getCenterTop()},setRightTop:function(t){return this.translate(t.minus(this.getRightTop()),!0),this},set rightTop(t){this.setRightTop(t)},getRightTop:function(){return this.getBounds().getRightTop()},get rightTop(){return this.getRightTop()},setLeftCenter:function(t){return this.translate(t.minus(this.getLeftCenter()),!0),this},set leftCenter(t){this.setLeftCenter(t)},getLeftCenter:function(){return this.getBounds().getLeftCenter()},get leftCenter(){return this.getLeftCenter()},setCenter:function(t){return this.translate(t.minus(this.getCenter()),!0),this},set center(t){this.setCenter(t)},getCenter:function(){return this.getBounds().getCenter()},get center(){return this.getCenter()},setRightCenter:function(t){return this.translate(t.minus(this.getRightCenter()),!0),this},set rightCenter(t){this.setRightCenter(t)},getRightCenter:function(){return this.getBounds().getRightCenter()},get rightCenter(){return this.getRightCenter()},setLeftBottom:function(t){return this.translate(t.minus(this.getLeftBottom()),!0),this},set leftBottom(t){this.setLeftBottom(t)},getLeftBottom:function(){return this.getBounds().getLeftBottom()},get leftBottom(){return this.getLeftBottom()},setCenterBottom:function(t){return this.translate(t.minus(this.getCenterBottom()),!0),this},set centerBottom(t){this.setCenterBottom(t)},getCenterBottom:function(){return this.getBounds().getCenterBottom()},get centerBottom(){return this.getCenterBottom()},setRightBottom:function(t){return this.translate(t.minus(this.getRightBottom()),!0),this},set rightBottom(t){this.setRightBottom(t)},getRightBottom:function(){return this.getBounds().getRightBottom()},get rightBottom(){return this.getRightBottom()},getWidth:function(){return this.getBounds().getWidth()},get width(){return this.getWidth()},getHeight:function(){return this.getBounds().getHeight()},get height(){return this.getHeight()},getId:function(){return this._id},get id(){return this.getId()},setVisible:function(t){return t!==this._visible&&(this._visible=t,this._picker.onVisibilityChange(),this._accessibleDisplaysInfo.onVisibilityChange(t),this.trigger0("visibility")),this},set visible(t){this.setVisible(t)},isVisible:function(){return this._visible},get visible(){return this.isVisible()},swapVisibility:function(t){var e=this.visible?this:t,i=this.visible?t:this,n=e.focused;return e.visible=!1,i.visible=!0,n&&i.focusable&&i.focus(),this},setOpacity:function(t){var e=S(t,0,1);e!==this._opacity&&(this._opacity=e,this.trigger0("opacity"))},set opacity(t){this.setOpacity(t)},getOpacity:function(){return this._opacity},get opacity(){return this.getOpacity()},setPickable:function(t){if(this._pickable!==t){var e=this._pickable;this._pickable=t,this._picker.onPickableChange(e,t),this.trigger0("pickability")}},set pickable(t){this.setPickable(t)},isPickable:function(){return this._pickable},get pickable(){return this.isPickable()},setInputEnabled:function(t){this._inputEnabled!==t&&(this._inputEnabled=t,this.trigger0("inputEnabled"))},set inputEnabled(t){this.setInputEnabled(t)},isInputEnabled:function(){return this._inputEnabled},get inputEnabled(){return this.isInputEnabled()},setInputListeners:function(t){for(;this._inputListeners.length;)this.removeInputListener(this._inputListeners[0]);for(var e=0;e<t.length;e++)this.addInputListener(t[e]);return this},set inputListeners(t){this.setInputListeners(t)},getInputListeners:function(){return this._inputListeners.slice(0)},get inputListeners(){return this.getInputListeners()},setCursor:function(t){this._cursor="auto"===t?null:t},set cursor(t){this.setCursor(t)},getCursor:function(){return this._cursor},get cursor(){return this.getCursor()},setMouseArea:function(t){this._mouseArea!==t&&(this._mouseArea=t,this._picker.onMouseAreaChange())},set mouseArea(t){this.setMouseArea(t)},getMouseArea:function(){return this._mouseArea},get mouseArea(){return this.getMouseArea()},setTouchArea:function(t){this._touchArea!==t&&(this._touchArea=t,this._picker.onTouchAreaChange())},set touchArea(t){this.setTouchArea(t)},getTouchArea:function(){return this._touchArea},get touchArea(){return this.getTouchArea()},setClipArea:function(t){this._clipArea!==t&&(this._clipArea=t,this.trigger0("clip"),this.invalidateBounds(),this._picker.onClipAreaChange())},set clipArea(t){this.setClipArea(t)},getClipArea:function(){return this._clipArea},get clipArea(){return this.getClipArea()},hasClipArea:function(){return null!==this._clipArea},setRendererBitmask:function(t){t!==this._rendererBitmask&&(this._rendererBitmask=t,this._rendererSummary.selfChange(),this.trigger0("rendererBitmask"))},invalidateSupportedRenderers:function(){},setRenderer:function(t){var e=0;"canvas"===t?e=f.bitmaskCanvas:"svg"===t?e=f.bitmaskSVG:"dom"===t?e=f.bitmaskDOM:"webgl"===t&&(e=f.bitmaskWebGL),this._hints.renderer!==e&&(this._hints.renderer=e,this.trigger1("hint","renderer"))},set renderer(t){this.setRenderer(t)},getRenderer:function(){return 0===this._hints.renderer?null:this._hints.renderer===f.bitmaskCanvas?"canvas":this._hints.renderer===f.bitmaskSVG?"svg":this._hints.renderer===f.bitmaskDOM?"dom":this._hints.renderer===f.bitmaskWebGL?"webgl":this._hints.renderer},get renderer(){return this.getRenderer()},setLayerSplit:function(t){t!==this._hints.layerSplit&&(this._hints.layerSplit=t,this.trigger1("hint","layerSplit"))},set layerSplit(t){this.setLayerSplit(t)},isLayerSplit:function(){return this._hints.layerSplit},get layerSplit(){return this.isLayerSplit()},setUsesOpacity:function(t){t!==this._hints.usesOpacity&&(this._hints.usesOpacity=t,this.trigger1("hint","usesOpacity"))},set usesOpacity(t){this.setUsesOpacity(t)},getUsesOpacity:function(){return this._hints.usesOpacity},get usesOpacity(){return this.getUsesOpacity()},setCSSTransform:function(t){t!==this._hints.cssTransform&&(this._hints.cssTransform=t,this.trigger1("hint","cssTransform"))},set cssTransform(t){this.setCSSTransform(t)},isCSSTransformed:function(){return this._hints.cssTransform},get cssTransform(){return this._hints.cssTransform},setExcludeInvisible:function(t){t!==this._hints.excludeInvisible&&(this._hints.excludeInvisible=t,this.trigger1("hint","excludeInvisible"))},set excludeInvisible(t){this.setExcludeInvisible(t)},isExcludeInvisible:function(){return this._hints.excludeInvisible},get excludeInvisible(){return this.isExcludeInvisible()},setPreventFit:function(t){t!==this._hints.preventFit&&(this._hints.preventFit=t,this.trigger1("hint","preventFit"))},set preventFit(t){this.setPreventFit(t)},isPreventFit:function(){return this._hints.preventFit},get preventFit(){return this.isPreventFit()},setWebGLScale:function(t){t!==this._hints.webglScale&&(this._hints.webglScale=t,this.trigger1("hint","webglScale"))},set webglScale(t){this.setWebGLScale(t)},getWebGLScale:function(){return this._hints.webglScale},get webglScale(){return this.getWebGLScale()},getUniqueTrail:function(t){if(t){var e=this.getTrails(t);return e[0]}for(var i=new p.Trail,n=this;n;)i.addAncestor(n),n=n._parents[0];return i},getUniqueTrailTo:function(t){return this.getUniqueTrail(function(e){return t===e})},getTrails:function(t){t=t||e.defaultTrailPredicate;var i=[],n=new p.Trail(this);return p.Trail.appendAncestorTrailsWithPredicate(i,n,t),i},getTrailsTo:function(t){return this.getTrails(function(e){return e===t})},getLeafTrails:function(t){t=t||e.defaultLeafTrailPredicate;var i=[],n=new p.Trail(this);return p.Trail.appendDescendantTrailsWithPredicate(i,n,t),i},getLeafTrailsTo:function(t){return this.getLeafTrails(function(e){return e===t})},getUniqueLeafTrail:function(t){var e=this.getLeafTrails(t);return e[0]},getUniqueLeafTrailTo:function(t){return this.getUniqueLeafTrail(function(e){return e===t})},getConnectedNodes:function(){for(var t=[],e=this._children.concat(this._parents).concat(this);e.length;){var i=e.pop();_.includes(t,i)||(t.push(i),e=e.concat(i._children,i._parents))}return t},getSubtreeNodes:function(){for(var t=[],e=this._children.concat(this);e.length;){var i=e.pop();_.includes(t,i)||(t.push(i),e=e.concat(i._children))}return t},getTopologicallySortedNodes:function(){function t(t){delete i[e.id][t.id],_.every(i,function(e){return!e[t.id]})&&n.push(t)}var e,i={},n=[],s=[];for(_.each(this.getConnectedNodes(),function(t){i[t.id]={},_.each(t._children,function(e){i[t.id][e.id]=!0}),t.parents.length||n.push(t)});n.length;)e=n.pop(),s.push(e),_.each(e._children,t);return s},canAddChild:function(t){function e(t){delete n[i.id][t.id],_.every(n,function(e){return!e[t.id]})&&s.push(t)}if(this===t||_.includes(this._children,t))return!1;var i,n={},s=[],r=[];for(_.each(this.getConnectedNodes().concat(t.getConnectedNodes()),function(e){n[e.id]={},_.each(e._children,function(t){n[e.id][t.id]=!0}),e.parents.length||e===t||s.push(e)}),n[this.id][t.id]=!0;s.length;)i=s.pop(),r.push(i),_.each(i._children,e),i===this&&e(t);return _.every(n,function(t){return _.every(t,function(t){return!1})})},canvasPaintSelf:function(t,e){},renderToCanvasSelf:function(t,e){this.isPainted()&&this._rendererBitmask&f.bitmaskCanvas&&this.canvasPaintSelf(t,e)},renderToCanvasSubtree:function(t,e){e=e||h.identity(),t.resetStyles(),this.renderToCanvasSelf(t,e);for(var i=0;i<this._children.length;i++){var n=this._children[i];if(n.isVisible()){var s=1!==n._opacity||n._clipArea;if(t.context.save(),e.multiplyMatrix(n._transform.getMatrix()),e.canvasSetTransform(t.context),s){var r=document.createElement("canvas");r.width=t.canvas.width,r.height=t.canvas.height;var a=r.getContext("2d"),o=new p.CanvasContextWrapper(r,a);e.canvasSetTransform(a),n.renderToCanvasSubtree(o,e),t.context.save(),n._clipArea&&(t.context.beginPath(),n._clipArea.writeToContext(t.context),t.context.clip()),t.context.setTransform(1,0,0,1,0,0),t.context.globalAlpha=n._opacity,t.context.drawImage(r,0,0),t.context.restore()}else n.renderToCanvasSubtree(t,e);e.multiplyMatrix(n._transform.getInverse()),t.context.restore()}}},renderToCanvas:function(t,e,i,n){t.width=t.width,n&&(e.fillStyle=n,e.fillRect(0,0,t.width,t.height));var s=new p.CanvasContextWrapper(t,e);this.renderToCanvasSubtree(s,h.identity()),i&&i()},toCanvas:function(t,e,i,n,s){var r=this.getBounds().union(this.localToParentBounds(this.getSafeSelfBounds()));e=void 0!==e?e:Math.ceil(2-r.minX),i=void 0!==i?i:Math.ceil(2-r.minY),n=void 0!==n?n:Math.ceil(r.getWidth()+4),s=void 0!==s?s:Math.ceil(r.getHeight()+4);var a=document.createElement("canvas");a.width=n,a.height=s;var o=a.getContext("2d");o.translate(e,i),this._transform.getMatrix().canvasAppendTransform(o);var l=new p.CanvasContextWrapper(a,o);this.renderToCanvasSubtree(l,h.translation(e,i).timesMatrix(this._transform.getMatrix())),t(a,e,i,n,s)},toDataURL:function(t,e,i,n,s){this.toCanvas(function(e,i,n,s,r){t(e.toDataURL(),i,n,s,r)},e,i,n,s)},toImage:function(t,e,i,n,s){this.toDataURL(function(e,i,n){var s=document.createElement("img");s.onload=function(){t(s,i,n);try{delete s.onload}catch(t){}},s.src=e},e,i,n,s)},toImageNodeAsynchronous:function(t,e,i,n,s){this.toImage(function(e,i,n){t(new p.Node({children:[new p.Image(e,{x:-i,y:-n})]}))},e,i,n,s)},toCanvasNodeSynchronous:function(t,e,i,n){var s=null;return this.toCanvas(function(t,e,i){s=new p.Node({children:[new p.Image(t,{x:-e,y:-i})]})},t,e,i,n),s},toDataURLImageSynchronous:function(t,e,i,n){var s;return this.toDataURL(function(t,e,i,n,r){s=new p.Image(t,{x:-e,y:-i,initialWidth:n,initialHeight:r})},t,e,i,n),s},toDataURLNodeSynchronous:function(t,e,i,n){return new p.Node({children:[this.toDataURLImageSynchronous(t,e,i,n)]})},rasterized:function(t){var i=(t=_.extend({resolution:1,sourceBounds:null,useTargetBounds:!0,wrap:!0,useCanvas:!1},t)).resolution,n=t.sourceBounds,r=new e({scale:i,children:[this]}),a=n||this.getSafeTransformedVisibleBounds().dilated(2).roundedOut();1!==i&&((a=new s(i*a.minX,i*a.minY,i*a.maxX,i*a.maxY)).width%1!=0&&(a.maxX+=1-a.width%1),a.height%1!=0&&(a.maxY+=1-a.height%1));var o;r.toCanvas(function(e,n,s,r,a){var h=t.useCanvas?e:e.toDataURL();(o=new p.Image(h,_.extend(t,{x:-n,y:-s,initialWidth:r,initialHeight:a}))).scale(1/i,1/i,!0)},-a.minX,-a.minY,a.width,a.height),r.dispose();var h=this.getVisibleBounds();if(n&&(h=n.intersection(h)),t.wrap){var l=new e({children:[o]});return t.useTargetBounds&&(l.localBounds=h),l}return t.useTargetBounds&&(o.localBounds=o.parentToLocalBounds(h)),o},createDOMDrawable:function(t,e){throw new Error("createDOMDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")},createSVGDrawable:function(t,e){throw new Error("createSVGDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")},createCanvasDrawable:function(t,e){throw new Error("createCanvasDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")},createWebGLDrawable:function(t,e){throw new Error("createWebGLDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")},getInstances:function(){return this._instances},get instances(){return this.getInstances()},addInstance:function(t){this._instances.push(t),this.trigger1("addedInstance",t)},removeInstance:function(t){var e=_.indexOf(this._instances,t);this._instances.splice(e,1),this.trigger1("removedInstance",t)},wasDisplayed:function(t){for(var e=0;e<this._instances.length;e++){var i=this._instances[e];if(i.display===t&&i.visible)return!0}return!1},getRootedDisplays:function(){return this._rootedDisplays},get rootedDisplays(){return this.getRootedDisplays()},addRootedDisplay:function(t){this._rootedDisplays.push(t),this._accessibleDisplaysInfo.onAddedRootedDisplay(t)},removeRootedDisplay:function(t){var e=_.indexOf(this._rootedDisplays,t);this._rootedDisplays.splice(e,1),this._accessibleDisplaysInfo.onRemovedRootedDisplay(t)},localToParentPoint:function(t){return this._transform.transformPosition2(t)},localToParentBounds:function(t){return this._transform.transformBounds2(t)},parentToLocalPoint:function(t){return this._transform.inversePosition2(t)},parentToLocalBounds:function(t){return this._transform.inverseBounds2(t)},transformBoundsFromLocalToParent:function(t){return t.transform(this._transform.getMatrix())},transformBoundsFromParentToLocal:function(t){return t.transform(this._transform.getInverse())},getLocalToGlobalMatrix:function(){for(var t=this,e=[];t;)e.push(t._transform.getMatrix()),t=t._parents[0];for(var i=h.identity(),n=e.length-1;n>=0;n--)i.multiplyMatrix(e[n]);return i},getUniqueTransform:function(){return new v(this.getLocalToGlobalMatrix())},getGlobalToLocalMatrix:function(){return this.getLocalToGlobalMatrix().invert()},localToGlobalPoint:function(t){for(var e=this,i=t.copy();e;)e._transform.getMatrix().multiplyVector2(i),e=e._parents[0];return i},globalToLocalPoint:function(t){for(var e=this,i=[];e;)i.push(e._transform),e=e._parents[0];for(var n=t.copy(),s=i.length-1;s>=0;s--)i[s].getInverse().multiplyVector2(n);return n},localToGlobalBounds:function(t){return t.transformed(this.getLocalToGlobalMatrix())},globalToLocalBounds:function(t){return t.transformed(this.getGlobalToLocalMatrix())},parentToGlobalPoint:function(t){return this.parents.length?this.parents[0].localToGlobalPoint(t):t},parentToGlobalBounds:function(t){return this.parents.length?this.parents[0].localToGlobalBounds(t):t},globalToParentPoint:function(t){return this.parents.length?this.parents[0].globalToLocalPoint(t):t},globalToParentBounds:function(t){return this.parents.length?this.parents[0].globalToLocalBounds(t):t},getGlobalBounds:function(){return this.parentToGlobalBounds(this.getBounds())},get globalBounds(){return this.getGlobalBounds()},boundsOf:function(t){return this.globalToLocalBounds(t.getGlobalBounds())},boundsTo:function(t){return t.globalToLocalBounds(this.getGlobalBounds())},attachDrawable:function(t){return this._drawables.push(t),this},detachDrawable:function(t){var e=_.indexOf(this._drawables,t);return this._drawables.splice(e,1),this},mutate:function(t){if(!t)return this;var i=this;return _.each(this._mutatorKeys,function(n){if(void 0!==t[n]){var s=Object.getOwnPropertyDescriptor(e.prototype,n);s&&"function"==typeof s.value?i[n](t[n]):i[n]=t[n]}}),this.initializePhetioObject({phetioType:b},t),this},getDebugHTMLExtras:function(){return""},inspect:function(){localStorage.scenerySnapshot=JSON.stringify({type:"Subtree",rootNodeId:this.id,nodes:p.serializeConnectedNodes(this)})},toString:function(t,e){return this.constructor.name+"#"+this.id},auditInstanceSubtreeForDisplay:function(t){},onEventListenerAdded:function(t,e){t in C&&(this.changeBoundsEventCount(1),this._boundsEventSelfCount++)},onEventListenerRemoved:function(t,e){t in C&&(this.changeBoundsEventCount(-1),this._boundsEventSelfCount--)}},r.prototype,{on:function(t,e){r.prototype.on.call(this,t,e),this.onEventListenerAdded(t,e)},onStatic:function(t,e){r.prototype.onStatic.call(this,t,e),this.onEventListenerAdded(t,e)},off:function(t,e){var i=r.prototype.off.call(this,t,e);return this.onEventListenerRemoved(t,e),i},offStatic:function(t,e){var i=r.prototype.offStatic.call(this,t,e);return this.onEventListenerRemoved(t,e),i},dispose:function(){this.disposeAccessibility(),this.removeAllChildren(),this.detach(),c.prototype.dispose.call(this),r.prototype.dispose.call(this)},disposeSubtree:function(){if(!this.isDisposed){var t=this.children;this.dispose();for(var e=0;e<t.length;e++)t[e].disposeSubtree()}}}),{DEFAULT_OPTIONS:R,defaultTrailPredicate:function(t){return 0===t._parents.length},defaultLeafTrailPredicate:function(t){return 0===t._children.length}}),i.compose(e),e}),i("SCENERY/display/Drawable",["require","AXON/Events","PHET_CORE/inherit","SCENERY/display/Renderer","SCENERY/scenery"],function(t){"use strict";function e(t){this.initializeDrawable(t)}var i=t("AXON/Events"),n=t("PHET_CORE/inherit"),s=t("SCENERY/display/Renderer"),r=t("SCENERY/scenery"),a=1;return r.register("Drawable",e),n(i,e,{initializeDrawable:function(t){return i.call(this),this.id=this.id||a++,this.cleanDrawable(),this.renderer=t,this.dirty=!0,this.isDisposed=!1,this.linksDirty=!1,this._visible=!0,this._fittable=!0,this},cleanDrawable:function(){this.parentDrawable=null,this.backbone=null,this.pendingParentDrawable=null,this.pendingBackbone=null,this.pendingAddition=!1,this.pendingRemoval=!1,this.previousDrawable=null,this.nextDrawable=null,this.oldPreviousDrawable=null,this.oldNextDrawable=null,this.removeAllEventListeners()},update:function(){var t=!1;return this.dirty&&!this.isDisposed&&(this.dirty=!1,t=!0),t},setVisible:function(t){this._visible!==t&&(this._visible=t,this.trigger0("visibility"))},set visible(t){this.setVisible(t)},isVisible:function(){return this._visible},get visible(){return this.isVisible()},setFittable:function(t){this._fittable!==t&&(this._fittable=t,this.trigger1("fittability",this))},set fittable(t){this.setFittable(t)},isFittable:function(){return this._fittable},get fittable(){return this.isFittable()},setBlockBackbone:function(t){this.parentDrawable=t,this.backbone=t,this.pendingParentDrawable=t,this.pendingBackbone=t,this.pendingAddition=!1,this.pendingRemoval=!1},notePendingAddition:function(t,e,i){this.pendingParentDrawable=e,this.pendingBackbone=i,this.pendingAddition=!0,this.pendingRemoval||t.markDrawableChangedBlock(this)},notePendingRemoval:function(t){this.pendingRemoval=!0,this.pendingAddition||t.markDrawableChangedBlock(this)},notePendingMove:function(t,e){this.pendingParentDrawable=e,this.pendingRemoval&&this.pendingAddition||t.markDrawableChangedBlock(this),this.pendingAddition=!0,this.pendingRemoval=!0},updateBlock:function(){var t=!1;return(this.pendingRemoval||this.pendingAddition)&&((t=!this.pendingRemoval||!this.pendingAddition||this.parentDrawable!==this.pendingParentDrawable||this.backbone!==this.pendingBackbone)?(this.pendingRemoval&&(this.parentDrawable.removeDrawable(this),this.pendingAddition||(this.pendingParentDrawable=null,this.pendingBackbone=null)),this.parentDrawable=this.pendingParentDrawable,this.backbone=this.pendingBackbone,this.pendingAddition&&this.parentDrawable.addDrawable(this)):this.pendingAddition&&s.isCanvas(this.renderer)&&this.parentDrawable.onPotentiallyMovedDrawable(this),this.pendingAddition=!1,this.pendingRemoval=!1),t},updateLinks:function(){this.oldNextDrawable=this.nextDrawable,this.oldPreviousDrawable=this.previousDrawable,this.linksDirty=!1},markDirty:function(){this.dirty||(this.dirty=!0,this.parentDrawable&&this.parentDrawable.markDirtyDrawable(this))},markLinksDirty:function(t){this.linksDirty||(this.linksDirty=!0,t.markDrawableForLinksUpdate(this))},markForDisposal:function(t){e.disconnectBefore(this,t),e.disconnectAfter(this,t),t.markDrawableForDisposal(this)},disposeImmediately:function(t){e.disconnectBefore(this,t),e.disconnectAfter(this,t),this.dispose()},dispose:function(){this.cleanDrawable(),this.isDisposed=!0,this.freeToPool()},audit:function(t,e,i){},toString:function(){return this.constructor.name+"#"+this.id},toDetailedString:function(){return this.toString()}}),e.connectDrawables=function(t,e,i){t.nextDrawable!==e&&(t.nextDrawable&&(t.nextDrawable.markLinksDirty(i),t.nextDrawable.previousDrawable=null),e.previousDrawable&&(e.previousDrawable.markLinksDirty(i),e.previousDrawable.nextDrawable=null),t.nextDrawable=e,e.previousDrawable=t,t.markLinksDirty(i),e.markLinksDirty(i))},e.disconnectBefore=function(t,e){t.previousDrawable&&(t.markLinksDirty(e),t.previousDrawable.markLinksDirty(e),t.previousDrawable.nextDrawable=null,t.previousDrawable=null)},e.disconnectAfter=function(t,e){t.nextDrawable&&(t.markLinksDirty(e),t.nextDrawable.markLinksDirty(e),t.nextDrawable.previousDrawable=null,t.nextDrawable=null)},e.listToArray=function(t,e){for(var i=[],n=t;i.push(n),n!==e;n=n.nextDrawable);return i},e.oldListToArray=function(t,e){for(var i=[],n=t;i.push(n),n!==e;n=n.oldNextDrawable);return i},e}),i("SCENERY/display/Block",["require","PHET_CORE/cleanArray","SCENERY/display/Drawable","PHET_CORE/inherit","SCENERY/scenery"],function(t){"use strict";function e(t,e){throw new Error("Should never be called")}t("PHET_CORE/cleanArray");var i=t("SCENERY/display/Drawable"),n=t("PHET_CORE/inherit");return t("SCENERY/scenery").register("Block",e),n(i,e,{initializeBlock:function(t,e){return this.initializeDrawable(e),this.display=t,this.drawableCount=0,this.used=!0,this.firstDrawable=null,this.lastDrawable=null,this.pendingFirstDrawable=null,this.pendingLastDrawable=null,this.previousBlock=null,this.nextBlock=null,this.zIndex=0,this},dispose:function(){this.display=null,this.firstDrawable=null,this.lastDrawable=null,this.pendingFirstDrawable=null,this.pendingLastDrawable=null,this.previousBlock=null,this.nextBlock=null,i.prototype.dispose.call(this)},addDrawable:function(t){this.drawableCount++,this.markDirtyDrawable(t)},removeDrawable:function(t){this.drawableCount--,this.markDirty()},onIntervalChange:function(t,e){},updateInterval:function(){this.pendingFirstDrawable===this.firstDrawable&&this.pendingLastDrawable===this.lastDrawable||(this.onIntervalChange(this.pendingFirstDrawable,this.pendingLastDrawable),this.firstDrawable=this.pendingFirstDrawable,this.lastDrawable=this.pendingLastDrawable)},notifyInterval:function(t,e){this.pendingFirstDrawable=t,this.pendingLastDrawable=e,this.updateInterval()},audit:function(t,e,i){}}),e}),i("SCENERY/display/FittedBlock",["require","SCENERY/display/Block","DOT/Bounds2","PHET_CORE/inherit","SCENERY/scenery","DOT/Vector2"],function(t){"use strict";function e(t,e,i){this.initialize(t,e,i)}var i=t("SCENERY/display/Block"),n=t("DOT/Bounds2"),s=t("PHET_CORE/inherit"),r=t("SCENERY/scenery"),a=t("DOT/Vector2"),o=n.NOTHING.copy();return r.register("FittedBlock",e),s(i,e,{initializeFittedBlock:function(t,e,i,s){return this.initializeBlock(t,e),this.transformRootInstance=i,this.canBeFullDisplay=i.isDisplayRoot,this.preferredFit=s,this.fit=s,this.dirtyFit=!0,this.dirtyFitListener=this.dirtyFitListener||this.markDirtyFit.bind(this),this.commonFitInstance=null,this.fitBounds=n.NOTHING.copy(),this.oldFitBounds=n.NOTHING.copy(),this.fitOffset=new a(0,0),this.unfittableDrawableCount=0,this.fittableListener=this.onFittabilityChange.bind(this),this.forceAcceleration=!1,this.display.onStatic("displaySize",this.dirtyFitListener),this},setFit:function(t){this.canBeFullDisplay||t!==e.FULL_DISPLAY||(t=e.COMMON_ANCESTOR),this.fit!==t&&(this.fit=t,this.markDirtyFit(),this.oldFitBounds.set(n.NOTHING),t===e.COMMON_ANCESTOR&&this.removeCommonFitInstance())},markDirtyFit:function(){this.dirtyFit=!0,this.markDirty()},updateFit:function(){if(this.dirtyFit||this.fit!==e.FULL_DISPLAY)if(this.dirtyFit=!1,this.fit===e.COMMON_ANCESTOR&&null===this.commonFitInstance&&this.addCommonFitInstance(this.computeCommonAncestorInstance()),this.fit===e.COMMON_ANCESTOR&&this.commonFitInstance.fittability.subtreeUnfittableCount>0&&this.canBeFullDisplay&&(this.oldFitBounds.set(n.NOTHING),this.fit=e.FULL_DISPLAY),this.fit===e.FULL_DISPLAY)this.fitBounds.set(n.NOTHING),this.setSizeFullDisplay();else{if(this.fit!==e.COMMON_ANCESTOR)throw new Error("unknown fit");this.fitBounds.set(this.commonFitInstance.node.getLocalBounds());for(var t=this.commonFitInstance;t!==this.transformRootInstance;)this.fitBounds.transform(t.node.getMatrix()),t=t.parent;this.fitBounds.roundOut(),this.fitBounds.dilate(4),this.transformRootInstance.isDisplayRoot&&(o.setMinMax(0,0,this.display.width,this.display.height),this.fitBounds.constrainBounds(o)),this.fitBounds.isValid()||this.fitBounds.setMinMax(0,0,0,0),this.fitBounds.equals(this.oldFitBounds)||(this.oldFitBounds.set(this.fitBounds),this.setSizeFitBounds())}},setSizeFullDisplay:function(){},setSizeFitBounds:function(){},addCommonFitInstance:function(t){t&&(this.commonFitInstance=t,this.commonFitInstance.fittability.subtreeFittabilityChange.addListener(this.dirtyFitListener))},removeCommonFitInstance:function(){this.commonFitInstance&&(this.commonFitInstance.fittability.subtreeFittabilityChange.removeListener(this.dirtyFitListener),this.commonFitInstance=null)},dispose:function(){this.display.offStatic("displaySize",this.dirtyFitListener),this.removeCommonFitInstance(),this.transformRootInstance=null,i.prototype.dispose.call(this)},addDrawable:function(t){i.prototype.addDrawable.call(this,t),t.onStatic("fittability",this.fittableListener),t.fittable||this.incrementUnfittable()},removeDrawable:function(t){i.prototype.removeDrawable.call(this,t),t.offStatic("fittability",this.fittableListener),t.fittable||this.decrementUnfittable()},onFittabilityChange:function(t){t.isFittable()?this.decrementUnfittable():this.incrementUnfittable()},incrementUnfittable:function(){this.unfittableDrawableCount++,1===this.unfittableDrawableCount&&this.checkFitConstraints()},decrementUnfittable:function(){this.unfittableDrawableCount--,0===this.unfittableDrawableCount&&this.checkFitConstraints()},checkFitConstraints:function(){this.unfittableDrawableCount>0&&this.canBeFullDisplay?this.setFit(e.FULL_DISPLAY):this.setFit(this.preferredFit)},computeCommonAncestorInstance:function(){for(var t=this.firstDrawable.instance,e=this.lastDrawable.instance,i=Math.min(t.trail.length,e.trail.length);t.trail.length>i;)t=t.parent;for(;e.trail.length>i;)e=e.parent;for(;t!==e;)t=t.parent,e=e.parent;var n=t;return n},onIntervalChange:function(t,n){i.prototype.onIntervalChange.call(this,t,n),this.fit===e.COMMON_ANCESTOR&&(this.removeCommonFitInstance(),this.markDirtyFit())}}),e.FULL_DISPLAY=1,e.COMMON_ANCESTOR=2,e.fitString={1:"fullDisplay",2:"commonAncestor"},e}),i("SCENERY/util/Util",["require","SCENERY/scenery","DOT/Bounds2","SCENERY/util/Features","DOT/Matrix3","DOT/Transform3","DOT/Vector2"],function(t){"use strict";function e(t,e){return new o(t,e)}var i=t("SCENERY/scenery"),n=t("DOT/Bounds2"),s=t("SCENERY/util/Features"),r=t("DOT/Matrix3"),a=t("DOT/Transform3"),o=t("DOT/Vector2"),h=!1,l=s.transform,u=s.transformOrigin||"transformOrigin",c={prepareForTransform:function(t,e){t.style[u]="top left",e?i.Util.setTransformAcceleration(t):i.Util.unsetTransformAcceleration(t)},setTransformAcceleration:function(t){t.style.webkitBackfaceVisibility="hidden"},unsetTransformAcceleration:function(t){t.style.webkitBackfaceVisibility=""},applyPreparedTransform:function(t,e,i){e.style[l]=t.getCSSTransform()},setTransform:function(t,e,i){e.style[l]=t},unsetTransform:function(t){t.style[l]=""},polyfillRequestAnimationFrame:function(){window.requestAnimationFrame&&window.cancelAnimationFrame||(s.requestAnimationFrame&&s.cancelAnimationFrame?(window.requestAnimationFrame=window[s.requestAnimationFrame],window.cancelAnimationFrame=window[s.cancelAnimationFrame]):(window.requestAnimationFrame=function(t){var e=Date.now();return window.setTimeout(function(){t(Date.now()-e)},16)},window.cancelAnimationFrame=clearTimeout))},backingStorePixelRatio:function(t){return t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1},backingScale:function(t){if("devicePixelRatio"in window){var e=c.backingStorePixelRatio(t);return window.devicePixelRatio/e}return 1},scanBounds:function(t,i,s){for(var r=_.map(_.range(i),function(){return!1}),a=_.map(_.range(i),function(){return!1}),o=0;o<i;o++)for(var h=0;h<i;h++){var l=4*(h*i+o);0===t.data[l]&&0===t.data[l+1]&&0===t.data[l+2]&&0===t.data[l+3]||(r[o]=!0,a[h]=!0)}var u=_.indexOf(r,!0),c=_.lastIndexOf(r,!0),d=_.indexOf(a,!0),f=_.lastIndexOf(a,!0),m=i/16;return{minBounds:new n(u<1||u>=i-1?Number.POSITIVE_INFINITY:s.inversePosition2(e(u+1+m,0)).x,d<1||d>=i-1?Number.POSITIVE_INFINITY:s.inversePosition2(e(0,d+1+m)).y,c<1||c>=i-1?Number.NEGATIVE_INFINITY:s.inversePosition2(e(c-m,0)).x,f<1||f>=i-1?Number.NEGATIVE_INFINITY:s.inversePosition2(e(0,f-m)).y),maxBounds:new n(u<1||u>=i-1?Number.NEGATIVE_INFINITY:s.inversePosition2(e(u-1-m,0)).x,d<1||d>=i-1?Number.NEGATIVE_INFINITY:s.inversePosition2(e(0,d-1-m)).y,c<1||c>=i-1?Number.POSITIVE_INFINITY:s.inversePosition2(e(c+2+m,0)).x,f<1||f>=i-1?Number.POSITIVE_INFINITY:s.inversePosition2(e(0,f+2+m)).y)}},canvasAccurateBounds:function(t,i){function s(e){g.save(),e.matrix.canvasSetTransform(g),t(g),g.restore();var i=g.getImageData(0,0,u,u),n=c.scanBounds(i,u,e);return h&&function(t){var e=document.createElement("canvas");e.width=u,e.height=u,e.getContext("2d").putImageData(t,0,0),$(e).css("border","1px solid black"),$(window).ready(function(){$("#display").append(e)})}(i),g.clearRect(0,0,u,u),n}function o(t){var e=(u-4)/(t.maxX-t.minX),i=(u-4)/(t.maxY-t.minY),n=-e*t.minX+2,s=-i*t.minY+2;return new a(r.translation(n,s).timesMatrix(r.scaling(e,i)))}var l=i&&i.precision?i.precision:.001,u=i&&i.resolution?i.resolution:128,d=i&&i.initialScale?i.initialScale:1/16,f=n.NOTHING,m=n.EVERYTHING,p=document.createElement("canvas");p.width=u,p.height=u;var g=p.getContext("2d");h&&$(window).ready(function(){var t=document.createElement("h2");$(t).text("Bounds Scan"),$("#display").append(t)});var v=new a;v.append(r.translation(u/2,u/2)),v.append(r.scaling(d));var y=s(v);f=f.union(y.minBounds);var E,b,_;for(E=(m=m.intersection(y.maxBounds)).minY,b=m.maxY;isFinite(f.minX)&&isFinite(m.minX)&&Math.abs(f.minX-m.minX)>l;){if(_=s(o(new n(m.minX,E,f.minX,b))),f.minX<=_.minBounds.minX&&m.minX>=_.maxBounds.minX){h&&(console.log("warning, exiting infinite loop!"),console.log('transformed "min" minX: '+o(new n(m.minX,m.minY,f.minX,m.maxY)).transformPosition2(e(f.minX,0))),console.log('transformed "max" minX: '+o(new n(m.minX,m.minY,f.minX,m.maxY)).transformPosition2(e(m.minX,0))));break}f=f.withMinX(Math.min(f.minX,_.minBounds.minX)),m=m.withMinX(Math.max(m.minX,_.maxBounds.minX)),E=Math.max(E,_.maxBounds.minY),b=Math.min(b,_.maxBounds.maxY)}for(E=m.minY,b=m.maxY;isFinite(f.maxX)&&isFinite(m.maxX)&&Math.abs(f.maxX-m.maxX)>l;){if(_=s(o(new n(f.maxX,E,m.maxX,b))),f.maxX>=_.minBounds.maxX&&m.maxX<=_.maxBounds.maxX){h&&console.log("warning, exiting infinite loop!");break}f=f.withMaxX(Math.max(f.maxX,_.minBounds.maxX)),m=m.withMaxX(Math.min(m.maxX,_.maxBounds.maxX)),E=Math.max(E,_.maxBounds.minY),b=Math.min(b,_.maxBounds.maxY)}for(E=m.minX,b=m.maxX;isFinite(f.minY)&&isFinite(m.minY)&&Math.abs(f.minY-m.minY)>l;){if(_=s(o(new n(E,m.minY,b,f.minY))),f.minY<=_.minBounds.minY&&m.minY>=_.maxBounds.minY){h&&console.log("warning, exiting infinite loop!");break}f=f.withMinY(Math.min(f.minY,_.minBounds.minY)),m=m.withMinY(Math.max(m.minY,_.maxBounds.minY)),E=Math.max(E,_.maxBounds.minX),b=Math.min(b,_.maxBounds.maxX)}for(E=m.minX,b=m.maxX;isFinite(f.maxY)&&isFinite(m.maxY)&&Math.abs(f.maxY-m.maxY)>l;){if(_=s(o(new n(E,f.maxY,b,m.maxY))),f.maxY>=_.minBounds.maxY&&m.maxY<=_.maxBounds.maxY){h&&console.log("warning, exiting infinite loop!");break}f=f.withMaxY(Math.max(f.maxY,_.minBounds.maxY)),m=m.withMaxY(Math.min(m.maxY,_.maxBounds.maxY)),E=Math.max(E,_.maxBounds.minX),b=Math.min(b,_.maxBounds.maxX)}h&&(console.log("minBounds: "+f),console.log("maxBounds: "+m));var S=new n(isFinite(f.minX)&&isFinite(m.minX)?(f.minX+m.minX)/2:Number.POSITIVE_INFINITY,isFinite(f.minY)&&isFinite(m.minY)?(f.minY+m.minY)/2:Number.POSITIVE_INFINITY,isFinite(f.maxX)&&isFinite(m.maxX)?(f.maxX+m.maxX)/2:Number.NEGATIVE_INFINITY,isFinite(f.maxY)&&isFinite(m.maxY)?(f.maxY+m.maxY)/2:Number.NEGATIVE_INFINITY);return S.minBounds=f,S.maxBounds=m,S.isConsistent=m.containsBounds(f),S.precision=Math.max(Math.abs(f.minX-m.minX),Math.abs(f.minY-m.minY),Math.abs(f.maxX-m.maxX),Math.abs(f.maxY-m.maxY)),S},toPowerOf2:function(t){for(var e=1;e<t;)e*=2;return e},createShader:function(t,e,i){var n=t.createShader(i);return t.shaderSource(n,e),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)||(console.log("GLSL compile error:"),console.log(t.getShaderInfoLog(n)),console.log(e)),n},applyWebGLContextDefaults:function(t){t.clearColor(0,0,0,0),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA)},checkWebGLSupport:function(t){var e=document.createElement("canvas"),i={failIfMajorPerformanceCaveat:!0};try{var n=!!window.WebGLRenderingContext&&(e.getContext("webgl",i)||e.getContext("experimental-webgl",i));if(!n)return!1;if(t)for(var s=0;s<t.length;s++)if(null===n.getExtension(t[s]))return!1;return!0}catch(t){return!1}},checkIE11StencilSupport:function(){var t=document.createElement("canvas");try{var e=!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"));return!!e&&(e.clearStencil(0),0===e.getError())}catch(t){return!1}},get isWebGLSupported(){return void 0===this._extensionlessWebGLSupport&&(this._extensionlessWebGLSupport=i.Util.checkWebGLSupport()),this._extensionlessWebGLSupport},loseContext:function(t){var e=t.getExtension("WEBGL_lose_context");e&&(e.loseContext(),setTimeout(function(){e.restoreContext()},1e3))}};return i.register("Util",c),c}),i("SCENERY/display/CanvasBlock",["require","SCENERY/util/CanvasContextWrapper","PHET_CORE/cleanArray","SCENERY/display/FittedBlock","PHET_CORE/inherit","DOT/Matrix3","PHET_CORE/Poolable","SCENERY/display/Renderer","SCENERY/scenery","SCENERY/util/Util","DOT/Vector2"],function(t){"use strict";function e(t,e,i,n){this.initialize(t,e,i,n)}var i=t("SCENERY/util/CanvasContextWrapper"),n=t("PHET_CORE/cleanArray"),s=t("SCENERY/display/FittedBlock"),r=t("PHET_CORE/inherit"),a=t("DOT/Matrix3"),o=t("PHET_CORE/Poolable"),h=t("SCENERY/display/Renderer"),l=t("SCENERY/scenery"),u=t("SCENERY/util/Util"),c=t("DOT/Vector2"),d=new a,f=new a;return l.register("CanvasBlock",e),r(s,e,{initialize:function(t,e,r,a){return this.initializeFittedBlock(t,e,r,s.COMMON_ANCESTOR),this.filterRootInstance=a,this.dirtyDrawables=n(this.dirtyDrawables),this.domElement||(this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.top="0",this.canvas.style.pointerEvents="none",this.canvasId=this.canvas.id="scenery-canvas"+this.id,this.context=this.canvas.getContext("2d"),this.context.save(),this.context.miterLimit=20,this.context.miterLimit=10,this.wrapper=new i(this.canvas,this.context),this.domElement=this.canvas,this.wrapperStack=[this.wrapper]),this.wrapperStackIndex=0,this.filterListenerCountMap=this.filterListenerCountMap||{},u.prepareForTransform(this.canvas,this.forceAcceleration),u.unsetTransform(this.canvas),this.canvasDrawOffset=new c(0,0),this.currentDrawable=null,this.clipDirty=!0,this.clipCount=0,this.backingScale=e&h.bitmaskCanvasLowResolution?1:l.Util.backingScale(this.context),this.clipDirtyListener=this.markDirty.bind(this),this.opacityDirtyListener=this.markDirty.bind(this),this.filterRootNode=this.filterRootInstance.node,this},setSizeFullDisplay:function(){var t=this.display.getSize();this.canvas.width=t.width*this.backingScale,this.canvas.height=t.height*this.backingScale,this.canvas.style.width=t.width+"px",this.canvas.style.height=t.height+"px",this.wrapper.resetStyles(),this.canvasDrawOffset.setXY(0,0),u.unsetTransform(this.canvas)},setSizeFitBounds:function(){var t=this.fitBounds.minX,e=this.fitBounds.minY;this.canvasDrawOffset.setXY(-t,-e),u.setTransform("matrix(1,0,0,1,"+t+","+e+")",this.canvas,this.forceAcceleration),this.canvas.width=this.fitBounds.width*this.backingScale,this.canvas.height=this.fitBounds.height*this.backingScale,this.canvas.style.width=this.fitBounds.width+"px",this.canvas.style.height=this.fitBounds.height+"px",this.wrapper.resetStyles()},update:function(){if(!s.prototype.update.call(this))return!1;for(;this.dirtyDrawables.length;)this.dirtyDrawables.pop().update();this.updateFit(),this.context.restore(),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.save(),this.wrapper.resetStyles(),this.currentDrawable=null;for(var t=this.firstDrawable;null!==t&&(this.renderDrawable(t),t!==this.lastDrawable);t=t.nextDrawable);return this.currentDrawable&&this.walkDown(this.currentDrawable.instance.trail,0),!0},applyClip:function(t){this.clipDirty=!1;var e=this.wrapperStack[this.wrapperStackIndex],i=e.context;if(i.restore(),i.save(),e.resetStyles(),this.clipCount){var n=t.instance.trail;d.rowMajor(this.backingScale,0,this.canvasDrawOffset.x*this.backingScale,0,this.backingScale,this.canvasDrawOffset.y*this.backingScale,0,0,1),f.set(this.transformRootInstance.trail.getMatrix()).invert(),f.multiplyMatrix(d).canvasSetTransform(i);for(var s=0;s<n.length;s++){var r=n.nodes[s];r.getMatrix().canvasAppendTransform(i),r.hasClipArea()&&(i.beginPath(),r.clipArea.writeToContext(i),i.clip())}}},walkDown:function(t,e){for(var i=this.filterRootInstance.trail.length-1,n=t.length-1;n>=e;n--){var s=t.nodes[n];if(s.hasClipArea()&&(this.clipCount--,this.clipDirty=!0),n>i&&1!==s.getOpacity()){var r=this.wrapperStack[this.wrapperStackIndex],a=this.wrapperStack[this.wrapperStackIndex-1];this.wrapperStackIndex--,this.clipDirty=!0,a.context.setTransform(1,0,0,1,0,0),a.context.globalAlpha=s.getOpacity(),a.context.drawImage(r.canvas,0,0),a.context.globalAlpha=1}}},walkUp:function(t,e){for(var n=this.filterRootInstance.trail.length-1,s=e;s<t.length;s++){var r=t.nodes[s];if(s>n&&1!==r.getOpacity()){if(this.wrapperStackIndex++,this.clipDirty=!0,this.wrapperStackIndex===this.wrapperStack.length){var a=document.createElement("canvas"),o=a.getContext("2d");o.save(),this.wrapperStack.push(new i(a,o))}var h=this.wrapperStack[this.wrapperStackIndex],l=h.context;h.setDimensions(this.canvas.width,this.canvas.height),l.setTransform(1,0,0,1,0,0),l.clearRect(0,0,this.canvas.width,this.canvas.height)}r.hasClipArea()&&(this.clipCount++,this.clipDirty=!0)}},renderDrawable:function(t){if(t.visible){var e=this.currentDrawable?t.instance.getBranchIndexTo(this.currentDrawable.instance):0;this.currentDrawable&&this.walkDown(this.currentDrawable.instance.trail,e),this.walkUp(t.instance.trail,e);var i=this.wrapperStack[this.wrapperStackIndex],n=i.context;this.clipDirty&&this.applyClip(t);var s=t.instance.relativeTransform.matrix;n.setTransform(this.backingScale,0,0,this.backingScale,this.canvasDrawOffset.x*this.backingScale,this.canvasDrawOffset.y*this.backingScale),t.instance!==this.transformRootInstance&&s.canvasAppendTransform(n),t.paintCanvas(i,t.instance.node,t.instance.relativeTransform.matrix),this.currentDrawable=t}},dispose:function(){this.filterRootNode=null,this.transformRootInstance=null,n(this.dirtyDrawables),this.canvas.width=0,this.canvas.height=0,s.prototype.dispose.call(this)},markDirtyDrawable:function(t){this.dirtyDrawables.push(t),this.markDirty()},addDrawable:function(t){s.prototype.addDrawable.call(this,t);for(var e=t.instance;e&&e!==this.filterRootInstance;e=e.parent){var i=e.node;this.filterListenerCountMap[i.id]?this.filterListenerCountMap[i.id]++:(this.filterListenerCountMap[i.id]=1,i.onStatic("opacity",this.opacityDirtyListener),i.onStatic("clip",this.clipDirtyListener))}},removeDrawable:function(t){for(var e=t.instance;e&&e!==this.filterRootInstance;e=e.parent){var i=e.node;this.filterListenerCountMap[i.id]--,0===this.filterListenerCountMap[i.id]&&(delete this.filterListenerCountMap[i.id],i.offStatic("clip",this.clipDirtyListener),i.offStatic("opacity",this.opacityDirtyListener))}s.prototype.removeDrawable.call(this,t)},onIntervalChange:function(t,e){s.prototype.onIntervalChange.call(this,t,e),this.markDirty()},onPotentiallyMovedDrawable:function(t){t.markDirty()},toString:function(){return"CanvasBlock#"+this.id+"-"+s.fitString[this.fit]}}),o.mixInto(e,{initialize:e.prototype.initialize}),e}),i("SCENERY/display/DOMBlock",["require","SCENERY/display/Block","PHET_CORE/inherit","PHET_CORE/Poolable","SCENERY/scenery"],function(t){"use strict";function e(t,e){this.initialize(t,e)}var i=t("SCENERY/display/Block"),n=t("PHET_CORE/inherit"),s=t("PHET_CORE/Poolable");return t("SCENERY/scenery").register("DOMBlock",e),n(i,e,{initialize:function(t,e){return this.initializeBlock(t,e.renderer),this.domDrawable=e,this.domElement=e.domElement,this},update:function(){return!!i.prototype.update.call(this)&&(this.domDrawable.update(),!0)},dispose:function(){this.domDrawable=null,this.domElement=null,i.prototype.dispose.call(this)},markDirtyDrawable:function(t){this.markDirty()},addDrawable:function(t){i.prototype.addDrawable.call(this,t)},removeDrawable:function(t){i.prototype.removeDrawable.call(this,t)}}),s.mixInto(e,{initialize:e.prototype.initialize}),e}),i("SCENERY/display/SVGGroup",["require","PHET_CORE/cleanArray","PHET_CORE/inherit","PHET_CORE/platform","PHET_CORE/Poolable","SCENERY/scenery"],function(t){"use strict";function e(t,e,i){this.initialize(t,e,i)}var i=t("PHET_CORE/cleanArray"),n=t("PHET_CORE/inherit"),s=t("PHET_CORE/platform"),r=t("PHET_CORE/Poolable"),a=t("SCENERY/scenery");return a.register("SVGGroup",e),n(Object,e,{initialize:function(t,e,n){return this.block=t,this.instance=e,this.node=e.trail.lastNode(),this.parent=n,this.children=i(this.children),this.hasSelfDrawable=!1,this.selfDrawable=null,this.dirty=!0,this.willApplyTransforms=this.block.transformRootInstance.trail.nodes.length<this.instance.trail.nodes.length,this.willApplyFilters=this.block.filterRootInstance.trail.nodes.length<this.instance.trail.nodes.length,this.transformDirty=!0,this.hasTransform=void 0!==this.hasTransform&&this.hasTransform,this.transformDirtyListener=this.transformDirtyListener||this.markTransformDirty.bind(this),this.willApplyTransforms&&this.node.onStatic("transform",this.transformDirtyListener),this.opacityDirty=!0,this.visibilityDirty=!0,this.clipDirty=!0,this.hasOpacity=void 0!==this.hasOpacity&&this.hasOpacity,this.clipDefinition=void 0!==this.clipDefinition?this.clipDefinition:null,this.clipPath=void 0!==this.clipPath?this.clipPath:null,this.opacityDirtyListener=this.opacityDirtyListener||this.markOpacityDirty.bind(this),this.visibilityDirtyListener=this.visibilityDirtyListener||this.markVisibilityDirty.bind(this),this.clipDirtyListener=this.clipDirtyListener||this.markClipDirty.bind(this),this.node.onStatic("visibility",this.visibilityDirtyListener),this.willApplyFilters&&this.node.onStatic("opacity",this.opacityDirtyListener),this.node.onStatic("clip",this.clipDirtyListener),this.orderDirty=!0,this.orderDirtyListener=this.orderDirtyListener||this.markOrderDirty.bind(this),this.node.onStatic("childrenChanged",this.orderDirtyListener),this.svgGroup||(this.svgGroup=document.createElementNS(a.svgns,"g")),this.instance.addSVGGroup(this),this.block.markDirtyGroup(this),this},addSelfDrawable:function(t){this.selfDrawable=t,this.svgGroup.insertBefore(t.svgElement,this.children.length?this.children[0].svgGroup:null),this.hasSelfDrawable=!0},removeSelfDrawable:function(t){this.hasSelfDrawable=!1,this.svgGroup.removeChild(t.svgElement),this.selfDrawable=null},addChildGroup:function(t){this.markOrderDirty(),t.parent=this,this.children.push(t),this.svgGroup.appendChild(t.svgGroup)},removeChildGroup:function(t){this.markOrderDirty(),t.parent=null,this.children.splice(_.indexOf(this.children,t),1),this.svgGroup.removeChild(t.svgGroup)},markDirty:function(){this.dirty||(this.dirty=!0,this.block.markDirtyGroup(this))},markOrderDirty:function(){this.orderDirty||(this.orderDirty=!0,this.markDirty())},markTransformDirty:function(){this.transformDirty||(this.transformDirty=!0,this.markDirty())},markOpacityDirty:function(){this.opacityDirty||(this.opacityDirty=!0,this.markDirty())},markVisibilityDirty:function(){this.visibilityDirty||(this.visibilityDirty=!0,this.markDirty())},markClipDirty:function(){this.clipDirty||(this.clipDirty=!0,this.markDirty())},update:function(){if(this.block){var t=this.svgGroup;if(this.dirty=!1,this.transformDirty)if(this.transformDirty=!1,this.willApplyTransforms){this.node.transform.isIdentity()?this.hasTransform&&(this.hasTransform=!1,s.ie9||s.ie10?t.setAttribute("transform",""):t.removeAttribute("transform")):(this.hasTransform=!0,t.setAttribute("transform",this.node.transform.getMatrix().getSVGTransform()))}else this.hasTransform&&(this.hasTransform=!1,s.ie9||s.ie10?t.setAttribute("transform",""):t.removeAttribute("transform"));if(this.visibilityDirty&&(this.visibilityDirty=!1,t.style.display=this.node.isVisible()?"":"none"),this.opacityDirty&&(this.opacityDirty=!1,this.willApplyFilters&&1!==this.node.opacity?(this.hasOpacity=!0,t.setAttribute("opacity",this.node.opacity)):this.hasOpacity&&(this.hasOpacity=!1,t.removeAttribute("opacity"))),this.clipDirty)if(this.clipDirty=!1,this.node.clipArea){if(!this.clipDefinition){var e="clip"+this.node.getId();this.clipDefinition=document.createElementNS(a.svgns,"clipPath"),this.clipDefinition.setAttribute("id",e),this.clipDefinition.setAttribute("clipPathUnits","userSpaceOnUse"),this.block.defs.appendChild(this.clipDefinition),this.clipPath=document.createElementNS(a.svgns,"path"),this.clipDefinition.appendChild(this.clipPath),t.setAttribute("clip-path","url(#"+e+")")}this.clipPath.setAttribute("d",this.node.clipArea.getSVGPath())}else this.clipDefinition&&(t.removeAttribute("clip-path"),this.block.defs.removeChild(this.clipDefinition),this.clipDefinition=null,this.clipPath=null);if(this.orderDirty){this.orderDirty=!1;for(var i=this.children.length-1,n=this.instance.children,r=n.length-1;r>=0;r--){var o=n[r].lookupSVGGroup(this.block);if(o){if(this.children[i]!==o){t.insertBefore(o.svgGroup,i+1>=this.children.length?null:this.children[i+1].svgGroup);var h=_.indexOf(this.children,o);this.children.splice(h,1),this.children.splice(i,0,o)}i--}}}}},isReleasable:function(){return!this.hasSelfDrawable&&!this.children.length&&this.parent},dispose:function(){this.willApplyTransforms&&this.node.offStatic("transform",this.transformDirtyListener),this.node.offStatic("visibility",this.visibilityDirtyListener),this.willApplyFilters&&this.node.offStatic("opacity",this.opacityDirtyListener),this.node.offStatic("clip",this.clipDirtyListener),this.node.offStatic("childrenChanged",this.orderDirtyListener),this.instance.active&&this.instance.removeSVGGroup(this),this.clipDefinition&&(this.svgGroup.removeAttribute("clip-path"),this.block.defs.removeChild(this.clipDefinition),this.clipDefinition=null,this.clipPath=null),this.parent=null,this.block=null,this.instance=null,this.node=null,i(this.children),this.selfDrawable=null,this.freeToPool()},toString:function(){return"SVGGroup:"+this.block.toString()+"_"+this.instance.toString()}}),e.addDrawable=function(t,i){e.ensureGroupsToInstance(t,i.instance).addSelfDrawable(i)},e.removeDrawable=function(t,i){i.instance.lookupSVGGroup(t).removeSelfDrawable(i),e.releaseGroupsToInstance(t,i.instance)},e.ensureGroupsToInstance=function(t,i){var n=i.lookupSVGGroup(t);if(!n){var s=e.ensureGroupsToInstance(t,i.parent);n=e.createFromPool(t,i,s),s.addChildGroup(n)}return n},e.releaseGroupsToInstance=function(t,i){var n=i.lookupSVGGroup(t);if(n.isReleasable()){var s=n.parent;s.removeChildGroup(n),e.releaseGroupsToInstance(t,s.instance),n.dispose()}},r.mixInto(e,{initialize:e.prototype.initialize}),e}),i("SCENERY/display/SVGBlock",["require","PHET_CORE/cleanArray","SCENERY/display/FittedBlock","PHET_CORE/inherit","PHET_CORE/Poolable","SCENERY/scenery","SCENERY/display/SVGGroup","SCENERY/util/Util"],function(t){"use strict";function e(t,e,i,n){this.initialize(t,e,i,n)}var i=t("PHET_CORE/cleanArray"),n=t("SCENERY/display/FittedBlock"),s=t("PHET_CORE/inherit"),r=t("PHET_CORE/Poolable"),a=t("SCENERY/scenery"),o=t("SCENERY/display/SVGGroup"),h=t("SCENERY/util/Util");return a.register("SVGBlock",e),s(n,e,{initialize:function(t,e,s,r){this.initializeFittedBlock(t,e,s,n.COMMON_ANCESTOR),this.filterRootInstance=r,this.dirtyGradients=i(this.dirtyGradients),this.dirtyGroups=i(this.dirtyGroups),this.dirtyDrawables=i(this.dirtyDrawables),this.paintMap={},this.domElement||(this.svg=document.createElementNS(a.svgns,"svg"),this.svg.style.position="absolute",this.svg.style.left="0",this.svg.style.top="0",this.svg.setAttribute("focusable",!1),this.svg.style["pointer-events"]="none",this.defs=document.createElementNS(a.svgns,"defs"),this.svg.appendChild(this.defs),this.baseTransformGroup=document.createElementNS(a.svgns,"g"),this.svg.appendChild(this.baseTransformGroup),this.domElement=this.svg),h.prepareForTransform(this.svg,this.forceAcceleration),h.unsetTransform(this.svg),this.baseTransformGroup.setAttribute("transform","");var l=s.trail.nodes.length>r.trail.nodes.length?r:s;return this.rootGroup=o.createFromPool(this,l,null),this.baseTransformGroup.appendChild(this.rootGroup.svgGroup),this},incrementPaint:function(t){if(this.paintMap.hasOwnProperty(t.id))this.paintMap[t.id].count++;else{var e=t.createSVGPaint(this);e.definition.setAttribute("id",t.id+"-"+this.id),this.paintMap[t.id]={count:1,paint:t,svgPaint:e},this.defs.appendChild(e.definition)}},decrementPaint:function(t){if(this.paintMap.hasOwnProperty(t.id)){var e=this.paintMap[t.id];1===e.count?(this.defs.removeChild(e.svgPaint.definition),e.svgPaint.dispose(),delete this.paintMap[t.id]):e.count--}},markDirtyGradient:function(t){this.dirtyGradients.push(t),this.markDirty()},markDirtyGroup:function(t){this.dirtyGroups.push(t),this.markDirty()},markDirtyDrawable:function(t){this.dirtyDrawables.push(t),this.markDirty()},setSizeFullDisplay:function(){this.baseTransformGroup.removeAttribute("transform"),h.unsetTransform(this.svg);var t=this.display.getSize();this.svg.setAttribute("width",t.width),this.svg.setAttribute("height",t.height)},setSizeFitBounds:function(){var t=this.fitBounds.minX,e=this.fitBounds.minY;this.baseTransformGroup.setAttribute("transform","translate("+-t+","+-e+")"),h.setTransform("matrix(1,0,0,1,"+t+","+e+")",this.svg,this.forceAcceleration),this.svg.setAttribute("width",this.fitBounds.width),this.svg.setAttribute("height",this.fitBounds.height)},update:function(){if(!n.prototype.update.call(this))return!1;for(;this.dirtyGroups.length;){var t=this.dirtyGroups.pop();t.block===this&&t.update()}for(;this.dirtyGradients.length;)this.dirtyGradients.pop().update();for(;this.dirtyDrawables.length;){var e=this.dirtyDrawables.pop();e.parentDrawable===this&&e.update()}return this.updateFit(),!0},dispose:function(){for(this.svg.setAttribute("width",0),this.svg.setAttribute("height",0),this.filterRootInstance=null,i(this.dirtyGradients),i(this.dirtyGroups),i(this.dirtyDrawables),this.paintMap={},this.baseTransformGroup.removeChild(this.rootGroup.svgGroup),this.rootGroup.dispose(),this.rootGroup=null;this.defs.childNodes.length;)this.defs.removeChild(this.defs.childNodes[0]);n.prototype.dispose.call(this)},addDrawable:function(t){n.prototype.addDrawable.call(this,t),o.addDrawable(this,t),t.updateSVGBlock(this)},removeDrawable:function(t){o.removeDrawable(this,t),n.prototype.removeDrawable.call(this,t)},onIntervalChange:function(t,e){n.prototype.onIntervalChange.call(this,t,e)},toString:function(){return"SVGBlock#"+this.id+"-"+n.fitString[this.fit]}}),r.mixInto(e,{initialize:e.prototype.initialize}),e}),i("SCENERY/util/ShaderProgram",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/util/Util"],function(t){"use strict";function e(t,e,i,n){n=_.extend({attributes:[],uniforms:[]},n),this.vertexSource=e,this.fragmentSource=i,this.attributeNames=n.attributes,this.uniformNames=n.uniforms,this.initialize(t)}var i=t("PHET_CORE/inherit"),n=t("SCENERY/scenery"),s=t("SCENERY/util/Util");return n.register("ShaderProgram",e),i(Object,e,{initialize:function(t){var e=this;this.gl=t,this.used=!1,this.program=this.gl.createProgram(),this.vertexShader=s.createShader(this.gl,this.vertexSource,this.gl.VERTEX_SHADER),this.fragmentShader=s.createShader(this.gl,this.fragmentSource,this.gl.FRAGMENT_SHADER),this.gl.attachShader(this.program,this.vertexShader),this.gl.attachShader(this.program,this.fragmentShader),this.gl.linkProgram(this.program),this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS)||(console.log("GLSL link error:"),console.log(this.gl.getProgramInfoLog(this.program)),console.log("for vertex shader"),console.log(this.vertexSource),console.log("for fragment shader"),console.log(this.fragmentSource)),this.gl.deleteShader(this.vertexShader),this.gl.deleteShader(this.fragmentShader),this.uniformLocations={},this.attributeLocations={},this.activeAttributes={},_.each(this.attributeNames,function(t){e.attributeLocations[t]=e.gl.getAttribLocation(e.program,t),e.activeAttributes[t]=!0}),_.each(this.uniformNames,function(t){e.uniformLocations[t]=e.gl.getUniformLocation(e.program,t)}),this.isInitialized=!0},use:function(){if(!this.used){var t=this;this.used=!0,this.gl.useProgram(this.program),_.each(this.attributeNames,function(e){t.activeAttributes[e]&&t.enableVertexAttribArray(e)})}},activateAttribute:function(t){this.activeAttributes[t]||(this.activeAttributes[t]=!0,this.used&&this.enableVertexAttribArray(t))},enableVertexAttribArray:function(t){this.gl.enableVertexAttribArray(this.attributeLocations[t])},unuse:function(){if(this.used){var t=this;this.used=!1,_.each(this.attributeNames,function(e){t.activeAttributes[e]&&t.disableVertexAttribArray(e)})}},disableVertexAttribArray:function(t){this.gl.disableVertexAttribArray(this.attributeLocations[t])},deactivateAttribute:function(t){this.activeAttributes[t]&&(this.activeAttributes[t]=!1,this.used&&this.disableVertexAttribArray(t))},dispose:function(){this.gl.deleteProgram(this.program)}})}),i("SCENERY/util/SpriteSheet",["require","DOT/BinPacker","DOT/Bounds2","DOT/Dimension2","PHET_CORE/inherit","SCENERY/scenery"],function(t){"use strict";function e(t){this.useMipmaps=t,this.gl=null,this.texture=null,this.bounds=new n(0,0,o.width,o.height),this.width=this.bounds.width,this.height=this.bounds.height,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.binPacker=new i(this.bounds),this.dirty=!0,this.usedSprites=[],this.unusedSprites=[]}var i=t("DOT/BinPacker"),n=t("DOT/Bounds2"),s=t("DOT/Dimension2"),r=t("PHET_CORE/inherit"),a=t("SCENERY/scenery"),o=new s(1024,1024);return a.register("SpriteSheet",e),r(Object,e,{initializeContext:function(t){this.gl=t,this.createTexture()},createTexture:function(){var t=this.gl;this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this.useMipmaps?t.LINEAR_MIPMAP_LINEAR:t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.canvas),this.useMipmaps&&(t.hint(t.GENERATE_MIPMAP_HINT,t.NICEST),t.generateMipmap(t.TEXTURE_2D)),t.bindTexture(t.TEXTURE_2D,null),this.dirty=!1},updateTexture:function(){if(this.dirty){this.dirty=!1;var t=this.gl;t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.canvas),this.useMipmaps&&(t.hint(t.GENERATE_MIPMAP_HINT,t.NICEST),t.generateMipmap(t.TEXTURE_2D)),t.bindTexture(t.TEXTURE_2D,null)}},addImage:function(t,i,s){var r;for(r=0;r<this.usedSprites.length;r++){var a=this.usedSprites[r];if(a.image===t)return a.count++,a}for(r=0;r<this.unusedSprites.length;r++){var o=this.unusedSprites[r];if(o.image===t)return o.count++,this.unusedSprites.splice(r,1),this.usedSprites.push(o),o}for(var h;!(h=this.binPacker.allocate(i+2+1,s+2+1))&&this.unusedSprites.length;){var l=this.unusedSprites.shift();this.dirty=!0;var u=l.bin.bounds;this.context.clearRect(u.x,u.y,u.width,u.height),this.binPacker.deallocate(l.bin)}if(h){var c=new n((h.bounds.minX+1)/this.width,(h.bounds.minY+1)/this.height,(h.bounds.maxX-1-1)/this.width,(h.bounds.maxY-1-1)/this.height),d=new e.Sprite(this,h,c,t,1);return this.copyImageWithGutter(t,i,s,h.bounds.x,h.bounds.y),this.dirty=!0,this.usedSprites.push(d),d}return null},removeImage:function(t){var e,i;for(i=0;i<this.usedSprites.length;i++)if(this.usedSprites[i].image===t){e=this.usedSprites[i];break}--e.count<=0&&(this.usedSprites.splice(i,1),this.unusedSprites.push(e))},containsImage:function(t){var e;for(e=0;e<this.usedSprites.length;e++)if(this.usedSprites[e].image===t)return!0;for(e=0;e<this.unusedSprites.length;e++)if(this.unusedSprites[e].image===t)return!0;return!1},copyImageWithGutter:function(t,e,i,n,s){this.copyImageRegion(t,1,1,0,0,n,s),this.copyImageRegion(t,1,1,e-1,0,n+1+e,s),this.copyImageRegion(t,1,1,e-1,i-1,n+1+e,s+1+i),this.copyImageRegion(t,1,1,0,i-1,n,s+1+i),this.copyImageRegion(t,e,1,0,0,n+1,s),this.copyImageRegion(t,e,1,0,i-1,n+1,s+1+i),this.copyImageRegion(t,1,i,0,0,n,s+1),this.copyImageRegion(t,1,i,e-1,0,n+1+e,s+1),this.context.drawImage(t,n+1,s+1)},copyImageRegion:function(t,e,i,n,s,r,a){this.context.drawImage(t,n,s,e,i,r,a,e,i)}}),e.Sprite=function(t,e,i,n,s){this.spriteSheet=t,this.bin=e,this.uvBounds=i,this.image=n,this.count=s},e.MAX_DIMENSION=o,e}),i("SCENERY/display/WebGLBlock",["require","PHET_CORE/cleanArray","AXON/Emitter","SCENERY/display/FittedBlock","PHET_CORE/inherit","DOT/Matrix3","PHET_CORE/Poolable","SCENERY/display/Renderer","SCENERY/scenery","SCENERY/util/ShaderProgram","SCENERY/util/SpriteSheet","SCENERY/util/Util"],function(t){"use strict";function e(t,e,i,n){this.initialize(t,e,i,n)}var i=t("PHET_CORE/cleanArray"),n=t("AXON/Emitter"),s=t("SCENERY/display/FittedBlock"),r=t("PHET_CORE/inherit"),a=t("DOT/Matrix3"),o=t("PHET_CORE/Poolable"),h=t("SCENERY/display/Renderer"),l=t("SCENERY/scenery"),u=t("SCENERY/util/ShaderProgram"),c=t("SCENERY/util/SpriteSheet"),d=t("SCENERY/util/Util");return l.register("WebGLBlock",e),r(s,e,{initialize:function(t,r,o,h){return this.initializeFittedBlock(t,r,o,s.FULL_DISPLAY),this.filterRootInstance=h,this.preserveDrawingBuffer=t.options.preserveDrawingBuffer,this.dirtyDrawables=i(this.dirtyDrawables),this.spriteSheets=this.spriteSheets||[],this.projectionMatrix=this.projectionMatrix||new a,this.projectionMatrixArray=new Float32Array(9),this.customProcessor=this.customProcessor||new e.CustomProcessor,this.vertexColorPolygonsProcessor=this.vertexColorPolygonsProcessor||new e.VertexColorPolygons(this.projectionMatrixArray),this.texturedTrianglesProcessor=this.texturedTrianglesProcessor||new e.TexturedTrianglesProcessor(this.projectionMatrixArray),this.glChangedEmitter=new n,this.isContextLost=!1,this.contextLostListener=this.onContextLoss.bind(this),this.contextRestoreListener=this.onContextRestoration.bind(this),this.domElement||(this.domElement=document.createElement("div"),this.domElement.className="webgl-container",this.domElement.style.position="absolute",this.domElement.style.left="0",this.domElement.style.top="0",this.rebuildCanvas()),this.gl.clear(this.gl.COLOR_BUFFER_BIT),d.prepareForTransform(this.canvas,!1),d.unsetTransform(this.canvas),this},rebuildCanvas:function(){var t=document.createElement("canvas"),e=this.getContextFromCanvas(t);e&&(this.canvas&&(this.domElement.removeChild(this.canvas),this.canvas.removeEventListener("webglcontextlost",this.contextLostListener,!1),this.canvas.removeEventListener("webglcontextrestored",this.contextRestoreListener,!1)),this.canvas=t,this.canvas.style.pointerEvents="none",this.canvasId=this.canvas.id="scenery-webgl"+this.id,this.canvas.addEventListener("webglcontextlost",this.contextLostListener,!1),this.canvas.addEventListener("webglcontextrestored",this.contextRestoreListener,!1),this.domElement.appendChild(this.canvas),this.setupContext(e))},setupContext:function(t){this.isContextLost=!1,this.gl=t,this.backingScale=d.backingScale(this.gl),this.display._allowBackingScaleAntialiasing&&0===t.getParameter(t.SAMPLES)&&(this.backingScale*=2),this.originalBackingScale=this.backingScale,d.applyWebGLContextDefaults(this.gl),this.markDirty(),this.dirtyFit=!0,this.customProcessor.initializeContext(this.gl),this.vertexColorPolygonsProcessor.initializeContext(this.gl),this.texturedTrianglesProcessor.initializeContext(this.gl);for(var e=0;e<this.spriteSheets.length;e++)this.spriteSheets[e].initializeContext(this.gl);this.glChangedEmitter.emit()},delayedRebuildCanvas:function(){var t=this;window.setTimeout(function(){t.rebuildCanvas()})},onContextLoss:function(t){this.isContextLost||(this.isContextLost=!0,t.preventDefault(),this.canvas.style.display="none",this.markDirty())},onContextRestoration:function(t){if(this.isContextLost){var e=this.getContextFromCanvas(this.canvas);this.setupContext(e),this.canvas.style.display=""}},getContextFromCanvas:function(t){var e={antialias:!0,preserveDrawingBuffer:this.preserveDrawingBuffer};return t.getContext("webgl",e)||t.getContext("experimental-webgl",e)},setSizeFullDisplay:function(){var t=this.display.getSize();this.canvas.width=Math.ceil(t.width*this.backingScale),this.canvas.height=Math.ceil(t.height*this.backingScale),this.canvas.style.width=t.width+"px",this.canvas.style.height=t.height+"px"},setSizeFitBounds:function(){throw new Error("setSizeFitBounds unimplemented for WebGLBlock")},update:function(){if(!s.prototype.update.call(this))return!1;var t=this.gl;for(this.isContextLost&&this.display._aggressiveContextRecreation&&this.delayedRebuildCanvas();this.dirtyDrawables.length;)this.dirtyDrawables.pop().update();for(var e=this.spriteSheets.length,i=0;i<e;i++)this.spriteSheets[i].updateTexture();this.firstDrawable&&this.firstDrawable===this.lastDrawable&&this.firstDrawable.node&&null!==this.firstDrawable.node._hints.webglScale&&this.backingScale!==this.originalBackingScale*this.firstDrawable.node._hints.webglScale&&(this.backingScale=this.originalBackingScale*this.firstDrawable.node._hints.webglScale,this.dirtyFit=!0),this.updateFit(),this.projectionMatrix.rowMajor(2/this.display.width,0,-1,0,-2/this.display.height,1,0,0,1),this.projectionMatrix.copyToArray(this.projectionMatrixArray),this.preserveDrawingBuffer&&t.clear(t.COLOR_BUFFER_BIT),t.viewport(0,0,this.canvas.width,this.canvas.height);for(var n=null,r=0,a=this.firstDrawable;null!==a;a=a.nextDrawable){if(a.visible){var o=null;a.webglRenderer===h.webglTexturedTriangles?o=this.texturedTrianglesProcessor:a.webglRenderer===h.webglCustom?o=this.customProcessor:a.webglRenderer===h.webglVertexColorPolygons&&(o=this.vertexColorPolygonsProcessor),o!==n&&(n&&(r+=n.deactivate()),(n=o).activate()),n.processDrawable(a)}if(a===this.lastDrawable)break}return n&&(r+=n.deactivate()),0!==r||this.preserveDrawingBuffer||t.clear(t.COLOR_BUFFER_BIT),t.flush(),!0},dispose:function(){i(this.dirtyDrawables),s.prototype.dispose.call(this)},markDirtyDrawable:function(t){this.dirtyDrawables.push(t),this.markDirty()},addDrawable:function(t){s.prototype.addDrawable.call(this,t),t.onAddToBlock(this)},removeDrawable:function(t){for(var e=0;(e=this.dirtyDrawables.indexOf(t,e))>=0;)this.dirtyDrawables.splice(e,1);t.onRemoveFromBlock(this),s.prototype.removeDrawable.call(this,t)},addSpriteSheetImage:function(t,e,i){for(var n=null,s=this.spriteSheets.length,r=0;r<s;r++){if(n=this.spriteSheets[r].addImage(t,e,i))break}if(!n){var a=new c(!0);if(n=a.addImage(t,e,i),a.initializeContext(this.gl),this.spriteSheets.push(a),!n)throw new Error("Attempt to load image that is too large for sprite sheets")}return n},removeSpriteSheetImage:function(t){t.spriteSheet.removeImage(t.image)},onIntervalChange:function(t,e){s.prototype.onIntervalChange.call(this,t,e),this.markDirty()},onPotentiallyMovedDrawable:function(t){this.markDirty()},toString:function(){return"WebGLBlock#"+this.id+"-"+s.fitString[this.fit]}}),e.CustomProcessor=function(){this.drawable=null},r(Object,e.CustomProcessor,{initializeContext:function(t){},activate:function(){this.drawCount=0},processDrawable:function(t){this.drawable=t,this.draw()},deactivate:function(){return this.drawCount},draw:function(){if(this.drawable){var t=this.drawable.draw();this.drawCount+=t,this.drawable=null}}}),e.VertexColorPolygons=function(t){this.projectionMatrixArray=t,this.lastArrayLength=128,this.vertexArray=new Float32Array(this.lastArrayLength)},r(Object,e.VertexColorPolygons,{initializeContext:function(t){this.gl=t,this.shaderProgram=new u(t,["attribute vec2 aVertex;","attribute vec4 aColor;","varying vec4 vColor;","uniform mat3 uProjectionMatrix;","void main() {","  vColor = aColor;","  vec3 ndc = uProjectionMatrix * vec3( aVertex, 1.0 );","  gl_Position = vec4( ndc.xy, 0.0, 1.0 );","}"].join("\n"),["precision mediump float;","varying vec4 vColor;","void main() {","  gl_FragColor = vec4( vColor.rgb * vColor.a, vColor.a );","}"].join("\n"),{attributes:["aVertex","aColor"],uniforms:["uProjectionMatrix"]}),this.vertexBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.DYNAMIC_DRAW)},activate:function(){this.shaderProgram.use(),this.vertexArrayIndex=0,this.drawCount=0},processDrawable:function(t){if(t.includeVertices){for(var e=t.vertexArray;e.length+this.vertexArrayIndex>this.vertexArray.length;){var i=new Float32Array(2*this.vertexArray.length);i.set(this.vertexArray),this.vertexArray=i}this.vertexArray.set(e,this.vertexArrayIndex),this.vertexArrayIndex+=e.length,this.drawCount++}},deactivate:function(){return this.drawCount&&this.draw(),this.shaderProgram.unuse(),this.drawCount},draw:function(){var t=this.gl;t.uniformMatrix3fv(this.shaderProgram.uniformLocations.uProjectionMatrix,!1,this.projectionMatrixArray),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray.length>this.lastArrayLength?t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.DYNAMIC_DRAW):t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray.subarray(0,this.vertexArrayIndex));var e=Float32Array.BYTES_PER_ELEMENT,i=6*e;t.vertexAttribPointer(this.shaderProgram.attributeLocations.aVertex,2,t.FLOAT,!1,i,0*e),t.vertexAttribPointer(this.shaderProgram.attributeLocations.aColor,4,t.FLOAT,!1,i,2*e),t.drawArrays(t.TRIANGLES,0,this.vertexArrayIndex/6),this.vertexArrayIndex=0}}),e.TexturedTrianglesProcessor=function(t){this.projectionMatrixArray=t,this.lastArrayLength=128,this.vertexArray=new Float32Array(this.lastArrayLength)},r(Object,e.TexturedTrianglesProcessor,{initializeContext:function(t){this.gl=t,this.shaderProgram=new u(t,["attribute vec2 aVertex;","attribute vec2 aTextureCoord;","attribute float aAlpha;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform mat3 uProjectionMatrix;","void main() {","  vTextureCoord = aTextureCoord;","  vAlpha = aAlpha;","  vec3 ndc = uProjectionMatrix * vec3( aVertex, 1.0 );","  gl_Position = vec4( ndc.xy, 0.0, 1.0 );","}"].join("\n"),["precision mediump float;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform sampler2D uTexture;","void main() {","  vec4 color = texture2D( uTexture, vTextureCoord, -0.7 );","  color.a *= vAlpha;","  gl_FragColor = color;","}"].join("\n"),{attributes:["aVertex","aTextureCoord","aAlpha"],uniforms:["uTexture","uProjectionMatrix"]}),this.vertexBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.DYNAMIC_DRAW)},activate:function(){this.shaderProgram.use(),this.currentSpriteSheet=null,this.vertexArrayIndex=0,this.drawCount=0},processDrawable:function(t){if(t.sprite){this.currentSpriteSheet&&t.sprite.spriteSheet!==this.currentSpriteSheet&&this.draw(),this.currentSpriteSheet=t.sprite.spriteSheet;for(var e=t.vertexArray;e.length+this.vertexArrayIndex>this.vertexArray.length;){var i=new Float32Array(2*this.vertexArray.length);i.set(this.vertexArray),this.vertexArray=i}this.vertexArray.set(e,this.vertexArrayIndex),this.vertexArrayIndex+=e.length}},deactivate:function(){return this.currentSpriteSheet&&this.draw(),this.shaderProgram.unuse(),this.drawCount},draw:function(){var t=this.gl;t.uniformMatrix3fv(this.shaderProgram.uniformLocations.uProjectionMatrix,!1,this.projectionMatrixArray),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray.length>this.lastArrayLength?t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.DYNAMIC_DRAW):t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray.subarray(0,this.vertexArrayIndex));var e=Float32Array.BYTES_PER_ELEMENT,i=5*e;t.vertexAttribPointer(this.shaderProgram.attributeLocations.aVertex,2,t.FLOAT,!1,i,0*e),t.vertexAttribPointer(this.shaderProgram.attributeLocations.aTextureCoord,2,t.FLOAT,!1,i,2*e),t.vertexAttribPointer(this.shaderProgram.attributeLocations.aAlpha,1,t.FLOAT,!1,i,4*e),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.currentSpriteSheet.texture),t.uniform1i(this.shaderProgram.uniformLocations.uTexture,0),t.drawArrays(t.TRIANGLES,0,this.vertexArrayIndex/5),t.bindTexture(t.TEXTURE_2D,null),this.drawCount++,this.currentSpriteSheet=null,this.vertexArrayIndex=0}}),o.mixInto(e,{initialize:e.prototype.initialize}),e}),i("SCENERY/display/Stitcher",["require","SCENERY/display/CanvasBlock","PHET_CORE/cleanArray","SCENERY/display/DOMBlock","SCENERY/display/Drawable","PHET_CORE/inherit","SCENERY/display/Renderer","SCENERY/scenery","SCENERY/display/SVGBlock","SCENERY/display/WebGLBlock"],function(t){"use strict";function e(t,e){throw new Error("We are too abstract for that!")}var i=t("SCENERY/display/CanvasBlock"),n=t("PHET_CORE/cleanArray"),s=t("SCENERY/display/DOMBlock"),r=(t("SCENERY/display/Drawable"),t("PHET_CORE/inherit")),a=t("SCENERY/display/Renderer"),o=t("SCENERY/scenery"),h=t("SCENERY/display/SVGBlock"),l=t("SCENERY/display/WebGLBlock");return o.register("Stitcher",e),r(Object,e,{initialize:function(t,e,i,s,r,a,o){this.backbone=t,this.firstDrawable=e,this.lastDrawable=i,this.touchedBlocks=n(this.touchedBlocks)},clean:function(){this.backbone=null,this.firstDrawable=null,this.lastDrawable=null},recordBackboneBoundaries:function(){this.backbone.previousFirstDrawable=this.firstDrawable,this.backbone.previousLastDrawable=this.lastDrawable},notePendingAddition:function(t,e){t.notePendingAddition(this.backbone.display,e,this.backbone)},notePendingMove:function(t,e){t.notePendingMove(this.backbone.display,e)},notePendingRemoval:function(t){t.notePendingRemoval(this.backbone.display)},markBlockForDisposal:function(t){t.domElement.parentNode===this.backbone.domElement&&this.backbone.domElement.removeChild(t.domElement),t.markForDisposal(this.backbone.display)},removeAllBlocks:function(){for(;this.backbone.blocks.length;){var t=this.backbone.blocks[0];this.removeBlock(t),this.markBlockForDisposal(t)}},notifyInterval:function(t,e,i){t.notifyInterval(e,i),this.backbone.markDirtyDrawable(t)},markBeforeBlock:function(t,e){t.pendingFirstDrawable=e,this.touchedBlocks.push(t)},markAfterBlock:function(t,e){t.pendingLastDrawable=e,this.touchedBlocks.push(t)},updateBlockIntervals:function(){for(;this.touchedBlocks.length;){var t=this.touchedBlocks.pop();t.used&&(t.updateInterval(),this.backbone.markDirtyDrawable(t))}},createBlock:function(t,e){var n,r=this.backbone;if(a.isCanvas(t))n=i.createFromPool(r.display,t,r.transformRootInstance,r.backboneInstance);else if(a.isSVG(t))n=h.createFromPool(r.display,t,r.transformRootInstance,r.backboneInstance);else if(a.isDOM(t))n=s.createFromPool(r.display,e);else{if(!a.isWebGL(t))throw new Error("unsupported renderer for createBlock: "+t);n=l.createFromPool(r.display,t,r.transformRootInstance,r.backboneInstance)}return n.setBlockBackbone(r),r.domElement.appendChild(n.domElement),r.isDisplayRoot&&n.domElement.setAttribute("aria-hidden",!0),r.markDirtyDrawable(n),n},appendBlock:function(t){this.backbone.blocks.push(t)},removeBlock:function(t){var e=_.indexOf(this.backbone.blocks,t);this.backbone.blocks.splice(e,1)},useNoBlocks:function(){n(this.backbone.blocks)},reindex:function(){this.backbone.reindexBlocks()},auditStitch:function(){}}),e.debugIntervals=function(t){},e.debugDrawables=function(t,e,i,n,s){},e}),i("SCENERY/display/GreedyStitcher",["require","PHET_CORE/cleanArray","PHET_CORE/inherit","SCENERY/display/Renderer","SCENERY/scenery","SCENERY/display/Stitcher"],function(t){"use strict";function e(t,e){return t.renderer!==e.renderer||h.isDOM(t.renderer)||h.isDOM(e.renderer)}function i(t){return null!==t.previousDrawable&&!e(t.previousDrawable,t)}function n(t){return null!==t.nextDrawable&&!e(t,t.nextDrawable)}function s(t,e,i){return t.drawableBefore?t.drawableBefore.oldNextDrawable!==t.drawableAfter:t.drawableAfter?t.drawableAfter.oldPreviousDrawable!==t.drawableBefore:null!==e}function r(t,e,i){var n=t.drawableBefore?t.drawableBefore.parentDrawable:null,s=t.drawableAfter?t.drawableAfter.parentDrawable:null;return(!n||!s||n!==s)&&(n?n.nextBlock!==s:s?s.previousBlock!==n:null!==e)}var a=t("PHET_CORE/cleanArray"),o=t("PHET_CORE/inherit"),h=t("SCENERY/display/Renderer"),l=t("SCENERY/scenery"),u={stitch:function(t,e,i,n,o,h,l){this.initialize(t,e,i,n,o,h,l),this.blockOrderChanged=!1,this.reusableBlocks=a(this.reusableBlocks),this.blockWasAdded=!1;var u;if(this.recordBackboneBoundaries(),t.blocks.length){var c=t.blocks[0];t.blocks[t.blocks.length-1];for(u=h;null!==u;u=u.nextChangeInterval){if(s(u,n))for(var d=u.drawableBefore?u.drawableBefore.oldNextDrawable:n,f=u.drawableAfter?u.drawableAfter.oldPreviousDrawable:o,m=d;this.notePendingRemoval(m),m!==f;m=m.oldNextDrawable);if(r(u,c))for(var p=null===u.drawableBefore?t.blocks[0]:u.drawableBefore.parentDrawable.nextBlock,g=null===u.drawableAfter?t.blocks[t.blocks.length-1]:u.drawableAfter.parentDrawable.previousBlock,v=p;this.unuseBlock(v),v!==g;v=v.nextBlock);}}if(e)for(u=h;null!==u;u=u.nextChangeInterval)this.processInterval(t,u,e,i);this.removeUnusedBlocks(),this.updateBlockIntervals(),null===e?this.useNoBlocks():this.blockOrderChanged&&(this.processBlockLinkedList(t,e.pendingParentDrawable,i.pendingParentDrawable),this.reindex()),this.clean(),a(this.reusableBlocks)},processInterval:function(t,s,r,a){if(function(t,e,i){return t.drawableBefore?t.drawableBefore.nextDrawable!==t.drawableAfter:t.drawableAfter?t.drawableAfter.previousDrawable!==t.drawableBefore:null!==e}(s,r))for(var o=s.drawableBefore?s.drawableBefore.nextDrawable:r,h=null,l=null,u=!0;;){var c=o.nextDrawable,d=c===s.drawableAfter;if(h||(h=o),null===l&&o.parentDrawable&&!o.parentDrawable.used&&o.backbone===t&&o.parentDrawable.parentDrawable===t&&(l=o.parentDrawable),(d||e(o,c))&&(u&&this.processEdgeCases(s,i(h),n(o)),this.processSubBlock(s,h,o,l,u,d),h=null,l=null,u=!1),d)break;o=c}else{if(s.drawableBefore&&s.drawableAfter){var f=!e(s.drawableBefore,s.drawableAfter);this.processEdgeCases(s,f,f)}s.drawableBefore&&!n(s.drawableBefore)?this.linkAfterDrawable(s.drawableBefore):s.drawableAfter&&!i(s.drawableAfter)&&this.linkBeforeDrawable(s.drawableAfter)}},processSubBlock:function(t,e,s,r,a,o){var h=i(e),l=n(s);h&&(r=e.previousDrawable.pendingParentDrawable),l&&(r=s.nextDrawable.pendingParentDrawable),r=this.ensureUsedBlock(r,e);for(var u=e;this.notePendingAddition(u,r),u!==s;u=u.nextDrawable);h||this.linkBeforeDrawable(e),o&&!l&&this.linkAfterDrawable(s)},processEdgeCases:function(t,e,i){if(null!==t.drawableBefore&&null!==t.drawableAfter){var n=t.drawableBefore.pendingParentDrawable,s=t.drawableAfter.pendingParentDrawable,r=t.nextChangeInterval&&t.nextChangeInterval.drawableAfter?t.nextChangeInterval.drawableAfter.pendingParentDrawable:null;n===s&&(this.blockWasAdded=!0);var a;e&&i?a=n:this.blockWasAdded||n===s?(a=this.createBlock(t.drawableAfter.renderer,t.drawableAfter),this.blockOrderChanged=!0):a=s,s===a?this.blockWasAdded=!0:this.changeExternals(t,a),r!==s&&(this.blockWasAdded||this.unuseBlock(s),this.blockWasAdded=!1)}},changeExternals:function(t,e){var i=function(t){var e=t.drawableAfter;if(e){for(var i=e.renderer,n=t.nextChangeInterval?t.nextChangeInterval.drawableBefore.nextDrawable:null,s=e;;){var r=s.nextDrawable;if(r===n||r.renderer!==i)break;s=r}return s}return null}(t);this.notePendingMoves(e,t.drawableAfter,i),t.nextChangeInterval&&t.nextChangeInterval.drawableBefore===i||this.linkAfterDrawable(i)},notePendingMoves:function(t,e,i){for(var n=e;this.notePendingMove(n,t),n!==i;n=n.nextDrawable);},ensureUsedBlock:function(t,e){return t?t.used||this.useBlock(t):t=this.getBlockForRenderer(e.renderer,e),t},getBlockForRenderer:function(t,e){var i;if(!h.isDOM(t))for(var n=this.reusableBlocks.length-1;n>=0;n--){var s=this.reusableBlocks[n];if(s.renderer===t){this.useBlockAtIndex(s,n),i=s;break}}return i||(i=this.createBlock(t,e)),this.blockOrderChanged=!0,i},unuseBlock:function(t){t.used&&(t.used=!1,this.reusableBlocks.push(t))},useBlock:function(t){this.useBlockAtIndex(t,_.indexOf(this.reusableBlocks,t))},useBlockAtIndex:function(t,e){this.reusableBlocks.splice(e,1),t.used=!0},removeUnusedBlocks:function(){for(;this.reusableBlocks.length;){var t=this.reusableBlocks.pop();this.markBlockForDisposal(t),this.blockOrderChanged=!0}},linkBeforeDrawable:function(t){var e=t.previousDrawable;this.linkBlocks(e?e.pendingParentDrawable:null,t.pendingParentDrawable,e,t)},linkAfterDrawable:function(t){var e=t.nextDrawable;this.linkBlocks(t.pendingParentDrawable,e?e.pendingParentDrawable:null,t,e)},linkBlocks:function(t,e,i,n){t&&(t.nextBlock!==e&&(this.blockOrderChanged=!0,t.nextBlock&&(t.nextBlock.previousBlock=null),t.nextBlock=e),this.markAfterBlock(t,i)),e&&(e.previousBlock!==t&&(this.blockOrderChanged=!0,e.previousBlock&&(e.previousBlock.nextBlock=null),e.previousBlock=t),this.markBeforeBlock(e,n))},processBlockLinkedList:function(t,e,i){for(;t.blocks.length;)t.blocks.pop();if(e)for(var n=e;t.blocks.push(n),n!==i;n=n.nextBlock);}},c=o(t("SCENERY/display/Stitcher"),function(){},u);return l.register("GreedyStitcher",c),c.stitchPrototype=u,c}),i("SCENERY/display/RebuildStitcher",["require","PHET_CORE/inherit","SCENERY/display/Renderer","SCENERY/scenery","SCENERY/display/Stitcher"],function(t){"use strict";var e=t("PHET_CORE/inherit"),i=t("SCENERY/display/Renderer"),n=t("SCENERY/scenery"),s={stitch:function(t,e,n,s,r,a,o){this.initialize(t,e,n,s,r,a,o);for(var h=t.previousFirstDrawable;null!==h&&(this.notePendingRemoval(h),h!==t.previousLastDrawable);h=h.oldNextDrawable);this.recordBackboneBoundaries(),this.removeAllBlocks();for(var l=null,u=0,c=null,d=e;null!==d&&(l&&d.renderer===u||(l&&this.notifyInterval(l,c,d.previousDrawable),u=d.renderer,l=this.createBlock(u,d),i.isDOM(u)&&(u=0),this.appendBlock(l),c=d),this.notePendingAddition(d,l),d!==n);d=d.nextDrawable);l&&this.notifyInterval(l,c,n),this.reindex(),this.clean()}},r=e(t("SCENERY/display/Stitcher"),function(){},s);return n.register("RebuildStitcher",r),r.stitchPrototype=s,r}),i("SCENERY/display/BackboneDrawable",["require","PHET_CORE/cleanArray","SCENERY/display/Drawable","SCENERY/display/GreedyStitcher","PHET_CORE/inherit","PHET_CORE/Poolable","SCENERY/display/RebuildStitcher","SCENERY/scenery","SCENERY/display/Stitcher","SCENERY/util/Util"],function(t){"use strict";function e(t,e,i,n,s){this.initialize(t,e,i,n,s)}var i=t("PHET_CORE/cleanArray"),n=t("SCENERY/display/Drawable"),s=t("SCENERY/display/GreedyStitcher"),r=t("PHET_CORE/inherit"),a=t("PHET_CORE/Poolable"),o=(t("SCENERY/display/RebuildStitcher"),t("SCENERY/scenery")),h=(t("SCENERY/display/Stitcher"),t("SCENERY/util/Util"));return o.register("BackboneDrawable",e),r(n,e,{initialize:function(t,r,a,o,l){if(n.call(this,o),this.display=t,this.forceAcceleration=!1,this.backboneInstance=r,this.transformRootInstance=a,this.filterRootAncestorInstance=r.parent?r.parent.getFilterRootInstance():r,this.transformRootAncestorInstance=r.parent?r.parent.getTransformRootInstance():r,this.willApplyTransform=this.transformRootAncestorInstance!==this.transformRootInstance,this.willApplyFilters=this.filterRootAncestorInstance!==this.backboneInstance,this.transformListener=this.transformListener||this.markTransformDirty.bind(this),this.willApplyTransform&&(this.backboneInstance.relativeTransform.addListener(this.transformListener),this.backboneInstance.relativeTransform.addPrecompute()),this.backboneVisibilityListener=this.backboneVisibilityListener||this.updateBackboneVisibility.bind(this),this.backboneInstance.onStatic("relativeVisibility",this.backboneVisibilityListener),this.updateBackboneVisibility(),this.visibilityDirty=!0,this.renderer=o,this.domElement=l?t._domElement:e.createDivBackbone(),this.isDisplayRoot=l,this.dirtyDrawables=i(this.dirtyDrawables),h.prepareForTransform(this.domElement,this.forceAcceleration),this.watchedFilterNodes=i(this.watchedFilterNodes),this.opacityDirty=!0,this.clipDirty=!0,this.opacityDirtyListener=this.opacityDirtyListener||this.markOpacityDirty.bind(this),this.clipDirtyListener=this.clipDirtyListener||this.markClipDirty.bind(this),this.willApplyFilters)for(var u=this.backboneInstance;u!==this.filterRootAncestorInstance;u=u.parent){var c=u.node;this.watchedFilterNodes.push(c),c.onStatic("opacity",this.opacityDirtyListener),c.onStatic("clip",this.clipDirtyListener)}return this.lastZIndex=0,this.blocks=this.blocks||[],this.previousFirstDrawable=null,this.previousLastDrawable=null,this.removedDrawables=!1,this.stitcher=this.stitcher||new s,this},dispose:function(){for(;this.watchedFilterNodes.length;){var t=this.watchedFilterNodes.pop();t.offStatic("opacity",this.opacityDirtyListener),t.offStatic("clip",this.clipDirtyListener)}if(this.backboneInstance.offStatic("relativeVisibility",this.backboneVisibilityListener),!this.removedDrawables)for(var e=this.previousFirstDrawable;null!==e&&(e.parentDrawable.removeDrawable(e),e!==this.previousLastDrawable);e=e.nextDrawable);this.markBlocksForDisposal(),this.willApplyTransform&&(this.backboneInstance.relativeTransform.removeListener(this.transformListener),this.backboneInstance.relativeTransform.removePrecompute()),this.backboneInstance=null,this.transformRootInstance=null,this.filterRootAncestorInstance=null,this.transformRootAncestorInstance=null,i(this.dirtyDrawables),i(this.watchedFilterNodes),this.previousFirstDrawable=null,this.previousLastDrawable=null,n.prototype.dispose.call(this)},markBlocksForDisposal:function(){for(;this.blocks.length;){var t=this.blocks.pop();t.domElement.parentNode===this.domElement&&this.domElement.removeChild(t.domElement),t.markForDisposal(this.display)}},updateBackboneVisibility:function(){this.visible=this.backboneInstance.relativeVisible,this.visibilityDirty||(this.visibilityDirty=!0,this.markDirty())},markForDisposal:function(t){for(var e=this.previousFirstDrawable;null!==e&&(e.notePendingRemoval(this.display),e!==this.previousLastDrawable);e=e.oldNextDrawable);this.removedDrawables=!0,n.prototype.markForDisposal.call(this,t)},markDirtyDrawable:function(t){this.dirtyDrawables.push(t),this.markDirty()},markTransformDirty:function(){o.Util.applyPreparedTransform(this.backboneInstance.relativeTransform.matrix,this.domElement,this.forceAcceleration)},markOpacityDirty:function(){this.opacityDirty||(this.opacityDirty=!0,this.markDirty())},markClipDirty:function(){this.clipDirty||(this.clipDirty=!0,this.markDirty())},update:function(){if(!n.prototype.update.call(this))return!1;for(;this.dirtyDrawables.length;)this.dirtyDrawables.pop().update();if(this.opacityDirty){this.opacityDirty=!1;var t=this.willApplyFilters?this.getFilterOpacity():1;this.domElement.style.opacity=1!==t?t:""}return this.visibilityDirty&&(this.visibilityDirty=!1,this.domElement.style.display=this.visible?"":"none"),this.clipDirty&&(this.clipDirty=!1),!0},getFilterOpacity:function(){for(var t=1,e=this.watchedFilterNodes.length,i=0;i<e;i++)t*=this.watchedFilterNodes[i].getOpacity();return t},getFilterVisibility:function(){for(var t=this.watchedFilterNodes.length,e=0;e<t;e++)if(!this.watchedFilterNodes[e].isVisible())return!1;return!0},getFilterClip:function(){return""},reindexBlocks:function(){for(var t=0,e=0;e<this.blocks.length;e++){var i=this.blocks[e];if(i.zIndex<=t){var n=e+1<this.blocks.length&&this.blocks[e+1].zIndex-1>t?Math.ceil((t+this.blocks[e+1].zIndex)/2):t+20;i.domElement.style.zIndex=i.zIndex=n}t=i.zIndex}this.lastZIndex=t+1},stitch:function(t,e,i,n){if(null!==i&&null!==n){for(var s=null,r=i,a=!1;r;)a=r.constrict()||a,r.isEmpty()?s&&(s.nextChangeInterval=r.nextChangeInterval):(s||(i=r),s=r),r=r.nextChangeInterval;if(s){(n=s).nextChangeInterval=null;this.stitcher.stitch(this,t,e,this.previousFirstDrawable,this.previousLastDrawable,i,n)}}},audit:function(t,e,i){}}),e.createDivBackbone=function(){var t=document.createElement("div");return t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.width="0",t.style.height="0",t},e.repurposeBackboneContainer=function(t){return"relative"===t.style.position&&"absolute"===t.style.position||(t.style.position="relative"),t.style.left="0",t.style.top="0",t},a.mixInto(e,{initialize:e.prototype.initialize}),e}),i("SCENERY/display/SelfDrawable",["require","SCENERY/display/Drawable","PHET_CORE/inherit","SCENERY/scenery"],function(t){"use strict";function e(t,e){this.initializeSelfDrawable(t,e)}var i=t("SCENERY/display/Drawable"),n=t("PHET_CORE/inherit"),s=t("SCENERY/scenery");return s.register("SelfDrawable",e),n(s.Drawable,e,{initializeSelfDrawable:function(t,e){return this.drawableVisibilityListener=this.drawableVisibilityListener||this.updateSelfVisibility.bind(this),this.initializeDrawable(t),this.instance=e,this.node=e.trail.lastNode(),this.node.attachDrawable(this),this.instance.onStatic("selfVisibility",this.drawableVisibilityListener),this.updateSelfVisibility(),this},dispose:function(){this.instance.offStatic("selfVisibility",this.drawableVisibilityListener),this.node.detachDrawable(this),this.instance=null,this.node=null,i.prototype.dispose.call(this)},updateSelfVisibility:function(){this.visible=this.instance.selfVisible},toDetailedString:function(){return this.toString()+" ("+this.instance.trail.toPathString()+")"}}),e}),i("SCENERY/display/CanvasSelfDrawable",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/display/SelfDrawable"],function(t){"use strict";function e(t,e){throw this.initializeCanvasSelfDrawable(t,e),new Error("Should use initialization and pooling")}var i=t("PHET_CORE/inherit"),n=t("SCENERY/scenery"),s=t("SCENERY/display/SelfDrawable");return n.register("CanvasSelfDrawable",e),i(s,e,{initializeCanvasSelfDrawable:function(t,e){return this.initializeSelfDrawable(t,e),this.transformListener=this.transformListener||this.markTransformDirty.bind(this),e.relativeTransform.addListener(this.transformListener),e.relativeTransform.addPrecompute(),this},markTransformDirty:function(){this.markDirty()},markPaintDirty:function(){this.markDirty()},updateSelfVisibility:function(){s.prototype.updateSelfVisibility.call(this),this.markDirty()},dispose:function(){this.instance.relativeTransform.removeListener(this.transformListener),this.instance.relativeTransform.removePrecompute(),s.prototype.dispose.call(this)}}),e}),i("SCENERY/display/ChangeInterval",["require","SCENERY/display/Drawable","PHET_CORE/inherit","PHET_CORE/Poolable","SCENERY/scenery"],function(t){"use strict";function e(t,e){this.initialize(t,e)}t("SCENERY/display/Drawable");var i=t("PHET_CORE/inherit"),n=t("PHET_CORE/Poolable");return t("SCENERY/scenery").register("ChangeInterval",e),i(Object,e,{initialize:function(t,e){return this.nextChangeInterval=null,this.drawableBefore=t,this.drawableAfter=e,this.collapsedEmpty=!1,this},dispose:function(){this.nextChangeInterval=null,this.drawableBefore=null,this.drawableAfter=null,this.freeToPool()},constrict:function(){var t=!1;if(this.isEmpty())return!0;for(;this.drawableBefore&&this.drawableBefore.nextDrawable===this.drawableBefore.oldNextDrawable;)if(this.drawableBefore=this.drawableBefore.nextDrawable,t=!0,this.drawableBefore||(this.collapsedEmpty=!0),this.isEmpty())return!0;for(;this.drawableAfter&&this.drawableAfter.previousDrawable===this.drawableAfter.oldPreviousDrawable;)if(this.drawableAfter=this.drawableAfter.previousDrawable,t=!0,this.drawableAfter||(this.collapsedEmpty=!0),this.isEmpty())return!0;return t},isEmpty:function(){return this.collapsedEmpty||null!==this.drawableBefore&&this.drawableBefore===this.drawableAfter},getOldInternalDrawableCount:function(t,e){for(var i=this.drawableBefore?this.drawableBefore.oldNextDrawable:t,n=this.drawableAfter,s=0,r=i;r!==n;r=r.oldNextDrawable)s++;return s},getNewInternalDrawableCount:function(t,e){for(var i=this.drawableBefore?this.drawableBefore.nextDrawable:t,n=this.drawableAfter,s=0,r=i;r!==n;r=r.nextDrawable)s++;return s}}),n.mixInto(e,{initialize:e.prototype.initialize}),e.newForDisplay=function(t,i,n){var s=e.createFromPool(t,i);return n.markChangeIntervalToDispose(s),s},e}),i("SCENERY/display/DOMSelfDrawable",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/display/SelfDrawable","SCENERY/display/Renderer"],function(t){"use strict";function e(t,e){throw this.initializeDOMSelfDrawable(t,e),new Error("Should use initialization and pooling")}var i=t("PHET_CORE/inherit"),n=t("SCENERY/scenery"),s=t("SCENERY/display/SelfDrawable");return t("SCENERY/display/Renderer"),n.register("DOMSelfDrawable",e),i(s,e,{initializeDOMSelfDrawable:function(t,e){return this.transformListener=this.transformListener||this.markTransformDirty.bind(this),this.initializeSelfDrawable(t,e),this.forceAcceleration=!1,this.markTransformDirty(),this.visibilityDirty=!0,e.relativeTransform.addListener(this.transformListener),e.relativeTransform.addPrecompute(),this},markTransformDirty:function(){this.transformDirty=!0,this.markDirty()},getTransformMatrix:function(){return this.instance.relativeTransform.validate(),this.instance.relativeTransform.matrix},update:function(){return!!s.prototype.update.call(this)&&(this.updateDOM(),this.visibilityDirty&&(this.visibilityDirty=!1,this.domElement.style.visibility=this.visible?"":"hidden"),this.cleanPaintableState&&this.cleanPaintableState(),!0)},updateDOM:function(){},updateSelfVisibility:function(){s.prototype.updateSelfVisibility.call(this),this.visibilityDirty||(this.visibilityDirty=!0,this.markDirty())},dispose:function(){this.instance.relativeTransform.removeListener(this.transformListener),this.instance.relativeTransform.removePrecompute(),s.prototype.dispose.call(this)}}),e}),i("SCENERY/display/Fittability",["require","AXON/Emitter","PHET_CORE/inherit","SCENERY/scenery"],function(t){"use strict";function e(t){this.instance=t}var i=t("AXON/Emitter"),n=t("PHET_CORE/inherit");return t("SCENERY/scenery").register("Fittability",e),n(Object,e,{initialize:function(t,e){return this.display=t,this.trail=e,this.node=e&&e.lastNode(),this.selfFittable=!!e&&this.isSelfFitSupported(),this.ancestorsFittable=this.selfFittable,this.subtreeUnfittableCount=this.selfFittable?0:1,this.subtreeFittabilityChange=this.subtreeFittabilityChange||new i,this},get parent(){return this.instance.parent?this.instance.parent.fittability:null},checkSelfFittability:function(){var t=this.isSelfFitSupported();this.selfFittable!==t&&this.updateSelfFittable()},isSelfFitSupported:function(){return!this.node.isPreventFit()},markSubtreeFittable:function(){if(this.selfFittable){this.ancestorsFittable=!0;for(var t=this.instance.children,e=0;e<t.length;e++)t[e].fittability.markSubtreeFittable();this.instance.updateDrawableFittability(!0)}},markSubtreeUnfittable:function(){if(this.ancestorsFittable){this.ancestorsFittable=!1;for(var t=this.instance.children,e=0;e<t.length;e++)t[e].fittability.markSubtreeUnfittable();this.instance.updateDrawableFittability(!1)}},updateSelfFittable:function(){var t=this.isSelfFitSupported();this.selfFittable=t,!this.selfFittable||this.parent&&!this.parent.ancestorsFittable?this.selfFittable||this.markSubtreeUnfittable():this.markSubtreeFittable(),this.selfFittable?this.decrementSubtreeUnfittableCount():this.incrementSubtreeUnfittableCount()},incrementSubtreeUnfittableCount:function(){this.subtreeUnfittableCount++,1===this.subtreeUnfittableCount&&(this.parent&&this.parent.incrementSubtreeUnfittableCount(),this.subtreeFittabilityChange.emit())},decrementSubtreeUnfittableCount:function(){this.subtreeUnfittableCount--,0===this.subtreeUnfittableCount&&(this.parent&&this.parent.decrementSubtreeUnfittableCount(),this.subtreeFittabilityChange.emit())},onInsert:function(t){this.ancestorsFittable||t.markSubtreeUnfittable(),t.subtreeUnfittableCount>0&&this.incrementSubtreeUnfittableCount()},onRemove:function(t){this.ancestorsFittable||t.markSubtreeFittable(),t.subtreeUnfittableCount>0&&this.decrementSubtreeUnfittableCount()},audit:function(){}}),e}),i("SCENERY/display/RelativeTransform",["require","PHET_CORE/cleanArray","PHET_CORE/inherit","DOT/Matrix3","SCENERY/scenery"],function(t){"use strict";function e(t){this.instance=t}var i=t("PHET_CORE/cleanArray"),n=t("PHET_CORE/inherit"),s=t("DOT/Matrix3");return t("SCENERY/scenery").register("RelativeTransform",e),n(Object,e,{initialize:function(t,e){return this.display=t,this.trail=e,this.node=e&&e.lastNode(),this.transformDirty=!0,this.nodeTransformListener=this.nodeTransformListener||this.onNodeTransformDirty.bind(this),this.matrix=this.matrix||s.identity(),this.relativeSelfDirty=!0,this.relativeChildrenListenersCount=0,this.relativePrecomputeCount=0,this.relativeChildrenPrecomputeCount=0,this.relativeFrameId=-1,this.relativeChildDirtyFrame=t?t._frameId:0,this.relativeTransformListeners=i(this.relativeTransformListeners),this},get parent(){return this.instance.parent?this.instance.parent.relativeTransform:null},addInstance:function(t){t.stateless||(t.relativeTransform.hasAncestorListenerNeed()&&this.incrementTransformListenerChildren(),t.relativeTransform.hasAncestorComputeNeed()&&this.incrementTransformPrecomputeChildren()),t.relativeTransform.forceMarkTransformDirty()},removeInstance:function(t){t.relativeTransform.hasAncestorListenerNeed()&&this.decrementTransformListenerChildren(),t.relativeTransform.hasAncestorComputeNeed()&&this.decrementTransformPrecomputeChildren()},attachNodeListeners:function(){this.node.onStatic("transform",this.nodeTransformListener)},detachNodeListeners:function(){this.node.offStatic("transform",this.nodeTransformListener)},hasDescendantListenerNeed:function(){return this.instance.isTransformed?this.relativeChildrenListenersCount>0:this.relativeChildrenListenersCount>0||this.relativeTransformListeners.length>0},hasAncestorListenerNeed:function(){return this.instance.isTransformed?this.relativeTransformListeners.length>0:this.relativeChildrenListenersCount>0||this.relativeTransformListeners.length>0},hasSelfListenerNeed:function(){return this.relativeTransformListeners.length>0},incrementTransformListenerChildren:function(){var t=this.hasAncestorListenerNeed();this.relativeChildrenListenersCount++,t!==this.hasAncestorListenerNeed()&&this.parent&&this.parent.incrementTransformListenerChildren()},decrementTransformListenerChildren:function(){var t=this.hasAncestorListenerNeed();this.relativeChildrenListenersCount--,t!==this.hasAncestorListenerNeed()&&this.parent&&this.parent.decrementTransformListenerChildren()},addListener:function(t){var e=this.hasAncestorListenerNeed();this.relativeTransformListeners.push(t),e!==this.hasAncestorListenerNeed()&&(this.parent&&this.parent.incrementTransformListenerChildren(),this.hasAncestorComputeNeed()||this.forceMarkTransformDirty())},removeListener:function(t){var e=this.hasAncestorListenerNeed();this.relativeTransformListeners.splice(_.indexOf(this.relativeTransformListeners,t),1),e!==this.hasAncestorListenerNeed()&&this.parent&&this.parent.decrementTransformListenerChildren()},hasDescendantComputeNeed:function(){return this.instance.isTransformed?this.relativeChildrenPrecomputeCount>0:this.relativeChildrenPrecomputeCount>0||this.relativePrecomputeCount>0},hasAncestorComputeNeed:function(){return this.instance.isTransformed?this.relativePrecomputeCount>0:this.relativeChildrenPrecomputeCount>0||this.relativePrecomputeCount>0},hasSelfComputeNeed:function(){return this.relativePrecomputeCount>0},incrementTransformPrecomputeChildren:function(){var t=this.hasAncestorComputeNeed();this.relativeChildrenPrecomputeCount++,t!==this.hasAncestorComputeNeed()&&this.parent&&this.parent.incrementTransformPrecomputeChildren()},decrementTransformPrecomputeChildren:function(){var t=this.hasAncestorComputeNeed();this.relativeChildrenPrecomputeCount--,t!==this.hasAncestorComputeNeed()&&this.parent&&this.parent.decrementTransformPrecomputeChildren()},addPrecompute:function(){var t=this.hasAncestorComputeNeed();this.relativePrecomputeCount++,t!==this.hasAncestorComputeNeed()&&(this.parent&&this.parent.incrementTransformPrecomputeChildren(),this.hasAncestorListenerNeed()||this.forceMarkTransformDirty())},removePrecompute:function(){var t=this.hasAncestorComputeNeed();this.relativePrecomputeCount--,t!==this.hasAncestorComputeNeed()&&this.parent&&this.parent.decrementTransformPrecomputeChildren()},onNodeTransformDirty:function(){this.transformDirty||this.forceMarkTransformDirty()},forceMarkTransformDirty:function(){this.transformDirty=!0,this.relativeSelfDirty=!0;for(var t=this.display._frameId,e=this.instance.parent;e&&e.relativeTransform.relativeChildDirtyFrame!==t;){var i=e.parent,n=e.isTransformed;if(e.relativeTransform.relativeChildDirtyFrame=t,null===i){this.display.markTransformRootDirty(e,n);break}if(n){this.display.markTransformRootDirty(e,!0);break}e=i}},computeRelativeTransform:function(){var t=this.node.getMatrix();this.instance.parent&&!this.instance.parent.isTransformed?(this.matrix.set(this.parent.matrix),this.matrix.multiplyMatrix(t)):this.matrix.set(t),this.relativeFrameId=this.display._frameId,this.relativeSelfDirty=!1},isValidationNotNeeded:function(){return this.hasAncestorComputeNeed()||this.relativeFrameId===this.display._frameId},validate:function(){if(!this.isValidationNotNeeded()&&(this.instance.parent&&!this.instance.parent.isTransformed&&this.parent.validate(),this.relativeSelfDirty)){this.computeRelativeTransform();for(var t=this.instance.children.length,e=0;e<t;e++)this.instance.children[e].relativeTransform.relativeSelfDirty=!0}},updateTransformListenersAndCompute:function(t,e,i,n){var s,r;if(n)for(s=this.instance.children.length,r=0;r<s;r++)this.instance.children[r].relativeTransform.updateTransformListenersAndCompute(!1,!1,i,!1);else{var a=t||this.relativeSelfDirty,o=a||this.relativeChildDirtyFrame===i,h=this.hasDescendantComputeNeed(),l=this.hasDescendantListenerNeed(),u=this.hasSelfComputeNeed(),c=this.hasSelfListenerNeed();if(h||!a||e||(this.relativeSelfDirty=!0),!o||!h&&!l&&!u&&!c)return;if(a&&(h||u)&&this.computeRelativeTransform(),this.transformDirty&&(this.transformDirty=!1),this.notifyRelativeTransformListeners(),!this.instance.isTransformed||n){var d=a&&!(h||u);for(s=this.instance.children.length,r=0;r<s;r++)this.instance.children[r].relativeTransform.updateTransformListenersAndCompute(a,d,i,!1)}}},notifyRelativeTransformListeners:function(){for(var t=this.relativeTransformListeners.length,e=0;e<t;e++)this.relativeTransformListeners[e]()},audit:function(t,e){}}),e}),i("SCENERY/display/Instance",["require","PHET_CORE/arrayRemove","SCENERY/display/ChangeInterval","PHET_CORE/cleanArray","SCENERY/display/Drawable","AXON/Events","SCENERY/display/Fittability","PHET_CORE/inherit","PHET_CORE/Poolable","SCENERY/display/RelativeTransform","SCENERY/display/Renderer","SCENERY/scenery","SCENERY/util/Util"],function(t){"use strict";function e(t,e,i,n){a.call(this),this.active=!1,this.initialize(t,e,i,n)}var i=t("PHET_CORE/arrayRemove"),n=t("SCENERY/display/ChangeInterval"),s=t("PHET_CORE/cleanArray"),r=t("SCENERY/display/Drawable"),a=t("AXON/Events"),o=t("SCENERY/display/Fittability"),h=t("PHET_CORE/inherit"),l=t("PHET_CORE/Poolable"),u=t("SCENERY/display/RelativeTransform"),c=t("SCENERY/display/Renderer"),d=t("SCENERY/scenery"),f=t("SCENERY/util/Util"),m=1,p=c.createOrderBitmask(c.bitmaskSVG,c.bitmaskCanvas,c.bitmaskDOM,c.bitmaskWebGL);return d.register("Instance",e),h(a,e,{initialize:function(t,e,i,n){return e.setImmutable(),this.id=this.id||m++,this.isWebGLSupported=t._allowWebGL&&f.isWebGLSupported,this.relativeTransform=this.relativeTransform||new u(this),this.fittability=this.fittability||new o(this),this.visible=!0,this.relativeVisible=!0,this.selfVisible=!0,this.visibilityDirty=!0,this.childVisibilityDirty=!0,this.branchIndexMap={}||this.branchIndexMap,this.branchIndexReferences=s(this.branchIndexReferences),this.addRemoveCounter=0,this.stitchChangeFrame=t._frameId,this.stitchChangeBefore=0,this.stitchChangeAfter=0,this.stitchChangeOnChildren=0,this.stitchChangeIncluded=!1,this.childInsertedListener=this.childInsertedListener||this.onChildInserted.bind(this),this.childRemovedListener=this.childRemovedListener||this.onChildRemoved.bind(this),this.childrenReorderedListener=this.childrenReorderedListener||this.onChildrenReordered.bind(this),this.visibilityListener=this.visibilityListener||this.onVisibilityChange.bind(this),this.markRenderStateDirtyListener=this.markRenderStateDirtyListener||this.markRenderStateDirty.bind(this),this.cleanInstance(t,e),this.node.addInstance(this),this.externalReferenceCount=0,this.stateless=!0,this.isDisplayRoot=i,this.isSharedCanvasCacheRoot=n,this.preferredRenderers=0,this.isUnderCanvasCache=n,this.isBackbone=!1,this.isTransformed=!1,this.isVisibilityApplied=!1,this.isInstanceCanvasCache=!1,this.isSharedCanvasCachePlaceholder=!1,this.isSharedCanvasCacheSelf=n,this.selfRenderer=0,this.groupRenderer=0,this.sharedCacheRenderer=0,this.renderStateDirtyFrame=t._frameId,this.skipPruningFrame=t._frameId,this.active=!0,this},cleanInstance:function(t,e){this.display=t,this.trail=e,this.node=e?e.lastNode():null,this.parent=null,this.oldParent=null,this.children=s(this.children),this.sharedCacheInstance=null,this.relativeTransform.initialize(t,e),this.fittability.initialize(t,e),this.instanceRemovalCheckList=s(this.instanceRemovalCheckList),this.selfDrawable=null,this.groupDrawable=null,this.sharedCacheDrawable=null,this.firstDrawable=null,this.lastDrawable=null,this.firstInnerDrawable=null,this.lastInnerDrawable=null,this.svgGroups=s(this.svgGroups),this.cleanSyncTreeResults()},cleanSyncTreeResults:function(){this.beforeStableIndex=this.children.length,this.afterStableIndex=-1,this.firstChangeInterval=null,this.lastChangeInterval=null,this.incompatibleStateChange=!1,this.groupChanged=!1,this.cascadingStateChange=!1,this.anyStateChange=!1},updateRenderingState:function(){var t=this.isBackbone,e=this.isTransformed,i=this.isVisibilityApplied,n=this.isInstanceCanvasCache,s=this.isSharedCanvasCacheSelf,r=this.isSharedCanvasCachePlaceholder,a=this.isUnderCanvasCache,o=this.selfRenderer,h=this.groupRenderer,l=this.sharedCacheRenderer,u=this.preferredRenderers;this.isBackbone=!1,this.isTransformed=!1,this.isVisibilityApplied=!1,this.isInstanceCanvasCache=!1,this.isSharedCanvasCacheSelf=!1,this.isSharedCanvasCachePlaceholder=!1,this.selfRenderer=0,this.groupRenderer=0,this.sharedCacheRenderer=0;var d=this.node._hints;this.isUnderCanvasCache=this.isSharedCanvasCacheRoot||!!this.parent&&(this.parent.isUnderCanvasCache||this.parent.isInstanceCanvasCache||this.parent.isSharedCanvasCacheSelf),this.preferredRenderers=this.parent?this.parent.preferredRenderers:p,d.renderer&&(this.preferredRenderers=c.pushOrderBitmask(this.preferredRenderers,d.renderer));var f=this.node.hasClipArea(),m=1!==this.node.opacity||d.usesOpacity,g=d.requireElement||d.cssTransform||d.layerSplit,v=this.isDisplayRoot||!this.isUnderCanvasCache&&g,y=!v&&(m||f)&&(this.node._rendererSummary.isSubtreeRenderedExclusivelySVG(this.preferredRenderers)||this.node._rendererSummary.isSubtreeRenderedExclusivelyCanvas(this.preferredRenderers));if(!y&&(v||m||f)?(this.isBackbone=!0,this.isVisibilityApplied=!0,this.isTransformed=this.isDisplayRoot||!!d.cssTransform,this.groupRenderer=c.bitmaskDOM):!y&&(m||f||d.canvasCache)&&(d.singleCache?this.isSharedCanvasCacheRoot?(this.isSharedCanvasCacheSelf=!0,this.sharedCacheRenderer=this.isWebGLSupported?c.bitmaskWebGL:c.bitmaskCanvas):this.isSharedCanvasCachePlaceholder=!0:(this.isInstanceCanvasCache=!0,this.isUnderCanvasCache=!0,this.groupRenderer=this.isWebGLSupported?c.bitmaskWebGL:c.bitmaskCanvas)),this.node.isPainted())if(this.isUnderCanvasCache)this.selfRenderer=c.bitmaskCanvas;else{var E=this.node._rendererBitmask;if(!this.isWebGLSupported){E^=E&c.bitmaskWebGL}this.selfRenderer=E&c.bitmaskOrder(this.preferredRenderers,0)||E&c.bitmaskOrder(this.preferredRenderers,1)||E&c.bitmaskOrder(this.preferredRenderers,2)||E&c.bitmaskOrder(this.preferredRenderers,3)||E&c.bitmaskSVG||E&c.bitmaskCanvas||E&c.bitmaskDOM||E&c.bitmaskWebGL||0}this.groupChanged=t!==this.isBackbone||n!==this.isInstanceCanvasCache||s!==this.isSharedCanvasCacheSelf,this.cascadingStateChange=a!==this.isUnderCanvasCache||u!==this.preferredRenderers,this.incompatibleStateChange=this.isTransformed!==e||this.isSharedCanvasCachePlaceholder!==r,this.anyStateChange=this.groupChanged||this.cascadingStateChange||this.incompatibleStateChange||o!==this.selfRenderer||h!==this.groupRenderer||l!==this.sharedCacheRenderer,i!==this.isVisibilityApplied&&(this.visibilityDirty=!0,this.parent&&this.parent.markChildVisibilityDirty()),this.fittability.checkSelfFittability()},getStateString:function(){return"S[ "+(this.isDisplayRoot?"displayRoot ":"")+(this.isBackbone?"backbone ":"")+(this.isInstanceCanvasCache?"instanceCache ":"")+(this.isSharedCanvasCachePlaceholder?"sharedCachePlaceholder ":"")+(this.isSharedCanvasCacheSelf?"sharedCacheSelf ":"")+(this.isTransformed?"TR ":"")+(this.isVisibilityApplied?"VIS ":"")+(this.selfRenderer?this.selfRenderer.toString(16):"-")+","+(this.groupRenderer?this.groupRenderer.toString(16):"-")+","+(this.sharedCacheRenderer?this.sharedCacheRenderer.toString(16):"-")+" "+"]"},baseSyncTree:function(){this.syncTree(),this.cleanSyncTreeResults()},syncTree:function(){var t=this.stateless;if((t||this.parent&&this.parent.cascadingStateChange||this.renderStateDirtyFrame===this.display._frameId)&&this.updateRenderingState(),!t&&this.incompatibleStateChange)return!1;if(this.stateless=!1,t&&(this.isTransformed&&this.display.markTransformRootDirty(this,!0),this.attachNodeListeners()),this.isSharedCanvasCachePlaceholder)this.sharedSyncTree();else if(t||this.skipPruningFrame===this.display._frameId||this.anyStateChange){this.prepareChildInstances(t);this.firstDrawable,this.lastDrawable,this.firstInnerDrawable,this.lastInnerDrawable;var e=this.updateSelfDrawable();this.localSyncTree(e),this.groupSyncTree(t)}return!0},localSyncTree:function(t){var e=this.display._frameId,i=this.selfDrawable,s=i,a=null;t&&(a=n.newForDisplay(null,null,this.display));for(var o=a,h=t?null:this.selfDrawable,l=0;l<this.children.length;l++){var u=this.children[l];u.syncTree()||(u=this.updateIncompatibleChildInstance(u,l)).syncTree();var c=u.shouldIncludeInParentDrawables();c&&u.firstDrawable&&(s?r.connectDrawables(s,u.firstDrawable,this.display):i=u.firstDrawable,s=u.lastDrawable);var d=u.stitchChangeIncluded,f=c;u.stitchChangeIncluded=f,u.stitchChangeFrame===e&&(u.firstChangeInterval=u.lastChangeInterval=n.newForDisplay(null,null,this.display));var m=u.firstChangeInterval,p=o&&null===o.drawableAfter,g=m&&null===m.drawableBefore;if(u.stitchChangeBefore===e&&!p&&!g){var v=n.newForDisplay(h,null,this.display);o&&(o.nextChangeInterval=v),o=v,a=a||o,p=!0}if((d||f)&&(p?m?null===m.drawableBefore?(o.drawableAfter=m.drawableAfter,o.nextChangeInterval=m.nextChangeInterval,o=u.lastChangeInterval===m?o:u.lastChangeInterval):(o.drawableAfter=u.firstDrawable,o.nextChangeInterval=m,o=u.lastChangeInterval):o.drawableAfter=u.firstDrawable:m&&(a=a||m,null===m.drawableBefore&&(m.drawableBefore=h),o&&(o.nextChangeInterval=m),o=u.lastChangeInterval),h=o&&null===o.drawableAfter?null:u.lastDrawable?u.lastDrawable:h),l===this.children.length-1&&u.stitchChangeAfter===e&&(!o||null!==o.drawableAfter)){var y=n.newForDisplay(h,null,this.display);o&&(o.nextChangeInterval=y),o=y,a=a||o}u.cleanSyncTreeResults()}a||this.stitchChangeOnChildren!==this.display._frameId||0!==this.children.length||(a=o=n.newForDisplay(null,null,this.display)),this.firstChangeInterval=a,this.lastChangeInterval=o,this.firstDrawable=this.firstInnerDrawable=i,this.lastDrawable=this.lastInnerDrawable=s},updateSelfDrawable:function(){if(this.node.isPainted()){var t=this.selfRenderer;if(!this.selfDrawable||0==(this.selfDrawable.renderer&t&c.bitmaskRendererArea))return this.selfDrawable&&this.selfDrawable.markForDisposal(this.display),this.selfDrawable=c.createSelfDrawable(this,this.node,t,this.fittability.ancestorsFittable),!0}return!1},updateIncompatibleChildInstance:function(t,i){this.display.markInstanceRootForDisposal(t);var n=e.createFromPool(this.display,this.trail.copy().addDescendant(t.node,i),!1,!1);return this.replaceInstanceWithIndex(t,n,i),n},groupSyncTree:function(t){var e=this.groupRenderer,i=!!e!=!!this.groupDrawable||!t&&this.groupChanged||this.groupDrawable&&this.groupDrawable.renderer!==e;i&&(this.groupDrawable&&(this.groupDrawable.markForDisposal(this.display),this.groupDrawable=null),this.firstChangeInterval=this.lastChangeInterval=n.newForDisplay(null,null,this.display)),e&&(this.firstDrawable&&r.disconnectBefore(this.firstDrawable,this.display),this.lastDrawable&&r.disconnectAfter(this.lastDrawable,this.display),this.isBackbone?(i&&(this.groupDrawable=d.BackboneDrawable.createFromPool(this.display,this,this.getTransformRootInstance(),e,this.isDisplayRoot),this.isTransformed&&this.display.markTransformRootDirty(this,!0)),this.firstChangeInterval&&this.groupDrawable.stitch(this.firstDrawable,this.lastDrawable,this.firstChangeInterval,this.lastChangeInterval)):this.isInstanceCanvasCache?(i&&(this.groupDrawable=d.InlineCanvasCacheDrawable.createFromPool(e,this)),this.firstChangeInterval&&this.groupDrawable.stitch(this.firstDrawable,this.lastDrawable,this.firstChangeInterval,this.lastChangeInterval)):this.isSharedCanvasCacheSelf&&i&&(this.groupDrawable=d.CanvasBlock.createFromPool(e,this)),this.groupDrawable.setFittable(this.fittability.ancestorsFittable),this.firstDrawable=this.lastDrawable=this.groupDrawable),i?this.firstChangeInterval=this.lastChangeInterval=n.newForDisplay(null,null,this.display):e&&(this.firstChangeInterval=this.lastChangeInterval=null)},sharedSyncTree:function(){this.ensureSharedCacheInitialized();var t=this.sharedCacheRenderer;this.sharedCacheDrawable&&this.sharedCacheDrawable.renderer===t||(this.sharedCacheDrawable&&this.sharedCacheDrawable.markForDisposal(this.display),this.sharedCacheDrawable=new d.SharedCanvasCacheDrawable(this.trail,t,this,this.sharedCacheInstance),this.firstDrawable=this.sharedCacheDrawable,this.lastDrawable=this.sharedCacheDrawable,this.firstChangeInterval=this.lastChangeInterval=n.newForDisplay(null,null,this.display))},prepareChildInstances:function(t){for(;this.instanceRemovalCheckList.length;){var i=this.instanceRemovalCheckList.pop();-1===i.addRemoveCounter&&(i.addRemoveCounter=0,this.display.markInstanceRootForDisposal(i))}if(t)for(var n=0;n<this.node.children.length;n++){var s=this.node.children[n];this.appendInstance(e.createFromPool(this.display,this.trail.copy().addDescendant(s,n),!1,!1))}},ensureSharedCacheInitialized:function(){if(!this.sharedCacheInstance){var t=this.node.getId();this.sharedCacheInstance=this.display._sharedCanvasInstances[t],this.sharedCacheInstance||(this.sharedCacheInstance=e.createFromPool(this.display,new d.Trail(this.node),!1,!0),this.sharedCacheInstance.syncTree(),this.display._sharedCanvasInstances[t]=this.sharedCacheInstance,this.display.markTransformRootDirty(this.sharedCacheInstance,!0)),this.sharedCacheInstance.externalReferenceCount++,this.isTransformed&&this.display.markTransformRootDirty(this,!0)}},shouldIncludeInParentDrawables:function(){return this.node.isVisible()||!this.node.isExcludeInvisible()},findPreviousDrawable:function(t){for(var e=t-1;e>=0;e--){var i=this.children[e].lastDrawable;if(null!==i)return i}return null},findNextDrawable:function(t){for(var e=this.children.length,i=t+1;i<e;i++){var n=this.children[i].firstDrawable;if(null!==n)return n}return null},appendInstance:function(t){this.insertInstance(t,this.children.length)},insertInstance:function(t,e){t.stitchChangeFrame=this.display._frameId,this.stitchChangeOnChildren=this.display._frameId,this.children.splice(e,0,t),t.parent=this,t.oldParent=this,e<=this.beforeStableIndex&&(this.beforeStableIndex=e-1),e>this.afterStableIndex?this.afterStableIndex=e+1:this.afterStableIndex++,this.fittability.onInsert(t.fittability),this.relativeTransform.addInstance(t),this.markChildVisibilityDirty()},removeInstance:function(t){return this.removeInstanceWithIndex(t,_.indexOf(this.children,t))},removeInstanceWithIndex:function(t,e){var i=this.display._frameId;t.stitchChangeFrame=i,this.stitchChangeOnChildren=i,e-1>=0&&(this.children[e-1].stitchChangeAfter=i),e+1<this.children.length&&(this.children[e+1].stitchChangeBefore=i),this.children.splice(e,1),t.parent=null,t.oldParent=this,e<=this.beforeStableIndex&&(this.beforeStableIndex=e-1),e>=this.afterStableIndex?this.afterStableIndex=e:this.afterStableIndex--,this.fittability.onRemove(t.fittability),this.relativeTransform.removeInstance(t)},replaceInstanceWithIndex:function(t,e,i){this.removeInstanceWithIndex(t,i),this.insertInstance(e,i)},reorderInstances:function(t,e){var i=this.display._frameId;this.children.splice(t,e-t+1);for(var n=t;n<=e;n++){var s=this.findChildInstanceOnNode(this.node._children[n]);this.children.splice(n,0,s),s.stitchChangeFrame=i,n>t&&(s.stitchChangeAfter=i),n<e&&(s.stitchChangeBefore=i)}this.stitchChangeOnChildren=i,this.beforeStableIndex=Math.min(this.beforeStableIndex,t-1),this.afterStableIndex=Math.max(this.afterStableIndex,e+1)},findChildInstanceOnNode:function(t){for(var e=t.getInstances(),i=0;i<e.length;i++)if(e[i].oldParent===this)return e[i];return null},onChildInserted:function(t,i){var n=this.findChildInstanceOnNode(t);n?n.addRemoveCounter+=1:n=e.createFromPool(this.display,this.trail.copy().addDescendant(t,i),!1,!1),this.insertInstance(n,i),this.markSkipPruning()},onChildRemoved:function(t,e){var i=this.findChildInstanceOnNode(t);i.addRemoveCounter-=1,this.instanceRemovalCheckList.push(i),this.removeInstanceWithIndex(i,e),this.markSkipPruning()},onChildrenReordered:function(t,e){this.reorderInstances(t,e),this.markSkipPruning()},onVisibilityChange:function(){this.stitchChangeFrame=this.display._frameId,this.parent&&this.parent.markSkipPruning(),this.visibilityDirty=!0,this.parent&&this.parent.markChildVisibilityDirty()},onOpacityChange:function(){this.markRenderStateDirty()},markChildVisibilityDirty:function(){this.childVisibilityDirty||(this.childVisibilityDirty=!0,this.parent&&this.parent.markChildVisibilityDirty())},updateDrawableFittability:function(t){this.selfDrawable&&this.selfDrawable.setFittable(t),this.groupDrawable&&this.groupDrawable.setFittable(t)},updateVisibility:function(t,e,i){this.visibilityDirty&&(i=!0);var n=this.node.isVisible(),s=this.visible,r=this.relativeVisible,a=this.selfVisible;this.visible=t&&n,this.relativeVisible=e&&n,this.selfVisible=!!this.isVisibilityApplied||this.relativeVisible;for(var o=this.children.length,h=0;h<o;h++){var l=this.children[h];(i||l.visibilityDirty||l.childVisibilityDirty)&&l.updateVisibility(this.visible,!!this.isVisibilityApplied||this.relativeVisible,i)}this.visibilityDirty=!1,this.childVisibilityDirty=!1,this.visible!==s&&this.trigger0("visibility"),this.relativeVisible!==r&&this.trigger0("relativeVisibility"),this.selfVisible!==a&&this.trigger0("selfVisibility")},getDescendantCount:function(){for(var t=this.children.length,e=0;e<this.children.length;e++)t+=this.children[e].getDescendantCount();return t},addSVGGroup:function(t){this.svgGroups.push(t)},removeSVGGroup:function(t){var e=_.indexOf(this.svgGroups,t);this.svgGroups.splice(e,1)},lookupSVGGroup:function(t){for(var e=this.svgGroups.length,i=0;i<e;i++){var n=this.svgGroups[i];if(n.block===t)return n}return null},getFilterRootInstance:function(){return this.isBackbone||this.isInstanceCanvasCache||!this.parent?this:this.parent.getFilterRootInstance()},getTransformRootInstance:function(){return this.isTransformed||!this.parent?this:this.parent.getTransformRootInstance()},getVisibilityRootInstance:function(){return this.isVisibilityApplied||!this.parent?this:this.parent.getVisibilityRootInstance()},attachNodeListeners:function(){this.relativeTransform.attachNodeListeners(),this.isSharedCanvasCachePlaceholder||(this.node.onStatic("childInserted",this.childInsertedListener),this.node.onStatic("childRemoved",this.childRemovedListener),this.node.onStatic("childrenReordered",this.childrenReorderedListener),this.node.onStatic("visibility",this.visibilityListener),this.node.onStatic("opacity",this.markRenderStateDirtyListener),this.node.onStatic("hint",this.markRenderStateDirtyListener),this.node.onStatic("clip",this.markRenderStateDirtyListener),this.node.onStatic("rendererBitmask",this.markRenderStateDirtyListener),this.node.onStatic("rendererSummary",this.markRenderStateDirtyListener))},detachNodeListeners:function(){this.relativeTransform.detachNodeListeners(),this.isSharedCanvasCachePlaceholder||(this.node.offStatic("childInserted",this.childInsertedListener),this.node.offStatic("childRemoved",this.childRemovedListener),this.node.offStatic("childrenReordered",this.childrenReorderedListener),this.node.offStatic("visibility",this.visibilityListener),this.node.offStatic("opacity",this.markRenderStateDirtyListener),this.node.offStatic("hint",this.markRenderStateDirtyListener),this.node.offStatic("clip",this.markRenderStateDirtyListener),this.node.offStatic("rendererBitmask",this.markRenderStateDirtyListener),this.node.offStatic("rendererSummary",this.markRenderStateDirtyListener))},markRenderStateDirty:function(){this.renderStateDirtyFrame=this.display._frameId,this.parent&&this.parent.markSkipPruning()},markSkipPruning:function(){this.skipPruningFrame=this.display._frameId,this.parent&&this.parent.markSkipPruning()},getBranchIndexTo:function(t){var e=this.branchIndexMap[t.id];if(void 0!==e)return e;var i=this.trail.getBranchIndexTo(t.trail);return this.branchIndexMap[t.id]=i,t.branchIndexMap[this.id]=i,this.branchIndexReferences.push(t),t.branchIndexReferences.push(this),i},dispose:function(){for(this.active=!1;this.branchIndexReferences.length;){var t=this.branchIndexReferences.pop();delete this.branchIndexMap[t.id],delete t.branchIndexMap[this.id],i(t.branchIndexReferences,this)}this.groupDrawable&&this.groupDrawable.disposeImmediately(this.display),this.sharedCacheDrawable&&this.sharedCacheDrawable.disposeImmediately(this.display),this.selfDrawable&&this.selfDrawable.disposeImmediately(this.display);for(var e=this.children.length,n=0;n<e;n++)this.children[n].dispose();for(;this.instanceRemovalCheckList.length;){var s=this.instanceRemovalCheckList.pop();s.active&&s.dispose()}this.stateless||this.detachNodeListeners(),this.node.removeInstance(this),this.sharedCacheInstance&&(this.sharedCacheInstance.externalReferenceCount--,0===this.sharedCacheInstance.externalReferenceCount&&(delete this.display._sharedCanvasInstances[this.node.getId()],this.sharedCacheInstance.dispose())),this.cleanInstance(null,null),this.removeAllEventListeners(),this.freeToPool()},audit:function(t,e){},auditVisibility:function(t){},auditChangeIntervals:function(t,e,i,n){if(t)for(var s=t;s!==e;)s=s.oldNextDrawable;if(i)for(var r=i;r!==n;)r=r.nextDrawable},toString:function(){return this.id+"#"+(this.node?(this.node.constructor.name?this.node.constructor.name:"?")+"#"+this.node.id:"-")}}),l.mixInto(e,{initialize:e.prototype.initialize}),e}),i("SCENERY/display/InlineCanvasCacheDrawable",["require","SCENERY/display/Drawable","PHET_CORE/inherit","SCENERY/scenery"],function(t){"use strict";function e(t,e){i.call(this,t),this.instance=e}var i=t("SCENERY/display/Drawable"),n=t("PHET_CORE/inherit");return t("SCENERY/scenery").register("InlineCanvasCacheDrawable",e),n(i,e,{stitch:function(t,e,i,n){}}),e}),i("SCENERY/display/SharedCanvasCacheDrawable",["require","SCENERY/display/Drawable","PHET_CORE/inherit","SCENERY/scenery"],function(t){"use strict";function e(t,e,n,s){i.call(this,e),this.instance=n,this.sharedInstance=s}var i=t("SCENERY/display/Drawable"),n=t("PHET_CORE/inherit");return t("SCENERY/scenery").register("SharedCanvasCacheDrawable",e),n(i,e,{}),e}),i("SCENERY/display/PaintSVGState",["require","PHET_CORE/inherit","SCENERY/scenery"],function(t){"use strict";function e(t,e){return t?t.toCSS?t.toCSS():t.isPaint?"url(#"+t.id+"-"+(e?e.id:"noblock")+")":t:"none"}function i(){this.initialize()}var n=t("PHET_CORE/inherit");return t("SCENERY/scenery").register("PaintSVGState",i),n(Object,i,{initialize:function(){this.svgBlock=null,this.fillStyle="none",this.strokeStyle="none",this.fillPaint=null,this.strokePaint=null,this.updateBaseStyle(),this.strokeDetailStyle=""},dispose:function(){this.releaseFillPaint(),this.releaseStrokePaint()},releaseFillPaint:function(){this.fillPaint&&(this.svgBlock.decrementPaint(this.fillPaint),this.fillPaint=null)},releaseStrokePaint:function(){this.strokePaint&&(this.svgBlock.decrementPaint(this.strokePaint),this.strokePaint=null)},updateFill:function(t,i){var n=e(i,t);i!==this.fillPaint&&(this.releaseFillPaint(),i&&i.isPaint&&(this.fillPaint=i,t.incrementPaint(i))),n!==this.fillStyle&&(this.fillStyle=n,this.updateBaseStyle())},updateStroke:function(t,i){var n=e(i,t);i!==this.strokePaint&&(this.releaseStrokePaint(),i&&i.isPaint&&(this.strokePaint=i,t.incrementPaint(i))),n!==this.strokeStyle&&(this.strokeStyle=n,this.updateBaseStyle())},updateBaseStyle:function(){this.baseStyle="fill: "+this.fillStyle+"; stroke: "+this.strokeStyle+";"},updateStrokeDetailStyle:function(t){var e="",i=t.getLineWidth();1!==i&&(e+="stroke-width: "+i+";");var n=t.getLineCap();"butt"!==n&&(e+="stroke-linecap: "+n+";");var s=t.getLineJoin();"miter"!==s&&(e+="stroke-linejoin: "+s+";");e+="stroke-miterlimit: "+t.getMiterLimit()+";",t.hasLineDash()&&(e+="stroke-dasharray: "+t.getLineDash().join(",")+";",e+="stroke-dashoffset: "+t.getLineDashOffset()+";"),this.strokeDetailStyle=e},updateSVGBlock:function(t){var e=this.svgBlock;e&&(this.fillPaint&&e.decrementPaint(this.fillPaint),this.strokePaint&&e.decrementPaint(this.strokePaint)),this.svgBlock=t,this.fillPaint&&t.incrementPaint(this.fillPaint),this.strokePaint&&t.incrementPaint(this.strokePaint)}}),i}),i("SCENERY/display/SVGSelfDrawable",["require","PHET_CORE/inherit","SCENERY/display/PaintSVGState","SCENERY/scenery","SCENERY/display/SelfDrawable"],function(t){"use strict";function e(t,e){throw this.initializeSVGSelfDrawable(t,e),new Error("Should use initialization and pooling")}var i=t("PHET_CORE/inherit"),n=t("SCENERY/display/PaintSVGState"),s=t("SCENERY/scenery"),r=t("SCENERY/display/SelfDrawable");return s.register("SVGSelfDrawable",e),i(r,e,{initializeSVGSelfDrawable:function(t,e,i,s){return this.initializeSelfDrawable(t,e),this.usesPaint=i,this.keepElements=s,this.svgElement=null,this.svgBlock=null,this.initializeState(t,e),this.usesPaint&&(this.paintState?this.paintState.initialize():this.paintState=new n),this},update:function(){return!!r.prototype.update.call(this)&&(this.updateSVG(),!0)},updateSVG:function(){if(this.paintDirty&&this.updateSVGSelf(this.node,this.svgElement),this.usesPaint&&this.dirtyCachedPaints){var t,e,i=this.node._cachedPaints.slice();for(t=0;t<i.length;t++){var n=i[t],s=!0;for(e=0;e<this.lastCachedPaints.length;e++)if(n===this.lastCachedPaints[e]){s=!1;break}s&&this.svgBlock.incrementPaint(n)}for(t=0;t<this.lastCachedPaints.length;t++){var r=this.lastCachedPaints[t],a=!0;for(e=0;e<i.length;e++)if(r===i[e]){a=!1;break}a&&this.svgBlock.decrementPaint(r)}this.lastCachedPaints=i}this.setToCleanState()},updateFillStrokeStyle:function(t){if(this.usesPaint){this.dirtyFill&&this.paintState.updateFill(this.svgBlock,this.node.getFillValue()),this.dirtyStroke&&this.paintState.updateStroke(this.svgBlock,this.node.getStrokeValue());var e=this.dirtyLineWidth||this.dirtyLineOptions;e&&this.paintState.updateStrokeDetailStyle(this.node),(this.dirtyFill||this.dirtyStroke||e)&&t.setAttribute("style",this.paintState.baseStyle+this.paintState.strokeDetailStyle),this.cleanPaintableState()}},updateSVGBlock:function(t){var e=this.svgBlock;if(this.usesPaint&&e)for(var i=0;i<this.lastCachedPaints.length;i++)e.decrementPaint(this.lastCachedPaints[i]);if(this.svgBlock=t,this.usesPaint)for(var n=0;n<this.lastCachedPaints.length;n++)t.incrementPaint(this.lastCachedPaints[n]);this.updateDefsSelf&&this.updateDefsSelf(t),this.usesPaint&&this.paintState.updateSVGBlock(t),this.usesPaint&&this.markDirtyFill(),this.usesPaint&&this.markDirtyStroke()},dispose:function(){this.disposeState(),this.keepElements||(this.svgElement=null),this.updateDefsSelf&&this.updateDefsSelf(null),this.usesPaint&&this.paintState.dispose(),this.defs=null,this.svgBlock=null,r.prototype.dispose.call(this)}}),e}),i("SCENERY/util/TrailPointer",["require","PHET_CORE/inherit","SCENERY/scenery"],function(t){"use strict";function e(t,e){this.trail=t,this.setBefore(e)}var i=t("PHET_CORE/inherit"),n=t("SCENERY/scenery");return n.register("TrailPointer",e),i(Object,e,{copy:function(){return new e(this.trail.copy(),this.isBefore)},setBefore:function(t){this.isBefore=t,this.isAfter=!t},getRenderSwappedPointer:function(){var t=this.isBefore?this.trail.previous():this.trail.next();return null===t?null:new e(t,!this.isBefore)},getRenderBeforePointer:function(){return this.isBefore?this:this.getRenderSwappedPointer()},getRenderAfterPointer:function(){return this.isAfter?this:this.getRenderSwappedPointer()},compareRender:function(t){var e=this.getRenderBeforePointer(),i=t.getRenderBeforePointer();return null!==e&&null!==i?e.trail.compare(i.trail):e===i?0:null===e?1:-1},compareNested:function(t){var e=this.trail.compare(t.trail);return 0===e?this.isBefore===t.isBefore?0:this.isBefore?-1:1:this.trail.isExtensionOf(t.trail)?t.isBefore?1:-1:t.trail.isExtensionOf(this.trail)?this.isBefore?-1:1:e},equalsRender:function(t){return 0===this.compareRender(t)},equalsNested:function(t){return 0===this.compareNested(t)},hasTrail:function(){return!!this.trail},nestedForwards:function(){if(this.isBefore)this.trail.lastNode()._children.length>0?this.trail.addDescendant(this.trail.lastNode()._children[0],0):this.setBefore(!1);else{if(0===this.trail.indices.length)return this.trail=null,null;var t=this.trail.indices[this.trail.indices.length-1];this.trail.removeDescendant(),this.trail.lastNode()._children.length>t+1&&(this.trail.addDescendant(this.trail.lastNode()._children[t+1],t+1),this.setBefore(!0))}return this},nestedBackwards:function(){if(this.isBefore){if(0===this.trail.indices.length)return this.trail=null,null;var t=this.trail.indices[this.trail.indices.length-1];this.trail.removeDescendant(),t-1>=0&&(this.trail.addDescendant(this.trail.lastNode()._children[t-1],t-1),this.setBefore(!1))}else if(this.trail.lastNode()._children.length>0){var e=this.trail.lastNode()._children;this.trail.addDescendant(e[e.length-1],e.length-1)}else this.setBefore(!0);return this},eachNodeBetween:function(t,e){this.eachTrailBetween(t,function(t){return e(t.lastNode())})},eachTrailBetween:function(t,e){this.isBefore&&e(this.trail),this.depthFirstUntil(t,function(t){if(t.isBefore)return e(t.trail)},!0)},depthFirstUntil:function(t,e,i){this.trail.reindex(),t.trail.reindex();var n=this.copy();n.trail.setMutable();for(var s=!0;!n.equalsNested(t);){var r=!1;if(s?(i||(r=e(n)),s=!1):r=e(n),r&&n.isBefore){if(n.setBefore(!1),1===n.compareNested(t))break}else n.nestedForwards()}i||e(n)},toString:function(){return"["+(this.isBefore?"before":"after")+" "+this.trail.toString().slice(1)}}),e.compareNested=function(t,e,i,n){var s=t.compare(i);return 0===s?e===n?0:e?-1:1:t.isExtensionOf(i)?n?1:-1:i.isExtensionOf(t)?e?-1:1:s},e}),i("SCENERY/util/Trail",["require","PHET_CORE/inherit","DOT/Matrix3","DOT/Transform3","SCENERY/scenery","SCENERY/util/TrailPointer","SCENERY/nodes/Node"],function(t){"use strict";function e(t){if(t instanceof e){var i=t;return this.nodes=i.nodes.slice(0),this.length=i.length,this.uniqueId=i.uniqueId,void(this.indices=i.indices.slice(0))}this.nodes=[],this.length=0,this.uniqueId="",this.indices=[];var n=this;if(t)if(t instanceof r.Node){var s=t;n.addDescendant(s)}else for(var a=t.length,o=0;o<a;o++)n.addDescendant(t[o])}var i=t("PHET_CORE/inherit"),n=t("DOT/Matrix3"),s=t("DOT/Transform3"),r=t("SCENERY/scenery");t("SCENERY/util/TrailPointer"),t("SCENERY/nodes/Node");return r.register("Trail",e),i(Object,e,{copy:function(){return new e(this)},isPainted:function(){return this.lastNode().isPainted()},isValid:function(){this.reindex();for(var t=this.indices.length,e=0;e<t;e++)if(this.indices[e]<0)return!1;return!0},isVisible:function(){for(var t=this.nodes.length;t--;)if(!this.nodes[t].isVisible())return!1;return!0},isAccessibleVisible:function(){for(var t=this.nodes.length;t--;)if(!this.nodes[t].isVisible()||!this.nodes[t].getAccessibleVisible())return!1;return!0},getOpacity:function(){for(var t=1,e=this.nodes.length;e--;)t*=this.nodes[e].getOpacity();return t},isPickable:function(){return!_.some(this.nodes,function(t){return!1===t.pickable||!1===t.visible})&&(!!_.some(this.nodes,function(t){return t._inputListeners.length>0||!0===t._pickable})||this.lastNode()._picker._subtreePickableCount>0)},get:function(t){return t>=0?this.nodes[t]:this.nodes[this.nodes.length+t]},slice:function(t,i){return new e(this.nodes.slice(t,i))},subtrailTo:function(t,e){return this.slice(0,_.indexOf(this.nodes,t)+(e?0:1))},isEmpty:function(){return 0===this.nodes.length},getMatrix:function(){for(var t=n.identity(),e=this.nodes,i=e.length,s=0;s<i;s++)t.multiplyMatrix(e[s].getMatrix());return t},getAncestorMatrix:function(){for(var t=n.identity(),e=this.nodes,i=e.length,s=1;s<i;s++)t.multiplyMatrix(e[s].getMatrix());return t},getParentMatrix:function(){for(var t=n.identity(),e=this.nodes,i=e.length,s=0;s<i-1;s++)t.multiplyMatrix(e[s].getMatrix());return t},getTransform:function(){return new s(this.getMatrix())},getParentTransform:function(){return new s(this.getParentMatrix())},addAncestor:function(t,e){if(this.nodes.length){var i=this.nodes[0];this.indices.unshift(void 0===e?_.indexOf(t._children,i):e)}return this.nodes.unshift(t),this.length++,this.uniqueId=this.uniqueId?t.id+"-"+this.uniqueId:t.id+"",this},removeAncestor:function(){return this.nodes.shift(),this.indices.length&&this.indices.shift(),this.length--,this.updateUniqueId(),this},addDescendant:function(t,e){if(this.nodes.length){var i=this.lastNode();this.indices.push(void 0===e?_.indexOf(i._children,t):e)}return this.nodes.push(t),this.length++,this.uniqueId=this.uniqueId?this.uniqueId+"-"+t.id:t.id+"",this},removeDescendant:function(){return this.nodes.pop(),this.indices.length&&this.indices.pop(),this.length--,this.updateUniqueId(),this},addDescendantTrail:function(t){var e=t.length;e&&this.addDescendant(t.nodes[0]);for(var i=1;i<e;i++)this.addDescendant(t.nodes[i],this.indices[i-1])},removeDescendantTrail:function(t){for(var e=t.length-1;e>=0;e--)this.removeDescendant()},reindex:function(){for(var t=this.length,e=1;e<t;e++){var i=this.indices[e-1],n=this.nodes[e-1];n._children[i]!==this.nodes[e]&&(this.indices[e-1]=_.indexOf(n._children,this.nodes[e]))}},setImmutable:function(){return this},setMutable:function(){return this},areIndicesValid:function(){for(var t=1;t<this.length;t++){var e=this.indices[t-1];if(this.nodes[t-1]._children[e]!==this.nodes[t])return!1}return!0},equals:function(t){if(this.length!==t.length)return!1;for(var e=0;e<this.nodes.length;e++)if(this.nodes[e]!==t.nodes[e])return!1;return!0},upToNode:function(t){_.indexOf(this.nodes,t);return this.slice(0,_.indexOf(this.nodes,t)+1)},isExtensionOf:function(t,e){if(this.length<=t.length-(e?1:0))return!1;for(var i=0;i<t.nodes.length;i++)if(this.nodes[i]!==t.nodes[i])return!1;return!0},containsNode:function(t){return _.includes(this.nodes,t)},getTransformTo:function(t){return new s(this.getMatrixTo(t))},getMatrixTo:function(t){this.reindex(),t.reindex();var e,i=this.getBranchIndexTo(t),s=n.IDENTITY;for(e=this.length-1;e>=i;e--)s=this.nodes[e].getMatrix().timesMatrix(s);for(e=i;e<t.length;e++)s=t.nodes[e].getTransform().getInverse().timesMatrix(s);return s},getBranchIndexTo:function(t){var e,i=Math.min(this.length,t.length);for(e=0;e<i&&this.nodes[e]===t.nodes[e];e++);return e},getLastInputEnabledIndex:function(){for(var t=-1,e=0;e<this.length&&this.nodes[e]._inputEnabled;e++)t=e;return t},getCursorCheckIndex:function(){var t=this.getLastInputEnabledIndex();return t+1<this.length?t+1:t},nodeFromTop:function(t){return this.nodes[this.length-1-t]},lastNode:function(){return this.nodeFromTop(0)},rootNode:function(){return this.nodes[0]},previous:function(){if(this.nodes.length<=1)return null;var t=this.nodeFromTop(0),i=this.nodeFromTop(1),n=_.indexOf(i._children,t),s=this.nodes.slice(0,this.nodes.length-1);if(0===n)return new e(s);for(s.push(i._children[n-1]);0!==s[s.length-1]._children.length;){var r=s[s.length-1];s.push(r._children[r._children.length-1])}return new e(s)},previousPainted:function(){for(var t=this.previous();t&&!t.isPainted();)t=t.previous();return t},next:function(){var t=this.nodes.slice(0),i=this.nodeFromTop(0);if(i._children.length>0)return t.push(i._children[0]),new e(t);for(var n=this.nodes.length-1;n>0;){var s=this.nodes[n],r=this.nodes[n-1];t.pop();var a=_.indexOf(r._children,s);if(a!==r._children.length-1)return t.push(r._children[a+1]),new e(t);n--}return null},nextPainted:function(){for(var t=this.next();t&&!t.isPainted();)t=t.next();return t},eachTrailUnder:function(t){new r.TrailPointer(this,!0).eachTrailBetween(new r.TrailPointer(this,!1),t)},compare:function(t){for(var e=Math.min(this.indices.length,t.indices.length),i=0;i<e;i++)if(this.indices[i]!==t.indices[i])return this.indices[i]<t.indices[i]?-1:1;return this.nodes.length<t.nodes.length?-1:this.nodes.length>t.nodes.length?1:0},isBefore:function(t){return-1===this.compare(t)},isAfter:function(t){return 1===this.compare(t)},localToGlobalPoint:function(t){return this.getMatrix().timesVector2(t)},localToGlobalBounds:function(t){return t.transformed(this.getMatrix())},globalToLocalPoint:function(t){return this.getTransform().inversePosition2(t)},globalToLocalBounds:function(t){return this.getTransform().inverseBounds2(t)},parentToGlobalPoint:function(t){return this.getParentMatrix().timesVector2(t)},parentToGlobalBounds:function(t){return t.transformed(this.getParentMatrix())},globalToParentPoint:function(t){return this.getParentTransform().inversePosition2(t)},globalToParentBounds:function(t){return this.getParentTransform().inverseBounds2(t)},updateUniqueId:function(){var t="",e=this.nodes.length;e>0&&(t+=this.nodes[0]._id);for(var i=1;i<e;i++)t+="-"+this.nodes[i]._id;this.uniqueId=t},getUniqueId:function(){return this.uniqueId},toString:function(){return this.reindex(),this.length?"[Trail "+this.indices.join(".")+" "+this.getUniqueId()+"]":"Empty Trail"},toPathString:function(){var t=_.filter(this.nodes,function(t){return"Node"!==t.constructor.name});return _.map(t,function(t){return t.constructor.name}).join("/")},toDebugString:function(){return this.toString()+" "+this.toPathString()}}),e.eachPaintedTrailBetween=function(t,i,n,s,r){e.eachTrailBetween(t,i,function(t){if(t&&t.isPainted())return n(t)},s,r)},e.eachTrailBetween=function(t,e,i,n,s){var a=t?new r.TrailPointer(t.copy(),!0):new r.TrailPointer(new r.Trail(s),!0),o=e?new r.TrailPointer(e.copy(),!0):new r.TrailPointer(new r.Trail(s),!1);n&&(a.nestedForwards(),o.nestedBackwards(),1===a.compareNested(o))||a.depthFirstUntil(o,function(t){if(t.isBefore)return i(t.trail)},!1)},e.branchIndex=function(t,e){var i,n=Math.min(t.length,e.length);for(i=0;i<n&&t.nodes[i]===e.nodes[i];i++);return i},e.sharedTrail=function(t,i){return t.slice(0,e.branchIndex(t,i))},e.appendAncestorTrailsWithPredicate=function(t,i,n){var s=i.rootNode();n(s)&&t.push(i.copy());for(var r=s._parents.length,a=0;a<r;a++){var o=s._parents[a];i.addAncestor(o),e.appendAncestorTrailsWithPredicate(t,i,n),i.removeAncestor()}},e.appendDescendantTrailsWithPredicate=function(t,i,n){var s=i.lastNode();n(s)&&t.push(i.copy());for(var r=s._children.length,a=0;a<r;a++){var o=s._children[a];i.addDescendant(o,a),e.appendDescendantTrailsWithPredicate(t,i,n),i.removeDescendant()}},e.spannedSubtrees=function(t,e){},e.fromUniqueId=function(t,i){for(var n=i.split("-").map(function(t){return parseInt(t,10)}),s=t,r=(n.shift(),[s]);n.length>0;)for(var a=n.shift(),o=(s.accessibleOrder||[]).concat(s.children),h=0;h<o.length;h++)if(null!==o[h]&&o[h].id===a){var l=o[h];r.push(l),s=l;break}return new e(r)},e}),i("SCENERY/accessibility/Focus",["require","PHET_CORE/inherit","SCENERY/scenery"],function(t){"use strict";function e(t,e){this.display=t,this.trail=e}var i=t("PHET_CORE/inherit");return t("SCENERY/scenery").register("Focus",e),i(Object,e)}),i("SCENERY/input/A11yPointer",["require","SCENERY/accessibility/AccessibleInstance","SCENERY/input/Pointer","SCENERY/scenery","SCENERY/util/Trail","SCENERY/accessibility/Focus"],function(t){"use strict";var e=t("SCENERY/accessibility/AccessibleInstance"),i=t("SCENERY/input/Pointer"),n=t("SCENERY/scenery"),s=t("SCENERY/util/Trail"),r=t("SCENERY/accessibility/Focus"),a=function(t){function a(t){_classCallCheck(this,a);var e=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,null,!1,"a11y"));return e.display=t,e.initializeListeners(),e.blockTrustedEvents=!1,e.keydownTargetNode=null,e}return _inherits(a,i),_createClass(a,[{key:"initializeListeners",value:function(){var t=this;this.addInputListener({focus:function(){t.trail.lastNode().focusable&&(n.Display.focus=new r(t.display,e.guessVisualTrail(t.trail,t.display.rootNode)),t.display.pointerFocus=null)},blur:function(e){n.Display.focus=null,t.keydownTargetNode=null},keydown:function(e){t.blockTrustedEvents&&e.domEvent.isTrusted||(n.Display.keyStateTracker.keydownUpdate(e),t.keydownTargetNode=e.target)},keyup:function(e){t.blockTrustedEvents&&e.domEvent.isTrusted||(n.Display.keyStateTracker.keyupUpdate(e),t.keydownTargetNode!==e.target&&e.abort())}})}},{key:"updateTrail",value:function(t){if(this.trail&&this.trail.getUniqueId()===t)return this.trail;var e=s.fromUniqueId(this.display.rootNode,t);return this.trail=e,e}},{key:"invalidateTrail",value:function(t){null!==this.trail&&this.trail.uniqueId===t||(this.trail=s.fromUniqueId(this.display.rootNode,t))}}]),a}();return n.register("A11yPointer",a)}),i("SCENERY/input/BatchedDOMEvent",["require","PHET_CORE/inherit","PHET_CORE/Poolable","SCENERY/scenery"],function(t){"use strict";function e(t,e,i){this.domEvent=t,this.type=e,this.callback=i}var i=t("PHET_CORE/inherit"),n=t("PHET_CORE/Poolable"),s=t("SCENERY/scenery");return s.register("BatchedDOMEvent",e),e.POINTER_TYPE=1,e.MS_POINTER_TYPE=2,e.TOUCH_TYPE=3,e.MOUSE_TYPE=4,e.WHEEL_TYPE=5,i(Object,e,{run:function(t){var i=this.domEvent,n=this.callback;if(t.validatePointers(),this.type===e.POINTER_TYPE)n.call(t,i.pointerId,i.pointerType,t.pointFromEvent(i),i);else if(this.type===e.MS_POINTER_TYPE)n.call(t,i.pointerId,s.Input.msPointerType(i),t.pointFromEvent(i),i);else if(this.type===e.TOUCH_TYPE)for(var r=0;r<i.changedTouches.length;r++){var a=i.changedTouches.item(r);n.call(t,a.identifier,t.pointFromEvent(a),i)}else if(this.type===e.MOUSE_TYPE)n.call(t,t.pointFromEvent(i),i);else{if(this.type!==e.WHEEL_TYPE)throw new Error("bad type value: "+this.type);n.call(t,i)}},dispose:function(){this.domEvent=null,this.callback=null,this.freeToPool()}}),e.fromPointerEvent=function(t,i){return e.createFromPool(t,i(t),t.pointerId)},n.mixInto(e),e}),i("SCENERY/input/BrowserEvents",["require","PHET_CORE/arrayRemove","SCENERY/input/BatchedDOMEvent","SCENERY/util/Features","PHET_CORE/platform","SCENERY/scenery"],function(t){"use strict";var e=t("PHET_CORE/arrayRemove"),i=t("SCENERY/input/BatchedDOMEvent"),n=t("SCENERY/util/Features"),s=t("PHET_CORE/platform"),r=t("SCENERY/scenery"),a=function(){},o={addDisplay:function(t,e,i){this.attachedDisplays.push(t),e?1===this.attachedDisplays.length&&this.connectWindowListeners(i):this.addOrRemoveListeners(t.domElement,!0,i),t.domElement.addEventListener("wheel",this.onwheel,o.getEventOptions(i,!0))},removeDisplay:function(t,i,n){e(this.attachedDisplays,t),i?0===this.attachedDisplays.length&&this.disconnectWindowListeners(n):this.addOrRemoveListeners(t.domElement,!1,n),t.domElement.removeEventListener("wheel",this.onwheel,o.getEventOptions(n,!0))},getEventOptions:function(t,e){return!(!n.passive||null===t)&&(e?{useCapture:!1,passive:t}:{passive:t})},listenersAttachedToWindow:0,listenersAttachedToElement:0,attachedDisplays:[],canUsePointerEvents:!!(window.navigator&&window.navigator.pointerEnabled||window.PointerEvent)&&!s.firefox,canUseMSPointerEvents:window.navigator&&window.navigator.msPointerEnabled,pointerListenerTypes:["pointerdown","pointerup","pointermove","pointerover","pointerout","pointercancel"],msPointerListenerTypes:["MSPointerDown","MSPointerUp","MSPointerMove","MSPointerOver","MSPointerOut","MSPointerCancel"],touchListenerTypes:["touchstart","touchend","touchmove","touchcancel"],mouseListenerTypes:["mousedown","mouseup","mousemove","mouseover","mouseout"],wheelListenerTypes:["wheel"],getNonWheelUsedTypes:function(){return this.canUsePointerEvents?this.pointerListenerTypes:this.canUseMSPointerEvents?this.msPointerListenerTypes:this.touchListenerTypes.concat(this.mouseListenerTypes)},connectWindowListeners:function(t){this.addOrRemoveListeners(window,!0,t)},disconnectWindowListeners:function(t){this.addOrRemoveListeners(window,!1,t)},addOrRemoveListeners:function(t,e,i){var n=t===window,s=e?1:-1;n?this.listenersAttachedToWindow+=s:this.listenersAttachedToElement+=s;for(var r=e?"addEventListener":"removeEventListener",h=this.getNonWheelUsedTypes(),l=0;l<h.length;l++){var u=h[l];n&&document[r](u,a,o.getEventOptions(i,!1));var c=this["on"+u];t[r](u,c,o.getEventOptions(i,!0))}},batchWindowEvent:function(t,e,i,n){for(var s=0;s<this.attachedDisplays.length;s++){var r=this.attachedDisplays[s]._input;r.batchEvent(t,e,r[i],n)}},onpointerdown:function(t){"mouse"===t.pointerType&&r.Display.userGestureEmitter.emit(),o.batchWindowEvent(t,i.POINTER_TYPE,"pointerDown",!1)},onpointerup:function(t){r.Display.userGestureEmitter.emit(),o.batchWindowEvent(t,i.POINTER_TYPE,"pointerUp",!0)},onpointermove:function(t){o.batchWindowEvent(t,i.POINTER_TYPE,"pointerMove",!1)},onpointerover:function(t){o.batchWindowEvent(t,i.POINTER_TYPE,"pointerOver",!1)},onpointerout:function(t){o.batchWindowEvent(t,i.POINTER_TYPE,"pointerOut",!1)},onpointercancel:function(t){o.batchWindowEvent(t,i.POINTER_TYPE,"pointerCancel",!1)},onMSPointerDown:function(t){o.batchWindowEvent(t,i.MS_POINTER_TYPE,"pointerDown",!1)},onMSPointerUp:function(t){o.batchWindowEvent(t,i.MS_POINTER_TYPE,"pointerUp",!0)},onMSPointerMove:function(t){o.batchWindowEvent(t,i.MS_POINTER_TYPE,"pointerMove",!1)},onMSPointerOver:function(t){o.batchWindowEvent(t,i.MS_POINTER_TYPE,"pointerOver",!1)},onMSPointerOut:function(t){o.batchWindowEvent(t,i.MS_POINTER_TYPE,"pointerOut",!1)},onMSPointerCancel:function(t){o.batchWindowEvent(t,i.MS_POINTER_TYPE,"pointerCancel",!1)},ontouchstart:function(t){o.batchWindowEvent(t,i.TOUCH_TYPE,"touchStart",!1)},ontouchend:function(t){r.Display.userGestureEmitter.emit(),o.batchWindowEvent(t,i.TOUCH_TYPE,"touchEnd",!0)},ontouchmove:function(t){o.batchWindowEvent(t,i.TOUCH_TYPE,"touchMove",!1)},ontouchcancel:function(t){o.batchWindowEvent(t,i.TOUCH_TYPE,"touchCancel",!1)},onmousedown:function(t){r.Display.userGestureEmitter.emit(),o.batchWindowEvent(t,i.MOUSE_TYPE,"mouseDown",!1)},onmouseup:function(t){r.Display.userGestureEmitter.emit(),o.batchWindowEvent(t,i.MOUSE_TYPE,"mouseUp",!0)},onmousemove:function(t){o.batchWindowEvent(t,i.MOUSE_TYPE,"mouseMove",!1)},onmouseover:function(t){o.batchWindowEvent(t,i.MOUSE_TYPE,"mouseOver",!1)},onmouseout:function(t){o.batchWindowEvent(t,i.MOUSE_TYPE,"mouseOut",!1)},onwheel:function(t){o.batchWindowEvent(t,i.WHEEL_TYPE,"wheel",!1)}};return r.register("BrowserEvents",o),o}),i("SCENERY/input/DOMEventIO",["require","TANDEM/types/ObjectIO","TANDEM/phetioInherit","SCENERY/scenery","AXON/validate"],function(t){"use strict";function e(t,e){i.call(this,t,e)}var i=t("TANDEM/types/ObjectIO"),n=t("TANDEM/phetioInherit"),s=t("SCENERY/scenery"),r=t("AXON/validate");return n(i,"DOMEventIO",e,{},{documentation:"A DOM Event",validator:{valueType:window.Event},toStateObject:function(t){return r(t,this.validator),s.Input.serializeDomEvent(t)},fromStateObject:function(t){return s.Input.deserializeDomEvent(t)}}),s.register("DOMEventIO",e)}),i("SCENERY/input/Event",["require","SCENERY/input/A11yPointer","SCENERY/input/Mouse","SCENERY/input/Pointer","SCENERY/scenery","SCENERY/util/Trail"],function(t){"use strict";var e=t("SCENERY/input/A11yPointer"),i=t("SCENERY/input/Mouse"),n=(t("SCENERY/input/Pointer"),t("SCENERY/scenery")),s=(t("SCENERY/util/Trail"),function(){function t(e,n,s,r){_classCallCheck(this,t),this.handled=!1,this.aborted=!1,this.trail=e,this.type=n,this.pointer=s,this.domEvent=r,this.currentTarget=null,this.target=e.lastNode(),this.isPrimary=!(s instanceof i&&r&&0!==r.button),r&&(s.lastDOMEvent=r)}return _createClass(t,[{key:"handle",value:function(){this.handled=!0}},{key:"abort",value:function(){this.aborted=!0}},{key:"isA11y",value:function(){return this.pointer instanceof e}},{key:"canStartPress",value:function(){return!(this.pointer.isAttached()||this.pointer instanceof i&&0!==this.domEvent.button)}}]),t}());return n.register("Event",s)}),i("DOT/Vector2IO",["require","DOT/dot","TANDEM/types/ObjectIO","TANDEM/phetioInherit","DOT/Vector2","AXON/validate"],function(t){"use strict";function e(t,e){n.call(this,t,e)}var i=t("DOT/dot"),n=t("TANDEM/types/ObjectIO"),s=t("TANDEM/phetioInherit"),r=t("DOT/Vector2"),a=t("AXON/validate");return s(n,"Vector2IO",e,{},{documentation:"A numerical object with x and y properties, like {x:3,y:4}",validator:{valueType:r},toStateObject:function(t){return a(t,this.validator),t.toStateObject()},fromStateObject:function(t){return r.fromStateObject(t)}}),i.register("Vector2IO",e),e}),i("SCENERY/input/Input",["require","SCENERY/input/A11yPointer","SCENERY/accessibility/AccessibilityUtil","SCENERY/input/BatchedDOMEvent","SCENERY/input/BrowserEvents","PHET_CORE/cleanArray","SCENERY/input/DOMEventIO","AXON/Emitter","AXON/EmitterIO","SCENERY/input/Event","SCENERY/util/Features","SCENERY/util/FullScreen","SCENERY/accessibility/KeyboardUtil","SCENERY/input/Mouse","TANDEM/types/NumberIO","SCENERY/input/Pen","TANDEM/PhetioObject","PHET_CORE/platform","SCENERY/input/Pointer","SCENERY/scenery","TANDEM/Tandem","SCENERY/input/Touch","SCENERY/util/Trail","DOT/Vector2","DOT/Vector2IO"],function(t){"use strict";var e=t("SCENERY/input/A11yPointer"),i=t("SCENERY/accessibility/AccessibilityUtil"),n=t("SCENERY/input/BatchedDOMEvent"),s=t("SCENERY/input/BrowserEvents"),r=t("PHET_CORE/cleanArray"),a=t("SCENERY/input/DOMEventIO"),o=t("AXON/Emitter"),h=t("AXON/EmitterIO"),l=t("SCENERY/input/Event"),u=t("SCENERY/util/Features"),c=t("SCENERY/util/FullScreen"),d=t("SCENERY/accessibility/KeyboardUtil"),f=t("SCENERY/input/Mouse"),m=t("TANDEM/types/NumberIO"),p=t("SCENERY/input/Pen"),g=t("TANDEM/PhetioObject"),v=t("PHET_CORE/platform"),y=(t("SCENERY/input/Pointer"),t("SCENERY/scenery")),E=t("TANDEM/Tandem"),b=t("SCENERY/input/Touch"),S=t("SCENERY/util/Trail"),T=t("DOT/Vector2"),C=t("DOT/Vector2IO"),x={button:!0,keyCode:!0,deltaX:!0,deltaY:!0,deltaZ:!0,deltaMode:!0,pointerId:!0,pointerType:!0,charCode:!0,which:!0,clientX:!0,clientY:!0,changedTouches:!0,target:!0},w="targetSubstitute",R=function(){function t(e,n,s,r,l,c){var d=this;_classCallCheck(this,t),c=_.extend({tandem:E.optional},c),this.display=e,this.rootNode=e.rootNode,this.attachToWindow=n,this.batchDOMEvents=s,this.assumeFullWindow=r,this.passiveEvents=l,this.batchedEvents=[],this.a11yPointer=null,this.mouse=null,this.pointers=[],this.pointerAddedListeners=[],this.currentlyFiringEvents=!1;if(this.validatePointersEmitter=new o({phetioPlayback:!0,tandem:c.tandem.createTandem("validatePointersEmitter"),phetioHighFrequency:!0,first:function(){for(var t=d.pointers.length;t--;){var e=d.pointers[t];e.point&&d.branchChangeEvents(e,e.lastDOMEvent,!1)}}}),this.mouseUpEmitter=new o({phetioPlayback:!0,tandem:c.tandem.createTandem("mouseUpEmitter"),phetioType:h([{name:"point",type:C},{name:"event",type:a}]),phetioEventType:g.EventType.USER,phetioDocumentation:"Emits when a mouse button is released",first:function(t,e){d.mouse||d.initMouse();var i=d.mouse.up(t,e);d.upEvent(d.mouse,e,i)}}),this.mouseDownEmitter=new o({phetioPlayback:!0,tandem:c.tandem.createTandem("mouseDownEmitter"),phetioType:h([{name:"point",type:C},{name:"event",type:a}]),phetioEventType:g.EventType.USER,phetioDocumentation:"Emits when a mouse button is pressed",first:function(t,e){d.mouse||d.initMouse();var i=d.mouse.down(t,e);d.downEvent(d.mouse,e,i)}}),this.mouseMovedEmitter=new o({phetioPlayback:!0,tandem:c.tandem.createTandem("mouseMovedEmitter"),phetioType:h([{name:"point",type:C},{name:"event",type:a}]),phetioEventType:g.EventType.USER,phetioDocumentation:"Emits when the mouse is moved",phetioHighFrequency:!0,first:function(t,e){d.mouse||d.initMouse(),d.mouse.move(t,e),d.moveEvent(d.mouse,e)}}),this.mouseOverEmitter=new o({phetioPlayback:!0,tandem:c.tandem.createTandem("mouseOverEmitter"),phetioType:h([{name:"point",type:C},{name:"event",type:a}]),phetioEventType:g.EventType.USER,phetioDocumentation:"Emits when the mouse is moved over a Node",first:function(t,e){d.mouse||d.initMouse(),d.mouse.over(t,e)}}),this.mouseOutEmitter=new o({phetioPlayback:!0,tandem:c.tandem.createTandem("mouseOutEmitter"),phetioType:h([{name:"point",type:C},{name:"event",type:a}]),phetioEventType:g.EventType.USER,phetioDocumentation:"Emits when the mouse moves out of the display",first:function(t,e){d.mouse||d.initMouse(),d.mouse.out(t,e)}}),this.wheelScrolledEmitter=new o({phetioPlayback:!0,tandem:c.tandem.createTandem("wheelScrolledEmitter"),phetioType:h([{name:"event",type:a}]),phetioEventType:g.EventType.USER,phetioDocumentation:"Emits when the mouse wheel scrolls",phetioHighFrequency:!0,first:function(t){if(d.mouse||d.initMouse(),d.mouse.wheel(t),d.mouse.point){var e=d.rootNode.trailUnderPointer(d.mouse)||new S(d.rootNode);d.dispatchEvent(e,"wheel",d.mouse,t,!0)}}}),this.touchStartedEmitter=new o({phetioPlayback:!0,tandem:c.tandem.createTandem("touchStartedEmitter"),phetioType:h([{name:"id",type:m},{name:"point",type:C},{name:"event",type:a}]),phetioEventType:g.EventType.USER,phetioDocumentation:"Emits when a touch begins",first:function(t,e,i){var n=new b(t,e,i);d.addPointer(n),d.downEvent(n,i,!1)}}),this.touchEndedEmitter=new o({phetioPlayback:!0,tandem:c.tandem.createTandem("touchEndedEmitter"),phetioType:h([{name:"id",type:m},{name:"point",type:C},{name:"event",type:a}]),phetioEventType:g.EventType.USER,phetioDocumentation:"Emits when a touch ends",first:function(t,e,i){var n=d.findPointerById(t);if(n){var s=n.end(e,i);d.upEvent(n,i,s),d.removePointer(n)}}}),this.touchMovedEmitter=new o({phetioPlayback:!0,tandem:c.tandem.createTandem("touchMovedEmitter"),phetioType:h([{name:"id",type:m},{name:"point",type:C},{name:"event",type:a}]),phetioEventType:g.EventType.USER,phetioDocumentation:"Emits when a touch moves",phetioHighFrequency:!0,first:function(t,e,i){var n=d.findPointerById(t);n&&(n.move(e,i),d.moveEvent(n,i))}}),this.touchCanceledEmitter=new o({phetioPlayback:!0,tandem:c.tandem.createTandem("touchCanceledEmitter"),phetioType:h([{name:"id",type:m},{name:"point",type:C},{name:"event",type:a}]),phetioEventType:g.EventType.USER,phetioDocumentation:"Emits when a touch is canceled",first:function(t,e,i){var n=d.findPointerById(t);if(n){var s=n.cancel(e,i);d.cancelEvent(n,i,s),d.removePointer(n)}}}),this.penStartedEmitter=new o({phetioPlayback:!0,tandem:c.tandem.createTandem("penStartedEmitter"),phetioType:h([{name:"id",type:m},{name:"point",type:C},{name:"event",type:a}]),phetioEventType:g.EventType.USER,phetioDocumentation:"Emits when a pen touches the screen",first:function(t,e,i){var n=new p(t,e,i);d.addPointer(n),d.downEvent(n,i,!1)}}),this.penEndedEmitter=new o({phetioPlayback:!0,tandem:c.tandem.createTandem("penEndedEmitter"),phetioType:h([{name:"id",type:m},{name:"point",type:C},{name:"event",type:a}]),phetioEventType:g.EventType.USER,phetioDocumentation:"Emits when a pen is lifted",first:function(t,e,i){var n=d.findPointerById(t);if(n){var s=n.end(e,i);d.upEvent(n,i,s),d.removePointer(n)}}}),this.penMovedEmitter=new o({phetioPlayback:!0,tandem:c.tandem.createTandem("penMovedEmitter"),phetioType:h([{name:"id",type:m},{name:"point",type:C},{name:"event",type:a}]),phetioEventType:g.EventType.USER,phetioDocumentation:"Emits when a pen is moved",phetioHighFrequency:!0,first:function(t,e,i){var n=d.findPointerById(t);n&&(n.move(e,i),d.moveEvent(n,i))}}),this.penCanceledEmitter=new o({phetioPlayback:!0,tandem:c.tandem.createTandem("penCanceledEmitter"),phetioType:h([{name:"id",type:m},{name:"point",type:C},{name:"event",type:a}]),phetioEventType:g.EventType.USER,phetioDocumentation:"Emits when a pen is canceled",first:function(t,e,i){var n=d.findPointerById(t);if(n){var s=n.cancel(e,i);d.cancelEvent(n,i,s),d.removePointer(n)}}}),this.display._accessible){var f=!1,y=function(t){return t[w]?t[w][i.DATA_TRAIL_ID]:t.target.getAttribute(i.DATA_TRAIL_ID)};this.focusinEmitter=new o({phetioPlayback:!0,tandem:c.tandem.createTandem("focusinEmitter"),phetioType:h([{name:"event",type:a}]),phetioEventType:g.EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the focusin DOM event.",first:function(t){if(!d.display.blockFocusCallbacks)if(f)f=!1;else{d.a11yPointer||d.initA11yPointer();var e=d.a11yPointer.updateTrail(y(t));d.dispatchEvent(e,"focus",d.a11yPointer,t,!1)}}}),this.focusoutEmitter=new o({phetioPlayback:!0,tandem:c.tandem.createTandem("focusoutEmitter"),phetioType:h([{name:"event",type:a}]),phetioEventType:g.EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the focusout DOM event.",first:function(t){if(!d.display.blockFocusCallbacks&&(d.a11yPointer||d.initA11yPointer(),d.a11yPointer.invalidateTrail(y(t)),d.dispatchEvent(d.a11yPointer.trail,"blur",d.a11yPointer,t,!1),d.a11yPointer.trail=null,t.relatedTarget)){var e=d.display.accessibleDOMElement.contains(document.activeElement);i.isElementFocusable(t.relatedTarget)&&!e&&(v.ie&&(f=!0),t.relatedTarget.focus())}}}),this.clickEmitter=new o({phetioPlayback:!0,tandem:c.tandem.createTandem("clickEmitter"),phetioType:h([{name:"event",type:a}]),phetioEventType:g.EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the click DOM event.",first:function(t){d.a11yPointer||d.initA11yPointer();var e=d.a11yPointer.updateTrail(y(t));d.dispatchEvent(e,"click",d.a11yPointer,t,!0)}}),this.inputEmitter=new o({phetioPlayback:!0,tandem:c.tandem.createTandem("inputEmitter"),phetioType:h([{name:"event",type:a}]),phetioEventType:g.EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the input DOM event.",first:function(t){d.a11yPointer||d.initA11yPointer();var e=d.a11yPointer.updateTrail(y(t));d.dispatchEvent(e,"input",d.a11yPointer,t,!0)}}),this.changeEmitter=new o({phetioPlayback:!0,tandem:c.tandem.createTandem("changeEmitter"),phetioType:h([{name:"event",type:a}]),phetioEventType:g.EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the change DOM event.",first:function(t){d.a11yPointer||d.initA11yPointer();var e=d.a11yPointer.updateTrail(y(t));d.dispatchEvent(e,"change",d.a11yPointer,t,!0)}}),this.keydownEmitter=new o({phetioPlayback:!0,tandem:c.tandem.createTandem("keydownEmitter"),phetioType:h([{name:"event",type:a}]),phetioEventType:g.EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the keydown DOM event.",first:function(t){d.a11yPointer||d.initA11yPointer();var e=d.a11yPointer.updateTrail(y(t));d.dispatchEvent(e,"keydown",d.a11yPointer,t,!0)}}),this.keyupEmitter=new o({phetioPlayback:!0,tandem:c.tandem.createTandem("keyupEmitter"),phetioType:h([{name:"event",type:a}]),phetioEventType:g.EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the keyup DOM event.",first:function(t){d.a11yPointer||d.initA11yPointer();var e=d.a11yPointer.updateTrail(y(t));d.dispatchEvent(e,"keyup",d.a11yPointer,t,!0)}});var T=!!u.passive&&{useCapture:!1,passive:!1};i.DOM_EVENTS.map(function(t){var e=t+"Emitter";d.display.accessibleDOMElement.addEventListener(t,function(t){d[e].emit(t)},T)}),document.body.addEventListener("keydown",this.handleDocumentKeydown.bind(this))}}return _createClass(t,[{key:"interruptPointers",value:function(){_.each(this.pointers,function(t){t.interruptAll()})}},{key:"batchEvent",value:function(t,e,i,s){this.display.interactive&&(this.batchedEvents.push(n.createFromPool(t,e,i)),!s&&this.batchDOMEvents||this.fireBatchedEvents()),!0!==this.passiveEvents&&(i!==this.mouseDown||v.ie||v.edge)&&t.preventDefault()}},{key:"fireBatchedEvents",value:function(){if(!this.currentlyFiringEvents&&this.batchedEvents.length){this.currentlyFiringEvents=!0;for(var t=this.batchedEvents,e=0;e<t.length;e++){var i=t[e];i.run(this),i.dispose()}r(t),this.currentlyFiringEvents=!1}}},{key:"clearBatchedEvents",value:function(){this.batchedEvents.length=0}},{key:"validatePointers",value:function(){this.validatePointersEmitter.emit()}},{key:"removeTemporaryPointers",value:function(){for(var t={},e=this.pointers.length-1;e>=0;e--){var i=this.pointers[e];if(!(i instanceof f)){this.pointers.splice(e,1);var n=i.trail||new S(this.rootNode);this.exitEvents(i,t,n,0,!0)}}}},{key:"connectListeners",value:function(){s.addDisplay(this.display,this.attachToWindow,this.passiveEvents)}},{key:"disconnectListeners",value:function(){s.removeDisplay(this.display,this.attachToWindow,this.passiveEvents)}},{key:"pointFromEvent",value:function(t){var e=T.createFromPool(t.clientX,t.clientY);if(!this.assumeFullWindow){var i=this.display.domElement.getBoundingClientRect();i.width>0&&i.height>0&&(e.subtractXY(i.left,i.top),i.width===this.display.width&&i.height===this.display.height||(e.x*=this.display.width/i.width,e.y*=this.display.height/i.height))}return e}},{key:"addPointer",value:function(t){if(this.pointers.push(t),this.pointerAddedListeners.length)for(var e=0;e<this.pointerAddedListeners.length;e++)this.pointerAddedListeners[e](t)}},{key:"addPointerAddedListener",value:function(t){this.pointerAddedListeners.push(t)}},{key:"removePointerAddedListener",value:function(t){var e=this.pointerAddedListeners.indexOf(t);-1!==e&&this.pointerAddedListeners.splice(e,e+1)}},{key:"removePointer",value:function(t){for(var e=this.pointers.length-1;e>=0;e--)this.pointers[e]===t&&this.pointers.splice(e,1);t.dispose()}},{key:"findPointerById",value:function(t){for(var e=this.pointers.length;e--;){var i=this.pointers[e];if(i.id===t)return i}return null}},{key:"initMouse",value:function(){this.mouse=new f,this.addPointer(this.mouse)}},{key:"initA11yPointer",value:function(){this.a11yPointer=new e(this.display),this.addPointer(this.a11yPointer)}},{key:"mouseDown",value:function(t,e){this.mouseDownEmitter.emit(t,e)}},{key:"mouseUp",value:function(t,e){this.mouseUpEmitter.emit(t,e)}},{key:"mouseMove",value:function(t,e){this.mouseMovedEmitter.emit(t,e)}},{key:"mouseOver",value:function(t,e){this.mouseOverEmitter.emit(t,e)}},{key:"mouseOut",value:function(t,e){this.mouseOutEmitter.emit(t,e)}},{key:"wheel",value:function(t){this.wheelScrolledEmitter.emit(t)}},{key:"touchStart",value:function(t,e,i){this.touchStartedEmitter.emit(t,e,i)}},{key:"touchEnd",value:function(t,e,i){this.touchEndedEmitter.emit(t,e,i)}},{key:"touchMove",value:function(t,e,i){this.touchMovedEmitter.emit(t,e,i)}},{key:"touchCancel",value:function(t,e,i){this.touchCanceledEmitter.emit(t,e,i)}},{key:"penStart",value:function(t,e,i){this.penStartedEmitter.emit(t,e,i)}},{key:"penEnd",value:function(t,e,i){this.penEndedEmitter.emit(t,e,i)}},{key:"penMove",value:function(t,e,i){this.penMovedEmitter.emit(t,e,i)}},{key:"penCancel",value:function(t,e,i){this.penCanceledEmitter.emit(t,e,i)}},{key:"pointerDown",value:function(t,e,i,n){var s=this.attachToWindow?document.body:this.display.domElement;switch(s.setPointerCapture&&n.pointerId&&s.setPointerCapture(n.pointerId),e){case"mouse":this.mouseDown(i,n);break;case"touch":this.touchStart(t,i,n);break;case"pen":this.penStart(t,i,n)}}},{key:"pointerUp",value:function(t,e,i,n){switch(e){case"mouse":this.mouseUp(i,n);break;case"touch":this.touchEnd(t,i,n);break;case"pen":this.penEnd(t,i,n)}}},{key:"pointerCancel",value:function(t,e,i,n){switch(e){case"mouse":console&&console.log&&console.log("WARNING: Pointer mouse cancel was received");break;case"touch":this.touchCancel(t,i,n);break;case"pen":this.penCancel(t,i,n);break;default:console.log&&console.log("Unknown pointer type: "+e)}}},{key:"pointerMove",value:function(t,e,i,n){switch(e){case"mouse":this.mouseMove(i,n);break;case"touch":this.touchMove(t,i,n);break;case"pen":this.penMove(t,i,n);break;default:console.log&&console.log("Unknown pointer type: "+e)}}},{key:"pointerOver",value:function(t,e,i,n){}},{key:"pointerOut",value:function(t,e,i,n){}},{key:"pointerEnter",value:function(t,e,i,n){}},{key:"pointerLeave",value:function(t,e,i,n){}},{key:"getPointerTrail",value:function(t){return this.rootNode.trailUnderPointer(t)||new S(this.rootNode)}},{key:"upEvent",value:function(t,e,i){var n=this.branchChangeEvents(t,e,i);this.dispatchEvent(n,"up",t,e,!0),t instanceof b&&this.exitEvents(t,e,n,0,!0)}},{key:"downEvent",value:function(t,e,i){var n=this.branchChangeEvents(t,e,i),s=null;if(!n.rootNode()._rendererSummary.isNotAccessible()){if(this.display.bounds.containsPoint(t.point)){for(var r=n.nodes.length-1;r>=0;r--)if(n.nodes[r].focusable){s=n.nodes[r];break}this.display.pointerFocus=s,y.Display.focus=null}}this.dispatchEvent(n,"down",t,e,!0)}},{key:"moveEvent",value:function(t,e){this.branchChangeEvents(t,e,!0)}},{key:"cancelEvent",value:function(t,e,i){var n=this.branchChangeEvents(t,e,i);this.dispatchEvent(n,"cancel",t,e,!0),t instanceof b&&this.exitEvents(t,e,n,0,!0)}},{key:"branchChangeEvents",value:function(t,e,i){var n=this.getPointerTrail(t),s=t.trail||new S(this.rootNode),r=s.lastNode()!==n.lastNode(),a=S.branchIndex(n,s),o=a!==n.length||a!==s.length;return o&&!1&&(!1).Input&&(!1).Input("changed from "+s.toString()+" to "+n.toString()),i&&this.dispatchEvent(n,"move",t,e,!0),o&&(this.exitEvents(t,e,s,a,r),this.enterEvents(t,e,n,a,r)),t.trail=n,n}},{key:"enterEvents",value:function(t,e,i,n,s){if(i.length>n)for(var r=i.length-1;r>=n;r--)this.dispatchEvent(i.slice(0,r+1),"enter",t,e,!1);s&&this.dispatchEvent(i,"over",t,e,!0)}},{key:"exitEvents",value:function(t,e,i,n,s){if(s&&this.dispatchEvent(i,"out",t,e,!0),i.length>n)for(var r=n;r<i.length;r++)this.dispatchEvent(i.slice(0,r+1),"exit",t,e,!1)}},{key:"dispatchEvent",value:function(t,e,i,n,s){var r=new l(t,e,i,n);this.dispatchToListeners(i,i.getListeners(),e,r),this.dispatchToTargets(t,e,i,r,s),this.dispatchToListeners(i,this.display.getInputListeners(),e,r)}},{key:"dispatchToListeners",value:function(t,e,i,n){if(!n.handled)for(var s=t.type+i,r=0;r<e.length;r++){var a=e[r];!n.aborted&&a[s]&&a[s](n),!n.aborted&&a[i]&&a[i](n)}}},{key:"dispatchToTargets",value:function(t,e,i,n,s){if(!n.aborted&&!n.handled)for(var r=t.getLastInputEnabledIndex();r>=0;s?r--:r=-1){var a=t.nodes[r];if(!a.isDisposed&&(n.currentTarget=a,this.dispatchToListeners(i,a.getInputListeners(),e,n),n.aborted||n.handled))return}}},{key:"handleDocumentKeydown",value:function(t){if(y.Display.userGestureEmitter.emit(),c.isFullScreen()&&t.keyCode===d.KEY_TAB){var e=this.display.accessibleDOMElement;(t.shiftKey?i.getPreviousFocusable(e):i.getNextFocusable(e))===t.target&&t.preventDefault()}if(this.display.pointerFocus||this.display.activeNode){var n=this.display.pointerFocus||this.display.activeNode,s=n.focusable;if(1===n.getAccessibleInstances().length){for(var r=!0,a=n.accessibleInstances[0].trail,o=a.nodes.length-1;o>=0;o--)if(!a.nodes[o].visible){r=!1;break}s&&r&&t.keyCode===d.KEY_TAB&&(t.preventDefault(),n.focus(),this.display.pointerFocus=null,this.display.activeNode=null)}}}}],[{key:"serializeDomEvent",value:function(e){var n={};for(var s in e)if(x[s]){var r=e[s];if("touches"===s||"targetTouches"===s||"changedTouches"===s){for(var a=[],o=0;o<r.length;o++){var h=r.item&&"function"==typeof r.item?r.item(o):r[o];a.push(t.serializeDomEvent(h))}n[s]=a}"target"===s&&null!==r?(n[s]={},n[s][i.DATA_TRAIL_ID]=r.getAttribute(i.DATA_TRAIL_ID)):n[s]="object"===(void 0===r?"undefined":_typeof(r))&&null!==r?{}:JSON.parse(JSON.stringify(r))}return n}},{key:"deserializeDomEvent",value:function(t){var e=new window.Event("inputEvent");for(var i in t)t.hasOwnProperty(i)&&("target"===i?e[w]=t[i]:e[i]=t[i]);return e}},{key:"debugText",value:function(t,e){var i=e.timeStamp+" "+e.type;return null!==t&&(i=t.x+","+t.y+" "+i),i}},{key:"msPointerType",value:function(t){return t.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_TOUCH?"touch":t.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_PEN?"pen":t.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_MOUSE?"mouse":t.pointerType}}]),t}();return R.BASIC_EVENT_TYPES=function(){return["down","up","cancel","move","wheel","enter","exit","over","out"]},R.A11Y_EVENT_TYPES=function(){return["focus","blur","click","input","change","keydown","keyup"]},R.EVENT_PREFIXES=function(){return["","mouse","touch","pen"]},R.ALL_EVENT_TYPES=function(){return R.EVENT_PREFIXES.map(function(t){return R.BASIC_EVENT_TYPES.map(function(e){return t+e})}).concat([R.A11Y_EVENT_TYPES])},y.register("Input",R)}),i("SCENERY/overlays/ShapeBasedOverlay",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/util/Trail"],function(t){"use strict";function e(t,e,i){function s(t,e){r.setAttribute("width",t),r.setAttribute("height",e),r.style.clip="rect(0px,"+t+"px,"+e+"px,0px)"}this.display=t,this.rootNode=e;var r=this.svg=document.createElementNS(n.svgns,"svg");r.style.position="absolute",r.setAttribute("class",i),r.style.top=0,r.style.left=0,r.style["pointer-events"]="none",t.onStatic("displaySize",function(t){s(t.width,t.height)}),s(t.width,t.height),this.domElement=r}var i=t("PHET_CORE/inherit"),n=t("SCENERY/scenery");return t("SCENERY/util/Trail"),n.register("ShapeBasedOverlay",e),i(Object,e,{addShape:function(t,e,i){var s=document.createElementNS(n.svgns,"path"),r=t.getSVGPath();r||(r="M0 0"),r?s.setAttribute("d",r):s.hasAttribute("d")&&s.removeAttribute("d"),s.setAttribute("style","fill: none; stroke: "+e+"; stroke-dasharray: 5, 3; stroke-dashoffset: "+(i?5:0)+"; stroke-width: 3;"),this.svg.appendChild(s)},update:function(){for(;this.svg.childNodes.length;)this.svg.removeChild(this.svg.childNodes[this.svg.childNodes.length-1]);this.addShapes()},addShapes:function(){},dispose:function(){}}),e}),i("SCENERY/overlays/CanvasNodeBoundsOverlay",["require","PHET_CORE/inherit","KITE/Shape","SCENERY/overlays/ShapeBasedOverlay","SCENERY/scenery","SCENERY/util/Trail"],function(t){"use strict";function e(t,e){s.call(this,t,e,"canvasNodeBoundsOverlay")}var i=t("PHET_CORE/inherit"),n=t("KITE/Shape"),s=t("SCENERY/overlays/ShapeBasedOverlay"),r=t("SCENERY/scenery");return t("SCENERY/util/Trail"),r.register("CanvasNodeBoundsOverlay",e),i(s,e,{addShapes:function(){var t=this;new r.Trail(this.rootNode).eachTrailUnder(function(e){var i=e.lastNode();if(!i.isVisible())return!0;if(i instanceof r.CanvasNode&&e.isVisible()){var s=e.getTransform();t.addShape(s.transformShape(n.bounds(i.selfBounds)),"rgba(0,255,0,0.8)",!0)}})}}),e}),i("SCENERY/overlays/FittedBlockBoundsOverlay",["require","PHET_CORE/inherit","DOT/Matrix3","KITE/Shape","SCENERY/overlays/ShapeBasedOverlay","SCENERY/scenery","SCENERY/util/Trail"],function(t){"use strict";function e(t,e){r.call(this,t,e,"canvasNodeBoundsOverlay")}var i=t("PHET_CORE/inherit"),n=t("DOT/Matrix3"),s=t("KITE/Shape"),r=t("SCENERY/overlays/ShapeBasedOverlay"),a=t("SCENERY/scenery");return t("SCENERY/util/Trail"),a.register("FittedBlockBoundsOverlay",e),i(r,e,{addShapes:function(){function t(t,n){t.willApplyTransform&&(n=n.timesMatrix(t.backboneInstance.relativeTransform.matrix)),t.blocks.forEach(function(t){!function(t,n){t.fitBounds&&!t.fitBounds.isEmpty()&&i.addShape(s.bounds(t.fitBounds).transformed(n),"rgba(255,0,0,0.8)",!0);if(t.firstDrawable&&t.lastDrawable){for(var r=t.firstDrawable;r!==t.lastDrawable;r=r.nextDrawable)e(r,n);e(t.lastDrawable,n)}}(t,n)})}function e(e,i){e.backboneInstance&&t(e,i)}var i=this;t(this.display._rootBackbone,n.IDENTITY)}}),e}),i("SCENERY/accessibility/FocusIO",["require","SCENERY/accessibility/Focus","TANDEM/types/ObjectIO","TANDEM/phetioInherit","SCENERY/scenery","AXON/validate"],function(t){"use strict";function e(t,e){n.call(this,t,e)}var i=t("SCENERY/accessibility/Focus"),n=t("TANDEM/types/ObjectIO"),s=t("TANDEM/phetioInherit"),r=t("SCENERY/scenery"),a=t("AXON/validate");return s(n,"FocusIO",e,{},{validator:{valueType:i},toStateObject:function(t){if(null===t)return null;a(t,this.validator);var e=[];return t.trail.nodes.forEach(function(i,n){n<t.trail.nodes.length-1&&(i.tandem?e.push(i.tandem.phetioID):e.push(t.trail.indices[n]))}),{focusedPhetioID:t.trail.lastNode().tandem.phetioID}},documentation:"A IO type for the instance in the simulation which currently has keyboard focus."}),r.register("FocusIO",e),e}),i("SCENERY/util/Color",["require","AXON/Emitter","PHET_CORE/inherit","AXON/Property","SCENERY/scenery","DOT/Util"],function(t){"use strict";function e(t,e,i,s){this.changeEmitter=new n,this.set(t,e,i,s)}function i(t){var e=1;return"%"===t.charAt(t.length-1)&&(e=2.55,t=t.slice(0,t.length-1)),o.roundSymmetric(parseInt(t,10)*e)}var n=t("AXON/Emitter"),s=t("PHET_CORE/inherit"),r=t("AXON/Property"),a=t("SCENERY/scenery"),o=t("DOT/Util"),h=o.clamp,l=o.linear;a.register("Color",e);var u="(-?\\d{1,3}%?)";e.formatParsers=[{regexp:/^transparent$/,apply:function(t,e){t.setRGBA(0,0,0,0)}},{regexp:/^#(\w{1})(\w{1})(\w{1})$/,apply:function(t,e){t.setRGBA(parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),1)}},{regexp:/^#(\w{2})(\w{2})(\w{2})$/,apply:function(t,e){t.setRGBA(parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),1)}},{regexp:new RegExp("^rgb\\("+u+","+u+","+u+"\\)$"),apply:function(t,e){t.setRGBA(i(e[1]),i(e[2]),i(e[3]),1)}},{regexp:new RegExp("^rgba\\("+u+","+u+","+u+",(\\d+|\\d*\\.\\d+)\\)$"),apply:function(t,e){t.setRGBA(i(e[1]),i(e[2]),i(e[3]),parseFloat(e[4]))}},{regexp:new RegExp("^hsl\\((\\d{1,3}),(\\d{1,3})%,(\\d{1,3})%\\)$"),apply:function(t,e){t.setHSLA(parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10),1)}},{regexp:new RegExp("^hsla\\((\\d{1,3}),(\\d{1,3})%,(\\d{1,3})%,(\\d+|\\d*\\.\\d+)\\)$"),apply:function(t,e){t.setHSLA(parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10),parseFloat(e[4]))}}],e.hueToRGB=function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t},e.toColor=function(t){return t instanceof e?t:new e(t)},s(Object,e,{copy:function(){return new e(this.r,this.g,this.b,this.a)},set:function(t,i,n,s){if("string"==typeof t)this.setCSS(t);else if(t instanceof e)this.setRGBA(t.r,t.g,t.b,t.a);else if(void 0===n){var r=t>>16&255,a=t>>8&255,o=t>>0&255,h=void 0===i?1:i;this.setRGBA(r,a,o,h)}else this.setRGBA(t,i,n,void 0===s?1:s);return this},getRed:function(){return this.r},setRed:function(t){return this.setRGBA(t,this.g,this.b,this.a)},get red(){return this.getRed()},set red(t){return this.setRed(t)},getGreen:function(){return this.g},setGreen:function(t){return this.setRGBA(this.r,t,this.b,this.a)},get green(){return this.getGreen()},set green(t){return this.setGreen(t)},getBlue:function(){return this.b},setBlue:function(t){return this.setRGBA(this.r,this.g,t,this.a)},get blue(){return this.getBlue()},set blue(t){return this.setBlue(t)},getAlpha:function(){return this.a},setAlpha:function(t){return this.setRGBA(this.r,this.g,this.b,t)},get alpha(){return this.getAlpha()},set alpha(t){return this.setAlpha(t)},setRGBA:function(t,e,i,n){return this.r=o.roundSymmetric(h(t,0,255)),this.g=o.roundSymmetric(h(e,0,255)),this.b=o.roundSymmetric(h(i,0,255)),this.a=h(n,0,1),this.updateColor(),this},blend:function(t,i){var n=Math.pow(this.r,2.4),s=Math.pow(t.r,2.4),r=Math.pow(this.g,2.4),a=Math.pow(t.g,2.4),o=Math.pow(this.b,2.4),h=Math.pow(t.b,2.4);return new e(Math.pow(n+(s-n)*i,1/2.4),Math.pow(r+(a-r)*i,1/2.4),Math.pow(o+(h-o)*i,1/2.4),this.a+(t.a-this.a)*i)},computeCSS:function(){if(1===this.a)return"rgb("+this.r+","+this.g+","+this.b+")";for(var t=this.a.toFixed(20);t.length>=2&&"0"===t[t.length-1]&&"."!==t[t.length-2];)t=t.slice(0,t.length-1);var e=0===this.a||1===this.a?this.a:t;return"rgba("+this.r+","+this.g+","+this.b+","+e+")"},toCSS:function(){return this._css},setCSS:function(t){var i=t.replace(/ /g,"").toLowerCase(),n=!1,s=e.colorKeywords[i];s&&(i="#"+s);for(var r=0;r<e.formatParsers.length;r++){var a=e.formatParsers[r],o=a.regexp.exec(i);if(o){a.apply(this,o),n=!0;break}}if(!n)throw new Error("scenery.Color unable to parse color string: "+t);this.updateColor()},toNumber:function(){return(this.r<<16)+(this.g<<8)+this.b},updateColor:function(){var t=this._css;this._css=this.computeCSS(),t!==this._css&&this.changeEmitter.emit()},setImmutable:function(){return this},getCanvasStyle:function(){return this.toCSS()},setHSLA:function(t,i,n,s){t=t%360/360,i=h(i/100,0,1);var r,a;return a=(n=h(n/100,0,1))<.5?n*(i+1):n+i-n*i,r=2*n-a,this.r=o.roundSymmetric(255*e.hueToRGB(r,a,t+1/3)),this.g=o.roundSymmetric(255*e.hueToRGB(r,a,t)),this.b=o.roundSymmetric(255*e.hueToRGB(r,a,t-1/3)),this.a=h(s,0,1),this.updateColor(),this},equals:function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},withAlpha:function(t){return new e(this.r,this.g,this.b,t)},checkFactor:function(t){if(t<0||t>1)throw new Error("factor must be between 0 and 1: "+t);return void 0===t?.7:t},brighterColor:function(t){t=this.checkFactor(t);return new e(Math.min(255,Math.floor(this.r/t)),Math.min(255,Math.floor(this.g/t)),Math.min(255,Math.floor(this.b/t)),this.a)},colorUtilsBrighter:function(t){t=this.checkFactor(t);return new e(Math.min(255,this.getRed()+Math.floor(t*(255-this.getRed()))),Math.min(255,this.getGreen()+Math.floor(t*(255-this.getGreen()))),Math.min(255,this.getBlue()+Math.floor(t*(255-this.getBlue()))),this.getAlpha())},darkerColor:function(t){t=this.checkFactor(t);return new e(Math.max(0,Math.floor(t*this.r)),Math.max(0,Math.floor(t*this.g)),Math.max(0,Math.floor(t*this.b)),this.a)},colorUtilsDarker:function(t){t=this.checkFactor(t);return new e(Math.max(0,this.getRed()-Math.floor(t*this.getRed())),Math.max(0,this.getGreen()-Math.floor(t*this.getGreen())),Math.max(0,this.getBlue()-Math.floor(t*this.getBlue())),this.getAlpha())},colorUtilsBrightness:function(t){return 0===t?this:t>0?this.colorUtilsBrighter(t):this.colorUtilsDarker(-t)},toString:function(){return this.constructor.name+"[r:"+this.r+" g:"+this.g+" b:"+this.b+" a:"+this.a+"]"},toStateObject:function(){return{r:this.r,g:this.g,b:this.b,a:this.a}}}),e.basicColorKeywords={aqua:"00ffff",black:"000000",blue:"0000ff",fuchsia:"ff00ff",gray:"808080",green:"008000",lime:"00ff00",maroon:"800000",navy:"000080",olive:"808000",purple:"800080",red:"ff0000",silver:"c0c0c0",teal:"008080",white:"ffffff",yellow:"ffff00"},e.colorKeywords={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},e.BLACK=e.black=new e(0,0,0).setImmutable(),e.BLUE=e.blue=new e(0,0,255).setImmutable(),e.CYAN=e.cyan=new e(0,255,255).setImmutable(),e.DARK_GRAY=e.darkGray=new e(64,64,64).setImmutable(),e.GRAY=e.gray=new e(128,128,128).setImmutable(),e.GREEN=e.green=new e(0,255,0).setImmutable(),e.LIGHT_GRAY=e.lightGray=new e(192,192,192).setImmutable(),e.MAGENTA=e.magenta=new e(255,0,255).setImmutable(),e.ORANGE=e.orange=new e(255,200,0).setImmutable(),e.PINK=e.pink=new e(255,175,175).setImmutable(),e.RED=e.red=new e(255,0,0).setImmutable(),e.WHITE=e.white=new e(255,255,255).setImmutable(),e.YELLOW=e.yellow=new e(255,255,0).setImmutable(),e.TRANSPARENT=e.transparent=new e(0,0,0,0).setImmutable(),e.interpolateRGBA=function(t,i,n){if(n<0||n>1)throw new Error("distance must be between 0 and 1: "+n);return new e(Math.floor(l(0,1,t.r,i.r,n)),Math.floor(l(0,1,t.g,i.g,n)),Math.floor(l(0,1,t.b,i.b,n)),l(0,1,t.a,i.a,n))},e.fromStateObject=function(t){return new e(t.r,t.g,t.b,t.a)},e.hsla=function(t,i,n,s){return new e(0,0,0,1).setHSLA(t,i,n,s)};new e("blue");return e.checkPaintString=function(t){},e.checkPaint=function(t){"string"==typeof t?e.checkPaintString(t):t instanceof r&&"string"==typeof t.value&&e.checkPaintString(t.value)},e}),i("SCENERY/util/Paint",["require","PHET_CORE/inherit","SCENERY/scenery"],function(t){"use strict";function e(){this.id="paint"+n++,this.transformMatrix=null}var i=t("PHET_CORE/inherit"),n=1;return t("SCENERY/scenery").register("Paint",e),i(Object,e,{isPaint:!0,getCanvasStyle:function(){throw new Error("abstract method")},setTransformMatrix:function(t){return this.transformMatrix!==t&&(this.transformMatrix=t),this}}),e}),i("SCENERY/util/PaintDef",["require","SCENERY/util/Color","SCENERY/util/Paint","AXON/Property","SCENERY/scenery"],function(t){"use strict";var e=t("SCENERY/util/Color"),i=t("SCENERY/util/Paint"),n=t("AXON/Property"),s=t("SCENERY/scenery"),r={isPaintDef:function(t){return null===t||"string"==typeof t||t instanceof e||t instanceof i||t instanceof n&&(null===t.value||"string"==typeof t.value||t.value instanceof e)},toColor:function(t){if("string"==typeof t)return new e(t);if(t instanceof e)return t.copy();if(t instanceof n)return r.toColor(t.value);if(t instanceof s.Gradient){var i=e.TRANSPARENT;return t.stops.forEach(function(t){i=i.blend(r.toColor(t.color),1)}),i}return e.TRANSPARENT}};return s.register("PaintDef",r),r}),i("SCENERY/nodes/Paintable",["require","PHET_CORE/arrayRemove","SCENERY/util/Color","PHET_CORE/extend","PHET_CORE/inheritance","KITE/util/LineStyles","SCENERY/nodes/Node","SCENERY/util/PaintDef","PHET_CORE/platform","AXON/Property","SCENERY/display/Renderer","SCENERY/scenery"],function(t){"use strict";var e=t("PHET_CORE/arrayRemove"),i=(t("SCENERY/util/Color"),t("PHET_CORE/extend")),n=(t("PHET_CORE/inheritance"),t("KITE/util/LineStyles")),s=(t("SCENERY/nodes/Node"),t("SCENERY/util/PaintDef"),t("PHET_CORE/platform")),r=t("AXON/Property"),a=t("SCENERY/display/Renderer"),o=t("SCENERY/scenery"),h=s.safari5,l=s.ie9,u=["fill","fillPickable","stroke","strokePickable","lineWidth","lineCap","lineJoin","miterLimit","lineDash","lineDashOffset","cachedPaints"],c={fill:null,fillPickable:!0,stroke:null,strokePickable:!1,lineWidth:n.DEFAULT_OPTIONS.lineWidth,lineCap:n.DEFAULT_OPTIONS.lineCap,lineJoin:n.DEFAULT_OPTIONS.lineJoin,lineDashOffset:n.DEFAULT_OPTIONS.lineDashOffset,miterLimit:n.DEFAULT_OPTIONS.miterLimit},d={mixInto:function(t){function s(){this.invalidateSupportedRenderers();for(var t=this._drawables.length,e=0;e<t;e++)this._drawables[e].markDirtyFill()}function o(){this.invalidateSupportedRenderers();for(var t=this._drawables.length,e=0;e<t;e++)this._drawables[e].markDirtyStroke()}var d=t.prototype;if(i(d,{drawableMarkFlags:d.drawableMarkFlags.concat(["fill","stroke","lineWidth","lineOptions","cachedPaints"]),_mutatorKeys:u.concat(d._mutatorKeys),initializePaintable:function(){this._fill=c.fill,this._fillPickable=c.fillPickable,this._stroke=c.stroke,this._strokePickable=c.strokePickable,this._cachedPaints=[],this._lineDrawingStyles=new n},setFill:function(t){return this._fill!==t&&(this._fill=t,this.invalidateFill()),this},set fill(t){this.setFill(t)},getFill:function(){return this._fill},get fill(){return this.getFill()},hasFill:function(){return null!==this._fill},getFillValue:function(){var t=this.getFill();return t instanceof r&&(t=t.get()),t},get fillValue(){return this.getFillValue()},setStroke:function(t){return this._stroke!==t&&(this._stroke=t,this.invalidateStroke()),this},set stroke(t){this.setStroke(t)},getStroke:function(){return this._stroke},get stroke(){return this.getStroke()},hasStroke:function(){return null!==this._stroke},hasPaintableStroke:function(){return this.hasStroke()&&this.getLineWidth()>0},getStrokeValue:function(){var t=this.getStroke();return t instanceof r&&(t=t.get()),t},get strokeValue(){return this.getStrokeValue()},setFillPickable:function(t){return this._fillPickable!==t&&(this._fillPickable=t,this.invalidateFill()),this},set fillPickable(t){this.setFillPickable(t)},isFillPickable:function(){return this._fillPickable},get fillPickable(){return this.isFillPickable()},setStrokePickable:function(t){return this._strokePickable!==t&&(this._strokePickable=t,this.invalidateStroke()),this},set strokePickable(t){this.setStrokePickable(t)},isStrokePickable:function(){return this._strokePickable},get strokePickable(){return this.isStrokePickable()},setLineWidth:function(t){if(this.getLineWidth()!==t){this._lineDrawingStyles.lineWidth=t,this.invalidateStroke();for(var e=this._drawables.length,i=0;i<e;i++)this._drawables[i].markDirtyLineWidth()}return this},set lineWidth(t){this.setLineWidth(t)},getLineWidth:function(){return this._lineDrawingStyles.lineWidth},get lineWidth(){return this.getLineWidth()},setLineCap:function(t){if(this._lineDrawingStyles.lineCap!==t){this._lineDrawingStyles.lineCap=t,this.invalidateStroke();for(var e=this._drawables.length,i=0;i<e;i++)this._drawables[i].markDirtyLineOptions()}return this},set lineCap(t){this.setLineCap(t)},getLineCap:function(){return this._lineDrawingStyles.lineCap},get lineCap(){return this.getLineCap()},setLineJoin:function(t){if(this._lineDrawingStyles.lineJoin!==t){this._lineDrawingStyles.lineJoin=t,this.invalidateStroke();for(var e=this._drawables.length,i=0;i<e;i++)this._drawables[i].markDirtyLineOptions()}return this},set lineJoin(t){this.setLineJoin(t)},getLineJoin:function(){return this._lineDrawingStyles.lineJoin},get lineJoin(){return this.getLineJoin()},setMiterLimit:function(t){if(this._lineDrawingStyles.miterLimit!==t){this._lineDrawingStyles.miterLimit=t,this.invalidateStroke();for(var e=this._drawables.length,i=0;i<e;i++)this._drawables[i].markDirtyLineOptions()}return this},set miterLimit(t){this.setMiterLimit(t)},getMiterLimit:function(){return this._lineDrawingStyles.miterLimit},get miterLimit(){return this.getMiterLimit()},setLineDash:function(t){if(this._lineDrawingStyles.lineDash!==t){this._lineDrawingStyles.lineDash=t||[],this.invalidateStroke();for(var e=this._drawables.length,i=0;i<e;i++)this._drawables[i].markDirtyLineOptions()}return this},set lineDash(t){this.setLineDash(t)},getLineDash:function(){return this._lineDrawingStyles.lineDash},get lineDash(){return this.getLineDash()},hasLineDash:function(){return!!this._lineDrawingStyles.lineDash.length},setLineDashOffset:function(t){if(this._lineDrawingStyles.lineDashOffset!==t){this._lineDrawingStyles.lineDashOffset=t,this.invalidateStroke();for(var e=this._drawables.length,i=0;i<e;i++)this._drawables[i].markDirtyLineOptions()}return this},set lineDashOffset(t){this.setLineDashOffset(t)},getLineDashOffset:function(){return this._lineDrawingStyles.lineDashOffset},get lineDashOffset(){return this.getLineDashOffset()},setLineStyles:function(t){return this._lineDrawingStyles=t,this.invalidateStroke(),this},set lineStyles(t){this.setLineStyles(t)},getLineStyles:function(){return this._lineDrawingStyles},get lineStyles(){return this.getLineStyles()},setCachedPaints:function(t){this._cachedPaints=t.filter(function(t){return t&&t.isPaint});for(var e=this._drawables.length,i=0;i<e;i++)this._drawables[i].markDirtyCachedPaints();return this},set cachedPaints(t){this.setCachedPaints(t)},getCachedPaints:function(){return this._cachedPaints},get cachedPaints(){return this.getCachedPaints()},addCachedPaint:function(t){if(t&&t.isPaint){this._cachedPaints.push(t);for(var e=this._drawables.length,i=0;i<e;i++)this._drawables[i].markDirtyCachedPaints()}},removeCachedPaint:function(t){if(t&&t.isPaint){e(this._cachedPaints,t);for(var i=this._drawables.length,n=0;n<i;n++)this._drawables[n].markDirtyCachedPaints()}},beforeCanvasFill:function(t){var e=this.getFillValue();t.setFillStyle(e),e.transformMatrix&&(t.context.save(),e.transformMatrix.canvasAppendTransform(t.context))},afterCanvasFill:function(t){this.getFillValue().transformMatrix&&t.context.restore()},beforeCanvasStroke:function(t){var e=this.getStrokeValue();t.setStrokeStyle(this._stroke),t.setLineWidth(this.getLineWidth()),t.setLineCap(this.getLineCap()),t.setLineJoin(this.getLineJoin()),t.setMiterLimit(this.getMiterLimit()),t.setLineDash(this.getLineDash()),t.setLineDashOffset(this.getLineDashOffset()),e.transformMatrix&&(t.context.save(),e.transformMatrix.canvasAppendTransform(t.context))},afterCanvasStroke:function(t){this.getStrokeValue().transformMatrix&&t.context.restore()},getCSSFill:function(){var t=this.getFillValue();return t?t.toCSS?t.toCSS():t:"transparent"},getSimpleCSSStroke:function(){var t=this.getStrokeValue();return t?t.toCSS?t.toCSS():t:"transparent"},appendFillablePropString:function(t,e){return this._fill&&(e&&(e+=",\n"),"string"==typeof this.getFillValue()?e+=t+"fill: '"+this.getFillValue()+"'":e+=t+"fill: "+this.getFillValue().toString()),e},appendStrokablePropString:function(t,e){function i(i,n,s){e&&(e+=",\n"),e+=s||"string"!=typeof n?t+i+": "+n:t+i+": '"+n+"'"}var s=this;if(this._stroke){var r=new n;"string"==typeof this.getStrokeValue()?i("stroke",this.getStrokeValue()):i("stroke",this.getStrokeValue().toString(),!0),_.each(["lineWidth","lineCap","miterLimit","lineJoin","lineDashOffset"],function(t){s[t]!==r[t]&&i(t,s[t])}),this.lineDash.length&&i("lineDash",JSON.stringify(this.lineDash),!0)}return e},getFillRendererBitmask:function(){var t=0;return h&&this._fill&&this._fill.isGradient||(t|=a.bitmaskSVG),t|=a.bitmaskCanvas,this.hasFill()?this._fill.isPattern||this._fill.isGradient||(t|=a.bitmaskDOM,t|=a.bitmaskWebGL):(t|=a.bitmaskDOM,t|=a.bitmaskWebGL),t},getStrokeRendererBitmask:function(){var t=0;return l&&this.hasStroke()&&this.hasLineDash()||(t|=a.bitmaskCanvas),t|=a.bitmaskSVG,this.hasStroke()||(t|=a.bitmaskDOM,t|=a.bitmaskWebGL),t}}),d.invalidateFill){var f=d.invalidateFill;d.invalidateFill=function(){f.call(this),s.call(this)}}else d.invalidateFill=s;if(d.invalidateStroke){var m=d.invalidateStroke;d.invalidateStroke=function(){m.call(this),o.call(this)}}else d.invalidateStroke=o}};return o.register("Paintable",d),d.DEFAULT_OPTIONS=c,d}),i("SCENERY/util/Gradient",["require","PHET_CORE/cleanArray","SCENERY/util/Color","PHET_CORE/inherit","SCENERY/util/Paint","AXON/Property","SCENERY/scenery"],function(t){"use strict";function e(){r.call(this),this.stops=[],this.lastStopRatio=0,this.canvasGradient=null,this.colorStopsDirty=!1,this.lastColorStopValues=[]}var i=t("PHET_CORE/cleanArray"),n=t("SCENERY/util/Color"),s=t("PHET_CORE/inherit"),r=t("SCENERY/util/Paint"),a=t("AXON/Property");return t("SCENERY/scenery").register("Gradient",e),s(r,e,{isGradient:!0,addColorStop:function(t,e){if(this.lastStopRatio>t)throw new Error("Color stops not specified in the order of increasing ratios");return this.lastStopRatio=t,this.stops.push({ratio:t,color:e}),this.lastColorStopValues.push(""),this},createCanvasGradient:function(){throw new Error("abstract method")},getSVGStops:function(){return this.stops},invalidateCanvasGradient:function(){this.colorStopsDirty=!0},haveCanvasColorStopsChanged:function(){if(null===this.lastColorStopValues)return!0;for(var t=0;t<this.stops.length;t++)if(e.colorToString(this.stops[t].color)!==this.lastColorStopValues[t])return!0;return!1},getCanvasStyle:function(){if(!this.canvasGradient||this.colorStopsDirty&&this.haveCanvasColorStopsChanged()){this.colorStopsDirty=!1,i(this.lastColorStopValues),this.canvasGradient=this.createCanvasGradient();for(var t=0;t<this.stops.length;t++){var n=this.stops[t],s=e.colorToString(n.color);this.canvasGradient.addColorStop(n.ratio,s),this.lastColorStopValues.push(s)}}return this.canvasGradient}}),e.colorToString=function(t){return t instanceof a&&(t=t.value),null===t&&(t="transparent"),t instanceof n&&(t=t.toCSS()),t},e}),i("SCENERY/display/PaintObserver",["require","SCENERY/util/Color","SCENERY/util/Gradient","PHET_CORE/inherit","AXON/Property","SCENERY/scenery"],function(t){"use strict";function e(t){this.primary=null,this.changeCallback=t,this.notifyChangeCallback=this.notifyChanged.bind(this),this.updateSecondaryListener=this.updateSecondary.bind(this),this.secondaryPropertyCountsMap={}}var i=t("SCENERY/util/Color"),n=t("SCENERY/util/Gradient"),s=t("PHET_CORE/inherit"),r=t("AXON/Property");return t("SCENERY/scenery").register("PaintObserver",e),s(Object,e,{setPrimary:function(t){t!==this.primary&&(this.detachPrimary(this.primary),this.primary=t,this.attachPrimary(t),this.notifyChangeCallback())},clean:function(){this.detachPrimary(this.primary),this.primary=null},updateSecondary:function(t,e,i){for(var n=this.secondaryPropertyCountsMap[i.id],s=0;s<n;s++)this.attachSecondary(t);this.notifyChangeCallback()},attachPrimary:function(t){if(t instanceof r)this.secondaryLazyLinkProperty(t),this.attachSecondary(t.get());else if(t instanceof i)t.setImmutable();else if(t instanceof n)for(var e=0;e<t.stops.length;e++)this.attachPrimary(t.stops[e].color)},detachPrimary:function(t){if(t instanceof r)this.secondaryUnlinkProperty(t);else if(t instanceof n)for(var e=0;e<t.stops.length;e++)this.detachPrimary(t.stops[e].color)},attachSecondary:function(t){t instanceof i&&t.setImmutable()},notifyChanged:function(){this.primary instanceof n&&this.primary.invalidateCanvasGradient(),this.changeCallback()},secondaryLazyLinkProperty:function(t){var e=t.id;this.secondaryPropertyCountsMap[e]?this.secondaryPropertyCountsMap[e]++:(this.secondaryPropertyCountsMap[e]=1,t.lazyLink(this.updateSecondaryListener))},secondaryUnlinkProperty:function(t){var e=t.id,i=--this.secondaryPropertyCountsMap[e];0===i&&(delete this.secondaryPropertyCountsMap[e],t.isDisposed||t.unlink(this.updateSecondaryListener))}}),e}),i("SCENERY/display/drawables/PaintableStatelessDrawable",["require","SCENERY/util/Color","PHET_CORE/inheritance","SCENERY/display/PaintObserver","SCENERY/scenery","SCENERY/display/SelfDrawable"],function(t){"use strict";t("SCENERY/util/Color"),t("PHET_CORE/inheritance");var e=t("SCENERY/display/PaintObserver"),i=t("SCENERY/scenery"),n=(t("SCENERY/display/SelfDrawable"),{mixInto:function(t){var i=t.prototype;i.initializePaintableStateless=function(t,i){return this.fillCallback=this.fillCallback||this.markDirtyFill.bind(this),this.strokeCallback=this.strokeCallback||this.markDirtyStroke.bind(this),this.fillObserver=this.fillObserver||new e(this.fillCallback),this.strokeObserver=this.strokeObserver||new e(this.strokeCallback),this.fillObserver.setPrimary(i.node._fill),this.strokeObserver.setPrimary(i.node._stroke),this},i.disposePaintableStateless=function(){this.fillObserver.clean(),this.strokeObserver.clean()},i.markDirtyFill=function(){this.markPaintDirty(),this.fillObserver.setPrimary(this.instance.node._fill)},i.markDirtyStroke=function(){this.markPaintDirty(),this.strokeObserver.setPrimary(this.instance.node._stroke)},i.markDirtyLineWidth=function(){this.markPaintDirty()},i.markDirtyLineOptions=function(){this.markPaintDirty()},i.markDirtyCachedPaints=function(){this.markPaintDirty()}}});return i.register("PaintableStatelessDrawable",n),n}),i("SCENERY/display/drawables/PathCanvasDrawable",["require","SCENERY/display/CanvasSelfDrawable","PHET_CORE/inherit","SCENERY/display/drawables/PaintableStatelessDrawable","PHET_CORE/Poolable","SCENERY/scenery"],function(t){"use strict";function e(t,e){this.initializeCanvasSelfDrawable(t,e),this.initializePaintableStateless(t,e)}var i=t("SCENERY/display/CanvasSelfDrawable"),n=t("PHET_CORE/inherit"),s=t("SCENERY/display/drawables/PaintableStatelessDrawable"),r=t("PHET_CORE/Poolable");return t("SCENERY/scenery").register("PathCanvasDrawable",e),n(i,e,{paintCanvas:function(t,e,i){var n=t.context;e.hasShape()&&(n.beginPath(),e._shape.writeToContext(n),e.hasFill()&&(e.beforeCanvasFill(t),n.fill(),e.afterCanvasFill(t)),e.hasPaintableStroke()&&(e.beforeCanvasStroke(t),n.stroke(),e.afterCanvasStroke(t)))},markDirtyShape:function(){this.markPaintDirty()},dispose:function(){i.prototype.dispose.call(this),this.disposePaintableStateless()}}),s.mixInto(e),r.mixInto(e),e}),i("SCENERY/display/drawables/PaintableStatefulDrawable",["require","SCENERY/util/Color","PHET_CORE/inheritance","SCENERY/display/PaintObserver","SCENERY/scenery","SCENERY/display/SelfDrawable"],function(t){"use strict";t("SCENERY/util/Color"),t("PHET_CORE/inheritance");var e=t("SCENERY/display/PaintObserver"),i=t("SCENERY/scenery"),n=(t("SCENERY/display/SelfDrawable"),{mixInto:function(t){var i=t.prototype;i.initializePaintableState=function(t,i){return this.dirtyFill=!0,this.hadStroke=!1,this.dirtyStroke=!0,this.dirtyLineWidth=!0,this.dirtyLineOptions=!0,this.dirtyCachedPaints=!0,this.lastCachedPaints=[],this.fillCallback=this.fillCallback||this.markDirtyFill.bind(this),this.strokeCallback=this.strokeCallback||this.markDirtyStroke.bind(this),this.fillObserver=this.fillObserver||new e(this.fillCallback),this.strokeObserver=this.strokeObserver||new e(this.strokeCallback),this.fillObserver.setPrimary(i.node._fill),this.strokeObserver.setPrimary(i.node._stroke),this},i.cleanPaintableState=function(){this.dirtyFill=!1,this.dirtyStroke=!1,this.dirtyLineWidth=!1,this.dirtyLineOptions=!1,this.dirtyCachedPaints=!1,this.hadStroke=null!==this.node.getStroke()},i.disposePaintableState=function(){this.fillObserver.clean(),this.strokeObserver.clean()},i.markDirtyFill=function(){this.dirtyFill=!0,this.markPaintDirty(),this.fillObserver.setPrimary(this.instance.node._fill)},i.markDirtyStroke=function(){this.dirtyStroke=!0,this.markPaintDirty(),this.strokeObserver.setPrimary(this.instance.node._stroke)},i.markDirtyLineWidth=function(){this.dirtyLineWidth=!0,this.markPaintDirty()},i.markDirtyLineOptions=function(){this.dirtyLineOptions=!0,this.markPaintDirty()},i.markDirtyCachedPaints=function(){this.dirtyCachedPaints=!0,this.markPaintDirty()}}});return i.register("PaintableStatefulDrawable",n),n}),i("SCENERY/display/drawables/PathStatefulDrawable",["require","PHET_CORE/inheritance","SCENERY/display/drawables/PaintableStatefulDrawable","SCENERY/scenery","SCENERY/display/SelfDrawable"],function(t){"use strict";t("PHET_CORE/inheritance");var e=t("SCENERY/display/drawables/PaintableStatefulDrawable"),i=t("SCENERY/scenery"),n=(t("SCENERY/display/SelfDrawable"),{mixInto:function(t){var i=t.prototype;i.initializeState=function(t,e){return this.paintDirty=!0,this.dirtyShape=!0,this.initializePaintableState(t,e),this},i.disposeState=function(){this.disposePaintableState()},i.markPaintDirty=function(){this.paintDirty=!0,this.markDirty()},i.markDirtyShape=function(){this.dirtyShape=!0,this.markPaintDirty()},i.setToCleanState=function(){this.paintDirty=!1,this.dirtyShape=!1},e.mixInto(t)}});return i.register("PathStatefulDrawable",n),n}),i("SCENERY/display/drawables/PathSVGDrawable",["require","PHET_CORE/inherit","SCENERY/display/drawables/PathStatefulDrawable","PHET_CORE/Poolable","SCENERY/scenery","SCENERY/display/SVGSelfDrawable"],function(t){"use strict";function e(t,e){this.initializeSVGSelfDrawable(t,e,!0,o),this.svgElement=this.svgElement||document.createElementNS(r.svgns,"path")}var i=t("PHET_CORE/inherit"),n=t("SCENERY/display/drawables/PathStatefulDrawable"),s=t("PHET_CORE/Poolable"),r=t("SCENERY/scenery"),a=t("SCENERY/display/SVGSelfDrawable"),o=!0;return r.register("PathSVGDrawable",e),i(a,e,{updateSVGSelf:function(){var t=this.svgElement;if(this.dirtyShape){var e=this.node.hasShape()?this.node._shape.getSVGPath():"";e||(e="M0 0"),t.setAttribute("d",e)}this.updateFillStrokeStyle(t)}}),n.mixInto(e),s.mixInto(e),e}),i("SCENERY/nodes/Path",["require","DOT/Bounds2","PHET_CORE/extendDefined","PHET_CORE/inherit","SCENERY/nodes/Node","SCENERY/nodes/Paintable","SCENERY/display/drawables/PathCanvasDrawable","SCENERY/display/drawables/PathSVGDrawable","SCENERY/display/Renderer","SCENERY/scenery","KITE/Shape"],function(t){"use strict";function e(t,e){this._shape=d.shape,this._strokedShape=null,this._boundsMethod=d.boundsMethod,this._invalidShapeListener=this.invalidateShape.bind(this),this._invalidShapeListenerAttached=!1,this.initializePaintable(),r.call(this),this.invalidateSupportedRenderers(),e=n({shape:t},e),this.mutate(e)}var i=t("DOT/Bounds2"),n=t("PHET_CORE/extendDefined"),s=t("PHET_CORE/inherit"),r=t("SCENERY/nodes/Node"),a=t("SCENERY/nodes/Paintable"),o=t("SCENERY/display/drawables/PathCanvasDrawable"),h=t("SCENERY/display/drawables/PathSVGDrawable"),l=t("SCENERY/display/Renderer"),u=t("SCENERY/scenery"),c=t("KITE/Shape"),d={shape:null,boundsMethod:"accurate"};return u.register("Path",e),s(r,e,{_mutatorKeys:["boundsMethod","shape"].concat(r.prototype._mutatorKeys),drawableMarkFlags:r.prototype.drawableMarkFlags.concat(["shape"]),setShape:function(t){return this._shape!==t&&(this._invalidShapeListenerAttached&&this.detachShapeListener(),"string"==typeof t&&(t=new c(t)),this._shape=t,this.invalidateShape(),this._shape&&!this._shape.isImmutable()&&this.attachShapeListener()),this},set shape(t){this.setShape(t)},getShape:function(){return this._shape},get shape(){return this.getShape()},getStrokedShape:function(){return this._strokedShape||(this._strokedShape=this.getShape().getStrokedShape(this._lineDrawingStyles)),this._strokedShape},getPathRendererBitmask:function(){return l.bitmaskCanvas|l.bitmaskSVG},invalidateSupportedRenderers:function(){this.setRendererBitmask(this.getFillRendererBitmask()&this.getStrokeRendererBitmask()&this.getPathRendererBitmask())},invalidateShape:function(){this.invalidatePath();for(var t=this._drawables.length,e=0;e<t;e++)this._drawables[e].markDirtyShape();this._invalidShapeListenerAttached&&this._shape&&this._shape.isImmutable()&&this.detachShapeListener()},invalidatePath:function(){this._strokedShape=null,this.invalidateSelf()},attachShapeListener:function(){this.isDisposed||(this._shape.onStatic("invalidated",this._invalidShapeListener),this._invalidShapeListenerAttached=!0)},detachShapeListener:function(){this._shape.offStatic("invalidated",this._invalidShapeListener),this._invalidShapeListenerAttached=!1},updateSelfBounds:function(){var t=this.hasShape()?this.computeShapeBounds():i.NOTHING,e=!t.equals(this._selfBounds);return e&&this._selfBounds.set(t),e},setBoundsMethod:function(t){return this._boundsMethod!==t&&(this._boundsMethod=t,this.invalidatePath(),this.trigger0("boundsMethod"),this.trigger0("selfBoundsValid")),this},set boundsMethod(t){return this.setBoundsMethod(t)},getBoundsMethod:function(){return this._boundsMethod},get boundsMethod(){return this.getBoundsMethod()},computeShapeBounds:function(){if("none"===this._boundsMethod)return i.NOTHING;if(this.hasPaintableStroke()&&"unstroked"!==this._boundsMethod){if("accurate"===this._boundsMethod)return this.getShape().getStrokedBounds(this.getLineStyles());var t;return t="safePadding"===this._boundsMethod&&"miter"===this.getLineJoin()?this.getMiterLimit():"square"===this.getLineCap()?Math.SQRT2:1,this.getShape().bounds.dilated(t*this.getLineWidth()/2)}return this.getShape().bounds},areSelfBoundsValid:function(){return"accurate"===this._boundsMethod||"safePadding"===this._boundsMethod||"none"!==this._boundsMethod&&!this.hasStroke()},getTransformedSelfBounds:function(t){return(this._stroke?this.getStrokedShape():this.getShape()).getBoundsWithTransform(t)},getTransformedSafeSelfBounds:function(t){return this.getTransformedSelfBounds(t)},invalidateStroke:function(){this.invalidatePath(),this.trigger0("selfBoundsValid")},hasShape:function(){return!!this._shape},canvasPaintSelf:function(t,e){o.prototype.paintCanvas(t,this,e)},createSVGDrawable:function(t,e){return h.createFromPool(t,e)},createCanvasDrawable:function(t,e){return o.createFromPool(t,e)},isPainted:function(){return!0},containsPointSelf:function(t){var e=!1;return this.hasShape()?(this._fillPickable&&(e=this.getShape().containsPoint(t)),!e&&this._strokePickable&&(e=this.getStrokedShape().containsPoint(t)),e):e},intersectsBoundsSelf:function(t){return!!this.hasShape()&&this._shape.intersectsBounds(t)},requiresSVGBoundsWorkaround:function(){if(!this._stroke||!this._stroke.isPaint||!this.hasShape())return!1;var t=this.computeShapeBounds();return t.x*t.y==0},getDebugHTMLExtras:function(){return this._shape?" (<span style=\"color: #88f\" onclick=\"window.open( 'data:text/plain;charset=utf-8,' + encodeURIComponent( '"+this._shape.getSVGPath()+"' ) );\">path</span>)":""},dispose:function(){this._invalidShapeListenerAttached&&this.detachShapeListener(),r.prototype.dispose.call(this)}}),e.DEFAULT_OPTIONS=_.extend({},r.DEFAULT_OPTIONS,d),a.mixInto(e),e}),i("SCENERY/accessibility/FocusHighlightPath",["require","SCENERY/util/Color","AXON/Emitter","PHET_CORE/inherit","KITE/util/LineStyles","SCENERY/nodes/Path","SCENERY/scenery","DOT/Vector2"],function(t){"use strict";function e(t,e){e=_.extend({outerStroke:l,innerStroke:u,outerLineWidth:null,innerLineWidth:null,lineDash:[],lineCap:r.DEFAULT_OPTIONS.lineCap,lineJoin:r.DEFAULT_OPTIONS.lineJoin,miterLimit:r.DEFAULT_OPTIONS.miterLimit,lineDashOffset:r.DEFAULT_OPTIONS.lineDashOffset},e),this._innerHighlightColor=e.innerStroke,this._outerHighlightColor=e.outerStroke,this.highlightChangedEmitter=new n,a.call(this,t),this.options=e;var i=_.extend({stroke:e.outerStroke},e);this.mutate(i),this.innerHighlightPath=new a(t,{stroke:e.innerStroke,lineDash:e.lineDash,lineCap:e.lineCap,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDashOffset:e.lineDashOffset}),this.addChild(this.innerHighlightPath),this.updateLineWidth()}var i=t("SCENERY/util/Color"),n=t("AXON/Emitter"),s=t("PHET_CORE/inherit"),r=t("KITE/util/LineStyles"),a=t("SCENERY/nodes/Path"),o=t("SCENERY/scenery"),h=t("DOT/Vector2"),l=new i("rgba(212,19,106,0.5)"),u=new i("rgba(250,40,135,0.9)"),c=new i("rgba(233,113,166,1.0)"),d=new i("rgba(233,113,166,1.0)"),f=new i("rgba(159,15,80,1.0)"),m=new i("rgba(159,15,80,1.0)");return o.register("FocusHighlightPath",e),s(a,e,{mutateWithInnerHighlight:function(t){a.prototype.mutate.call(this,t),this.innerHighlightPath&&this.innerHighlightPath.mutate(t),this.highlightChangedEmitter.emit()},makeDashed:function(){this.mutateWithInnerHighlight({lineDash:[7,7]})},setShape:function(t){a.prototype.setShape.call(this,t),this.innerHighlightPath&&this.innerHighlightPath.setShape(t),this.highlightChangedEmitter.emit()},updateLineWidth:function(t){t=t||this,this.lineWidth=this.getOuterLineWidth(t),this.innerHighlightPath.lineWidth=this.getInnerLineWidth(t),this.highlightChangedEmitter.emit()},getOuterLineWidth:function(t){return this.options.outerLineWidth?this.options.outerLineWidth:e.getOuterLineWidthFromNode(t)},getInnerLineWidth:function(t){return this.options.innerLineWidth?this.options.innerLineWidth:e.getInnerLineWidthFromNode(t)},setInnerHighlightColor:function(t){this._innerHighlightColor=t,this.innerHighlightPath.setStroke(t),this.highlightChangedEmitter.emit()},set innerHighlightColor(t){this.setInnerHighlightColor(t)},getInnerHighlightColor:function(){return this._innerHighlightColor},get innerHighlightColor(){return this.getInnerHighlightColor()},setOuterHighlightColor:function(t){this._outerHighlightColor=t,this.setStroke(t),this.highlightChangedEmitter.emit()},set outerHighlightColor(t){this.setOuterHighlightColor(t)},getOuterHighlightColor:function(){return this._outerHighlightColor},get outerHighlightColor(){return this.getOuterHighlightColor()}},{OUTER_FOCUS_COLOR:l,INNER_FOCUS_COLOR:u,INNER_LIGHT_GROUP_FOCUS_COLOR:c,OUTER_LIGHT_GROUP_FOCUS_COLOR:d,INNER_DARK_GROUP_FOCUS_COLOR:f,OUTER_DARK_GROUP_FOCUS_COLOR:m,GROUP_OUTER_LINE_WIDTH:2,GROUP_INNER_LINE_WIDTH:2,getInnerLineWidthFromNode:function(t){return 2.5/e.getWidthMagnitudeFromTransform(t)},getOuterLineWidthFromNode:function(t){return 4/e.getWidthMagnitudeFromTransform(t)},getWidthMagnitudeFromTransform:function(t){return t.transform.transformDelta2(h.X_UNIT).magnitude},getDilationCoefficient:function(t){return.75*e.getOuterLineWidthFromNode(t)},getGroupDilationCoefficient:function(t){return 1.9*e.getOuterLineWidthFromNode(t)}})}),i("SCENERY/accessibility/FocusHighlightFromNode",["require","SCENERY/accessibility/FocusHighlightPath","PHET_CORE/inherit","SCENERY/scenery","KITE/Shape"],function(t){"use strict";function e(t,e){e=_.extend({useLocalBounds:!0,outerLineWidth:null,innerLineWidth:null,dilationCoefficient:null,useGroupDilation:!1},e),this.useLocalBounds=e.useLocalBounds,this.useGroupDilation=e.useGroupDilation,this.dilationCoefficient=e.dilationCoefficient,this.sourceNode=t,i.call(this,null,e),this.outerLineWidth=e.outerLineWidth,this.innerLineWidth=e.innerLineWidth,t&&this.setShapeFromNode(t)}var i=t("SCENERY/accessibility/FocusHighlightPath"),n=t("PHET_CORE/inherit"),s=t("SCENERY/scenery"),r=t("KITE/Shape");return s.register("FocusHighlightFromNode",e),n(i,e,{setShapeFromNode:function(t){this.nodeBounds=this.useLocalBounds?t.localBounds:t.bounds;var e=this.useGroupDilation?i.getGroupDilationCoefficient(t):i.getDilationCoefficient(t),n=this.dilationCoefficient||e,s=this.nodeBounds.dilated(n);this.updateLineWidthFromNode(t),this.setShape(r.bounds(s))},updateLineWidthFromNode:function(t){this.lineWidth=this.outerLineWidth||i.getOuterLineWidthFromNode(t),this.innerHighlightPath.lineWidth=this.innerLineWidth||i.getInnerLineWidthFromNode(t)},getUniqueHighlightTrail:function(){return this.sourceNode.getUniqueTrail()}})}),i("SCENERY/overlays/FocusOverlay",["require","SCENERY/accessibility/FocusHighlightFromNode","SCENERY/accessibility/FocusHighlightPath","PHET_CORE/inherit","SCENERY/nodes/Node","SCENERY/scenery","KITE/Shape","SCENERY/util/TransformTracker"],function(t){"use strict";function e(t,e){this.display=t,this.focusRootNode=e,this.trail=null,this.node=null,this.mode=null,this.groupMode=null,this.groupHighlightNode=null,this.transformTracker=null,this.groupTransformTracker=null,this.nodeFocusHighlight=null,this.transformDirty=!0,this.highlightNode=new r,this.focusRootNode.addChild(this.highlightNode),this.focusDisplay=new a.Display(this.focusRootNode,{width:this.width,height:this.height,allowWebGL:t._allowWebGL,allowCSSHacks:!1,accessibility:!1,isApplication:!1,interactive:!1}),this.domElement=this.focusDisplay.domElement,this.domElement.style.pointerEvents="none",this.shapeFocusHighlightPath=new n(null),this.boundsFocusHighlightPath=new i(null,{useLocalBounds:!0}),this.groupFocusHighlightPath=new i(null,{useLocalBounds:!0,useGroupDilation:!0,outerLineWidth:n.GROUP_OUTER_LINE_WIDTH,innerLineWidth:n.GROUP_INNER_LINE_WIDTH,innerStroke:n.FOCUS_COLOR}),this.highlightNode.addChild(this.shapeFocusHighlightPath),this.highlightNode.addChild(this.boundsFocusHighlightPath),this.focusRootNode.addChild(this.groupFocusHighlightPath),this.boundsListener=this.onBoundsChange.bind(this),this.transformListener=this.onTransformChange.bind(this),this.focusListener=this.onFocusChange.bind(this),this.focusHighlightListener=this.onFocusHighlightChange.bind(this),a.Display.focusProperty.link(this.focusListener)}var i=t("SCENERY/accessibility/FocusHighlightFromNode"),n=t("SCENERY/accessibility/FocusHighlightPath"),s=t("PHET_CORE/inherit"),r=t("SCENERY/nodes/Node"),a=t("SCENERY/scenery"),o=t("KITE/Shape"),h=t("SCENERY/util/TransformTracker"),l=n.OUTER_FOCUS_COLOR,u=n.INNER_FOCUS_COLOR,c=n.INNER_LIGHT_GROUP_FOCUS_COLOR,d=n.OUTER_LIGHT_GROUP_FOCUS_COLOR;return a.register("FocusOverlay",e),s(Object,e,{dispose:function(){this.hasHighlight()&&this.deactivateHighlight(),a.Display.focusProperty.unlink(this.focusListener)},hasHighlight:function(){return!!this.trail},activateHighlight:function(t){this.trail=t,this.node=t.lastNode();var e=this.node.focusHighlight,n=t;"invisible"===e?this.mode="invisible":e instanceof o?(this.mode="shape",this.shapeFocusHighlightPath.visible=!0,this.shapeFocusHighlightPath.setShape(e)):e instanceof r?(this.mode="node",e instanceof i&&(n=e.getUniqueHighlightTrail()),this.nodeFocusHighlight=e,this.node.focusHighlightLayerable?this.nodeFocusHighlight.visible=!0:(this.nodeFocusHighlight.visible=!0,this.highlightNode.addChild(this.nodeFocusHighlight))):(this.mode="bounds",this.boundsFocusHighlightPath.setShapeFromNode(this.node),this.boundsFocusHighlightPath.visible=!0,this.node.onStatic("localBounds",this.boundsListener),this.onBoundsChange()),this.node.onStatic("focusHighlightChanged",this.focusHighlightListener),this.transformTracker=new h(n,{isStatic:!0}),this.transformTracker.addListener(this.transformListener),this.activateGroupHighlights(),this.updateHighlightColors(),this.transformDirty=!0},deactivateHighlight:function(){"shape"===this.mode?this.shapeFocusHighlightPath.visible=!1:"node"===this.mode?this.node.focusHighlightLayerable?this.node.focusHighlight.visible=!1:(this.highlightNode.removeChild(this.nodeFocusHighlight),this.nodeFocusHighlight=null):"bounds"===this.mode&&(this.boundsFocusHighlightPath.visible=!1,this.node.offStatic("localBounds",this.boundsListener)),this.node.offStatic("focusHighlightChanged",this.focusHighlightListener),this.deactivateGroupHighlights(),this.trail=null,this.node=null,this.mode=null,this.transformTracker.removeListener(this.transformListener),this.transformTracker.dispose()},activateGroupHighlights:function(){for(var t=this.trail,e=0;e<t.length;e++){var i=t.nodes[e],n=i.groupFocusHighlight;if(n){var s=t.upToNode(i);this.groupTransformTracker=new h(s),this.groupTransformTracker.addListener(this.transformListener),"boolean"==typeof n?(this.groupFocusHighlightPath.setShapeFromNode(i),this.groupFocusHighlightPath.visible=!0,this.groupHighlightNode=this.groupFocusHighlightPath,this.groupMode="bounds"):n instanceof r&&(this.groupHighlightNode=n,this.focusRootNode.addChild(n),this.groupMode="node");break}}},updateHighlightColors:function(){"shape"===this.mode?(this.shapeFocusHighlightPath.innerHighlightColor!==e.innerHighlightColor&&this.shapeFocusHighlightPath.setInnerHighlightColor(e.innerHighlightColor),this.shapeFocusHighlightPath.outerHighlightColor!==e.outerHighlightColor&&this.shapeFocusHighlightPath.setOuterHighlightColor(e.outerHighlightColor)):"bounds"===this.mode&&(this.boundsFocusHighlightPath.innerHighlightColor!==e.innerHighlightColor&&this.boundsFocusHighlightPath.setInnerHighlightColor(e.innerHighlightColor),this.boundsFocusHighlightPath.outerHighlightColor!==e.outerHighlightColor&&this.boundsFocusHighlightPath.setOuterHighlightColor(e.outerHighlightColor)),this.groupMode&&(this.groupFocusHighlightPath.innerHighlightColor!==e.innerGroupHighlightColor&&this.groupFocusHighlightPath.setInnerHighlightColor(e.innerGroupHighlightColor),this.groupFocusHighlightPath.outerHighlightColor!==e.outerGroupHighlightColor&&this.groupFocusHighlightPath.setOuterHighlightColor(e.outerGroupHighlightColor))},deactivateGroupHighlights:function(){this.groupMode&&("bounds"===this.groupMode?this.groupFocusHighlightPath.visible=!1:"node"===this.groupMode&&this.focusRootNode.removeChild(this.groupHighlightNode),this.groupMode=null,this.groupHighlightNode=null,this.groupTransformTracker.removeListener(this.transformListener),this.groupTransformTracker.dispose())},afterTransform:function(){"shape"===this.mode?this.shapeFocusHighlightPath.updateLineWidth():"bounds"===this.mode?this.boundsFocusHighlightPath.updateLineWidth():"node"===this.mode&&this.node.focusHighlight.updateLineWidth&&this.node.focusHighlight.updateLineWidth(this.node)},onTransformChange:function(){this.transformDirty=!0},onBoundsChange:function(){this.boundsFocusHighlightPath.setShapeFromNode(this.node)},onFocusChange:function(t){var e=t&&t.display===this.display?t.trail:null;this.hasHighlight()&&this.deactivateHighlight(),e&&this.activateHighlight(e)},onFocusHighlightChange:function(){this.onFocusChange(a.Display.focus)},update:function(){this.hasHighlight()&&this.transformDirty&&(this.transformDirty=!1,this.highlightNode.setMatrix(this.transformTracker.matrix),this.groupHighlightNode&&this.groupHighlightNode.setMatrix(this.groupTransformTracker.matrix),this.afterTransform()),this.display.size.equals(this.focusDisplay.size)||this.focusDisplay.setWidthHeight(this.display.width,this.display.height),this.focusDisplay.updateDisplay()}},{setInnerHighlightColor:function(t){u=t},set innerHighlightColor(t){this.setInnerHighlightColor(t)},getInnerHighlightColor:function(){return u},get innerHighlightColor(){return this.getInnerHighlightColor()},setOuterHilightColor:function(t){l=t},set outerHighlightColor(t){this.setOuterHilightColor(t)},getOuterHighlightColor:function(){return l},get outerHighlightColor(){return this.getOuterHighlightColor()},setInnerGroupHighlightColor:function(t){c=t},set innerGroupHighlightColor(t){this.setInnerGroupHighlightColor(t)},getInnerGroupHighlightColor:function(){return c},get innerGroupHighlightColor(){return this.getInnerGroupHighlightColor()},setOuterGroupHighlightColor:function(t){d=t},set outerGroupHighlightColor(t){this.setOuterGroupHighlightColor(t)},getOuterGroupHighlightColor:function(){return d},get outerGroupHighlightColor(){return this.getOuterGroupHighlightColor()}}),e}),i("SCENERY/overlays/PointerAreaOverlay",["require","PHET_CORE/inherit","KITE/Shape","SCENERY/overlays/ShapeBasedOverlay","SCENERY/scenery","SCENERY/util/Trail"],function(t){"use strict";function e(t,e){s.call(this,t,e,"mouseTouchAreaOverlay")}var i=t("PHET_CORE/inherit"),n=t("KITE/Shape"),s=t("SCENERY/overlays/ShapeBasedOverlay"),r=t("SCENERY/scenery");return t("SCENERY/util/Trail"),r.register("PointerAreaOverlay",e),i(s,e,{addShapes:function(){var t=this;new r.Trail(this.rootNode).eachTrailUnder(function(e){var i=e.lastNode();if(!i.isVisible())return!0;if((i.mouseArea||i.touchArea)&&e.isVisible()){var s=e.getTransform();i.mouseArea&&t.addShape(s.transformShape(i.mouseArea.isBounds?n.bounds(i.mouseArea):i.mouseArea),"rgba(0,0,255,0.8)",!0),i.touchArea&&t.addShape(s.transformShape(i.touchArea.isBounds?n.bounds(i.touchArea):i.touchArea),"rgba(255,0,0,0.8)",!1)}})}}),e}),i("SCENERY/overlays/PointerOverlay",["require","PHET_CORE/inherit","DOT/Matrix3","SCENERY/scenery","SCENERY/input/Touch","SCENERY/util/Util","SCENERY/util/Trail"],function(t){"use strict";function e(t,e){var i=this;this.display=t,this.rootNode=e,this.pointerSVGContainer=document.createElement("div"),this.pointerSVGContainer.style.position="absolute",this.pointerSVGContainer.style.top=0,this.pointerSVGContainer.style.left=0,this.pointerSVGContainer.style["pointer-events"]="none";t.onStatic("displaySize",function(t){i.pointerSVGContainer.setAttribute("width",t.width),i.pointerSVGContainer.setAttribute("height",t.height),i.pointerSVGContainer.style.clip="rect(0px,"+t.width+"px,"+t.height+"px,0px)"});var o=n.IDENTITY.copy();this.pointerAdded=function(t){if(!t.isKey){var e=document.createElementNS(s.svgns,"svg");e.style.position="absolute",e.style.top=0,e.style.left=0,e.style["pointer-events"]="none",a.prepareForTransform(e,!1),e.setAttribute("width",21),e.setAttribute("height",21);var n=document.createElementNS(s.svgns,"circle");n.setAttribute("cx",10.5),n.setAttribute("cy",10.5),n.setAttribute("r",10),n.setAttribute("style","fill:black;"),n.setAttribute("style","stroke:white;"),n.setAttribute("opacity",.4);var h=function(){t instanceof r&&(i.pointerSVGContainer.removeChild(e),t.removeInputListener(l))},l={move:function(){t.point&&a.applyPreparedTransform(o.setToTranslation(t.point.x-10.5,t.point.y-10.5),e,!1)},up:h,cancel:h};t.addInputListener(l),l.move(),e.appendChild(n),i.pointerSVGContainer.appendChild(e)}},t._input.addPointerAddedListener(this.pointerAdded),t._input&&t._input.mouse&&this.pointerAdded(t._input.mouse),this.domElement=this.pointerSVGContainer}var i=t("PHET_CORE/inherit"),n=t("DOT/Matrix3"),s=t("SCENERY/scenery"),r=t("SCENERY/input/Touch"),a=t("SCENERY/util/Util");return t("SCENERY/util/Trail"),s.register("PointerOverlay",e),i(Object,e,{dispose:function(){this.display._input.removePointerAddedListener(this.pointerAdded)},update:function(){}}),e}),i("SCENERY/display/Display",["require","SCENERY/accessibility/AccessibilityTree","DOT/Dimension2","AXON/Emitter","PHET_CORE/escapeHTML","AXON/Events","PHET_CORE/extend","PHET_CORE/inherit","SCENERY/accessibility/KeyStateTracker","DOT/Matrix3","AXON/Property","AXON/PropertyIO","TANDEM/Tandem","AXON/timer","SCENERY/util/Features","SCENERY/nodes/Node","SCENERY/scenery","SCENERY/display/BackboneDrawable","SCENERY/display/CanvasBlock","SCENERY/display/CanvasSelfDrawable","SCENERY/display/ChangeInterval","SCENERY/display/DOMSelfDrawable","SCENERY/display/Drawable","SCENERY/display/Instance","SCENERY/display/InlineCanvasCacheDrawable","SCENERY/display/Renderer","SCENERY/display/SharedCanvasCacheDrawable","SCENERY/display/SVGSelfDrawable","SCENERY/input/Input","SCENERY/util/Trail","SCENERY/accessibility/AccessibleInstance","SCENERY/overlays/CanvasNodeBoundsOverlay","SCENERY/overlays/FittedBlockBoundsOverlay","SCENERY/accessibility/FocusIO","SCENERY/overlays/FocusOverlay","TANDEM/types/NullableIO","PHET_CORE/platform","SCENERY/overlays/PointerAreaOverlay","SCENERY/overlays/PointerOverlay","SCENERY/util/Util"],function(t){"use strict";function e(t,e){a.call(this),e=_.extend({width:e&&e.container&&e.container.clientWidth||640,height:e&&e.container&&e.container.clientHeight||480,allowCSSHacks:!0,allowSceneOverflow:!1,defaultCursor:"default",backgroundColor:null,preserveDrawingBuffer:!1,allowWebGL:!0,accessibility:!0,isApplication:!1,interactive:!0,listenToOnlyElement:!1,batchDOMEvents:!1,assumeFullWindow:!1,aggressiveContextRecreation:!0,passiveEvents:!R.safari&&null,allowBackingScaleAntialiasing:!0},e),this.options=e,this._accessible=e.accessibility,this._allowWebGL=e.allowWebGL,this._size=new n(this.options.width,this.options.height),this._currentSize=new n(-1,-1),this._rootNode=t,this._rootNode.addRootedDisplay(this),this._rootBackbone=null,this._domElement=e&&e.container?v.BackboneDrawable.repurposeBackboneContainer(e.container):v.BackboneDrawable.createDivBackbone(),this._sharedCanvasInstances={},this._baseInstance=null,this._frameId=0,this._dirtyTransformRoots=[],this._dirtyTransformRootsWithoutPass=[],this._instanceRootsToDispose=[],this._drawablesToDispose=[],this._drawablesToChangeBlock=[],this._drawablesToUpdateLinks=[],this._changeIntervalsToDispose=[],this._lastCursor=null,this._currentBackgroundCSS=null,this._backgroundColor=null,this._requestAnimationFrameID=0,this._input=null,this._inputListeners=[],this._interactive=this.options.interactive,this._listenToOnlyElement=e.listenToOnlyElement,this._batchDOMEvents=e.batchDOMEvents,this._assumeFullWindow=e.assumeFullWindow,this._passiveEvents=e.passiveEvents,this._aggressiveContextRecreation=e.aggressiveContextRecreation,this._allowBackingScaleAntialiasing=e.allowBackingScaleAntialiasing,this._overlays=[],this._pointerOverlay=null,this._pointerAreaOverlay=null,this._canvasAreaBoundsOverlay=null,this._fittedBlockBoundsOverlay=null,this.applyCSSHacks(),this.setBackgroundColor(this.options.backgroundColor),this.scenery=v,this.options.accessibility&&(this.options.isApplication&&this._domElement.setAttribute("aria-role","application"),this._focusRootNode=new g,this._focusOverlay=new x(this,this._focusRootNode),this.addOverlay(this._focusOverlay),this._unsortedAccessibleInstances=[],this.pointerFocus=null,this.activeNode=null,this.blockFocusCallbacks=!1,this._focusedNodeOnRemoveTrail,this._rootAccessibleInstance=b.createFromPool(null,this,new v.Trail),i.rebuildInstanceTree(this._rootAccessibleInstance),this._domElement.appendChild(this._rootAccessibleInstance.peer.primarySibling))}var i=t("SCENERY/accessibility/AccessibilityTree"),n=t("DOT/Dimension2"),s=t("AXON/Emitter"),r=t("PHET_CORE/escapeHTML"),a=t("AXON/Events"),o=t("PHET_CORE/extend"),h=t("PHET_CORE/inherit"),l=t("SCENERY/accessibility/KeyStateTracker"),u=t("DOT/Matrix3"),c=t("AXON/Property"),d=t("AXON/PropertyIO"),f=t("TANDEM/Tandem"),m=t("AXON/timer"),p=t("SCENERY/util/Features"),g=t("SCENERY/nodes/Node"),v=t("SCENERY/scenery");t("SCENERY/display/BackboneDrawable"),t("SCENERY/display/CanvasBlock"),t("SCENERY/display/CanvasSelfDrawable");t("SCENERY/display/ChangeInterval");t("SCENERY/display/DOMSelfDrawable");t("SCENERY/display/Drawable"),t("SCENERY/display/Instance");t("SCENERY/display/InlineCanvasCacheDrawable");var y=t("SCENERY/display/Renderer");t("SCENERY/display/SharedCanvasCacheDrawable"),t("SCENERY/display/SVGSelfDrawable");var E=t("SCENERY/input/Input");t("SCENERY/util/Trail");var b=t("SCENERY/accessibility/AccessibleInstance"),S=t("SCENERY/overlays/CanvasNodeBoundsOverlay"),T=t("SCENERY/overlays/FittedBlockBoundsOverlay"),C=t("SCENERY/accessibility/FocusIO"),x=t("SCENERY/overlays/FocusOverlay"),w=t("TANDEM/types/NullableIO"),R=t("PHET_CORE/platform"),D=t("SCENERY/overlays/PointerAreaOverlay"),P=t("SCENERY/overlays/PointerOverlay"),N=t("SCENERY/util/Util");return v.register("Display",e),h(Object,e,o({getDOMElement:function(){return this._domElement},get domElement(){return this.getDOMElement()},updateDisplay:function(){if(!window.sceneryDebugPause){var t=!!this._baseInstance;for(this._input&&this._input.validatePointers(),this._accessible&&this._rootAccessibleInstance.peer.updateSubtreePositioning(),this._rootNode.validateWatchedBounds(),this._baseInstance=this._baseInstance||v.Instance.createFromPool(this,new v.Trail(this._rootNode),!0,!1),this._baseInstance.baseSyncTree(),t&&this.markTransformRootDirty(this._baseInstance,this._baseInstance.isTransformed);this._drawablesToUpdateLinks.length;)this._drawablesToUpdateLinks.pop().updateLinks();for(;this._changeIntervalsToDispose.length;)this._changeIntervalsToDispose.pop().dispose();for(this._rootBackbone=this._rootBackbone||this._baseInstance.groupDrawable;this._drawablesToChangeBlock.length;)this._drawablesToChangeBlock.pop().updateBlock();for(this.updateDirtyTransformRoots(),this._baseInstance.updateVisibility(!0,!0,!1);this._instanceRootsToDispose.length;)this._instanceRootsToDispose.pop().dispose();for(;this._drawablesToDispose.length;)this._drawablesToDispose.pop().dispose();if(this._rootBackbone.update(),this.updateCursor(),this.updateBackgroundColor(),this.updateSize(),this._overlays.length)for(var e=this._rootBackbone.lastZIndex,n=0;n<this._overlays.length;n++){var s=this._overlays[n];s.domElement.style.zIndex=e++,s.update()}this._frameId++;i.auditAccessibleDisplays(this.rootNode)}},updateSize:function(){var t=!1;this._size.width!==this._currentSize.width&&(t=!0,this._currentSize.width=this._size.width,this._domElement.style.width=this._size.width+"px"),this._size.height!==this._currentSize.height&&(t=!0,this._currentSize.height=this._size.height,this._domElement.style.height=this._size.height+"px"),t&&!this.options.allowSceneOverflow&&(this._domElement.style.clip="rect(0px,"+this._size.width+"px,"+this._size.height+"px,0px)")},getRootNode:function(){return this._rootNode},get rootNode(){return this.getRootNode()},getSize:function(){return this._size},get size(){return this.getSize()},getBounds:function(){return this._size.toBounds()},get bounds(){return this.getBounds()},setSize:function(t){this._size.equals(t)||(this._size=t,this.trigger1("displaySize",this._size))},setWidthHeight:function(t,e){this.setSize(new n(t,e))},getWidth:function(){return this._size.width},get width(){return this.getWidth()},setWidth:function(t){this.getWidth()!==t&&this.setSize(new n(t,this.getHeight()))},set width(t){this.setWidth(t)},getHeight:function(){return this._size.height},get height(){return this.getHeight()},setHeight:function(t){this.getHeight()!==t&&this.setSize(new n(this.getWidth(),t))},set height(t){this.setHeight(t)},setBackgroundColor:function(t){this._backgroundColor=t},set backgroundColor(t){this.setBackgroundColor(t)},getBackgroundColor:function(){return this._backgroundColor},get backgroundColor(){return this.getBackgroundColor()},get interactive(){return this._interactive},set interactive(t){this._interactive=t,!this._interactive&&this._input&&(this._input.interruptPointers(),this._input.clearBatchedEvents(),this._input.removeTemporaryPointers(),this._rootNode.interruptSubtreeInput()),this.options.accessibility&&(this._interactive||(this.activeNode=e.focusedNode,this.activeNode&&this.activeNode.blur()),this.accessibleDOMElement.hidden=!this._interactive)},addOverlay:function(t){this._overlays.push(t),this._domElement.appendChild(t.domElement),t.domElement.setAttribute("aria-hidden",!0)},removeOverlay:function(t){this._domElement.removeChild(t.domElement),this._overlays.splice(_.indexOf(this._overlays,t),1)},markUnsortedAccessibleInstance:function(t){this._unsortedAccessibleInstances.push(t)},sortAccessibleInstances:function(){for(var t=e.focusedNode;this._unsortedAccessibleInstances.length;)this._unsortedAccessibleInstances.pop().sortChildren();t&&t.focus()},getAccessibleDOMElement:function(){return this._rootAccessibleInstance.peer.primarySibling},get accessibleDOMElement(){return this.getAccessibleDOMElement()},getUsedRenderersBitmask:function(){function t(e){var i=0;return _.each(e.blocks,function(e){e instanceof v.DOMBlock&&e.domDrawable instanceof v.BackboneDrawable?i|=t(e.domDrawable):i|=e.renderer}),i}return t(this._rootBackbone)&y.bitmaskRendererArea},markTransformRootDirty:function(t,e){e?this._dirtyTransformRoots.push(t):this._dirtyTransformRootsWithoutPass.push(t)},updateDirtyTransformRoots:function(){for(;this._dirtyTransformRoots.length;)this._dirtyTransformRoots.pop().relativeTransform.updateTransformListenersAndCompute(!1,!1,this._frameId,!0);for(;this._dirtyTransformRootsWithoutPass.length;)this._dirtyTransformRootsWithoutPass.pop().relativeTransform.updateTransformListenersAndCompute(!1,!1,this._frameId,!1)},markDrawableChangedBlock:function(t){this._drawablesToChangeBlock.push(t)},markInstanceRootForDisposal:function(t){this._instanceRootsToDispose.push(t)},markDrawableForDisposal:function(t){this._drawablesToDispose.push(t)},markDrawableForLinksUpdate:function(t){this._drawablesToUpdateLinks.push(t)},markChangeIntervalToDispose:function(t){this._changeIntervalsToDispose.push(t)},updateBackgroundColor:function(){var t=null===this._backgroundColor?"":this._backgroundColor.toCSS?this._backgroundColor.toCSS():this._backgroundColor;t!==this._currentBackgroundCSS&&(this._currentBackgroundCSS=t,this._domElement.style.backgroundColor=t)},updateCursor:function(){if(this._input&&this._input.mouse&&this._input.mouse.point){if(this._input.mouse.cursor)return this.setSceneCursor(this._input.mouse.cursor);var t=this._rootNode.trailUnderPointer(this._input.mouse);if(t)for(var e=t.getCursorCheckIndex();e>=0;e--){var i=t.nodes[e],n=i.getCursor();if(n)return this.setSceneCursor(n)}}return this.setSceneCursor(this.options.defaultCursor)},setSceneCursor:function(t){if(t!==this._lastCursor){this._lastCursor=t;var i=e.customCursors[t];if(i)for(var n=i.length-1;n>=0;n--)this._domElement.style.cursor=i[n];else this._domElement.style.cursor=t}},applyCSSHacks:function(){this.options.allowSceneOverflow||(this._domElement.style.overflow="hidden"),document.onselectstart=function(){return!1},this._domElement.style.msTouchAction="none",p.setStyle(this._domElement,p.fontSmoothing,"antialiased"),this.options.allowCSSHacks&&(p.setStyle(this._domElement,p.userDrag,"none"),p.setStyle(this._domElement,p.userSelect,"none"),p.setStyle(this._domElement,p.touchAction,"none"),p.setStyle(this._domElement,p.touchCallout,"none"),p.setStyle(this._domElement,p.tapHighlightColor,"rgba(0,0,0,0)"))},canvasDataURL:function(t){this.canvasSnapshot(function(e){t(e.toDataURL())})},canvasSnapshot:function(t){var e=document.createElement("canvas");e.width=this._size.width,e.height=this._size.height;var i=e.getContext("2d");this._rootNode.renderToCanvas(e,i,function(){t(e,i.getImageData(0,0,e.width,e.height))},this.domElement.style.backgroundColor)},setPointerDisplayVisible:function(t){t!==!!this._pointerOverlay&&(t?(this._pointerOverlay=new P(this,this._rootNode),this.addOverlay(this._pointerOverlay)):(this.removeOverlay(this._pointerOverlay),this._pointerOverlay.dispose(),this._pointerOverlay=null))},setPointerAreaDisplayVisible:function(t){t!==!!this._pointerAreaOverlay&&(t?(this._pointerAreaOverlay=new D(this,this._rootNode),this.addOverlay(this._pointerAreaOverlay)):(this.removeOverlay(this._pointerAreaOverlay),this._pointerAreaOverlay.dispose(),this._pointerAreaOverlay=null))},setCanvasNodeBoundsVisible:function(t){t!==!!this._canvasAreaBoundsOverlay&&(t?(this._canvasAreaBoundsOverlay=new S(this,this._rootNode),this.addOverlay(this._canvasAreaBoundsOverlay)):(this.removeOverlay(this._canvasAreaBoundsOverlay),this._canvasAreaBoundsOverlay.dispose(),this._canvasAreaBoundsOverlay=null))},setFittedBlockBoundsVisible:function(t){t!==!!this._fittedBlockBoundsOverlay&&(t?(this._fittedBlockBoundsOverlay=new T(this,this._rootNode),this.addOverlay(this._fittedBlockBoundsOverlay)):(this.removeOverlay(this._fittedBlockBoundsOverlay),this._fittedBlockBoundsOverlay.dispose(),this._fittedBlockBoundsOverlay=null))},resizeOnWindowResize:function(){var t=this,e=function(){t.setWidthHeight(window.innerWidth,window.innerHeight)};window.addEventListener("resize",e),e()},updateOnRequestAnimationFrame:function(t){var e=0,i=0,n=this;!function s(){n._requestAnimationFrameID=window.requestAnimationFrame(s,n._domElement);var r=Date.now();0!==e&&(i=(r-e)/1e3),e=r,m.emit(i),t&&t(i),n.updateDisplay()}()},cancelUpdateOnRequestAnimationFrame:function(){window.cancelAnimationFrame(this._requestAnimationFrameID)},initializeEvents:function(t){var e=new E(this,!this._listenToOnlyElement,this._batchDOMEvents,this._assumeFullWindow,this._passiveEvents,t);this._input=e,e.connectListeners()},detachEvents:function(){this._input.disconnectListeners(),this._input=null},addInputListener:function(t){return _.includes(this._inputListeners,t)||this._inputListeners.push(t),this},removeInputListener:function(t){return this._inputListeners.splice(_.indexOf(this._inputListeners,t),1),this},hasInputListener:function(t){for(var e=0;e<this._inputListeners.length;e++)if(this._inputListeners[e]===t)return!0;return!1},getInputListeners:function(){return this._inputListeners.slice(0)},get inputListeners(){return this.getInputListeners()},ensureNotPainting:function(){},loseWebGLContexts:function(){!function t(e){e.blocks&&e.blocks.forEach(function(e){e.gl&&N.loseContext(e.gl);for(var i=e.firstDrawable;null!==i&&(t(i),i!==e.lastDrawable);i=i.nextDrawable);})}(this._rootBackbone)},inspect:function(){localStorage.scenerySnapshot=JSON.stringify(v.serialize(this))},getDebugHTML:function(){function t(e){for(var i=1,n=0;n<e.children.length;n++)i+=t(e.children[n]);return i}function e(t){for(var i=1,n=0;n<t.children.length;n++)i+=e(t.children[n]);return i}function i(t){var e=1;if(t.blocks)_.each(t.blocks,function(t){e+=i(t)});else if(t.firstDrawable&&t.lastDrawable){for(var n=t.firstDrawable;n!==t.lastDrawable;n=n.nextDrawable)e+=i(n);e+=i(t.lastDrawable)}return e}function n(t){var e=t.constructor.name;m[e]?m[e]++:m[e]=1}function s(t){var e=0;t.selfDrawable&&(n(t.selfDrawable),e++),t.groupDrawable&&(n(t.groupDrawable),e++),t.sharedCacheDrawable&&(n(t.sharedCacheDrawable),e++);for(var i=0;i<t.children.length;i++)e+=s(t.children[i]);return e}function r(t){if(t.firstDrawable&&t.lastDrawable){var e=t.domDrawable&&t.domDrawable.blocks,i='<div style="margin-left: '+20*d+'px">';if(i+=t.toString(),e||(i+=" ("+t.drawableCount+" drawables)"),i+="</div>",d+=1,e)for(var n=0;n<t.domDrawable.blocks.length;n++)i+=r(t.domDrawable.blocks[n]);return d-=1,i}}function a(t){function e(t){i+=' <span style="color: #008">'+t+"</span>"}var i="",n=t.node;i+=t.id,i+=" "+(n.constructor.name?n.constructor.name:"?"),i+=' <span style="font-weight: '+(n.isPainted()?"bold":"normal")+'">'+n.id+"</span>",i+=n.getDebugHTMLExtras(),n.visible||e("invis"),t.visible||e("I-invis"),t.relativeVisible||e("I-rel-invis"),t.selfVisible||e("I-self-invis"),t.fittability.ancestorsFittable||e("nofit-ancestor"),t.fittability.selfFittable||e("nofit-self"),!0===n.pickable&&e("pickable"),!1===n.pickable&&e("unpickable"),t.trail.isPickable()&&e('<span style="color: #808">hits</span>'),n.clipArea&&e("clipArea"),n.mouseArea&&e("mouseArea"),n.touchArea&&e("touchArea"),n.getInputListeners().length&&e("inputListeners"),n.getRenderer()&&e("renderer:"+n.getRenderer()),n.isLayerSplit()&&e("layerSplit"),n.opacity<1&&e("opacity:"+n.opacity),n._boundsEventCount>0&&e('<span style="color: #800">boundsListen:'+n._boundsEventCount+":"+n._boundsEventSelfCount+"</span>");var s="";switch(n.transform.getMatrix().type){case u.Types.IDENTITY:s="";break;case u.Types.TRANSLATION_2D:s="translated";break;case u.Types.SCALING:s="scale";break;case u.Types.AFFINE:s="affine";break;case u.Types.OTHER:s="other";break;default:throw new Error("invalid matrix type: "+n.transform.getMatrix().type)}return s&&(i+=' <span style="color: #88f" title="'+n.transform.getMatrix().toString().replace("\n","&#10;")+'">'+s+"</span>"),i+=' <span style="color: #888">[Trail '+t.trail.indices.join(".")+"]</span>",i+=' <span style="color: #c88">'+function(t){return t?t.toString():t+""}(t.state)+"</span>",i+=' <span style="color: #8c8">'+n._rendererSummary.bitmask.toString(16)+(n._rendererBitmask!==y.bitmaskNodeDefault?" ("+n._rendererBitmask.toString(16)+")":"")+"</span>"}function o(t){var e=t.toString();return t.visible&&(e="<strong>"+e+"</strong>"),t.dirty&&(e+=t.dirty?' <span style="color: #c00;">[x]</span>':""),t.fittable||(e+=t.dirty?' <span style="color: #0c0;">[no-fit]</span>':""),e}function h(t){function e(t,e){i+=' <span style="color: #888">'+t+":"+o(e)+"</span>"}var i='<div style="margin-left: '+20*d+'px">';i+=a(t),t.selfDrawable&&e("self",t.selfDrawable),t.groupDrawable&&e("group",t.groupDrawable),t.sharedCacheDrawable&&e("sharedCache",t.sharedCacheDrawable),f+=i+="</div>",d+=1,_.each(t.children,function(t){h(t)}),d-=1}function l(t){var e='<div style="margin-left: '+20*d+'px">';if(e+=o(t),t.instance?(e+=' <span style="color: #0a0;">('+t.instance.trail.toPathString()+")</span>",e+="&nbsp;&nbsp;&nbsp;"+a(t.instance)):t.backboneInstance&&(e+=' <span style="color: #a00;">('+t.backboneInstance.trail.toPathString()+")</span>",e+="&nbsp;&nbsp;&nbsp;"+a(t.backboneInstance)),e+="</div>",f+=e,t.blocks)d+=1,_.each(t.blocks,function(t){l(t)}),d-=1;else if(t.firstDrawable&&t.lastDrawable){d+=1;for(var i=t.firstDrawable;i!==t.lastDrawable;i=i.nextDrawable)l(i);l(t.lastDrawable),d-=1}}var c="font-weight: bold; font-size: 120%; margin-top: 5px;",d=0,f="";f+='<div style="'+c+'">Display Summary</div>',f+=this._size.toString()+" frame:"+this._frameId+" input:"+!!this._input+" cursor:"+this._lastCursor+"<br/>",f+="Nodes: "+t(this._rootNode)+"<br/>",f+=this._baseInstance?"Instances: "+e(this._baseInstance)+"<br/>":"",f+=this._rootBackbone?"Drawables: "+i(this._rootBackbone)+"<br/>":"";var m={};f+=this._baseInstance?"Retained Drawables: "+s(this._baseInstance)+"<br/>":"";for(var p in m)f+="&nbsp;&nbsp;&nbsp;&nbsp;"+p+": "+m[p]+"<br/>";if(this._rootBackbone){f+='<div style="'+c+'">Block Summary</div>';for(var g=0;g<this._rootBackbone.blocks.length;g++)f+=r(this._rootBackbone.blocks[g])}return this._baseInstance&&(f+='<div style="'+c+'">Root Instance Tree</div>',h(this._baseInstance)),_.each(this._sharedCanvasInstances,function(t){f+='<div style="'+c+'">Shared Canvas Instance Tree</div>',h(t)}),this._rootBackbone&&(f+='<div style="font-weight: bold;">Root Drawable Tree</div>',l(this._rootBackbone)),f},popupDebug:function(){var t='<!DOCTYPE html><html lang="en"><head><title>Scenery Debug Snapshot</title></head><body style="font-size: 12px;">'+this.getDebugHTML()+"</body></html>";window.open("data:text/html;charset=utf-8,"+encodeURIComponent(t))},getAccessibleDebugHTML:function(){function t(i,s){e+=s+r((i.isRootInstance?"":i.node.tagName)+" "+i.toString())+"<br>",i.children.forEach(function(e){t(e,s+n)})}var e="",i="font-weight: bold; font-size: 120%; margin-top: 5px;",n="&nbsp;&nbsp;&nbsp;&nbsp;";e+='<div style="'+i+'">Accessible Instances</div><br>',t(this._rootAccessibleInstance,""),e+='<br><div style="'+i+'">Parallel DOM</div><br>';for(var s=this._rootAccessibleInstance.peer.primarySibling.outerHTML,a=(s=s.replace(/\>\</g,">\n<")).split("\n"),o="",h=0;h<a.length;h++){var l=a[h],u="</"===l.slice(0,2);u&&(o=o.slice(n.length)),e+=o+r(l)+"<br>",u||(o+=n)}return e},foreignObjectRasterization:function(t){function i(t){t.id||(t.id="unknown-canvas-"+r++),s[t.id]=t.toDataURL()}function n(t){if(t.blocks)_.each(t.blocks,function(t){n(t)});else if(t.firstDrawable&&t.lastDrawable){for(var e=t.firstDrawable;e!==t.lastDrawable;e=e.nextDrawable)n(e);n(t.lastDrawable),t.canvas&&t.canvas instanceof window.HTMLCanvasElement&&i(t.canvas)}v.DOMDrawable&&t instanceof v.DOMDrawable&&(t.domElement instanceof window.HTMLCanvasElement&&i(t.domElement),Array.prototype.forEach.call(t.domElement.getElementsByTagName("canvas"),function(t){i(t)}))}var s={},r=0;n(this._rootBackbone);var a=document.implementation.createHTMLDocument("");a.documentElement.innerHTML=this.domElement.outerHTML,a.documentElement.setAttribute("xmlns",a.documentElement.namespaceURI);var o=a.documentElement.getElementsByTagName("canvas");o=Array.prototype.slice.call(o);for(var h=0;h<o.length;h++){var l=o[h],u=l.style.cssText,c=a.createElement("img"),d=s[l.id];c.src=d,c.setAttribute("style",u),l.parentNode.replaceChild(c,l)}for(var f=this.width,m=this.height,p=function(){e.elementToSVGDataURL(a.documentElement,f,m,t)},g=0,y=!1,E=Array.prototype.slice.call(a.documentElement.getElementsByTagName("image")),b=0;b<E.length;b++){var S=E[b],T=S.getAttribute("xlink:href");"data:"!==T.slice(0,5)&&(g++,y=!0,function(){var t=new window.Image,e=S;t.onload=function(){var i=document.createElement("canvas");i.width=t.width,i.height=t.height;i.getContext("2d").drawImage(t,0,0),e.setAttribute("xlink:href",i.toDataURL()),0==--g&&p()},t.onerror=function(){0==--g&&p()},t.src=T}())}y||p()},popupRasterization:function(){this.foreignObjectRasterization(window.open)}},a.prototype),{elementToSVGDataURL:function(t,e,i,n){var s=document.createElement("canvas"),r=s.getContext("2d");s.width=e,s.height=i;var a='<svg xmlns="http://www.w3.org/2000/svg" width="'+e+'" height="'+i+'"><foreignObject width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml">'+(new window.XMLSerializer).serializeToString(t)+"</div></foreignObject></svg>",o=new window.Image;o.onload=function(){r.drawImage(o,0,0),n(s.toDataURL())},o.onerror=function(){n(null)};var h=new window.TextEncoderLite("utf-8").encode(a),l=window.fromByteArray(h);o.src="data:image/svg+xml;base64,"+l},set focus(t){if(window.phet&&phet.phetio&&phet.chipper.accessibility&&t)t.trail.lastNode();var e;this.focusProperty.value&&(e=this.focusedNode).focusChangedEmitter.emit(!1),this.focusProperty.value=t,t?t.trail.lastNode().focusChangedEmitter.emit(!0):e&&e.blur()},get focus(){return this.focusProperty.value},getFocusedNode:function(){var t=null,e=this.focusProperty.get();return e&&(t=e.trail.lastNode()),t},get focusedNode(){return this.getFocusedNode()}}),e.prototype.dispose=function(){this._input&&this.detachEvents(),this._rootNode.removeRootedDisplay(this),this._accessible&&this._rootAccessibleInstance.dispose()},e.customCursors={"scenery-grab-pointer":["grab","-moz-grab","-webkit-grab","pointer"],"scenery-grabbing-pointer":["grabbing","-moz-grabbing","-webkit-grabbing","pointer"]},e.focusProperty=new c(null,window.phet&&phet.chipper&&phet.chipper.accessibility?{tandem:f.generalTandem.createTandem("focusProperty"),phetioType:d(w(C)),phetioState:!1,phetioReadOnly:!0}:{}),e.userGestureEmitter=new s,e.keyStateTracker=new l,e.assertSubtreeDisposed=function(t){},e}),i("SCENERY/accessibility/AccessibilityFuzzer",["require","SCENERY/accessibility/AccessibilityTree","PHET_CORE/arrayDifference","SCENERY/display/Display","PHET_CORE/inherit","SCENERY/nodes/Node","DOT/Permutation","DOT/Random","SCENERY/scenery"],function(t){"use strict";function e(t,e,i){i=i||null,this.nodeCount=t,this.logToConsole=e,this.nodes=_.range(0,t).map(function(){return new a}),this.display=new s(this.nodes[0]),this.random=new h({seed:i}),this.actionsTaken=[]}var i=t("SCENERY/accessibility/AccessibilityTree"),n=t("PHET_CORE/arrayDifference"),s=t("SCENERY/display/Display"),r=t("PHET_CORE/inherit"),a=t("SCENERY/nodes/Node"),o=t("DOT/Permutation"),h=t("DOT/Random");return t("SCENERY/scenery").register("AccessibilityFuzzer",e),r(Object,e,{step:function(){var t=this.random.sample(this.enumerateActions());if(this.logToConsole&&console.log(t.text),this.actionsTaken.push(t),t.execute(),this.display._rootAccessibleInstance.auditRoot(),i.auditAccessibleDisplays(this.display.rootNode),this.logToConsole)for(var e=0;e<this.nodes.length;e++){var n=this.nodes[e];console.log(e+"#"+n.id+" "+n.tagName+" ch:"+i.debugOrder(n.children)+" or:"+i.debugOrder(n.accessibleOrder)+" vis:"+n.visible+" avis:"+n.accessibleVisible)}},enumerateActions:function(){var t=this,e=[];return this.nodes.forEach(function(s){e.push({text:"#"+s.id+".visible = "+!s.visible,execute:function(){s.visible=!s.visible}}),e.push({text:"#"+s.id+".accessibleVisible = "+!s.accessibleVisible,execute:function(){s.accessibleVisible=!s.accessibleVisible}}),["span","div",null].forEach(function(t){s.tagName!==t&&e.push({text:"#"+s.id+".tagName = "+t,execute:function(){s.tagName=t}})}),t.powerSet(n(t.nodes,[s]).concat([null])).forEach(function(n){o.forEachPermutation(n,function(n){t.isAccessibleOrderChangeLegal(s,n)&&e.push({text:"#"+s.id+".accessibleOrder = "+i.debugOrder(n),execute:function(){s.accessibleOrder=n}})})}),t.nodes.forEach(function(i){t.isAddChildLegal(s,i)&&_.range(0,s.children.length+1).forEach(function(t){e.push({text:"#"+s.id+".insertChild("+t+",#"+i.id+")",execute:function(){s.insertChild(t,i)}})}),s.hasChild(i)&&e.push({text:"#"+s.id+".removeChild(#"+i.id+")",execute:function(){s.removeChild(i)}})})}),e},isAddChildLegal:function(t,e){return!t.hasChild(e)&&this.isAcyclic(t,e)},powerSet:function(t){if(0===t.length)return[[]];var e=this.powerSet(t.slice(1));return e.concat(e.map(function(e){return[t[0]].concat(e)}))},isAccessibleOrderChangeLegal:function(t,e){var i=this;if(null===e&&(e=[]),e=e.filter(function(t){return null!==t}),_.includes(e,t)||_.uniq(e).length<e.length)return!1;for(var n=0;n<e.length;n++)if(e[n]._accessibleParent&&e[n]._accessibleParent!==t)return!1;var s=function(i,n){return i===t?i.hasChild(n)||_.includes(e,n):i.hasChild(n)||!!i.accessibleOrder&&_.includes(i.accessibleOrder,n)},r=t.children.concat(e);return _.every(r,function(e){return i.isAcyclic(t,e,s)})},isAcyclic:function(t,e,i){if(t===e)return!1;for(var n=e.children.concat(e.accessibleOrder).filter(function(t){return null!==t});n.length;){var s=n.pop();if(s===t)return!1;i?this.nodes.forEach(function(t){i(s,t)&&n.push(t)}):(Array.prototype.push.apply(n,s.children),s.accessibleOrder&&Array.prototype.push.apply(n,s.accessibleOrder.filter(function(t){return null!==t})))}return!0}})}),i("SCENERY/accessibility/reader/Cursor",["require","PHET_CORE/inherit","AXON/Property","SCENERY/scenery"],function(t){"use strict";function e(t){var e=this;this.outputUtteranceProperty=new s(new i(document.title,"off")),this.linearDOM=this.getLinearDOMElements(t),this.activeElement=null,this.activeLine=null,this.letterPosition=0,this.positionInLine=0,this.wordPosition=0,this.observers=[],this.keyState={},document.addEventListener("keydown",function(n){e.keyState[n.keyCode]=!0;var s,h=n.shiftKey?o:a;if(e.linearDOM=e.getLinearDOMElements(t),e.updateLiveElementList(),!e.activeElement||"application"!==e.activeElement.getAttribute("role")){if(e.keyState[40]&&!e.keyState[45])s=e.readNextPreviousLine(a);else if(e.keyState[38]&&!e.keyState[45])s=e.readNextPreviousLine(o);else if(e.keyState[72]){var l=["H1","H2","H3","H4","H5","H6"];s=e.readNextPreviousHeading(l,h)}else e.keyState[9]||(e.keyState[39]&&!e.keyState[17]?s=e.readNextPreviousCharacter(a):e.keyState[37]&&!e.keyState[17]?s=e.readNextPreviousCharacter(o):e.keyState[37]&&e.keyState[17]?s=e.readNextPreviousWord(o):e.keyState[39]&&e.keyState[17]?s=e.readNextPreviousWord(a):e.keyState[45]&&e.keyState[38]?s=e.readActiveLine():e.keyState[49]?s=e.readNextPreviousHeading(["H1"],h):e.keyState[50]?s=e.readNextPreviousHeading(["H2"],h):e.keyState[51]?s=e.readNextPreviousHeading(["H3"],h):e.keyState[52]?s=e.readNextPreviousHeading(["H4"],h):e.keyState[53]?s=e.readNextPreviousHeading(["H5"],h):e.keyState[54]?s=e.readNextPreviousHeading(["H6"],h):e.keyState[70]?s=e.readNextPreviousFormElement(h):e.keyState[66]?s=e.readNextPreviousButton(h):e.keyState[76]?s=e.readNextPreviousList(h):e.keyState[73]?s=e.readNextPreviousListItem(h):e.keyState[45]&&e.keyState[40]&&e.readEntireDocument());e.activeElement&&e.isFocusable(e.activeElement)&&e.activeElement.focus(),s===r&&(s="space"),s&&e.outputUtteranceProperty.set(new i(s,"off"))}}),document.addEventListener("keyup",function(t){e.keyState[t.keyCode]=!1}),document.addEventListener("focusin",function(t){if(t.target!==e.activeElement){e.activeElement=t.target;var n=e.getAccessibleText(this.activeElement,!0);if(n){var s=e.activeElement.getAttribute("aria-live");e.outputUtteranceProperty.set(new i(n,s))}}})}function i(t,e){this.text=t,this.liveRole=e}var n=t("PHET_CORE/inherit"),s=t("AXON/Property"),r=" ",a="NEXT",o="PREVIOUS";return t("SCENERY/scenery").register("Cursor",e),n(Object,e,{getLinearDOMElements:function(t){for(var e=t.getElementsByTagName("*"),i=[],n=0;n<e.length;n++)e[n].nodeType===Node.ELEMENT_NODE&&(i[n]=e[n]);return i},getLiveRole:function(t){var e=null;return["log","status","alert","progressbar","marquee","timer","assertive","polite"].forEach(function(i){t.getAttribute("aria-live")!==i&&t.getAttribute("role")!==i||(e=i)}),e},getNextPreviousElement:function(t){this.activeElement||(this.activeElement=this.linearDOM[0]);var e="NEXT"===t?1:-1,i=this.linearDOM.indexOf(this.activeElement)+e;return this.linearDOM[i]},getLabel:function(t){var e,i=document.getElementsByTagName("label");return Array.prototype.forEach.call(i,function(t){t.getAttribute("for")&&(e=t)}),e},getAccessibleText:function(t,e){var i="";if(!t)return"End of Document";if("ScreenView"===t.getAttribute("class"))return null;if("HEADER"===t.tagName)return null;if("SECTION"===t.tagName)return null;if("LABEL"===t.tagName)return null;for(var n=t;n.parentElement;){if(n.getAttribute("aria-hidden")||n.hidden)return null;n=n.parentElement}if("P"===t.tagName&&(i+=t.textContent),"H1"===t.tagName&&(i+="Heading Level 1, "+t.textContent),"H2"===t.tagName&&(i+="Heading Level 2, "+t.textContent),"H3"===t.tagName&&(i+="Heading Level 3, "+t.textContent),"UL"===t.tagName){var s=t.children.length;i+="List with "+s+" items"}if("LI"===t.tagName&&(i+="List Item: "+t.textContent),"BUTTON"===t.tagName){if(t.getAttribute("aria-pressed")){var a=" toggle";a+=" Button,","true"===t.getAttribute("aria-pressed")?a+=" pressed":a+=" not pressed",i+=t.textContent+","+a}else i+=t.textContent+" Button"}if("INPUT"===t.tagName&&("reset"===t.type&&(i+=t.getAttribute("value")+" Button"),"checkbox"===t.type)){var o=this.getLabel(t.id).textContent;if("switch"===t.getAttribute("role")){var h=t.getAttribute("aria-checked");if(h){i+=o+","+r+"switch,"+r+("true"===h?"On":"Off")}}else{var l=t.checked?" Checked":" Not Checked";i+=t.textContent+" Checkbox"+l}}if(e){i.length>0&&(i+=",");var u=t.getAttribute("aria-label");u&&(i+=r+u+",");var c=t.getAttribute("aria-labelledBy");if(c){var d=document.getElementById(c).textContent;i+=r+d+","}n=t;for(var f;n.parentElement;){if("document"===(f=n.getAttribute("role"))||"application"===f){i+=r+f+",";break}n=n.parentElement}t.getAttribute("role")&&"button"===(f=t.getAttribute("role"))&&(i+=r+"Button"),t.draggable&&(i+=r+"draggable,"),"true"===t.getAttribute("aria-grabbed")&&(i+=r+"grabbed,");var m=t.getAttribute("aria-describedby");if(m){var p,g;m.split(r).forEach(function(t){p=document.getElementById(t),g=p.textContent,i+=r+g})}}return","===i[i.length-1]&&(i=i.slice(0,-1)),i},getNextPreviousElementWithAccessibleContent:function(t){for(var e;!e;)this.activeElement=this.getNextPreviousElement(t),e=this.getAccessibleText(this.activeElement,!1);return this.activeElement},getNextPreviousElementWithRole:function(t,e){var i=null,n=e===a?1:-1;this.activeElement||(this.activeElement=this.linearDOM[0]);for(var s=this.linearDOM.indexOf(this.activeElement)+n;this.linearDOM[s];){for(var r=0;r<t.length;r++){var o=this.linearDOM[s].tagName,h=this.linearDOM[s].type,l=this.linearDOM[s].getAttribute("role"),u=t[r];if(o===u||l===u||h===u){i=this.linearDOM[s];break}}if(i)break;s+=n}return i},readNextPreviousLine:function(t){var e="";this.letterPosition=0,this.wordPosition=0,this.activeElement||(this.activeElement=this.getNextPreviousElementWithAccessibleContent(t));var i=this.getAccessibleText(this.activeElement,!1).split(r);if(t===o&&(this.positionInLine=this.positionInLine-30),!i[this.positionInLine]){this.positionInLine=0;var n=this.activeElement;this.activeElement=this.getNextPreviousElementWithAccessibleContent(t),i=this.getAccessibleText(this.activeElement,!1).split(" "),this.activeElement||(this.activeElement=n)}for(var s=this.positionInLine+15,a=this.positionInLine;a<s;a++)if(i[a]){if(e+=i[a],this.positionInLine+=1,!i[a+1]){this.positionInLine+=15-this.positionInLine%15;break}e+=r}return this.activeLine=e,e},readActiveLine:function(){var t="";this.activeLine||(this.activeLine=this.readNextPreviousLine(a));for(var e=this.activeLine.split(r),i=0;i<15;i++)if(e[i]){if(t+=e[i],!e[i+1])break;t+=r}return t},readNextPreviousWord:function(t){this.activeLine||(this.activeLine=this.readNextPreviousLine(t));var e,i,n=this.activeLine.split(r);t===a?(i=n.length,e=1):t===o&&(i=0,e=-2),this.wordPosition===i&&(this.activeLine=this.readNextPreviousLine(t));var s=n[this.wordPosition];return this.wordPosition+=e,s},readNextPreviousHeading:function(t,e){for(var i,n,s;!i;)s=this.activeElement,n=this.getNextPreviousElementWithRole(t,e),this.activeElement=n,i=this.getAccessibleText(n);if(!n){this.activeElement=s;var r=e===a?"more":"previous";if(1===t.length){var o="No "+r+" headings at ",h=t[0];return o+("H1"===h?"Level 1":"H2"===h?"Level 2":"H3"===h?"Level 3":"H4"===h?"Level 4":"H5"===h?"Level 5":"Level 6")}return"No "+r+" headings"}return this.activeElement=n,i},readNextPreviousButton:function(t){for(var e,i,n,s=["button","BUTTON","submit","reset"];!i;)n=this.activeElement,e=this.getNextPreviousElementWithRole(s,t),this.activeElement=e,i=this.getAccessibleText(e,!0);if(!e){this.activeElement=n;return"No "+(t===a?"more":"previous")+" buttons"}return this.activeElement=e,i},readNextPreviousFormElement:function(t){for(var e,i,n,s=["INPUT","BUTTON"].concat(["button"]);!i;)n=this.activeElement,e=this.getNextPreviousElementWithRole(s,t),this.activeElement=e,i=this.getAccessibleText(e,!0);if("End of Document"===i){this.activeElement=n;return"No "+(t===a?"next":"previous")+" form field"}return this.activeElement=e,i},readNextPreviousListItem:function(t){this.activeElement||(this.activeElement=this.getNextPreviousElementWithAccessibleContent(t));var e,i=this.activeElement.parentElement;if("UL"===i.tagName||"OL"===i.tagName){for(var n=t===a?1:-1,s=Array.prototype.indexOf.call(i.children,this.activeElement)+n;i.children[s];){if(e=this.getAccessibleText(i.children[s])){this.activeElement=i.children[s];break}s+=n}e||(e=this.readNextPreviousList(t))}else e=this.readNextPreviousList(t);if(!e){return"No "+(t===a?"more":"previous")+" list items"}return e},readNextPreviousList:function(t){this.activeElement||(this.activeElement=this.getNextPreviousElementWithAccessibleContent(t));var e,i=this.activeElement.parentElement;"UL"!==i.tagName&&"OL"!==i.tagName||(e=this.activeElement,this.activeElement=i);var n=this.getNextPreviousElementWithRole(["UL","OL"],t);if(!n){e&&(this.activeElement=e);return"No "+(t===a?"more":"previous")+" lists"}var s=this.getAccessibleText(n),r="",o=n.children[0];return o&&(r=this.getAccessibleText(o),this.activeElement=o),s+", "+r},readNextPreviousCharacter:function(t){this.activeLine||(this.activeLine=this.readNextPreviousLine(a));var e,i,n;t===a?(e=this.activeLine.length,i=1,n=0):t===o&&(e=2,i=-1,n=-2),this.letterPosition===e&&(this.activeLine=this.readNextPreviousLine(t),this.letterPosition=this.activeLine.length);var s=this.activeLine[this.letterPosition+n];return this.letterPosition+=i,s},updateLiveElementList:function(){for(var t=this,e=0;e<this.observers.length;e++)this.observers[e]&&this.observers[e].disconnect();for(this.observers=[],e=0;e<this.linearDOM.length;e++){var n=this.linearDOM[e];if(t.getLiveRole(n)){var s=new MutationObserver(function(e){!function(e){e.forEach(function(e){for(var n,s=e.target;!n;)n=t.getLiveRole(s),s=s.parentElement;if(e.addedNodes[0]){var r=e.addedNodes[0].data;t.outputUtteranceProperty.set(new i(r,n))}})}(e)}),r={childList:!0,subtree:!0};s.observe(n,r),t.observers.push(s)}}},readEntireDocument:function(){for(var t=this.getAccessibleText(this.activeElement),e=this.activeElement;"End of Document"!==t;)e=this.activeElement,"End of Document"===(t=this.readNextPreviousLine(a))&&(this.activeElement=e),this.outputUtteranceProperty.set(new i(t,"polite"))},isFocusable:function(t){var e=!1;return["tabindex","BUTTON","INPUT"].forEach(function(i){t.getAttribute(i)?e=!0:t.tagName!==i||(e=!0)}),e}}),n(Object,i),e}),i("SCENERY/accessibility/reader/Reader",["require","AXON/Emitter","PHET_CORE/inherit","SCENERY/scenery"],function(t){"use strict";function e(t){var e=this;this.speakingStartedEmitter=new i({validationEnabled:!1}),this.speakingEndedEmitter=new i({validationEnabled:!1}),this.speaking=!1,e.politeUtterances=[];var n=navigator.userAgent,s=n.match(/Windows/),r=!!(n.match(/Version\/[5-9]\./)&&n.match(/Safari\//)&&n.match(/AppleWebKit/));window.speechSynthesis&&SpeechSynthesisUtterance&&window.speechSynthesis.speak?(this.synth=window.speechSynthesis,t.outputUtteranceProperty.link(function(t){var i=new SpeechSynthesisUtterance(t.text);i.addEventListener("start",function(i){e.speakingStartedEmitter.emit(t)}),i.addEventListener("end",function(i){e.speakingEndedEmitter.emit(t)});var n;if(e.synth.getVoices().forEach(function(t){t.default&&(n=t)}),i.voice=n,i.rate=1.2,"assertive"!==t.liveRole&&"off"!==t.liveRole&&t.liveRole){if("polite"===t.liveRole)if(r){e.politeUtterances.push(i);if(e.speaking)setTimeout(function(){!function(){e.speaking=!0;var t=e.politeUtterances.shift();t?e.synth.speak(t):e.speaking=!1}()},2e3);else{e.synth.speak(i);var a=e.politeUtterances.indexOf(i);a>0&&e.politeUtterances.splice(a,1)}}else e.synth.speak(i)}else e.politeUtterances=[],e.speaking=!0,s?(e.synth.pause(),e.synth.cancel(),e.synth.speak(i),e.synth.resume()):(e.synth.cancel(),e.synth.speak(i))})):t.outputUtteranceProperty.link(function(){e.speakingStartedEmitter.emit({text:"Sorry! Web Speech API not supported on this platform."})})}var i=t("AXON/Emitter"),n=t("PHET_CORE/inherit");return t("SCENERY/scenery").register("Reader",e),n(Object,e)}),i("SCENERY/debug/DebugContext",["require","PHET_CORE/inherit","SCENERY/scenery"],function(t){"use strict";function e(t){return JSON.stringify(t)}function i(t){console.log("context."+t+";")}function n(t){i(t)}function s(t,n){i(t+" = "+e(n))}function r(t,n){i(void 0===n||0===n.length?t+"()":t+"( "+_.reduce(n,function(t,i){return t.length>0?t+", "+e(i):e(i)},"")+" )")}function a(t){this._context=t,t&&!t.ellipse&&(this.ellipse=t.ellipse)}var o=t("PHET_CORE/inherit");return t("SCENERY/scenery").register("DebugContext",a),o(Object,a,{get canvas(){return n("canvas"),this._context.canvas},get width(){return n("width"),this._context.width},get height(){return n("height"),this._context.height},commit:function(){r("commit"),this._context.commit()},save:function(){r("save"),this._context.save()},restore:function(){r("restore"),this._context.restore()},get currentTransform(){return n("currentTransform"),this._context.currentTransform},set currentTransform(t){s("currentTransform",t),this._context.currentTransform=t},scale:function(t,e){r("scale",[t,e]),this._context.scale(t,e)},rotate:function(t){r("rotate",[t]),this._context.rotate(t)},translate:function(t,e){r("translate",[t,e]),this._context.translate(t,e)},transform:function(t,e,i,n,s,a){r("transform",[t,e,i,n,s,a]),this._context.transform(t,e,i,n,s,a)},setTransform:function(t,e,i,n,s,a){r("setTransform",[t,e,i,n,s,a]),this._context.setTransform(t,e,i,n,s,a)},resetTransform:function(){r("resetTransform"),this._context.resetTransform()},get globalAlpha(){return n("globalAlpha"),this._context.globalAlpha},set globalAlpha(t){s("globalAlpha",t),this._context.globalAlpha=t},get globalCompositeOperation(){return n("globalCompositeOperation"),this._context.globalCompositeOperation},set globalCompositeOperation(t){s("globalCompositeOperation",t),this._context.globalCompositeOperation=t},get imageSmoothingEnabled(){return n("imageSmoothingEnabled"),this._context.imageSmoothingEnabled},set imageSmoothingEnabled(t){s("imageSmoothingEnabled",t),this._context.imageSmoothingEnabled=t},get strokeStyle(){return n("strokeStyle"),this._context.strokeStyle},set strokeStyle(t){s("strokeStyle",t),this._context.strokeStyle=t},get fillStyle(){return n("fillStyle"),this._context.fillStyle},set fillStyle(t){s("fillStyle",t),this._context.fillStyle=t},createLinearGradient:function(t,e,i,n){return r("createLinearGradient",[t,e,i,n]),this._context.createLinearGradient(t,e,i,n)},createRadialGradient:function(t,e,i,n,s,a){return r("createRadialGradient",[t,e,i,n,s,a]),this._context.createRadialGradient(t,e,i,n,s,a)},createPattern:function(t,e){return r("createPattern",[t,e]),this._context.createPattern(t,e)},get shadowOffsetX(){return n("shadowOffsetX"),this._context.shadowOffsetX},set shadowOffsetX(t){s("shadowOffsetX",t),this._context.shadowOffsetX=t},get shadowOffsetY(){return n("shadowOffsetY"),this._context.shadowOffsetY},set shadowOffsetY(t){s("shadowOffsetY",t),this._context.shadowOffsetY=t},get shadowBlur(){return n("shadowBlur"),this._context.shadowBlur},set shadowBlur(t){s("shadowBlur",t),this._context.shadowBlur=t},get shadowColor(){return n("shadowColor"),this._context.shadowColor},set shadowColor(t){s("shadowColor",t),this._context.shadowColor=t},clearRect:function(t,e,i,n){r("clearRect",[t,e,i,n]),this._context.clearRect(t,e,i,n)},fillRect:function(t,e,i,n){r("fillRect",[t,e,i,n]),this._context.fillRect(t,e,i,n)},strokeRect:function(t,e,i,n){r("strokeRect",[t,e,i,n]),this._context.strokeRect(t,e,i,n)},get fillRule(){return n("fillRule"),this._context.fillRule},set fillRule(t){s("fillRule",t),this._context.fillRule=t},beginPath:function(){r("beginPath"),this._context.beginPath()},fill:function(t){t?(r("fill",[t]),this._context.fill(t)):(r("fill"),this._context.fill())},stroke:function(t){t?(r("stroke",[t]),this._context.stroke(t)):(r("stroke"),this._context.stroke())},drawSystemFocusRing:function(t,e){r("drawSystemFocusRing",e?[t,e]:[t]),this._context.drawSystemFocusRing(t,e)},drawCustomFocusRing:function(t,e){return r("drawCustomFocusRing",e?[t,e]:[t]),this._context.drawCustomFocusRing(t,e)},scrollPathIntoView:function(t){r("scrollPathIntoView",t?[t]:void 0),this._context.scrollPathIntoView(t)},clip:function(t){r("clip",t?[t]:void 0),this._context.clip(t)},resetClip:function(){r("resetClip"),this._context.resetClip()},isPointInPath:function(t,e,i){return r("isPointInPath",i?[t,e,i]:[t,e]),this._context.isPointInPath(t,e,i)},fillText:function(t,e,i,n){r("fillText",void 0!==n?[t,e,i,n]:[t,e,i]),this._context.fillText(t,e,i,n)},strokeText:function(t,e,i,n){r("strokeText",void 0!==n?[t,e,i,n]:[t,e,i]),this._context.strokeText(t,e,i,n)},measureText:function(t){return r("measureText",[t]),this._context.measureText(t)},drawImage:function(t,e,i,n,s,a,o,h,l){r("drawImage",void 0!==n?void 0!==a?[t,e,i,n,s,a,o,h,l]:[t,e,i,n,s]:[t,e,i]),this._context.drawImage(t,e,i,n,s,a,o,h,l)},addHitRegion:function(t){r("addHitRegion",[t]),this._context.addHitRegion(t)},removeHitRegion:function(t){r("removeHitRegion",[t]),this._context.removeHitRegion(t)},createImageData:function(t,e){return r("createImageData",void 0!==e?[t,e]:[t]),this._context.createImageData(t,e)},createImageDataHD:function(t,e){return r("createImageDataHD",[t,e]),this._context.createImageDataHD(t,e)},getImageData:function(t,e,i,n){return r("getImageData",[t,e,i,n]),this._context.getImageData(t,e,i,n)},getImageDataHD:function(t,e,i,n){return r("getImageDataHD",[t,e,i,n]),this._context.getImageDataHD(t,e,i,n)},putImageData:function(t,e,i,n,s,a,o){r("putImageData",void 0!==n?[t,e,i,n,s,a,o]:[t,e,i]),this._context.putImageData(t,e,i,n,s,a,o)},putImageDataHD:function(t,e,i,n,s,a,o){r("putImageDataHD",void 0!==n?[t,e,i,n,s,a,o]:[t,e,i]),this._context.putImageDataHD(t,e,i,n,s,a,o)},get lineWidth(){return n("lineWidth"),this._context.lineWidth},set lineWidth(t){s("lineWidth",t),this._context.lineWidth=t},get lineCap(){return n("lineCap"),this._context.lineCap},set lineCap(t){s("lineCap",t),this._context.lineCap=t},get lineJoin(){return n("lineJoin"),this._context.lineJoin},set lineJoin(t){s("lineJoin",t),this._context.lineJoin=t},get miterLimit(){return n("miterLimit"),this._context.miterLimit},set miterLimit(t){s("miterLimit",t),this._context.miterLimit=t},setLineDash:function(t){r("setLineDash",[t]),this._context.setLineDash(t)},getLineDash:function(){return r("getLineDash"),this._context.getLineDash()},get lineDashOffset(){return n("lineDashOffset"),this._context.lineDashOffset},set lineDashOffset(t){s("lineDashOffset",t),this._context.lineDashOffset=t},get font(){return n("font"),this._context.font},set font(t){s("font",t),this._context.font=t},get textAlign(){return n("textAlign"),this._context.textAlign},set textAlign(t){s("textAlign",t),this._context.textAlign=t},get textBaseline(){return n("textBaseline"),this._context.textBaseline},set textBaseline(t){s("textBaseline",t),this._context.textBaseline=t},get direction(){return n("direction"),this._context.direction},set direction(t){s("direction",t),this._context.direction=t},closePath:function(){r("closePath"),this._context.closePath()},moveTo:function(t,e){r("moveTo",[t,e]),this._context.moveTo(t,e)},lineTo:function(t,e){r("lineTo",[t,e]),this._context.lineTo(t,e)},quadraticCurveTo:function(t,e,i,n){r("quadraticCurveTo",[t,e,i,n]),this._context.quadraticCurveTo(t,e,i,n)},bezierCurveTo:function(t,e,i,n,s,a){r("bezierCurveTo",[t,e,i,n,s,a]),this._context.bezierCurveTo(t,e,i,n,s,a)},arcTo:function(t,e,i,n,s,a,o){r("arcTo",void 0!==a?[t,e,i,n,s,a,o]:[t,e,i,n,s]),this._context.arcTo(t,e,i,n,s,a,o)},rect:function(t,e,i,n){r("rect",[t,e,i,n]),this._context.rect(t,e,i,n)},arc:function(t,e,i,n,s,a){r("arc",[t,e,i,n,s,a]),this._context.arc(t,e,i,n,s,a)},ellipse:function(t,e,i,n,s,a,o,h){r("ellipse",[t,e,i,n,s,a,o,h]),this._context.ellipse(t,e,i,n,s,a,o,h)}}),a}),i("SCENERY/display/WebGLSelfDrawable",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/display/SelfDrawable"],function(t){"use strict";function e(t,e){throw this.initializeWebGLSelfDrawable(t,e),new Error("Should use initialization and pooling")}var i=t("PHET_CORE/inherit"),n=t("SCENERY/scenery"),s=t("SCENERY/display/SelfDrawable");return n.register("WebGLSelfDrawable",e),i(s,e,{initializeWebGLSelfDrawable:function(t,e){return this.initializeSelfDrawable(t,e),this.transformListener=this.transformListener||this.markTransformDirty.bind(this),e.relativeTransform.addListener(this.transformListener),e.relativeTransform.addPrecompute(),this},markTransformDirty:function(){this.markDirty()},updateSelfVisibility:function(){s.prototype.updateSelfVisibility.call(this),this.markDirty()},dispose:function(){this.instance.relativeTransform.removeListener(this.transformListener),this.instance.relativeTransform.removePrecompute(),s.prototype.dispose.call(this)}}),e}),i("SCENERY/display/drawables/CanvasNodeDrawable",["require","SCENERY/display/CanvasSelfDrawable","PHET_CORE/inherit","PHET_CORE/Poolable","SCENERY/scenery"],function(t){"use strict";function e(t,e){this.initializeCanvasSelfDrawable(t,e)}var i=t("SCENERY/display/CanvasSelfDrawable"),n=t("PHET_CORE/inherit"),s=t("PHET_CORE/Poolable"),r=[];return t("SCENERY/scenery").register("CanvasNodeDrawable",e),n(i,e,{paintCanvas:function(t,e,i){if(!e.selfBounds.isEmpty()){var n=t.context;n.save(),n.fillStyle="black",n.strokeStyle="black",n.lineWidth=1,n.lineCap="butt",n.lineJoin="miter",n.lineDash=r,n.lineDashOffset=0,n.miterLimit=10,e.paintCanvas(n),n.restore()}}}),s.mixInto(e),e}),i("SCENERY/display/drawables/CircleCanvasDrawable",["require","SCENERY/display/CanvasSelfDrawable","PHET_CORE/inherit","SCENERY/display/drawables/PaintableStatelessDrawable","PHET_CORE/Poolable","SCENERY/scenery"],function(t){"use strict";function e(t,e){this.initializeCanvasSelfDrawable(t,e),this.initializePaintableStateless(t,e)}var i=t("SCENERY/display/CanvasSelfDrawable"),n=t("PHET_CORE/inherit"),s=t("SCENERY/display/drawables/PaintableStatelessDrawable"),r=t("PHET_CORE/Poolable");return t("SCENERY/scenery").register("CircleCanvasDrawable",e),n(i,e,{paintCanvas:function(t,e,i){var n=t.context;n.beginPath(),n.arc(0,0,e._radius,0,2*Math.PI,!1),n.closePath(),e.hasFill()&&(e.beforeCanvasFill(t),n.fill(),e.afterCanvasFill(t)),e.hasPaintableStroke()&&(e.beforeCanvasStroke(t),n.stroke(),e.afterCanvasStroke(t))},markDirtyRadius:function(){this.markPaintDirty()},dispose:function(){i.prototype.dispose.call(this),this.disposePaintableStateless()}}),s.mixInto(e),r.mixInto(e),e}),i("SCENERY/display/drawables/CircleStatefulDrawable",["require","PHET_CORE/inheritance","SCENERY/display/drawables/PaintableStatefulDrawable","SCENERY/scenery","SCENERY/display/SelfDrawable"],function(t){"use strict";t("PHET_CORE/inheritance");var e=t("SCENERY/display/drawables/PaintableStatefulDrawable"),i=t("SCENERY/scenery"),n=(t("SCENERY/display/SelfDrawable"),{mixInto:function(t){var i=t.prototype;i.initializeState=function(t,e){return this.paintDirty=!0,this.dirtyRadius=!0,this.initializePaintableState(t,e),this},i.disposeState=function(){this.disposePaintableState()},i.markPaintDirty=function(){this.paintDirty=!0,this.markDirty()},i.markDirtyRadius=function(){this.dirtyRadius=!0,this.markPaintDirty()},i.setToCleanState=function(){this.paintDirty=!1,this.dirtyRadius=!1},e.mixInto(t)}});return i.register("CircleStatefulDrawable",n),n}),i("SCENERY/display/drawables/CircleDOMDrawable",["require","SCENERY/display/drawables/CircleStatefulDrawable","SCENERY/display/DOMSelfDrawable","SCENERY/util/Features","PHET_CORE/inherit","DOT/Matrix3","PHET_CORE/Poolable","SCENERY/scenery","SCENERY/util/Util"],function(t){"use strict";function e(t,e){if(this.initializeDOMSelfDrawable(t,e),this.initializeState(t,e),this.matrix=this.matrix||a.dirtyFromPool(),!this.fillElement||!this.strokeElement){var i=this.fillElement=document.createElement("div"),n=this.strokeElement=document.createElement("div");i.style.display="block",i.style.position="absolute",i.style.left="0",i.style.top="0",i.style.pointerEvents="none",n.style.display="block",n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.pointerEvents="none",i.appendChild(n)}this.domElement=this.fillElement,h.Util.prepareForTransform(this.domElement,this.forceAcceleration)}var i=t("SCENERY/display/drawables/CircleStatefulDrawable"),n=t("SCENERY/display/DOMSelfDrawable"),s=t("SCENERY/util/Features"),r=t("PHET_CORE/inherit"),a=t("DOT/Matrix3"),o=t("PHET_CORE/Poolable"),h=t("SCENERY/scenery");t("SCENERY/util/Util");return h.register("CircleDOMDrawable",e),r(n,e,{updateDOM:function(){var t=this.node,e=this.fillElement,i=this.strokeElement;if(this.paintDirty&&(this.dirtyRadius&&(e.style.width=2*t._radius+"px",e.style.height=2*t._radius+"px",e.style[s.borderRadius]=t._radius+"px"),this.dirtyFill&&(e.style.backgroundColor=t.getCSSFill()),this.dirtyStroke&&(t.hasStroke()?i.style.borderStyle="solid":i.style.borderStyle="none"),t.hasStroke())){var n=!this.hadStroke;(n||this.dirtyLineWidth||this.dirtyRadius)&&(i.style.width=2*t._radius-t.getLineWidth()+"px",i.style.height=2*t._radius-t.getLineWidth()+"px",i.style[s.borderRadius]=t._radius+t.getLineWidth()/2+"px"),(n||this.dirtyLineWidth)&&(i.style.left=-t.getLineWidth()/2+"px",i.style.top=-t.getLineWidth()/2+"px",i.style.borderWidth=t.getLineWidth()+"px"),(n||this.dirtyStroke)&&(i.style.borderColor=t.getSimpleCSSStroke())}if(this.transformDirty||this.dirtyRadius){this.matrix.set(this.getTransformMatrix());var r=a.translation(-t._radius,-t._radius);this.matrix.multiplyMatrix(r),r.freeToPool(),h.Util.applyPreparedTransform(this.matrix,this.fillElement,this.forceAcceleration)}this.setToCleanState(),this.cleanPaintableState(),this.transformDirty=!1},dispose:function(){this.disposeState(),n.prototype.dispose.call(this)}}),i.mixInto(e),o.mixInto(e),e}),i("SCENERY/display/drawables/CircleSVGDrawable",["require","SCENERY/display/drawables/CircleStatefulDrawable","PHET_CORE/inherit","PHET_CORE/Poolable","SCENERY/scenery","SCENERY/display/SVGSelfDrawable"],function(t){"use strict";function e(t,e){this.initializeSVGSelfDrawable(t,e,!0,o),this.svgElement=this.svgElement||document.createElementNS(r.svgns,"circle")}var i=t("SCENERY/display/drawables/CircleStatefulDrawable"),n=t("PHET_CORE/inherit"),s=t("PHET_CORE/Poolable"),r=t("SCENERY/scenery"),a=t("SCENERY/display/SVGSelfDrawable"),o=!0;return r.register("CircleSVGDrawable",e),n(a,e,{updateSVGSelf:function(){var t=this.svgElement;this.dirtyRadius&&t.setAttribute("r",this.node._radius),this.updateFillStrokeStyle(t)}}),i.mixInto(e),s.mixInto(e),e}),i("SCENERY/display/drawables/DOMDrawable",["require","SCENERY/display/DOMSelfDrawable","PHET_CORE/inherit","PHET_CORE/Poolable","SCENERY/scenery","SCENERY/util/Util"],function(t){"use strict";function e(t,e){this.initializeDOMSelfDrawable(t,e),this.domElement=this.node._container,r.Util.prepareForTransform(this.domElement,this.forceAcceleration)}var i=t("SCENERY/display/DOMSelfDrawable"),n=t("PHET_CORE/inherit"),s=t("PHET_CORE/Poolable"),r=t("SCENERY/scenery");return t("SCENERY/util/Util"),r.register("DOMDrawable",e),n(i,e,{updateDOM:function(){this.transformDirty&&!this.node._preventTransform&&r.Util.applyPreparedTransform(this.getTransformMatrix(),this.domElement,this.forceAcceleration),this.transformDirty=!1},dispose:function(){i.prototype.dispose.call(this),this.domElement=null}}),s.mixInto(e),e}),i("SCENERY/display/drawables/ImageCanvasDrawable",["require","SCENERY/display/CanvasSelfDrawable","PHET_CORE/inherit","PHET_CORE/Poolable","SCENERY/scenery"],function(t){"use strict";function e(t,e){this.initializeCanvasSelfDrawable(t,e)}var i=t("SCENERY/display/CanvasSelfDrawable"),n=t("PHET_CORE/inherit"),s=t("PHET_CORE/Poolable");return t("SCENERY/scenery").register("ImageCanvasDrawable",e),n(i,e,{paintCanvas:function(t,e,i){var n=1!==e._imageOpacity;if(e._image&&0!==e._image.width&&0!==e._image.height){if(n&&(t.context.save(),t.context.globalAlpha*=e._imageOpacity),e._mipmap&&e.hasMipmaps()){var s=e.getMipmapLevel(i),r=e.getMipmapCanvas(s),a=Math.pow(2,s);t.context.drawImage(r,0,0,r.width*a,r.height*a)}else t.context.drawImage(e._image,0,0);n&&t.context.restore()}},markDirtyImage:function(){this.markPaintDirty()},markDirtyMipmap:function(){this.markPaintDirty()},markDirtyImageOpacity:function(){this.markPaintDirty()}}),s.mixInto(e),e}),i("SCENERY/display/drawables/ImageStatefulDrawable",["require","PHET_CORE/inheritance","SCENERY/scenery","SCENERY/display/SelfDrawable"],function(t){"use strict";t("PHET_CORE/inheritance");var e=t("SCENERY/scenery"),i=(t("SCENERY/display/SelfDrawable"),{mixInto:function(t){var e=t.prototype;e.initializeState=function(t,e){return this.paintDirty=!0,this.dirtyImage=!0,this.dirtyImageOpacity=!0,this.dirtyMipmap=!0,this},e.disposeState=function(){},e.markPaintDirty=function(){this.paintDirty=!0,this.markDirty()},e.markDirtyImage=function(){this.dirtyImage=!0,this.markPaintDirty()},e.markDirtyImageOpacity=function(){this.dirtyImageOpacity=!0,this.markPaintDirty()},e.markDirtyMipmap=function(){this.dirtyMipmap=!0,this.markPaintDirty()},e.setToCleanState=function(){this.paintDirty=!1,this.dirtyImage=!1,this.dirtyImageOpacity=!1,this.dirtyMipmap=!1}}});return e.register("ImageStatefulDrawable",i),i}),i("SCENERY/display/drawables/ImageDOMDrawable",["require","SCENERY/display/DOMSelfDrawable","SCENERY/display/drawables/ImageStatefulDrawable","PHET_CORE/inherit","PHET_CORE/Poolable","SCENERY/scenery","SCENERY/util/Util"],function(t){"use strict";function e(t,e){this.initializeDOMSelfDrawable(t,e),this.initializeState(t,e),this.domElement||(this.domElement=document.createElement("img"),this.domElement.style.display="block",this.domElement.style.position="absolute",this.domElement.style.pointerEvents="none",this.domElement.style.left="0",this.domElement.style.top="0"),this.hasOpacity=!1,a.Util.prepareForTransform(this.domElement,this.forceAcceleration)}var i=t("SCENERY/display/DOMSelfDrawable"),n=t("SCENERY/display/drawables/ImageStatefulDrawable"),s=t("PHET_CORE/inherit"),r=t("PHET_CORE/Poolable"),a=t("SCENERY/scenery");t("SCENERY/util/Util");return a.register("ImageDOMDrawable",e),s(i,e,{updateDOM:function(){var t=this.node,e=this.domElement;this.paintDirty&&this.dirtyImage&&(e.src=t._image?t._image.src:"//:0"),this.dirtyImageOpacity&&(1===t._imageOpacity?this.hasOpacity&&(this.hasOpacity=!1,e.style.opacity=""):(this.hasOpacity=!0,e.style.opacity=t._imageOpacity)),this.transformDirty&&a.Util.applyPreparedTransform(this.getTransformMatrix(),this.domElement,this.forceAcceleration),this.setToCleanState(),this.transformDirty=!1},dispose:function(){this.disposeState(),i.prototype.dispose.call(this)}}),n.mixInto(e),r.mixInto(e),e}),i("SCENERY/display/drawables/ImageSVGDrawable",["require","SCENERY/display/drawables/ImageStatefulDrawable","PHET_CORE/inherit","PHET_CORE/platform","PHET_CORE/Poolable","SCENERY/scenery","SCENERY/display/SVGSelfDrawable"],function(t){"use strict";function e(t,e){this.initializeSVGSelfDrawable(t,e,!1,h);var i=this;this.svgElement=this.svgElement||document.createElementNS(a.svgns,"image"),this.svgElement.setAttribute("x",0),this.svgElement.setAttribute("y",0),this.hasOpacity=!1,this._usingMipmap=!1,this._mipmapLevel=-1,this._mipmapTransformListener=this._mipmapTransformListener||function(){i.markDirtyMipmap()},this._mipmapListener=this._mipmapListener||function(){i.markDirtyMipmap(),i.updateMipmapStatus(i.node._mipmap)},this.node.onStatic("mipmap",this._mipmapListener),this.updateMipmapStatus(e.node._mipmap)}var i=t("SCENERY/display/drawables/ImageStatefulDrawable"),n=t("PHET_CORE/inherit"),s=t("PHET_CORE/platform"),r=t("PHET_CORE/Poolable"),a=t("SCENERY/scenery"),o=t("SCENERY/display/SVGSelfDrawable"),h=!0;return a.register("ImageSVGDrawable",e),n(o,e,{updateSVGSelf:function(){var t=this.svgElement;this.dirtyImage?this.node._image?this.updateURL(t,!0):(t.setAttribute("width","0"),t.setAttribute("height","0"),t.setAttributeNS(a.xlinkns,"xlink:href","//:0")):this.dirtyMipmap&&this.node._image&&this.updateURL(t,!1),this.dirtyImageOpacity&&(1===this.node._imageOpacity?this.hasOpacity&&(this.hasOpacity=!1,t.removeAttribute("opacity")):(this.hasOpacity=!0,t.setAttribute("opacity",this.node._imageOpacity)))},updateURL:function(t,e){var i=-1;if(this.node._mipmap&&(i=this.node.getMipmapLevel(this.instance.relativeTransform.matrix)),e||i!==this._mipmapLevel)if(this._mipmapLevel>=0&&-1===i&&(s.ie9||s.ie10?t.setAttribute("transform",""):t.removeAttribute("transform")),this._mipmapLevel=i,this.node._mipmap&&this.node.hasMipmaps()){var n=this.node.getMipmapURL(i),r=this.node.getMipmapCanvas(i);t.setAttribute("width",r.width+"px"),t.setAttribute("height",r.height+"px"),t.setAttribute("transform","scale("+Math.pow(2,i).toFixed(20)+")"),t.setAttributeNS(a.xlinkns,"xlink:href",n)}else t.setAttribute("width",this.node.getImageWidth()+"px"),t.setAttribute("height",this.node.getImageHeight()+"px"),t.setAttributeNS(a.xlinkns,"xlink:href",this.node.getImageURL())},updateMipmapStatus:function(t){this._usingMipmap!==t&&(this._usingMipmap=t,t?(this.instance.relativeTransform.addListener(this._mipmapTransformListener),this.instance.relativeTransform.addPrecompute()):(this.instance.relativeTransform.removeListener(this._mipmapTransformListener),this.instance.relativeTransform.removePrecompute()),this.markDirtyMipmap())},dispose:function(){this.updateMipmapStatus(!1),this.node.offStatic("mipmap",this._mipmapListener),o.prototype.dispose.call(this)}}),i.mixInto(e),r.mixInto(e),e}),i("SCENERY/display/drawables/ImageWebGLDrawable",["require","SCENERY/display/drawables/ImageStatefulDrawable","PHET_CORE/inherit","PHET_CORE/Poolable","SCENERY/display/Renderer","SCENERY/scenery","DOT/Vector2","SCENERY/display/WebGLSelfDrawable"],function(t){"use strict";function e(t,e){this.initializeWebGLSelfDrawable(t,e),this.vertexArray||(this.vertexArray=new Float32Array(6*l)),this.upperLeft=new o(0,0),this.lowerLeft=new o(0,0),this.upperRight=new o(0,0),this.lowerRight=new o(0,0),this.xyDirty=!0,this.uvDirty=!0,this.updatedOnce=!1,this.sprite=null}var i=t("SCENERY/display/drawables/ImageStatefulDrawable"),n=t("PHET_CORE/inherit"),s=t("PHET_CORE/Poolable"),r=t("SCENERY/display/Renderer"),a=t("SCENERY/scenery"),o=t("DOT/Vector2"),h=t("SCENERY/display/WebGLSelfDrawable"),l=5,u=0*l,c=1*l,d=2*l,f=3*l,m=4*l,p=5*l;return a.register("ImageWebGLDrawable",e),n(h,e,{webglRenderer:r.webglTexturedTriangles,onAddToBlock:function(t){this.webglBlock=t,this.markDirty(),this.reserveSprite()},onRemoveFromBlock:function(t){this.unreserveSprite()},reserveSprite:function(){if(this.sprite){if(this.sprite.image===this.node._image)return;this.unreserveSprite()}var t=this.node.getImageWidth(),e=this.node.getImageHeight();this.sprite=t>0&&e>0?this.webglBlock.addSpriteSheetImage(this.node._image,t,e):null,this.xyDirty=!0,this.uvDirty=!0},unreserveSprite:function(){this.sprite&&this.webglBlock.removeSpriteSheetImage(this.sprite),this.sprite=null},markTransformDirty:function(){this.xyDirty=!0,h.prototype.markTransformDirty.call(this)},markPaintDirty:function(){this.xyDirty=!0,this.uvDirty=!0,this.markDirty()},update:function(){if(!h.prototype.update.call(this))return!1;if(this.reserveSprite(),!this.dirtyImageOpacity&&this.updatedOnce||(this.vertexArray[u+4]=this.node._imageOpacity,this.vertexArray[c+4]=this.node._imageOpacity,this.vertexArray[d+4]=this.node._imageOpacity,this.vertexArray[f+4]=this.node._imageOpacity,this.vertexArray[m+4]=this.node._imageOpacity,this.vertexArray[p+4]=this.node._imageOpacity),this.updatedOnce=!0,!this.sprite)return!1;if(this.uvDirty){this.uvDirty=!1;var t=this.sprite.uvBounds;this.vertexArray[u+2]=t.minX,this.vertexArray[u+3]=t.minY,this.vertexArray[c+2]=t.minX,this.vertexArray[c+3]=t.maxY,this.vertexArray[d+2]=t.maxX,this.vertexArray[d+3]=t.minY,this.vertexArray[f+2]=t.maxX,this.vertexArray[f+3]=t.minY,this.vertexArray[m+2]=t.minX,this.vertexArray[m+3]=t.maxY,this.vertexArray[p+2]=t.maxX,this.vertexArray[p+3]=t.maxY}if(this.xyDirty){this.xyDirty=!1;var e=this.node.getImageWidth(),i=this.node.getImageHeight(),n=this.instance.relativeTransform.matrix;n.multiplyVector2(this.upperLeft.setXY(0,0)),n.multiplyVector2(this.lowerLeft.setXY(0,i)),n.multiplyVector2(this.upperRight.setXY(e,0)),n.multiplyVector2(this.lowerRight.setXY(e,i)),this.vertexArray[u+0]=this.upperLeft.x,this.vertexArray[u+1]=this.upperLeft.y,this.vertexArray[c+0]=this.lowerLeft.x,this.vertexArray[c+1]=this.lowerLeft.y,this.vertexArray[d+0]=this.upperRight.x,this.vertexArray[d+1]=this.upperRight.y,this.vertexArray[f+0]=this.upperRight.x,this.vertexArray[f+1]=this.upperRight.y,this.vertexArray[m+0]=this.lowerLeft.x,this.vertexArray[m+1]=this.lowerLeft.y,this.vertexArray[p+0]=this.lowerRight.x,this.vertexArray[p+1]=this.lowerRight.y}return!0},dispose:function(){h.prototype.dispose.call(this)}}),i.mixInto(e),s.mixInto(e),e}),i("SCENERY/display/drawables/LineCanvasDrawable",["require","SCENERY/display/CanvasSelfDrawable","PHET_CORE/inherit","SCENERY/display/drawables/PaintableStatelessDrawable","PHET_CORE/Poolable","SCENERY/scenery"],function(t){"use strict";function e(t,e){this.initializeCanvasSelfDrawable(t,e),this.initializePaintableStateless(t,e)}var i=t("SCENERY/display/CanvasSelfDrawable"),n=t("PHET_CORE/inherit"),s=t("SCENERY/display/drawables/PaintableStatelessDrawable"),r=t("PHET_CORE/Poolable");return t("SCENERY/scenery").register("LineCanvasDrawable",e),n(i,e,{paintCanvas:function(t,e,i){var n=t.context;n.beginPath(),n.moveTo(e._x1,e._y1),n.lineTo(e._x2,e._y2),e.hasPaintableStroke()&&(e.beforeCanvasStroke(t),n.stroke(),e.afterCanvasStroke(t))},markDirtyLine:function(){this.markPaintDirty()},markDirtyP1:function(){this.markPaintDirty()},markDirtyP2:function(){this.markPaintDirty()},markDirtyX1:function(){this.markPaintDirty()},markDirtyY1:function(){this.markPaintDirty()},markDirtyX2:function(){this.markPaintDirty()},markDirtyY2:function(){this.markPaintDirty()},dispose:function(){i.prototype.dispose.call(this),this.disposePaintableStateless()}}),s.mixInto(e),r.mixInto(e),e}),i("SCENERY/display/drawables/LineStatefulDrawable",["require","PHET_CORE/inheritance","SCENERY/display/drawables/PaintableStatefulDrawable","SCENERY/scenery","SCENERY/display/SelfDrawable"],function(t){"use strict";t("PHET_CORE/inheritance");var e=t("SCENERY/display/drawables/PaintableStatefulDrawable"),i=t("SCENERY/scenery"),n=(t("SCENERY/display/SelfDrawable"),{mixInto:function(t){var i=t.prototype;i.initializeState=function(t,e){return this.paintDirty=!0,this.dirtyX1=!0,this.dirtyY1=!0,this.dirtyX2=!0,this.dirtyY2=!0,this.initializePaintableState(t,e),this},i.disposeState=function(){this.disposePaintableState()},i.markPaintDirty=function(){this.paintDirty=!0,this.markDirty()},i.markDirtyLine=function(){this.dirtyX1=!0,this.dirtyY1=!0,this.dirtyX2=!0,this.dirtyY2=!0,this.markPaintDirty()},i.markDirtyP1=function(){this.dirtyX1=!0,this.dirtyY1=!0,this.markPaintDirty()},i.markDirtyP2=function(){this.dirtyX2=!0,this.dirtyY2=!0,this.markPaintDirty()},i.markDirtyX1=function(){this.dirtyX1=!0,this.markPaintDirty()},i.markDirtyY1=function(){this.dirtyY1=!0,this.markPaintDirty()},i.markDirtyX2=function(){this.dirtyX2=!0,this.markPaintDirty()},i.markDirtyY2=function(){this.dirtyY2=!0,this.markPaintDirty()},i.setToCleanState=function(){this.paintDirty=!1,this.dirtyX1=!1,this.dirtyY1=!1,this.dirtyX2=!1,this.dirtyY2=!1},e.mixInto(t)}});return i.register("LineStatefulDrawable",n),n}),i("SCENERY/display/drawables/LineStatelessDrawable",["require","PHET_CORE/inheritance","SCENERY/display/drawables/PaintableStatelessDrawable","SCENERY/scenery","SCENERY/display/SelfDrawable"],function(t){"use strict";t("PHET_CORE/inheritance");var e=t("SCENERY/display/drawables/PaintableStatelessDrawable"),i=t("SCENERY/scenery"),n=(t("SCENERY/display/SelfDrawable"),{mixInto:function(t){var i=t.prototype;i.initializeLineStateless=function(){return this.paintDirty=!0,this},i.markPaintDirty=function(){this.paintDirty=!0,this.markDirty()},i.markDirtyLine=function(){this.markPaintDirty()},i.markDirtyP1=function(){this.markPaintDirty()},i.markDirtyP2=function(){this.markPaintDirty()},i.markDirtyX1=function(){this.markPaintDirty()},i.markDirtyY1=function(){this.markPaintDirty()},i.markDirtyX2=function(){this.markPaintDirty()},i.markDirtyY2=function(){this.markPaintDirty()},e.mixInto(t)}});return i.register("LineStatelessDrawable",n),n}),i("SCENERY/display/drawables/LineSVGDrawable",["require","PHET_CORE/inherit","SCENERY/display/drawables/LineStatefulDrawable","PHET_CORE/Poolable","SCENERY/scenery","SCENERY/display/SVGSelfDrawable"],function(t){"use strict";function e(t,e){this.initializeSVGSelfDrawable(t,e,!0,o),this.svgElement=this.svgElement||document.createElementNS(r.svgns,"line")}var i=t("PHET_CORE/inherit"),n=t("SCENERY/display/drawables/LineStatefulDrawable"),s=t("PHET_CORE/Poolable"),r=t("SCENERY/scenery"),a=t("SCENERY/display/SVGSelfDrawable"),o=!0;return r.register("LineSVGDrawable",e),i(a,e,{updateSVGSelf:function(){var t=this.svgElement;this.dirtyX1&&t.setAttribute("x1",this.node._x1),this.dirtyY1&&t.setAttribute("y1",this.node._y1),this.dirtyX2&&t.setAttribute("x2",this.node._x2),this.dirtyY2&&t.setAttribute("y2",this.node._y2),this.updateFillStrokeStyle(t)}}),n.mixInto(e),s.mixInto(e),e}),i("SCENERY/display/drawables/RectangleCanvasDrawable",["require","SCENERY/display/CanvasSelfDrawable","PHET_CORE/inherit","SCENERY/display/drawables/PaintableStatelessDrawable","PHET_CORE/Poolable","SCENERY/scenery"],function(t){"use strict";function e(t,e){this.initializeCanvasSelfDrawable(t,e),this.initializePaintableStateless(t,e)}var i=t("SCENERY/display/CanvasSelfDrawable"),n=t("PHET_CORE/inherit"),s=t("SCENERY/display/drawables/PaintableStatelessDrawable"),r=t("PHET_CORE/Poolable");return t("SCENERY/scenery").register("RectangleCanvasDrawable",e),n(i,e,{writeRectangularPath:function(t,e){t.beginPath(),t.moveTo(e._rectX,e._rectY),t.lineTo(e._rectX+e._rectWidth,e._rectY),t.lineTo(e._rectX+e._rectWidth,e._rectY+e._rectHeight),t.lineTo(e._rectX,e._rectY+e._rectHeight),t.closePath()},paintCanvas:function(t,e,i){var n=t.context;if(e.isRounded()){n.beginPath();var s=e.getMaximumArcSize(),r=Math.min(e._cornerXRadius,s),a=Math.min(e._cornerYRadius,s),o=e._rectX+r,h=e._rectX+e._rectWidth-r,l=e._rectY+a,u=e._rectY+e._rectHeight-a;r===a?(n.arc(h,l,r,-Math.PI/2,0,!1),n.arc(h,u,r,0,Math.PI/2,!1),n.arc(o,u,r,Math.PI/2,Math.PI,!1),n.arc(o,l,r,Math.PI,3*Math.PI/2,!1)):(n.ellipse(h,l,r,a,0,-Math.PI/2,0,!1),n.ellipse(h,u,r,a,0,0,Math.PI/2,!1),n.ellipse(o,u,r,a,0,Math.PI/2,Math.PI,!1),n.ellipse(o,l,r,a,0,Math.PI,3*Math.PI/2,!1)),n.closePath(),e.hasFill()&&(e.beforeCanvasFill(t),n.fill(),e.afterCanvasFill(t)),e.hasPaintableStroke()&&(e.beforeCanvasStroke(t),n.stroke(),e.afterCanvasStroke(t))}else e.hasFill()&&(e.getFillValue().transformMatrix?(this.writeRectangularPath(n,e),e.beforeCanvasFill(t),n.fill(),e.afterCanvasFill(t)):(e.beforeCanvasFill(t),n.fillRect(e._rectX,e._rectY,e._rectWidth,e._rectHeight),e.afterCanvasFill(t))),e.hasPaintableStroke()&&(e.getStrokeValue().transformMatrix?(this.writeRectangularPath(n,e),e.beforeCanvasStroke(t),n.stroke(),e.afterCanvasStroke(t)):(e.beforeCanvasStroke(t),n.strokeRect(e._rectX,e._rectY,e._rectWidth,e._rectHeight),e.afterCanvasStroke(t)))},markDirtyRectangle:function(){this.markPaintDirty()},markDirtyX:function(){this.markDirtyRectangle()},markDirtyY:function(){this.markDirtyRectangle()},markDirtyWidth:function(){this.markDirtyRectangle()},markDirtyHeight:function(){this.markDirtyRectangle()},markDirtyCornerXRadius:function(){this.markDirtyRectangle()},markDirtyCornerYRadius:function(){this.markDirtyRectangle()},dispose:function(){i.prototype.dispose.call(this),this.disposePaintableStateless()}}),s.mixInto(e),r.mixInto(e),e}),i("SCENERY/display/drawables/RectangleStatefulDrawable",["require","PHET_CORE/inheritance","SCENERY/display/drawables/PaintableStatefulDrawable","SCENERY/scenery","SCENERY/display/SelfDrawable"],function(t){"use strict";t("PHET_CORE/inheritance");var e=t("SCENERY/display/drawables/PaintableStatefulDrawable"),i=t("SCENERY/scenery"),n=(t("SCENERY/display/SelfDrawable"),{mixInto:function(t){var i=t.prototype;i.initializeState=function(t,e){return this.paintDirty=!0,this.dirtyX=!0,this.dirtyY=!0,this.dirtyWidth=!0,this.dirtyHeight=!0,this.dirtyCornerXRadius=!0,this.dirtyCornerYRadius=!0,this.initializePaintableState(t,e),this},i.disposeState=function(){this.disposePaintableState()},i.markPaintDirty=function(){this.paintDirty=!0,this.markDirty()},i.markDirtyRectangle=function(){this.dirtyX=!0,this.dirtyY=!0,this.dirtyWidth=!0,this.dirtyHeight=!0,this.dirtyCornerXRadius=!0,this.dirtyCornerYRadius=!0,this.markPaintDirty()},i.markDirtyX=function(){this.dirtyX=!0,this.markPaintDirty()},i.markDirtyY=function(){this.dirtyY=!0,this.markPaintDirty()},i.markDirtyWidth=function(){this.dirtyWidth=!0,this.markPaintDirty()},i.markDirtyHeight=function(){this.dirtyHeight=!0,this.markPaintDirty()},i.markDirtyCornerXRadius=function(){this.dirtyCornerXRadius=!0,this.markPaintDirty()},i.markDirtyCornerYRadius=function(){this.dirtyCornerYRadius=!0,this.markPaintDirty()},i.setToCleanState=function(){this.paintDirty=!1,this.dirtyX=!1,this.dirtyY=!1,this.dirtyWidth=!1,this.dirtyHeight=!1,this.dirtyCornerXRadius=!1,this.dirtyCornerYRadius=!1},e.mixInto(t)}});return i.register("RectangleStatefulDrawable",n),n}),i("SCENERY/display/drawables/RectangleDOMDrawable",["require","SCENERY/display/DOMSelfDrawable","SCENERY/util/Features","PHET_CORE/inherit","DOT/Matrix3","PHET_CORE/Poolable","SCENERY/display/drawables/RectangleStatefulDrawable","SCENERY/scenery"],function(t){"use strict";function e(t,e){if(this.initializeDOMSelfDrawable(t,e),this.initializeState(t,e),!this.fillElement||!this.strokeElement){var i=this.fillElement=document.createElement("div");i.style.display="block",i.style.position="absolute",i.style.left="0",i.style.top="0",i.style.pointerEvents="none";var n=this.strokeElement=document.createElement("div");n.style.display="block",n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.pointerEvents="none",i.appendChild(n)}this.domElement=this.fillElement,h.Util.prepareForTransform(this.domElement,this.forceAcceleration)}var i=t("SCENERY/display/DOMSelfDrawable"),n=t("SCENERY/util/Features"),s=t("PHET_CORE/inherit"),r=t("DOT/Matrix3"),a=t("PHET_CORE/Poolable"),o=t("SCENERY/display/drawables/RectangleStatefulDrawable"),h=t("SCENERY/scenery"),l=r.dirtyFromPool();return h.register("RectangleDOMDrawable",e),s(i,e,{updateDOM:function(){var t=this.node,e=this.fillElement,i=this.strokeElement;if(this.paintDirty){var s=Math.min(t._cornerXRadius,t._cornerYRadius),a=this.dirtyCornerXRadius||this.dirtyCornerYRadius;if(this.dirtyWidth&&(e.style.width=t._rectWidth+"px"),this.dirtyHeight&&(e.style.height=t._rectHeight+"px"),a&&(e.style[n.borderRadius]=s+"px"),this.dirtyFill&&(e.style.backgroundColor=t.getCSSFill()),this.dirtyStroke&&(t.hasStroke()?i.style.borderStyle="solid":i.style.borderStyle="none"),t.hasStroke()){var o=!this.hadStroke;(o||this.dirtyWidth||this.dirtyLineWidth)&&(i.style.width=t._rectWidth-t.getLineWidth()+"px"),(o||this.dirtyHeight||this.dirtyLineWidth)&&(i.style.height=t._rectHeight-t.getLineWidth()+"px"),(o||this.dirtyLineWidth)&&(i.style.left=-t.getLineWidth()/2+"px",i.style.top=-t.getLineWidth()/2+"px",i.style.borderWidth=t.getLineWidth()+"px"),(o||this.dirtyStroke)&&(i.style.borderColor=t.getSimpleCSSStroke()),(o||a||this.dirtyLineWidth||this.dirtyLineOptions)&&(i.style[n.borderRadius]=t.isRounded()||"round"===t.getLineJoin()?s+t.getLineWidth()/2+"px":"0")}}if(this.transformDirty||this.dirtyX||this.dirtyY){l.set(this.getTransformMatrix());var u=r.translation(t._rectX,t._rectY);l.multiplyMatrix(u),u.freeToPool(),h.Util.applyPreparedTransform(l,this.fillElement,this.forceAcceleration)}this.setToCleanState(),this.cleanPaintableState(),this.transformDirty=!1},dispose:function(){this.disposeState(),i.prototype.dispose.call(this)}}),o.mixInto(e),a.mixInto(e),e}),i("SCENERY/display/drawables/RectangleSVGDrawable",["require","PHET_CORE/inherit","PHET_CORE/Poolable","SCENERY/display/drawables/RectangleStatefulDrawable","SCENERY/scenery","SCENERY/display/SVGSelfDrawable"],function(t){"use strict";function e(t,e){this.initializeSVGSelfDrawable(t,e,!0,o),this.lastArcW=-1,this.lastArcH=-1,this.svgElement=this.svgElement||document.createElementNS(r.svgns,"rect")}var i=t("PHET_CORE/inherit"),n=t("PHET_CORE/Poolable"),s=t("SCENERY/display/drawables/RectangleStatefulDrawable"),r=t("SCENERY/scenery"),a=t("SCENERY/display/SVGSelfDrawable"),o=!0;return r.register("RectangleSVGDrawable",e),i(a,e,{updateSVGSelf:function(){var t=this.svgElement;if(this.dirtyX&&t.setAttribute("x",this.node._rectX),this.dirtyY&&t.setAttribute("y",this.node._rectY),this.dirtyWidth&&t.setAttribute("width",this.node._rectWidth),this.dirtyHeight&&t.setAttribute("height",this.node._rectHeight),this.dirtyCornerXRadius||this.dirtyCornerYRadius||this.dirtyWidth||this.dirtyHeight){var e=0,i=0;if(this.node.isRounded()){var n=this.node.getMaximumArcSize();e=Math.min(this.node._cornerXRadius,n),i=Math.min(this.node._cornerYRadius,n)}e!==this.lastArcW&&(this.lastArcW=e,t.setAttribute("rx",e)),i!==this.lastArcH&&(this.lastArcH=i,t.setAttribute("ry",i))}this.updateFillStrokeStyle(t)}}),s.mixInto(e),n.mixInto(e),e}),i("SCENERY/display/drawables/RectangleWebGLDrawable",["require","SCENERY/util/Color","PHET_CORE/inherit","PHET_CORE/Poolable","AXON/Property","SCENERY/display/drawables/RectangleStatefulDrawable","SCENERY/display/Renderer","SCENERY/scenery","DOT/Vector2","SCENERY/display/WebGLSelfDrawable"],function(t){"use strict";function e(t,e){this.initializeWebGLSelfDrawable(t,e),this.initializeState(t,e),this.vertexArray||(this.vertexArray=new Float32Array(36)),this.upperLeft=new l(0,0),this.lowerLeft=new l(0,0),this.upperRight=new l(0,0),this.lowerRight=new l(0,0),this.transformDirty=!0,this.includeVertices=!0}var i=t("SCENERY/util/Color"),n=t("PHET_CORE/inherit"),s=t("PHET_CORE/Poolable"),r=t("AXON/Property"),a=t("SCENERY/display/drawables/RectangleStatefulDrawable"),o=t("SCENERY/display/Renderer"),h=t("SCENERY/scenery"),l=t("DOT/Vector2"),u=t("SCENERY/display/WebGLSelfDrawable"),c=new i("transparent");return h.register("RectangleWebGLDrawable",e),n(u,e,{webglRenderer:o.webglVertexColorPolygons,onAddToBlock:function(t){this.webglBlock=t,this.markDirty()},onRemoveFromBlock:function(t){},markTransformDirty:function(){this.transformDirty=!0,u.prototype.markTransformDirty.call(this)},update:function(){if(!u.prototype.update.call(this))return!1;if(this.dirtyFill&&(this.includeVertices=this.node.hasFill(),this.includeVertices))for(var t=this.node.fill instanceof r?this.node.fill.value:this.node.fill,e=c.set(t),i=e.red/255,n=e.green/255,s=e.blue/255,a=e.alpha,o=0;o<6;o++){var h=6*o;this.vertexArray[2+h]=i,this.vertexArray[3+h]=n,this.vertexArray[4+h]=s,this.vertexArray[5+h]=a}if(this.transformDirty||this.dirtyX||this.dirtyY||this.dirtyWidth||this.dirtyHeight){this.transformDirty=!1;var l=this.node._rectX,d=this.node._rectY,f=this.node._rectWidth,m=this.node._rectHeight,p=this.instance.relativeTransform.matrix;p.multiplyVector2(this.upperLeft.setXY(l,d)),p.multiplyVector2(this.lowerLeft.setXY(l,d+m)),p.multiplyVector2(this.upperRight.setXY(l+f,d)),p.multiplyVector2(this.lowerRight.setXY(l+f,d+m)),this.vertexArray[0]=this.upperLeft.x,this.vertexArray[1]=this.upperLeft.y,this.vertexArray[6]=this.lowerLeft.x,this.vertexArray[7]=this.lowerLeft.y,this.vertexArray[12]=this.upperRight.x,this.vertexArray[13]=this.upperRight.y,this.vertexArray[18]=this.upperRight.x,this.vertexArray[19]=this.upperRight.y,this.vertexArray[24]=this.lowerLeft.x,this.vertexArray[25]=this.lowerLeft.y,this.vertexArray[30]=this.lowerRight.x,this.vertexArray[31]=this.lowerRight.y}return this.setToCleanState(),this.cleanPaintableState(),!0},dispose:function(){this.disposeState(),u.prototype.dispose.call(this)}}),a.mixInto(e),s.mixInto(e),e}),i("SCENERY/display/drawables/TextCanvasDrawable",["require","SCENERY/display/CanvasSelfDrawable","PHET_CORE/inherit","SCENERY/display/drawables/PaintableStatelessDrawable","PHET_CORE/Poolable","SCENERY/scenery"],function(t){"use strict";function e(t,e){this.initializeCanvasSelfDrawable(t,e),this.initializePaintableStateless(t,e)}var i=t("SCENERY/display/CanvasSelfDrawable"),n=t("PHET_CORE/inherit"),s=t("SCENERY/display/drawables/PaintableStatelessDrawable"),r=t("PHET_CORE/Poolable");return t("SCENERY/scenery").register("TextCanvasDrawable",e),n(i,e,{paintCanvas:function(t,e,i){var n=t.context;(e.hasFill()||e.hasPaintableStroke())&&(t.setFont(e._font.getFont()),t.setDirection("ltr")),e.hasFill()&&(e.beforeCanvasFill(t),n.fillText(e.renderedText,0,0),e.afterCanvasFill(t)),e.hasPaintableStroke()&&(e.beforeCanvasStroke(t),n.strokeText(e.renderedText,0,0),e.afterCanvasStroke(t))},markDirtyText:function(){this.markPaintDirty()},markDirtyFont:function(){this.markPaintDirty()},markDirtyBounds:function(){this.markPaintDirty()},dispose:function(){i.prototype.dispose.call(this),this.disposePaintableStateless()}}),s.mixInto(e),r.mixInto(e),e}),i("SCENERY/display/drawables/TextStatefulDrawable",["require","PHET_CORE/inheritance","SCENERY/display/drawables/PaintableStatefulDrawable","SCENERY/scenery","SCENERY/display/SelfDrawable"],function(t){"use strict";t("PHET_CORE/inheritance");var e=t("SCENERY/display/drawables/PaintableStatefulDrawable"),i=t("SCENERY/scenery"),n=(t("SCENERY/display/SelfDrawable"),{mixInto:function(t){var i=t.prototype;i.initializeState=function(t,e){return this.paintDirty=!0,this.dirtyText=!0,this.dirtyFont=!0,this.dirtyBounds=!0,this.initializePaintableState(t,e),this},i.disposeState=function(){this.disposePaintableState()},i.markPaintDirty=function(){this.paintDirty=!0,this.markDirty()},i.markDirtyText=function(){this.dirtyText=!0,this.markPaintDirty()},i.markDirtyFont=function(){this.dirtyFont=!0,this.markPaintDirty()},i.markDirtyBounds=function(){this.dirtyBounds=!0,this.markPaintDirty()},i.setToCleanState=function(){this.paintDirty=!1,this.dirtyText=!1,this.dirtyFont=!1,this.dirtyBounds=!1},e.mixInto(t)}});return i.register("TextStatefulDrawable",n),n}),i("SCENERY/display/drawables/TextDOMDrawable",["require","SCENERY/display/DOMSelfDrawable","PHET_CORE/inherit","DOT/Matrix3","PHET_CORE/Poolable","SCENERY/scenery","SCENERY/display/drawables/TextStatefulDrawable","SCENERY/util/Util"],function(t){"use strict";function e(t,e){this.initializeDOMSelfDrawable(t,e),this.initializeState(t,e),this.domElement||(this.domElement=document.createElement("div"),this.domElement.style.display="block",this.domElement.style.position="absolute",this.domElement.style.pointerEvents="none",this.domElement.style.left="0",this.domElement.style.top="0",this.domElement.setAttribute("dir","ltr")),a.Util.prepareForTransform(this.domElement,this.forceAcceleration)}var i=t("SCENERY/display/DOMSelfDrawable"),n=t("PHET_CORE/inherit"),s=t("DOT/Matrix3"),r=t("PHET_CORE/Poolable"),a=t("SCENERY/scenery"),o=t("SCENERY/display/drawables/TextStatefulDrawable");t("SCENERY/util/Util");var h=s.dirtyFromPool();return a.register("TextDOMDrawable",e),n(i,e,{updateDOM:function(){var t=this.node,e=this.domElement;if(this.paintDirty&&(this.dirtyFont&&(e.style.font=t.getFont()),this.dirtyStroke&&(e.style.color=t.getCSSFill()),this.dirtyBounds&&(e.style.width=t.getSelfBounds().width+"px",e.style.height=t.getSelfBounds().height+"px"),this.dirtyText&&(e.textContent=t.renderedText)),this.transformDirty||this.dirtyText||this.dirtyFont||this.dirtyBounds){var i=t.getSelfBounds().minY;h.set(this.getTransformMatrix());var n=s.translation(0,i);h.multiplyMatrix(n),n.freeToPool(),a.Util.applyPreparedTransform(h,e,this.forceAcceleration)}this.setToCleanState(),this.cleanPaintableState(),this.transformDirty=!1},dispose:function(){this.disposeState(),i.prototype.dispose.call(this)}}),o.mixInto(e),r.mixInto(e),e}),i("SCENERY/display/drawables/TextSVGDrawable",["require","PHET_CORE/inherit","PHET_CORE/platform","PHET_CORE/Poolable","SCENERY/scenery","SCENERY/display/SVGSelfDrawable","SCENERY/display/drawables/TextStatefulDrawable"],function(t){"use strict";function e(t,e){if(this.initializeSVGSelfDrawable(t,e,!0,h),!this.svgElement){var i=this.svgElement=document.createElementNS(r.svgns,"text");i.appendChild(document.createTextNode("")),i.setAttribute("dominant-baseline","alphabetic"),i.setAttribute("text-rendering","geometricPrecision"),l&&i.setAttribute("lengthAdjust","spacingAndGlyphs"),i.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),i.setAttribute("direction","ltr")}}var i=t("PHET_CORE/inherit"),n=t("PHET_CORE/platform"),s=t("PHET_CORE/Poolable"),r=t("SCENERY/scenery"),a=t("SCENERY/display/SVGSelfDrawable"),o=t("SCENERY/display/drawables/TextStatefulDrawable"),h=!0,l=!n.ie&&!n.edge;return r.register("TextSVGDrawable",e),i(a,e,{updateSVGSelf:function(){var t=this.svgElement;this.dirtyFont&&(t.setAttribute("font-family",this.node._font.getFamily()),t.setAttribute("font-size",this.node._font.getSize()),t.setAttribute("font-style",this.node._font.getStyle()),t.setAttribute("font-weight",this.node._font.getWeight()),t.setAttribute("font-stretch",this.node._font.getStretch())),this.dirtyText&&(t.lastChild.nodeValue=this.node.renderedText),this.dirtyBounds&&l&&isFinite(this.node.selfBounds.width)&&t.setAttribute("textLength",this.node.selfBounds.width),this.updateFillStrokeStyle(t)}}),o.mixInto(e),s.mixInto(e),e}),i("SCENERY/display/drawables/WebGLNodeDrawable",["require","PHET_CORE/inherit","PHET_CORE/Poolable","SCENERY/display/Renderer","SCENERY/scenery","SCENERY/display/WebGLSelfDrawable"],function(t){"use strict";function e(t,e){this.contextChangeListener=this.onWebGLContextChange.bind(this),this.painter=null,this.initializeWebGLSelfDrawable(t,e)}var i=t("PHET_CORE/inherit"),n=t("PHET_CORE/Poolable"),s=t("SCENERY/display/Renderer"),r=t("SCENERY/scenery"),a=t("SCENERY/display/WebGLSelfDrawable");return r.register("WebGLNodeDrawable",e),i(a,e,{webglRenderer:s.webglCustom,createPainter:function(){return new(0,this.node.painterType)(this.webGLBlock.gl,this.node)},onWebGLContextChange:function(){this.painter=this.createPainter()},onAddToBlock:function(t){this.webGLBlock=t,this.painter=this.createPainter(),t.glChangedEmitter.addListener(this.contextChangeListener)},onRemoveFromBlock:function(t){t.glChangedEmitter.removeListener(this.contextChangeListener)},draw:function(){var t=this.instance.relativeTransform.matrix,e=this.painter.paint(t,this.webGLBlock.projectionMatrix);return e},dispose:function(){this.painter.dispose(),this.painter=null,this.webGLBlock&&(this.webGLBlock=null),a.prototype.dispose.call(this)},markPaintDirty:function(){this.markDirty()},get shaderAttributes(){return this.node.shaderAttributes}}),n.mixInto(e),e}),i("SCENERY/input/ButtonListenerIO",["require","TANDEM/types/ObjectIO","TANDEM/phetioInherit","SCENERY/scenery"],function(t){"use strict";function e(t,e){i.call(this,t,e)}var i=t("TANDEM/types/ObjectIO"),n=t("TANDEM/phetioInherit"),s=t("SCENERY/scenery");return n(i,"ButtonListenerIO",e,{},{documentation:"Button listener",events:["up","over","down","out","fire"],validator:{valueType:s.ButtonListener}}),s.register("ButtonListenerIO",e),e}),i("SCENERY/input/DownUpListener",["require","PHET_CORE/inherit","SCENERY/input/Mouse","TANDEM/PhetioObject","SCENERY/scenery","SCENERY/util/Trail","SCENERY/util/Trail"],function(t){"use strict";function e(t){var e=this;t=_.extend({mouseButton:0},t),s.call(this,t),this.options=t,this.isDown=!1,this.downCurrentTarget=null,this.downTrail=null,this.pointer=null,this.interrupted=!1,this.downListener={up:function(t){t.pointer instanceof n&&t.domEvent.button!==e.options.mouseButton||e.buttonUp(t)},cancel:function(t){e.buttonUp(t)}}}var i=t("PHET_CORE/inherit"),n=t("SCENERY/input/Mouse"),s=t("TANDEM/PhetioObject"),r=t("SCENERY/scenery"),a=t("SCENERY/util/Trail");return t("SCENERY/util/Trail"),r.register("DownUpListener",e),i(s,e,{buttonDown:function(t){this.isDown||t.pointer instanceof n&&t.domEvent.button!==this.options.mouseButton||(t.pointer.addInputListener(this.downListener),this.isDown=!0,this.downCurrentTarget=t.currentTarget,this.downTrail=t.trail.subtrailTo(t.currentTarget,!1),this.pointer=t.pointer,this.options.down&&this.options.down(t,this.downTrail))},buttonUp:function(t){this.isDown=!1,this.pointer.removeInputListener(this.downListener);var e=t.currentTarget;if(t.currentTarget=this.downCurrentTarget,this.options.upInside||this.options.upOutside){var i=t.trail.isExtensionOf(this.downTrail,!0)&&!this.interrupted;i&&this.options.upInside?this.options.upInside(t,this.downTrail):!i&&this.options.upOutside&&this.options.upOutside(t,this.downTrail)}this.options.up&&this.options.up(t,this.downTrail),t.currentTarget=e},down:function(t){this.buttonDown(t)},interrupt:function(){this.isDown&&(this.interrupted=!0,this.buttonUp({trail:new a,currentTarget:this.downCurrentTarget,pointer:this.pointer}),this.interrupted=!1)}}),e}),i("SCENERY/input/ButtonListener",["require","SCENERY/input/ButtonListenerIO","SCENERY/input/DownUpListener","PHET_CORE/inherit","TANDEM/PhetioObject","SCENERY/scenery","TANDEM/Tandem"],function(t){"use strict";function e(t){var e=this;t=_.extend({tandem:o.optional,phetioType:i,phetioState:!1,phetioEventType:r.EventType.USER},t),this.buttonState="up",this._overCount=0,this._buttonOptions=t,n.call(this,{tandem:t.tandem,phetioType:t.phetioType,phetioState:t.phetioState,mouseButton:t.mouseButton||0,down:function(t,i){t.pointer.isKey&&e.enter(t),e.setButtonState(t,"down")},up:function(t,i){e.setButtonState(t,e._overCount>0?"over":"up"),t.pointer.isKey&&e.exit(t)}})}var i=t("SCENERY/input/ButtonListenerIO"),n=t("SCENERY/input/DownUpListener"),s=t("PHET_CORE/inherit"),r=t("TANDEM/PhetioObject"),a=t("SCENERY/scenery"),o=t("TANDEM/Tandem");return a.register("ButtonListener",e),s(n,e,{setButtonState:function(t,e){if(e!==this.buttonState){var i=this.buttonState;this.buttonState=e,this._buttonOptions[e]&&(this.phetioStartEvent(e),this._buttonOptions[e](t,i),this.phetioEndEvent()),this._buttonOptions.fire&&this._overCount>0&&(this._buttonOptions.fireOnDown?"down"===e:"down"===i)&&(this.phetioStartEvent("fire"),this._buttonOptions.fire(t),this.phetioEndEvent())}},enter:function(t){this._overCount++,1===this._overCount&&this.setButtonState(t,this.isDown?"down":"over")},exit:function(t){this._overCount--,0===this._overCount&&this.setButtonState(t,this.isDown?"out":"up")}}),e}),i("SCENERY/input/SimpleDragHandler",["require","AXON/BooleanProperty","AXON/Emitter","AXON/EmitterIO","SCENERY/input/Event","PHET_CORE/inherit","SCENERY/input/Mouse","TANDEM/PhetioObject","SCENERY/scenery","TANDEM/Tandem","SCENERY/input/Touch","DOT/Vector2","DOT/Vector2IO","TANDEM/types/VoidIO"],function(t){"use strict";function e(t){var e=this;t=_.extend({start:null,drag:null,end:null,translate:null,allowTouchSnag:!1,mouseButton:0,dragCursor:"pointer",attach:!1,tandem:u.required,phetioState:!1,phetioEventType:h.EventType.USER},t),this.options=t,this.isDraggingProperty=new i(!1,{phetioReadOnly:!0,phetioState:!1,tandem:t.tandem.createTandem("isDraggingProperty"),phetioDocumentation:"Indicates whether the object is dragging"}),this.pointer=null,this.trail=null,this.transform=null,this.node=null,this.lastDragPoint=null,this.startTransformMatrix=null,this.mouseButton=void 0,this.interrupted=!1,this.lastInterruptedTouchPointer=null,this.dragStartedEmitter=new n({tandem:t.tandem.createTandem("dragStartedEmitter"),phetioType:s([{name:"point",type:f,documentation:"the position of the drag start in view coordinates"},{name:"event",type:m,documentation:"the scenery pointer Event",validator:{isValidValue:function(t){return null===t||t instanceof r}}}]),first:function(t,i){e.dragging||(i.pointer.dragging=!0,i.pointer.cursor=e.options.dragCursor,i.pointer.addInputListener(e.dragListener,e.options.attach),e.isDraggingProperty.set(!0),e.pointer=i.pointer,e.trail=i.trail.subtrailTo(i.currentTarget,!0),e.transform=e.trail.getTransform(),e.node=i.currentTarget,e.lastDragPoint=i.pointer.point,e.startTransformMatrix=i.currentTarget.getMatrix().copy(),e.mouseButton=i.pointer instanceof o?i.domEvent.button:void 0,e.options.start&&e.options.start.call(null,i,e.trail))}}),this.draggedEmitter=new n({phetioHighFrequency:!0,tandem:t.tandem.createTandem("draggedEmitter"),phetioType:s([{name:"point",type:f,documentation:"the position of the drag in view coordinates"},{name:"event",type:m,documentation:"the scenery pointer Event",validator:{isValidValue:function(t){return null===t||t instanceof r}}}]),first:function(t,i){if(e.dragging&&!e.isDisposed){var n=e.pointer.point.minus(e.lastDragPoint);if(0!==n.magnitudeSquared()){var s=e.transform.inverseDelta2(n);if(e.options.translate){var r=e.node.getMatrix().getTranslation();e.options.translate.call(null,{delta:s,oldPosition:r,position:r.plus(s)})}if(e.lastDragPoint=e.pointer.point,e.options.drag){var a=i.currentTarget;i.currentTarget=e.node,e.options.drag.call(null,i,e.trail),i.currentTarget=a}}}}}),this.dragEndedEmitter=new n({tandem:t.tandem.createTandem("dragEndedEmitter"),phetioType:s([{name:"point",type:f,documentation:"the position of the drag end in view coordinates"},{name:"event",type:m,documentation:"the scenery pointer Event",validator:{isValidValue:function(t){return null===t||t instanceof r||t.pointer&&t.currentTarget}}}]),first:function(t,i){e.dragging&&(e.pointer.dragging=!1,e.pointer.cursor=null,e.pointer.removeInputListener(e.dragListener),e.isDraggingProperty.set(!1),e.options.end&&e.options.end.call(null,i,e.trail),e.pointer=null)}}),this.transformListener={transform:function(t){if(e.trail.isExtensionOf(t.trail,!0)){var i=t.trail.getMatrix(),n=e.transform.getMatrix();e.node.prependMatrix(i.inverted().timesMatrix(n)),e.transform.setMatrix(i)}}},this.dragListener={up:function(t){if(e.dragging&&!e.isDisposed&&(!(t.pointer instanceof o)||t.domEvent.button===e.mouseButton)){var i=t.currentTarget;t.currentTarget=e.node,e.endDrag(t),t.currentTarget=i}},cancel:function(t){if(e.dragging&&!e.isDisposed){var i=t.currentTarget;t.currentTarget=e.node,e.endDrag(t),t.currentTarget=i,e.transform||e.node.setMatrix(e.startTransformMatrix)}},move:function(t){e.draggedEmitter.emit(t.pointer.point,t)}},h.call(this,t)}var i=t("AXON/BooleanProperty"),n=t("AXON/Emitter"),s=t("AXON/EmitterIO"),r=t("SCENERY/input/Event"),a=t("PHET_CORE/inherit"),o=t("SCENERY/input/Mouse"),h=t("TANDEM/PhetioObject"),l=t("SCENERY/scenery"),u=t("TANDEM/Tandem"),c=t("SCENERY/input/Touch"),d=t("DOT/Vector2"),f=t("DOT/Vector2IO"),m=t("TANDEM/types/VoidIO");return l.register("SimpleDragHandler",e),a(h,e,{get dragging(){return this.isDraggingProperty.get()},set dragging(t){},startDrag:function(t){this.dragStartedEmitter.emit(t.pointer.point,t)},endDrag:function(t){this.dragEndedEmitter.emit(t?t.pointer.point:d.ZERO,t)},interrupt:function(){this.dragging&&(this.interrupted=!0,this.pointer instanceof c&&(this.lastInterruptedTouchPointer=this.pointer),this.endDrag({pointer:this.pointer,currentTarget:this.node}),this.interrupted=!1)},tryToSnag:function(t){t.pointer instanceof o&&t.domEvent&&this.options.mouseButton!==t.domEvent.button&&-1!==this.options.mouseButton||this.isDisposed||this.dragging||t.pointer.dragging||t.pointer===this.lastInterruptedTouchPointer||!t.canStartPress()||this.startDrag(t)},tryTouchToSnag:function(t){this.options.allowTouchSnag&&(!0===this.options.allowTouchSnag||this.options.allowTouchSnag(t))&&this.tryToSnag(t)},down:function(t){this.tryToSnag(t)},touchenter:function(t){this.tryTouchToSnag(t)},touchmove:function(t){this.tryTouchToSnag(t)},dispose:function(){this.dragging&&(this.pointer.dragging=!1,this.pointer.cursor=null,this.pointer.removeInputListener(this.dragListener)),this.isDraggingProperty.dispose(),this.dragEndedEmitter.dispose(),this.draggedEmitter.dispose(),this.dragStartedEmitter.dispose(),h.prototype.dispose.call(this)}},{createForwardingListener:function(t,e){return e=_.extend({allowTouchSnag:!1},e),{down:function(e){!e.pointer.dragging&&e.canStartPress()&&t(e)},touchenter:function(t){e.allowTouchSnag&&this.down(t)},touchmove:function(t){e.allowTouchSnag&&this.down(t)}}}})}),i("SCENERY/input/EventIO",["require","TANDEM/types/ObjectIO","TANDEM/phetioInherit","SCENERY/scenery","DOT/Vector2IO","SCENERY/input/Event","AXON/validate"],function(t){"use strict";function e(t,e){i.call(this,t,e)}var i=t("TANDEM/types/ObjectIO"),n=t("TANDEM/phetioInherit"),s=t("SCENERY/scenery"),r=t("DOT/Vector2IO"),a=t("SCENERY/input/Event"),o=t("AXON/validate");return n(i,"EventIO",e,{},{get documentation(){return"An event, with a point"},validator:{valueType:a},toStateObject:function(t){o(t,this.validator);var e={type:t.type,domEventType:t.domEvent.type};return t.pointer&&t.pointer.point&&(e.point=r.toStateObject(t.pointer.point)),e}}),s.register("EventIO",e)}),i("SCENERY/listeners/PressListener",["require","AXON/BooleanProperty","AXON/DerivedProperty","AXON/Emitter","AXON/EmitterIO","SCENERY/input/EventIO","PHET_CORE/inherit","SCENERY/input/Mouse","SCENERY/nodes/Node","TANDEM/types/NullableIO","AXON/ObservableArray","TANDEM/PhetioObject","SCENERY/scenery","TANDEM/Tandem","AXON/timer","TANDEM/types/VoidIO"],function(t){"use strict";function e(t){var e=this;t=_.extend({mouseButton:0,pressCursor:"pointer",press:_.noop,release:_.noop,drag:_.noop,targetNode:null,attach:!0,canStartPress:b,a11yLooksPressedInterval:100,tandem:m.required,phetioReadOnly:d.DEFAULT_OPTIONS.phetioReadOnly,phetioFeatured:d.DEFAULT_OPTIONS.phetioFeatured},t),this._id=v++,this._mouseButton=t.mouseButton,this._a11yLooksPressedInterval=t.a11yLooksPressedInterval,this._pressCursor=t.pressCursor,this._pressListener=t.press,this._releaseListener=t.release,this._dragListener=t.drag,this._canStartPress=t.canStartPress,this._targetNode=t.targetNode,this._attach=t.attach,this.overPointers=new c,this.isPressedProperty=new i(!1,{reentrant:!0}),this.isOverProperty=new i(!1),this.isHoveringProperty=new i(!1),this.isHighlightedProperty=new i(!1),this.isFocusedProperty=new i(!1),this.pointer=null,this.pressedTrail=null,this.interrupted=!1,this._listeningToPointer=!1,this._isHoveringListener=this.invalidateHovering.bind(this),this._isHighlightedListener=this.invalidateHighlighted.bind(this),this.a11yClickingProperty=new i(!1),this.looksPressedProperty=n.or([this.a11yClickingProperty,this.isPressedProperty]),this._a11yClickingTimeoutListener=null,this._pointerListener={up:this.pointerUp.bind(this),cancel:this.pointerCancel.bind(this),move:this.pointerMove.bind(this),interrupt:this.pointerInterrupt.bind(this)},this._pressedEmitter=new s({tandem:t.tandem.createTandem("pressedEmitter"),phetioDocumentation:"Emits whenever a press occurs. The first argument when emitting can be used to convey info about the Event.",phetioReadOnly:t.phetioReadOnly,phetioFeatured:t.phetioFeatured,phetioEventType:d.EventType.USER,phetioType:y,first:this.onPress.bind(this)}),this._releasedEmitter=new s({tandem:t.tandem.createTandem("releasedEmitter"),phetioDocumentation:"Emits whenever a release occurs.",phetioReadOnly:t.phetioReadOnly,phetioFeatured:t.phetioFeatured,phetioEventType:d.EventType.USER,phetioType:E,first:this.onRelease.bind(this)}),this.overPointers.lengthProperty.link(this.invalidateOver.bind(this)),this.isFocusedProperty.link(this.invalidateOver.bind(this)),this.overPointers.lengthProperty.link(this._isHoveringListener),this.isPressedProperty.link(this._isHoveringListener),this.overPointers.addItemAddedListener(function(t){t.isDownProperty.link(e._isHoveringListener)}),this.overPointers.addItemRemovedListener(function(t){t.isDownProperty.unlink(e._isHoveringListener)}),this.isHoveringProperty.link(this._isHighlightedListener),this.isPressedProperty.link(this._isHighlightedListener)}var i=t("AXON/BooleanProperty"),n=t("AXON/DerivedProperty"),s=t("AXON/Emitter"),r=t("AXON/EmitterIO"),a=t("SCENERY/input/EventIO"),o=t("PHET_CORE/inherit"),h=t("SCENERY/input/Mouse"),l=t("SCENERY/nodes/Node"),u=t("TANDEM/types/NullableIO"),c=t("AXON/ObservableArray"),d=t("TANDEM/PhetioObject"),f=t("SCENERY/scenery"),m=t("TANDEM/Tandem"),p=t("AXON/timer"),g=t("TANDEM/types/VoidIO"),v=0,y=r([{name:"event",type:a},{name:"targetNode",type:g,validator:{isValidValue:function(t){return null===t||t instanceof l}}},{name:"callback",type:g,validator:{isValidValue:function(t){return null===t||"function"==typeof t}}}]),E=r([{name:"event",type:u(a)},{name:"callback",type:g,validator:{isValidValue:function(t){return null===t||"function"==typeof t}}}]),b=_.constant(!0);return f.register("PressListener",e),o(Object,e,{get isPressed(){return this.isPressedProperty.value},getCurrentTarget:function(){return this.pressedTrail.lastNode()},canPress:function(t){return!this.isPressed&&this._canStartPress(t,this)&&(!(t.pointer instanceof h)||t.domEvent.button===this._mouseButton)&&(!this._attach||!t.pointer.isAttached())},canClick:function(){return!this.isPressed&&this._canStartPress(null,this)},press:function(t,e,i){return!!this.canPress(t)&&(this._pressedEmitter.emit(t,e||null,i||null),!0)},release:function(t,e){this._releasedEmitter.emit(t||null,e||null)},drag:function(t){this._dragListener(t,this)},interrupt:function(){this.a11yClickingProperty.value?(this.interrupted=!0,p.hasListener(this._a11yClickingTimeoutListener)&&(p.clearTimeout(this._a11yClickingTimeoutListener),this.a11yClickingProperty.value=!1)):this.isPressed&&(this.interrupted=!0,this.release())},invalidateOver:function(){this.isOverProperty.value=this.isFocusedProperty.value||this.overPointers.length>0},invalidateHovering:function(){for(var t=this.overPointers.getArray(),e=0;e<t.length;e++){var i=t[e];if(!i.isDown||i===this.pointer)return void(this.isHoveringProperty.value=!0)}this.isHoveringProperty.value=!1},invalidateHighlighted:function(){this.isHighlightedProperty.value=this.isHoveringProperty.value||this.isPressedProperty.value},onPress:function(t,e,i){e=e||this._targetNode,this.pointer=t.pointer,this.pressedTrail=e?e.getUniqueTrail():t.trail.subtrailTo(t.currentTarget,!1),this.interrupted=!1,this.pointer.addInputListener(this._pointerListener,this._attach),this._listeningToPointer=!0,this.pointer.cursor=this._pressCursor,this.isPressedProperty.value=!0,this._pressListener(t,this),i&&i()},onRelease:function(t,e){this.pointer.removeInputListener(this._pointerListener),this._listeningToPointer=!1,this.pointer.cursor=null,this.pointer=null,this.pressedTrail=null,this.isPressedProperty.value=!1,this._releaseListener(t,this),e&&e()},down:function(t){this.press(t)},enter:function(t){this.overPointers.push(t.pointer)},exit:function(t){this.overPointers.remove(t.pointer)},pointerUp:function(t){this.isPressed&&this.release(t)},pointerCancel:function(t){this.isPressed&&this.interrupt()},pointerMove:function(t){this.isPressed&&this.drag(t)},pointerInterrupt:function(){this.interrupt()},click:function(t){if(this.canClick())if(this.interrupted=!1,this.a11yClickingProperty.value=!0,this.isFocusedProperty.value=!0,this.isPressedProperty.value=!0,this._pressListener(t,this),this.isPressedProperty.value=!1,this._releaseListener(t,this),this.interrupted)this.a11yClickingProperty.value=!1;else{p.clearTimeout(this._a11yClickingTimeoutListener);var e=this;this._a11yClickingTimeoutListener=p.setTimeout(function(){e.a11yClickingProperty.value=!1},this._a11yLooksPressedInterval)}},focus:function(){this.isFocusedProperty.value=!0},blur:function(){this.isFocusedProperty.value=!1},dispose:function(){this.overPointers.clear(),this._listeningToPointer&&this.pointer.removeInputListener(this._pointerListener),this.isPressedProperty.isDisposed||(this.isPressedProperty.unlink(this._isHighlightedListener),this.isPressedProperty.unlink(this._isHoveringListener)),!this.isHoveringProperty.isDisposed&&this.isHoveringProperty.unlink(this._isHighlightedListener),this.a11yClickingProperty.dispose(),this.looksPressedProperty.dispose(),this._pressedEmitter.dispose(),this._releasedEmitter.dispose()}}),e}),i("SCENERY/listeners/DragListener",["require","DOT/Bounds2","AXON/Emitter","AXON/EmitterIO","SCENERY/input/EventIO","PHET_CORE/inherit","TANDEM/PhetioObject","SCENERY/listeners/PressListener","AXON/Property","SCENERY/scenery","TANDEM/Tandem","SCENERY/input/Touch","DOT/Transform3","SCENERY/util/TransformTracker","DOT/Vector2"],function(t){"use strict";function e(t){var e=this;t=_.extend({allowTouchSnag:!0,applyOffset:!0,trackAncestors:!1,translateNode:!1,transform:null,locationProperty:null,dragBoundsProperty:null,mapLocation:null,offsetLocation:null,start:null,end:null,tandem:u.required,phetioReadOnly:a.DEFAULT_OPTIONS.phetioReadOnly,phetioFeatured:a.DEFAULT_OPTIONS.phetioFeatured},t),o.call(this,t),this._allowTouchSnag=t.allowTouchSnag,this._applyOffset=t.applyOffset,this._trackAncestors=t.trackAncestors,this._translateNode=t.translateNode,this._transform=t.transform,this._locationProperty=t.locationProperty,this._mapLocation=t.mapLocation,this._offsetLocation=t.offsetLocation,this._dragBoundsProperty=t.dragBoundsProperty||new h(null),this._start=t.start,this._end=t.end,this.isUserControlledProperty=this.isPressedProperty,this._globalPoint=new f(0,0),this._localPoint=new f(0,0),this._parentPoint=new f(0,0),this._modelPoint=new f(0,0),this._transformTracker=null,this._transformTrackerListener=this.ancestorTransformed.bind(this),this._lastInterruptedTouchPointer=null,this._draggedEmitter=new i({phetioFeatured:t.phetioFeatured,tandem:t.tandem.createTandem("draggedEmitter"),phetioHighFrequency:!0,phetioDocumentation:"Emits whenever a drag occurs with an EventIO argument.",phetioReadOnly:t.phetioReadOnly,phetioEventType:a.EventType.USER,phetioType:p,first:function(t){e._globalPoint.equals(e.pointer.point)||e.reposition(e.pointer.point),o.prototype.drag.call(e,t)}})}t("DOT/Bounds2");var i=t("AXON/Emitter"),n=t("AXON/EmitterIO"),s=t("SCENERY/input/EventIO"),r=t("PHET_CORE/inherit"),a=t("TANDEM/PhetioObject"),o=t("SCENERY/listeners/PressListener"),h=t("AXON/Property"),l=t("SCENERY/scenery"),u=t("TANDEM/Tandem"),c=t("SCENERY/input/Touch"),d=(t("DOT/Transform3"),t("SCENERY/util/TransformTracker")),f=t("DOT/Vector2"),m=new f(0,0),p=n([{name:"event",type:s}]);return l.register("DragListener",e),r(o,e,{press:function(t,e,i){var n=this;return o.prototype.press.call(this,t,e,function(){n.attachTransformTracker(),n.parentToLocalPoint(n.globalToParentPoint(n._localPoint.set(n.pointer.point))),n.reposition(n.pointer.point),n._start&&n._start(t,n),i&&i()})},canClick:function(){return!1},release:function(t,e){var i=this;o.prototype.release.call(this,t,function(){i.detachTransformTracker(),i._end&&i._end(i),e&&e()})},drag:function(t){this._globalPoint.equals(this.pointer.point)||this._draggedEmitter.emit(t)},tryTouchSnag:function(t){this._allowTouchSnag&&!t.pointer.isAttached()&&this.press(t)},getGlobalPoint:function(){return this._globalPoint.copy()},get globalPoint(){return this.getGlobalPoint()},getLocalPoint:function(){return this._localPoint.copy()},get localPoint(){return this.getLocalPoint()},getParentPoint:function(){return this._parentPoint.copy()},get parentPoint(){return this.getParentPoint()},getModelPoint:function(){return this._modelPoint.copy()},get modelPoint(){return this.getModelPoint()},globalToParentPoint:function(t){return this.pressedTrail.getParentTransform().getInverse().multiplyVector2(t),t},parentToLocalPoint:function(t){return this.pressedTrail.lastNode().getTransform().getInverse().multiplyVector2(t),t},localToParentPoint:function(t){return this.pressedTrail.lastNode().getMatrix().multiplyVector2(t),t},parentToModelPoint:function(t){return this._transform&&this._transform.getInverse().multiplyVector2(t),t},modelToParentPoint:function(t){return this._transform&&this._transform.getMatrix().multiplyVector2(t),t},mapModelPoint:function(t){return this._mapLocation?this._mapLocation(t):this._dragBoundsProperty.value?this._dragBoundsProperty.value.closestPointTo(t):t},applyParentOffset:function(t){this._offsetLocation&&t.add(this._offsetLocation(t,this)),this._applyOffset&&(t.subtract(this.localToParentPoint(m.set(this._localPoint))),t.add(this.localToParentPoint(m.setXY(0,0))))},reposition:function(t){this._globalPoint.set(t),this.applyParentOffset(this.globalToParentPoint(this._parentPoint.set(t))),this._modelPoint=this.mapModelPoint(this.parentToModelPoint(m.set(this._parentPoint))),this.modelToParentPoint(this._parentPoint.set(this._modelPoint)),this._translateNode&&(this.pressedTrail.lastNode().translation=this._parentPoint),this._locationProperty&&(this._locationProperty.value=this._modelPoint.copy())},touchenter:function(t){this.tryTouchSnag(t)},touchmove:function(t){this.tryTouchSnag(t)},ancestorTransformed:function(){this.reposition(this.pointer.point)},attachTransformTracker:function(){this._trackAncestors&&(this._transformTracker=new d(this.pressedTrail.copy().removeDescendant()),this._transformTracker.addListener(this._transformTrackerListener))},detachTransformTracker:function(){this._transformTracker&&(this._transformTracker.removeListener(this._transformTrackerListener),this._transformTracker.dispose(),this._transformTracker=null)},setDragBounds:function(t){this._dragBoundsProperty.value=t},set dragBounds(t){this.setDragBounds(t)},getDragBounds:function(){return this._dragBoundsProperty.value},get dragBounds(){return this.getDragBounds()},interrupt:function(){this.pointer&&this.pointer instanceof c&&(this._lastInterruptedTouchPointer=this.pointer),o.prototype.interrupt.call(this)},canPress:function(t){return t.pointer!==this._lastInterruptedTouchPointer&&o.prototype.canPress.call(this,t)},dispose:function(){this._draggedEmitter.dispose(),this.detachTransformTracker(),o.prototype.dispose.call(this)}},{createForwardingListener:function(t,e){return e=_.extend({allowTouchSnag:!1},e),{down:function(e){e.canStartPress()&&t(e)},touchenter:function(t){e.allowTouchSnag&&this.down(t)},touchmove:function(t){e.allowTouchSnag&&this.down(t)}}}}),e}),i("SCENERY/listeners/FireListener",["require","AXON/Emitter","PHET_CORE/inherit","TANDEM/PhetioObject","SCENERY/listeners/PressListener","SCENERY/scenery","TANDEM/Tandem"],function(t){"use strict";function e(t){t=_.extend({fire:_.noop,fireOnDown:!1,tandem:o.required},t),r.call(this,t),this._fireOnDown=t.fireOnDown,this.firedEmitter=new i({tandem:t.tandem.createTandem("firedEmitter"),phetioEventType:s.EventType.USER}),this.firedEmitter.addListener(t.fire)}var i=t("AXON/Emitter"),n=t("PHET_CORE/inherit"),s=t("TANDEM/PhetioObject"),r=t("SCENERY/listeners/PressListener"),a=t("SCENERY/scenery"),o=t("TANDEM/Tandem");return a.register("FireListener",e),n(r,e,{fire:function(t){this.firedEmitter.emit()},press:function(t,e,i){var n=this;return r.prototype.press.call(this,t,e,function(){n._fireOnDown&&n.fire(t),i&&i()})},release:function(t,e){var i=this;r.prototype.release.call(this,t,function(){i._fireOnDown||!i.isHoveringProperty.value||i.interrupted||i.fire(),e&&e()})},dispose:function(){this.firedEmitter.dispose(),r.prototype.dispose.call(this)}}),e}),i("SCENERY/listeners/HandleDownListener",["require","PHET_CORE/inherit","SCENERY/scenery"],function(t){"use strict";function e(){}var i=t("PHET_CORE/inherit");return t("SCENERY/scenery").register("HandleDownlistener",e),i(Object,e,{down:function(t){t.handle()}}),e}),i("SCENERY/listeners/MultiListener",["require","PHET_CORE/arrayRemove","PHET_CORE/inherit","DOT/Matrix","DOT/Matrix3","SCENERY/input/Mouse","SCENERY/scenery","DOT/SingularValueDecomposition","DOT/Vector2"],function(t){"use strict";function e(t,e){var i=this;e=_.extend({mouseButton:0,pressCursor:"pointer",targetNode:null,allowScale:!0,allowRotation:!0,allowMultitouchInterruption:!1},e),this._targetNode=t,this._mouseButton=e.mouseButton,this._pressCursor=e.pressCursor,this._allowScale=e.allowScale,this._allowRotation=e.allowRotation,this._allowMultitouchInterruption=e.allowMultitouchInterruption,this._presses=[],this._backgroundPresses=[],this._pressListener={move:function(t){i.movePress(i.findPress(t.pointer))},up:function(t){i.removePress(i.findPress(t.pointer))},cancel:function(t){var e=i.findPress(t.pointer);e.interrupted=!0,i.removePress(e)},interrupt:function(){i.interrupt()}},this._backgroundListener={up:function(t){i.removeBackgroundPress(i.findBackgroundPress(t.pointer))},cancel:function(t){i.removeBackgroundPress(i.findBackgroundPress(t.pointer))},interrupt:function(){i.removeBackgroundPress(i.findBackgroundPress(event.pointer))}}}function i(t,e){this.pointer=t,this.trail=e,this.interrupted=!1,this.localPoint=null,this.recomputeLocalPoint()}var n=t("PHET_CORE/arrayRemove"),s=t("PHET_CORE/inherit"),r=t("DOT/Matrix"),a=t("DOT/Matrix3"),o=t("SCENERY/input/Mouse"),h=t("SCENERY/scenery"),l=t("DOT/SingularValueDecomposition"),u=t("DOT/Vector2");return h.register("MultiListener",e),s(Object,e,{findPress:function(t){for(var e=0;e<this._presses.length;e++)if(this._presses[e].pointer===t)return this._presses[e];return null},findBackgroundPress:function(t){for(var e=0;e<this._backgroundPresses.length;e++)if(this._backgroundPresses[e].pointer===t)return this._backgroundPresses[e];return null},down:function(t){if(!(t.pointer instanceof o&&t.domEvent.button!==this._mouseButton)){var e=new i(t.pointer,t.trail.subtrailTo(this._targetNode,!1));t.pointer.isAttached()?this._allowMultitouchInterruption&&(this._presses.length||this._backgroundPresses.length?(e.pointer.interruptAttached(),this.addPress(e),this.convertBackgroundPresses()):this.addBackgroundPress(e)):(this.addPress(e),this.convertBackgroundPresses())}},addPress:function(t){this._presses.push(t),t.pointer.cursor=this._pressCursor,t.pointer.addInputListener(this._pressListener,!0),this.recomputeLocals(),this.reposition()},movePress:function(t){this.reposition()},removePress:function(t){t.pointer.removeInputListener(this._pressListener),t.pointer.cursor=null,n(this._presses,t),this.recomputeLocals(),this.reposition()},addBackgroundPress:function(t){this._backgroundPresses.push(t),t.pointer.addInputListener(this._backgroundListener,!1)},removeBackgroundPress:function(t){t.pointer.removeInputListener(this._backgroundListener),n(this._backgroundPresses,t)},convertBackgroundPresses:function(){for(var t=this._backgroundPresses.slice(),e=0;e<t.length;e++){var i=t[e];this.removeBackgroundPress(i),i.pointer.interruptAttached(),this.addPress(i)}},reposition:function(){this._targetNode.matrix=this.computeMatrix()},recomputeLocals:function(){for(var t=0;t<this._presses.length;t++)this._presses[t].recomputeLocalPoint()},interrupt:function(){for(;this._presses.length;)this.removePress(this._presses[this._presses.length-1])},computeMatrix:function(){return 0===this._presses.length?this._targetNode.getMatrix():1===this._presses.length?this.computeSinglePressMatrix():this._allowScale&&this._allowRotation?this.computeTranslationRotationScaleMatrix():this._allowScale?this.computeTranslationScaleMatrix():this._allowRotation?this.computeTranslationRotationMatrix():this.computeTranslationMatrix()},computeSinglePressMatrix:function(){var t=this._presses[0].targetPoint,e=this._targetNode.localToParentPoint(this._presses[0].localPoint),i=t.minus(e);return a.translationFromVector(i).timesMatrix(this._targetNode.getMatrix())},computeTranslationMatrix:function(){for(var t=new u(0,0),e=0;e<this._presses.length;e++)t.add(this._presses[e].targetPoint),t.subtract(this._presses[e].localPoint);return a.translationFromVector(t.dividedScalar(this._presses.length))},computeTranslationScaleMatrix:function(){var t=this._presses.map(function(t){return t.localPoint}),e=this._presses.map(function(t){return t.targetPoint}),i=new u(0,0),n=new u(0,0);t.forEach(function(t){i.add(t)}),e.forEach(function(t){n.add(t)}),i.divideScalar(this._presses.length),n.divideScalar(this._presses.length);var s=0,r=0;t.forEach(function(t){s+=t.distanceSquared(i)}),e.forEach(function(t){r+=t.distanceSquared(n)});var o=Math.sqrt(r/s),h=a.translation(n.x,n.y),l=a.translation(-i.x,-i.y);return h.timesMatrix(a.scaling(o)).timesMatrix(l)},computeTranslationRotationMatrix:function(){var t,e=new r(2,this._presses.length),i=new r(2,this._presses.length),n=new u(0,0),s=new u(0,0);for(t=0;t<this._presses.length;t++){var o=this._presses[t].localPoint,h=this._presses[t].targetPoint;n.add(o),s.add(h),e.set(0,t,o.x),e.set(1,t,o.y),i.set(0,t,h.x),i.set(1,t,h.y)}for(n.divideScalar(this._presses.length),s.divideScalar(this._presses.length),t=0;t<this._presses.length;t++)e.set(0,t,e.get(0,t)-n.x),e.set(1,t,e.get(1,t)-n.y),i.set(0,t,i.get(0,t)-s.x),i.set(1,t,i.get(1,t)-s.y);var c=e.times(i.transpose()),d=new l(c),f=d.getV().times(d.getU().transpose());f.det()<0&&(f=d.getV().times(r.diagonalMatrix([1,-1])).times(d.getU().transpose()));var m=(new a).rowMajor(f.get(0,0),f.get(0,1),0,f.get(1,0),f.get(1,1),0,0,0,1),p=s.minus(m.timesVector2(n));return m.set02(p.x),m.set12(p.y),m},computeTranslationRotationScaleMatrix:function(){var t,e=new r(2*this._presses.length,4);for(t=0;t<this._presses.length;t++){var i=this._presses[t].localPoint;e.set(2*t+0,0,i.x),e.set(2*t+0,1,i.y),e.set(2*t+0,2,1),e.set(2*t+1,0,i.y),e.set(2*t+1,1,-i.x),e.set(2*t+1,3,1)}var n=new r(2*this._presses.length,1);for(t=0;t<this._presses.length;t++){var s=this._presses[t].targetPoint;n.set(2*t+0,0,s.x),n.set(2*t+1,0,s.y)}var o=l.pseudoinverse(e).times(n),h=o.get(0,0),u=o.get(1,0),c=o.get(2,0),d=o.get(3,0);return(new a).rowMajor(h,u,c,-u,h,d,0,0,1)}}),s(Object,i,{recomputeLocalPoint:function(){this.localPoint=this.trail.globalToLocalPoint(this.pointer.point)},get targetPoint(){return this.trail.globalToParentPoint(this.pointer.point)}}),e}),i("SCENERY/listeners/PanZoomListener",["require","PHET_CORE/inherit","SCENERY/listeners/MultiListener","SCENERY/scenery"],function(t){"use strict";function e(t,e,i){i=_.extend({allowScale:!0,allowRotation:!1,pressCursor:null},i),n.call(this,t,i),this._panBounds=e}var i=t("PHET_CORE/inherit"),n=t("SCENERY/listeners/MultiListener");return t("SCENERY/scenery").register("PanZoomListener",e),i(n,e,{reposition:function(){n.prototype.reposition.call(this);var t=this._targetNode.getScaleVector().x;t<1&&this._targetNode.scale(1/t),this._targetNode.left>this._panBounds.left&&(this._targetNode.left=this._panBounds.left),this._targetNode.top>this._panBounds.top&&(this._targetNode.top=this._panBounds.top),this._targetNode.right<this._panBounds.right&&(this._targetNode.right=this._panBounds.right),this._targetNode.bottom<this._panBounds.bottom&&(this._targetNode.bottom=this._panBounds.bottom)}}),e}),i("SCENERY/nodes/AlignBox",["require","DOT/Bounds2","PHET_CORE/inherit","SCENERY/nodes/Node","SCENERY/scenery"],function(t){"use strict";function e(t,e){this._content=t,this._alignBounds=null,this._xAlign="center",this._yAlign="center",this._leftMargin=0,this._rightMargin=0,this._topMargin=0,this._bottomMargin=0,this._group=null,this._contentBoundsListener=this.invalidateAlignment.bind(this),this._layoutLock=!1,this._content.on("bounds",this._contentBoundsListener),s.call(this,_.extend({},e,{children:[this._content]}))}var i=t("DOT/Bounds2"),n=t("PHET_CORE/inherit"),s=t("SCENERY/nodes/Node"),r=t("SCENERY/scenery");return r.register("AlignBox",e),n(s,e,{_mutatorKeys:["alignBounds","xAlign","yAlign","margin","xMargin","yMargin","leftMargin","rightMargin","topMargin","bottomMargin","group"].concat(s.prototype._mutatorKeys),invalidateAlignment:function(){this._group&&this._group.onAlignBoxResized(this),this.updateLayout()},setAlignBounds:function(t){return this._alignBounds===t||t&&this._alignBounds&&t.equals(this._alignBounds)||(this._alignBounds=t,this.updateLayout()),this},set alignBounds(t){this.setAlignBounds(t)},getAlignBounds:function(){return this._alignBounds},get alignBounds(){return this.getAlignBounds()},setGroup:function(t){return this._group!==t&&(this._group&&this._group.removeAlignBox(this),this._group=t,this._group&&this._group.addAlignBox(this)),this},set group(t){this.setGroup(t)},getGroup:function(){return this._group},get group(){return this.getGroup()},setXAlign:function(t){return this._xAlign!==t&&(this._xAlign=t,this.invalidateAlignment()),this},set xAlign(t){this.setXAlign(t)},getXAlign:function(){return this._xAlign},get xAlign(){return this.getXAlign()},setYAlign:function(t){return this._yAlign!==t&&(this._yAlign=t,this.invalidateAlignment()),this},set yAlign(t){this.setYAlign(t)},getYAlign:function(){return this._yAlign},get yAlign(){return this.getYAlign()},setMargin:function(t){return this._leftMargin===t&&this._rightMargin===t&&this._topMargin===t&&this._bottomMargin===t||(this._leftMargin=this._rightMargin=this._topMargin=this._bottomMargin=t,this.invalidateAlignment()),this},set margin(t){this.setMargin(t)},getMargin:function(){return this._leftMargin},get margin(){return this.getMargin()},setXMargin:function(t){return this._leftMargin===t&&this._rightMargin===t||(this._leftMargin=this._rightMargin=t,this.invalidateAlignment()),this},set xMargin(t){this.setXMargin(t)},getXMargin:function(){return this._leftMargin},get xMargin(){return this.getXMargin()},setYMargin:function(t){return this._topMargin===t&&this._bottomMargin===t||(this._topMargin=this._bottomMargin=t,this.invalidateAlignment()),this},set yMargin(t){this.setYMargin(t)},getYMargin:function(){return this._topMargin},get yMargin(){return this.getYMargin()},setLeftMargin:function(t){return this._leftMargin!==t&&(this._leftMargin=t,this.invalidateAlignment()),this},set leftMargin(t){this.setLeftMargin(t)},getLeftMargin:function(){return this._leftMargin},get leftMargin(){return this.getLeftMargin()},setRightMargin:function(t){return this._rightMargin!==t&&(this._rightMargin=t,this.invalidateAlignment()),this},set rightMargin(t){this.setRightMargin(t)},getRightMargin:function(){return this._rightMargin},get rightMargin(){return this.getRightMargin()},setTopMargin:function(t){return this._topMargin!==t&&(this._topMargin=t,this.invalidateAlignment()),this},set topMargin(t){this.setTopMargin(t)},getTopMargin:function(){return this._topMargin},get topMargin(){return this.getTopMargin()},setBottomMargin:function(t){return this._bottomMargin!==t&&(this._bottomMargin=t,this.invalidateAlignment()),this},set bottomMargin(t){this.setBottomMargin(t)},getBottomMargin:function(){return this._bottomMargin},get bottomMargin(){return this.getBottomMargin()},getContentBounds:function(){var t=this._content.bounds;return new i(t.left-this._leftMargin,t.top-this._topMargin,t.right+this._rightMargin,t.bottom+this._bottomMargin)},updateProperty:function(t,e){var i=this._content[t],n=this.localBounds[t]+e;Math.abs(i-n)>1e-5&&(this._content[t]=n)},updateLayout:function(){if(!this._layoutLock){if(this._layoutLock=!0,null!==this._alignBounds)this.localBounds=this._alignBounds;else{var t=this._leftMargin+this._content.width+this._rightMargin,e=this._topMargin+this._content.height+this._bottomMargin;this.localBounds=new i(0,0,t,e)}this._content.localBounds.isEmpty()||("center"===this._xAlign?this.updateProperty("centerX",(this.leftMargin-this.rightMargin)/2):"left"===this._xAlign?this.updateProperty("left",this._leftMargin):"right"===this._xAlign&&this.updateProperty("right",-this._rightMargin),"center"===this._yAlign?this.updateProperty("centerY",(this.topMargin-this.bottomMargin)/2):"top"===this._yAlign?this.updateProperty("top",this._topMargin):"bottom"===this._yAlign&&this.updateProperty("bottom",-this._bottomMargin)),this._layoutLock=!1}},dispose:function(){this._content.off("bounds",this._contentBoundsListener),this.group=null,s.prototype.dispose.call(this)}}),e}),i("SCENERY/nodes/AlignGroup",["require","SCENERY/nodes/AlignBox","PHET_CORE/arrayRemove","DOT/Bounds2","PHET_CORE/inherit","SCENERY/nodes/Node","AXON/NumberProperty","SCENERY/scenery"],function(t){"use strict";function e(t){t=_.extend({matchHorizontal:!0,matchVertical:!0},t),this._alignBoxes=[],this._matchHorizontal=t.matchHorizontal,this._matchVertical=t.matchVertical,this._resizeLock=!1,this._maxWidthProperty=new a(0),this._maxHeightProperty=new a(0),this.id=o++}var i=t("SCENERY/nodes/AlignBox"),n=t("PHET_CORE/arrayRemove"),s=t("DOT/Bounds2"),r=t("PHET_CORE/inherit"),a=(t("SCENERY/nodes/Node"),t("AXON/NumberProperty")),o=1;return t("SCENERY/scenery").register("AlignGroup",e),r(Object,e,{getMaxWidth:function(){return this._maxWidthProperty.value},get maxWidth(){return this.getMaxWidth()},getMaxWidthProperty:function(){return this._maxWidthProperty},get maxWidthProperty(){return this.getMaxWidthProperty()},getMaxHeight:function(){return this._maxHeightProperty.value},get maxHeight(){return this.getMaxHeight()},getMaxHeightProperty:function(){return this._maxHeightProperty},get maxHeightProperty(){return this.getMaxHeightProperty()},createBox:function(t,e){return new i(t,_.extend({group:this},e))},setMatchHorizontal:function(t){return this._matchHorizontal!==t&&(this._matchHorizontal=t,this.updateLayout()),this},set matchHorizontal(t){this.setMatchHorizontal(t)},getMatchHorizontal:function(){return this._matchHorizontal},get matchHorizontal(){return this.getMatchHorizontal()},setMatchVertical:function(t){return this._matchVertical!==t&&(this._matchVertical=t,this.updateLayout()),this},set matchVertical(t){this.setMatchVertical(t)},getMatchVertical:function(){return this._matchVertical},get matchVertical(){return this.getMatchVertical()},dispose:function(){for(var t=this._alignBoxes.length-1;t>=0;t--)this._alignBoxes[t].dispose()},updateLayout:function(){if(!this._resizeLock){this._resizeLock=!0;for(var t=0,e=0,i=0;i<this._alignBoxes.length;i++){var n=this._alignBoxes[i].getContentBounds();!n.isEmpty()&&n.isFinite()&&(t=Math.max(t,n.width),e=Math.max(e,n.height))}if(this._maxWidthProperty.value=t,this._maxHeightProperty.value=e,t>0&&e>0)for(i=0;i<this._alignBoxes.length;i++)this.setBoxBounds(this._alignBoxes[i],t,e);this._resizeLock=!1}},setBoxBounds:function(t,e,i){var n;if(this._matchVertical&&this._matchHorizontal)n=new s(0,0,e,i);else{var r=t.getContentBounds();n=this._matchVertical?new s(0,0,r.width,i):this._matchHorizontal?new s(0,0,e,r.height):r}t.alignBounds=n},onAlignBoxResized:function(t){this.updateLayout()},addAlignBox:function(t){this._alignBoxes.push(t),this.updateLayout()},removeAlignBox:function(t){n(this._alignBoxes,t),this.updateLayout()}}),e}),i("SCENERY/nodes/CanvasNode",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/display/drawables/CanvasNodeDrawable","SCENERY/nodes/Node","SCENERY/display/Renderer"],function(t){"use strict";function e(t){r.call(this,t),this.setRendererBitmask(a.bitmaskCanvas)}var i=t("PHET_CORE/inherit"),n=t("SCENERY/scenery"),s=t("SCENERY/display/drawables/CanvasNodeDrawable"),r=t("SCENERY/nodes/Node"),a=t("SCENERY/display/Renderer");return n.register("CanvasNode",e),i(r,e,{_mutatorKeys:["canvasBounds"].concat(r.prototype._mutatorKeys),setCanvasBounds:function(t){this.invalidateSelf(t)},set canvasBounds(t){this.setCanvasBounds(t)},getCanvasBounds:function(){return this.getSelfBounds()},get canvasBounds(){return this.getCanvasBounds()},isPainted:function(){return!0},paintCanvas:function(t){throw new Error("CanvasNode needs paintCanvas implemented")},invalidatePaint:function(){for(var t=this._drawables.length,e=0;e<t;e++)this._drawables[e].markDirty()},canvasPaintSelf:function(t,e){this.paintCanvas(t.context)},containsPointSelf:function(t){return!1},createCanvasDrawable:function(t,e){return s.createFromPool(t,e)}}),e}),i("SCENERY/nodes/Circle",["require","DOT/Bounds2","SCENERY/display/drawables/CircleCanvasDrawable","SCENERY/display/drawables/CircleDOMDrawable","SCENERY/display/drawables/CircleSVGDrawable","PHET_CORE/extendDefined","SCENERY/util/Features","PHET_CORE/inherit","SCENERY/nodes/Path","SCENERY/display/Renderer","SCENERY/scenery","KITE/Shape"],function(t){"use strict";function e(t,e){this._radius=0,e="object"===(void 0===t?"undefined":_typeof(t))?t:a({radius:t},e),l.call(this,null,e)}var i=t("DOT/Bounds2"),n=t("SCENERY/display/drawables/CircleCanvasDrawable"),s=t("SCENERY/display/drawables/CircleDOMDrawable"),r=t("SCENERY/display/drawables/CircleSVGDrawable"),a=t("PHET_CORE/extendDefined"),o=t("SCENERY/util/Features"),h=t("PHET_CORE/inherit"),l=t("SCENERY/nodes/Path"),u=t("SCENERY/display/Renderer"),c=t("SCENERY/scenery"),d=t("KITE/Shape");return c.register("Circle",e),h(l,e,{_mutatorKeys:["radius"].concat(l.prototype._mutatorKeys),drawableMarkFlags:l.prototype.drawableMarkFlags.concat(["radius"]).filter(function(t){return"shape"!==t}),getStrokeRendererBitmask:function(){var t=l.prototype.getStrokeRendererBitmask.call(this);return this.hasStroke()&&!this.getStroke().isGradient&&!this.getStroke().isPattern&&this.getLineWidth()<=this.getRadius()&&(t|=u.bitmaskDOM),t},getPathRendererBitmask:function(){return u.bitmaskCanvas|u.bitmaskSVG|(o.borderRadius?u.bitmaskDOM:0)},invalidateCircle:function(){this._shape=null,this.invalidatePath()},createCircleShape:function(){return d.circle(0,0,this._radius).makeImmutable()},intersectsBoundsSelf:function(t){var e=Math.abs(t.centerX),i=Math.abs(t.centerY),n=t.maxX-e,s=t.maxY-i;return!(e>n+this._radius||i>s+this._radius)&&(e<=n||i<=s||(e-=n,i-=s,e*e+i*i<=this._radius*this._radius))},canvasPaintSelf:function(t,e){n.prototype.paintCanvas(t,this,e)},createDOMDrawable:function(t,e){return s.createFromPool(t,e)},createSVGDrawable:function(t,e){return r.createFromPool(t,e)},createCanvasDrawable:function(t,e){return n.createFromPool(t,e)},setRadius:function(t){if(this._radius!==t){this._radius=t,this.invalidateCircle();for(var e=this._drawables.length,i=0;i<e;i++)this._drawables[i].markDirtyRadius()}return this},set radius(t){return this.setRadius(t)},getRadius:function(){return this._radius},get radius(){return this.getRadius()},computeShapeBounds:function(){var t=new i(-this._radius,-this._radius,this._radius,this._radius);return this._stroke&&(t=t.dilated(this.getLineWidth()/2)),t},containsPointSelf:function(t){var e,i=t.x*t.x+t.y*t.y,n=!0;if(this._strokePickable){e=this.getLineWidth()/2;var s=this._radius+e;n=n&&i<=s*s}if(this._fillPickable)return this._strokePickable?n:i<=this._radius*this._radius;if(this._strokePickable){var r=this._radius-e;return n&&i>=r*r}return!1},setShape:function(t){if(null!==t)throw new Error("Cannot set the shape of a scenery.Circle to something non-null");this.invalidatePath()},getShape:function(){return this._shape||(this._shape=this.createCircleShape()),this._shape},hasShape:function(){return!0}}),e}),i("SCENERY/nodes/DOM",["require","DOT/Bounds2","SCENERY/display/drawables/DOMDrawable","PHET_CORE/extendDefined","PHET_CORE/inherit","SCENERY/nodes/Node","SCENERY/display/Renderer","SCENERY/scenery"],function(t){"use strict";function e(t,e){t&&t.jquery&&(t=t[0]),this._container=document.createElement("div"),this._$container=$(this._container),this._$container.css("position","absolute"),this._$container.css("left",0),this._$container.css("top",0),this.invalidateDOMLock=!1,this._preventTransform=!1,e=s({element:t},e),a.call(this,e),this.setRendererBitmask(o.bitmaskDOM)}var i=t("DOT/Bounds2"),n=t("SCENERY/display/drawables/DOMDrawable"),s=t("PHET_CORE/extendDefined"),r=t("PHET_CORE/inherit"),a=t("SCENERY/nodes/Node"),o=t("SCENERY/display/Renderer");return t("SCENERY/scenery").register("DOM",e),r(a,e,{_mutatorKeys:["element","preventTransform"].concat(a.prototype._mutatorKeys),calculateDOMBounds:function(){var t=$(this._element);return new i(0,0,t.width(),t.height())},invalidateDOM:function(){if(!this.invalidateDOMLock){this.invalidateDOMLock=!0;var t=document.createElement("div");$(t).css({display:"hidden",padding:"0 !important",margin:"0 !important",position:"absolute",left:0,top:0,width:65535,height:65535}),this._container.removeChild(this._element),t.appendChild(this._element),document.body.appendChild(t);var e=this.calculateDOMBounds();this.invalidateSelf(e),this._$container.width(e.getWidth()),this._$container.height(e.getHeight()),document.body.removeChild(t),t.removeChild(this._element),this._container.appendChild(this._element),this.invalidateDOMLock=!1}},createDOMDrawable:function(t,e){return n.createFromPool(t,e)},isPainted:function(){return!0},setElement:function(t){return this._element!==t&&(this._element&&this._container.removeChild(this._element),this._element=t,this._container.appendChild(this._element),this.invalidateDOM()),this},set element(t){this.setElement(t)},getElement:function(){return this._element},get element(){return this.getElement()},setPreventTransform:function(t){this._preventTransform!==t&&(this._preventTransform=t)},set preventTransform(t){this.setPreventTransform(t)},isTransformPrevented:function(){return this._preventTransform},get preventTransform(){return this.isTransformPrevented()}}),e}),i("SCENERY/nodes/LayoutBox",["require","DOT/Bounds2","PHET_CORE/inherit","SCENERY/nodes/Node","SCENERY/scenery"],function(t){"use strict";function e(t){this._orientation="vertical",this._spacing=r,this._align="center",this._resize=!0,s.call(this),this._updateLayoutListener=this.updateLayoutAutomatically.bind(this),this._updateLayoutLocked=!1,this.onStatic("childInserted",this.onLayoutBoxChildInserted.bind(this)),this.onStatic("childRemoved",this.onLayoutBoxChildRemoved.bind(this)),this.onStatic("childrenChanged",this.onLayoutBoxChildrenChanged.bind(this)),this._layoutMutating=!0,this.mutate(t),this._layoutMutating=!1}var i=t("DOT/Bounds2"),n=t("PHET_CORE/inherit"),s=t("SCENERY/nodes/Node"),r=0,a={vertical:"top",horizontal:"left"},o={vertical:"height",horizontal:"width"},h={vertical:{left:"left",center:"centerX",right:"right",origin:"x"},horizontal:{top:"top",center:"centerY",bottom:"bottom",origin:"y"}};return t("SCENERY/scenery").register("LayoutBox",e),n(s,e,{_mutatorKeys:["orientation","spacing","align","resize"].concat(s.prototype._mutatorKeys),getAlignmentBounds:function(){for(var t=Number.NEGATIVE_INFINITY,e=Number.NEGATIVE_INFINITY,n=0;n<this._children.length;n++){var s=this._children[n];t=Math.max(t,s.width),e=Math.max(e,s.height)}return new i(0,0,t,e)},layout:function(){for(var t=this._children,e=a[this._orientation],i=o[this._orientation],n=h[this._orientation][this._align],s=this.getAlignmentBounds(),r=0,l=0;l<t.length;l++){var u=t[l];u.bounds.isValid()&&(u[e]=r,u[n]="origin"===this._align?0:s[n],r+=u[i]+this._spacing)}},updateLayout:function(){this._updateLayoutLocked||(this._updateLayoutLocked=!0,this.layout(),this._updateLayoutLocked=!1)},updateLayoutAutomatically:function(){(this._layoutMutating||this._resize)&&this.updateLayout()},onLayoutBoxChildInserted:function(t){this._resize&&t.onStatic("bounds",this._updateLayoutListener)},onLayoutBoxChildRemoved:function(t){this._resize&&t.offStatic("bounds",this._updateLayoutListener)},onLayoutBoxChildrenChanged:function(){this._resize&&this.updateLayoutAutomatically()},setChildren:function(t){if(this._updateLayoutLocked)return s.prototype.setChildren.call(this,t);var e=this.getChildren();return this._updateLayoutLocked=!0,s.prototype.setChildren.call(this,t),this._updateLayoutLocked=!1,_.isEqual(e,t)||this.updateLayoutAutomatically(),this},setOrientation:function(t){return this._orientation!==t&&(this._orientation=t,this.updateLayout()),this},set orientation(t){this.setOrientation(t)},getOrientation:function(){return this._orientation},get orientation(){return this.getOrientation()},setSpacing:function(t){return this._spacing!==t&&(this._spacing=t,this.updateLayout()),this},set spacing(t){this.setSpacing(t)},getSpacing:function(){return this._spacing},get spacing(){return this.getSpacing()},setAlign:function(t){return this._align!==t&&(this._align=t,this.updateLayout()),this},set align(t){this.setAlign(t)},getAlign:function(){return this._align},get align(){return this.getAlign()},setResize:function(t){if(this._resize!==t){this._resize=t;for(var e=0;e<this._children.length;e++){var i=this._children[e];t?i.onStatic("bounds",this._updateLayoutListener):i.offStatic("bounds",this._updateLayoutListener)}this.updateLayoutAutomatically()}return this},set resize(t){this.setResize(t)},isResize:function(){return this._resize},get resize(){return this.isResize()}})}),i("SCENERY/nodes/HBox",["require","PHET_CORE/inherit","SCENERY/nodes/LayoutBox","SCENERY/scenery"],function(t){"use strict";function e(t){(t=t||{}).orientation="horizontal",n.call(this,t)}var i=t("PHET_CORE/inherit"),n=t("SCENERY/nodes/LayoutBox");return t("SCENERY/scenery").register("HBox",e),i(n,e)}),i("SCENERY/util/FontIO",["require","TANDEM/types/ObjectIO","TANDEM/phetioInherit","SCENERY/scenery","AXON/validate"],function(t){"use strict";function e(t,e){i.call(this,t,e)}var i=t("TANDEM/types/ObjectIO"),n=t("TANDEM/phetioInherit"),s=t("SCENERY/scenery"),r=t("AXON/validate");return n(i,"FontIO",e,{},{validator:{valueType:s.Font},documentation:"Font handling for text drawing. Options:<ul><li><strong>style:</strong> normal      &mdash; normal | italic | oblique </li><li><strong>variant:</strong> normal    &mdash; normal | small-caps </li><li><strong>weight:</strong> normal     &mdash; normal | bold | bolder | lighter | 100 | 200 | 300 | 400 | 500 | 600 | 700 | 800 | 900 </li><li><strong>stretch:</strong> normal    &mdash; normal | ultra-condensed | extra-condensed | condensed | semi-condensed | semi-expanded | expanded | extra-expanded | ultra-expanded </li><li><strong>size:</strong> 10px         &mdash; absolute-size | relative-size | length | percentage -- unitless number interpreted as px. absolute suffixes: cm, mm, in, pt, pc, px. relative suffixes: em, ex, ch, rem, vw, vh, vmin, vmax. </li><li><strong>lineHeight:</strong> normal &mdash; normal | number | length | percentage -- NOTE: Canvas spec forces line-height to normal </li><li><strong>family:</strong> sans-serif &mdash; comma-separated list of families, including generic families (serif, sans-serif, cursive, fantasy, monospace). ideally escape with double-quotes</li></ul>",toStateObject:function(t){return r(t,this.validator),{style:t.getStyle(),variant:t.getVariant(),weight:t.getWeight(),stretch:t.getStretch(),size:t.getSize(),lineHeight:t.getLineHeight(),family:t.getFamily()}},fromStateObject:function(t){return new s.Font(t)}}),s.register("FontIO",e),e}),i("SCENERY/util/Font",["require","SCENERY/util/FontIO","PHET_CORE/inherit","TANDEM/PhetioObject","SCENERY/scenery","TANDEM/Tandem"],function(t){"use strict";function e(t){t=_.extend({style:"normal",variant:"normal",weight:"normal",stretch:"normal",size:"10px",lineHeight:"normal",family:"sans-serif",phetioType:i,tandem:a.optional},t),this._style=t.style,this._variant=t.variant,this._weight=""+t.weight,this._stretch=t.stretch,this._size=e.castSize(t.size),this._lineHeight=t.lineHeight,this._family=t.family,this._font=this.computeShorthand(),s.call(this,t)}var i=t("SCENERY/util/FontIO"),n=t("PHET_CORE/inherit"),s=t("TANDEM/PhetioObject"),r=t("SCENERY/scenery"),a=t("TANDEM/Tandem"),o=["normal","italic","oblique"],h=["normal","small-caps"],l=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"],u=["normal","ultra-condensed","extra-condensed","condensed","semi-condensed","semi-expanded","expanded","extra-expanded","ultra-expanded"];return r.register("Font",e),n(s,e,{getFont:function(){return this._font},get font(){return this.getFont()},getStyle:function(){return this._style},get style(){return this.getStyle()},getVariant:function(){return this._variant},get variant(){return this.getVariant()},getWeight:function(){return this._weight},get weight(){return this.getWeight()},getStretch:function(){return this._stretch},get stretch(){return this.getStretch()},getSize:function(){return this._size},get size(){return this.getSize()},getLineHeight:function(){return this._lineHeight},get lineHeight(){return this.getLineHeight()},getFamily:function(){return this._family},get family(){return this.getFamily()},copy:function(t){return new e(_.extend({style:this._style,variant:this._variant,weight:this._weight,stretch:this._stretch,size:this._size,lineHeight:this._lineHeight,family:this._family},t))},computeShorthand:function(){var t="";return"normal"!==this._style&&(t+=this._style+" "),"normal"!==this._variant&&(t+=this._variant+" "),"normal"!==this._weight&&(t+=this._weight+" "),"normal"!==this._stretch&&(t+=this._stretch+" "),t+=this._size,"normal"!==this._lineHeight&&(t+="/"+this._lineHeight),t+=" "+this._family},toCSS:function(){return this.getFont()}},{castSize:function(t){return"number"==typeof t?t+"px":t},fromCSS:function(t){for(var i={},n=_.filter(t.split(/[\x09\x0A\x0C\x0D\x20]/),function(t){return t.length>0}),s=0;s<n.length;s++){var r=n[s];if("normal"===r);else if(_.includes(o,r))i.style=r;else if(_.includes(h,r))i.variant=r;else if(_.includes(l,r))i.weight=r;else{if(!_.includes(u,r)){var a=r.split(/\//);i.size=a[0],a[1]&&(i.lineHeight=a[1]),i.family=n.slice(s+1).join(" ");break}i.stretch=r}}return new e(i)}}),e.DEFAULT=new e,e}),i("SCENERY/util/TextBounds",["require","DOT/Bounds2","SCENERY/util/CanvasContextWrapper","SCENERY/util/Font","SCENERY/scenery","SCENERY/util/Util"],function(t){"use strict";var e,i,n=t("DOT/Bounds2"),s=t("SCENERY/util/CanvasContextWrapper"),r=(t("SCENERY/util/Font"),t("SCENERY/scenery")),a=t("SCENERY/util/Util"),o={},h={approximateSVGBounds:function(t,s){if(!e.parentNode){if(!document.body)throw new Error("No document.body and trying to get approximate SVG bounds of a Text node");document.body.appendChild(e)}h.setSVGTextAttributes(i,t,s);var r=i.getBBox();return new n(r.x,r.y,r.x+r.width,r.y+r.height)},accurateCanvasBounds:function(t){var e=h.approximateSVGBounds(t._font,t.renderedText);if(!t.renderedText.length||0===e.width)return e;var i=a.canvasAccurateBounds(function(e){if(e.font=t._font.toCSS(),e.direction="ltr",e.fillText(t.renderedText,0,0),t.hasPaintableStroke()){var i=new s(null,e);t.beforeCanvasStroke(i),e.strokeText(t.renderedText,0,0),t.afterCanvasStroke(i)}},{precision:.5,resolution:128,initialScale:32/Math.max(Math.abs(e.minX),Math.abs(e.minY),Math.abs(e.maxX),Math.abs(e.maxY))});return i.isFinite()?i:e},getVerticalBounds:function(t){var e=t.toCSS(),i=o[e];return i||(i=o[e]=h.approximateSVGBounds(t,"m")),i},approximateCanvasWidth:function(t,e){var i=r.scratchContext;return i.font=t.toCSS(),i.direction="ltr",i.measureText(e).width},approximateHybridBounds:function(t,e){var i=h.getVerticalBounds(t),s=h.approximateCanvasWidth(t,e);return new n(0,i.minY,s,i.maxY)},approximateDOMBounds:function(t,e){var i=document.createElement("div");$(i).css({position:"absolute",left:0,top:0,padding:"0 !important",margin:"0 !important",display:"hidden"});var s=document.createElement("span");$(s).css("font",t.toCSS()),s.appendChild(e),s.setAttribute("direction","ltr");var r=document.createElement("div");$(r).css({"vertical-align":"baseline",display:"inline-block",width:0,height:"1024px",margin:"0 !important",padding:"0 !important"}),i.appendChild(s),i.appendChild(r),document.body.appendChild(i);var a=s.getBoundingClientRect(),o=i.getBoundingClientRect(),h=new n(a.left,a.top-1024,a.right+1,a.bottom-1024).shifted(-o.left,-o.top);return document.body.removeChild(i),h},approximateImprovedDOMBounds:function(t,e){var i=document.createElement("div");i.style.display="inline-block",i.style.font=t.toCSS(),i.style.color="transparent",i.style.padding="0 !important",i.style.margin="0 !important",i.style.position="absolute",i.style.left="0",i.style.top="0",i.setAttribute("direction","ltr"),i.appendChild(e),document.body.appendChild(i);var s=new n(i.offsetLeft,i.offsetTop,i.offsetLeft+i.offsetWidth+1,i.offsetTop+i.offsetHeight+1);document.body.removeChild(i);var r=h.getVerticalBounds(t);return s.shiftedY(r.minY)},setSVGTextAttributes:function(t,e,i){t.setAttribute("direction","ltr"),t.setAttribute("font-family",e.getFamily()),t.setAttribute("font-size",e.getSize()),t.setAttribute("font-style",e.getStyle()),t.setAttribute("font-weight",e.getWeight()),t.setAttribute("font-stretch",e.getStretch()),t.lastChild.nodeValue=i},initializeTextBounds:function(){(e=document.getElementById("sceneryTextSizeContainer"))||((e=document.createElementNS(r.svgns,"svg")).setAttribute("width","2"),e.setAttribute("height","2"),e.setAttribute("id","sceneryTextSizeContainer"),e.setAttribute("style","visibility: hidden; pointer-events: none; position: absolute; left: -65535px; right: -65535px;")),(i=document.getElementById("sceneryTextSizeElement"))||((i=document.createElementNS(r.svgns,"text")).appendChild(document.createTextNode("")),i.setAttribute("dominant-baseline","alphabetic"),i.setAttribute("text-rendering","geometricPrecision"),i.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),i.setAttribute("id","sceneryTextSizeElement"),e.appendChild(i))}};return r.register("TextBounds",h),h}),i("SCENERY/nodes/TextIO",["require","SCENERY/util/FontIO","SCENERY/nodes/NodeIO","SCENERY/util/NodeProperty","TANDEM/types/NumberIO","TANDEM/phetioInherit","AXON/PropertyIO","SCENERY/scenery","TANDEM/types/StringIO","TANDEM/types/VoidIO"],function(t){"use strict";function e(t,e){n.call(this,t,e);var i=new s(t,"text","text",_.extend({phetioReadOnly:t.phetioReadOnly,phetioState:t.phetioState,phetioType:o(l),tandem:t.tandem.createTandem("textProperty"),phetioDocumentation:"Property for the displayed text"},t.phetioComponentOptions.textProperty));this.disposeTextIO=function(){i.dispose()}}var i=t("SCENERY/util/FontIO"),n=t("SCENERY/nodes/NodeIO"),s=t("SCENERY/util/NodeProperty"),r=t("TANDEM/types/NumberIO"),a=t("TANDEM/phetioInherit"),o=t("AXON/PropertyIO"),h=t("SCENERY/scenery"),l=t("TANDEM/types/StringIO"),u=t("TANDEM/types/VoidIO");return a(n,"TextIO",e,{dispose:function(){this.disposeTextIO(),n.prototype.dispose.call(this)},setFontOptions:{returnType:u,parameterTypes:[i],implementation:function(t){this.instance.setFont(t)},documentation:"Sets font options for this TextIO instance, e.g. {size: 16, weight: bold}. If increasing the font size does not make the text size larger, you may need to increase the maxWidth of the TextIO also.",invocableForReadOnlyInstances:!1},getFontOptions:{returnType:i,parameterTypes:[],implementation:function(){return this.instance.getFont()},documentation:"Gets font options for this TextIO instance as an object"},setMaxWidth:{returnType:u,parameterTypes:[r],implementation:function(t){this.instance.setMaxWidth(t)},documentation:"Sets the maximum width of text box. If the text width exceeds maxWidth, it is scaled down to fit.",invocableForReadOnlyInstances:!1},getMaxWidth:{returnType:r,parameterTypes:[],implementation:function(){return this.instance.maxWidth},documentation:"Gets the maximum width of text box"}},{documentation:"Text that is displayed in the simulation. TextIO has a nested PropertyIO.&lt;String&gt; for the current string value.",validator:{valueType:h.Text}}),h.register("TextIO",e),e}),i("SCENERY/nodes/Text",["require","PHET_CORE/escapeHTML","PHET_CORE/extendDefined","SCENERY/util/Font","PHET_CORE/inherit","SCENERY/nodes/Node","SCENERY/nodes/Paintable","PHET_CORE/platform","SCENERY/display/Renderer","SCENERY/scenery","TANDEM/Tandem","SCENERY/util/TextBounds","SCENERY/display/drawables/TextCanvasDrawable","SCENERY/display/drawables/TextDOMDrawable","SCENERY/nodes/TextIO","SCENERY/display/drawables/TextSVGDrawable"],function(t){"use strict";function e(t,e){this._text="",this._font=s.DEFAULT,this._boundsMethod="hybrid",this._isHTML=void 0!==this._isHTML&&this._isHTML,this._cachedRenderedText=null,this.initializePaintable(),e=n({fill:"#000000",text:t,tandem:c.optional,phetioType:p},e),this.textTandem=e.tandem,a.call(this,e),this.invalidateSupportedRenderers()}var i=t("PHET_CORE/escapeHTML"),n=t("PHET_CORE/extendDefined"),s=t("SCENERY/util/Font"),r=t("PHET_CORE/inherit"),a=t("SCENERY/nodes/Node"),o=t("SCENERY/nodes/Paintable"),h=t("PHET_CORE/platform"),l=t("SCENERY/display/Renderer"),u=t("SCENERY/scenery"),c=t("TANDEM/Tandem"),d=t("SCENERY/util/TextBounds"),f=t("SCENERY/display/drawables/TextCanvasDrawable"),m=t("SCENERY/display/drawables/TextDOMDrawable"),p=t("SCENERY/nodes/TextIO"),g=t("SCENERY/display/drawables/TextSVGDrawable"),v=-1!==window.navigator.userAgent.indexOf("like Gecko) Version/5")&&-1!==window.navigator.userAgent.indexOf("Safari/");u.register("Text",e),r(a,e,{_mutatorKeys:["boundsMethod","text","font","fontWeight","fontFamily","fontStretch","fontStyle","fontSize"].concat(a.prototype._mutatorKeys),drawableMarkFlags:a.prototype.drawableMarkFlags.concat(["text","font","bounds"]),setText:function(t){if((t=""+t)!==this._text){var e=this._text;this._text=t,this._cachedRenderedText=null;for(var i=this._drawables.length,n=0;n<i;n++)this._drawables[n].markDirtyText();this.invalidateText(),this.trigger2("text",e,t)}return this},set text(t){this.setText(t)},getText:function(){return this._text},get text(){return this.getText()},getRenderedText:function(){return null===this._cachedRenderedText&&(this._cachedRenderedText=this._text.replace(" "," "),h.edge&&(this._cachedRenderedText=e.simplifyEmbeddingMarks(this._cachedRenderedText))),this._cachedRenderedText},get renderedText(){return this.getRenderedText()},setBoundsMethod:function(t){if(t!==this._boundsMethod){this._boundsMethod=t,this.invalidateSupportedRenderers();for(var e=this._drawables.length,i=0;i<e;i++)this._drawables[i].markDirtyBounds();this.invalidateText(),this.trigger0("boundsMethod"),this.trigger0("selfBoundsValid")}return this},set boundsMethod(t){this.setBoundsMethod(t)},getBoundsMethod:function(){return this._boundsMethod},get boundsMethod(){return this.getBoundsMethod()},getTextRendererBitmask:function(){var t=0;return"fast"===this._boundsMethod||this._isHTML||(t|=l.bitmaskCanvas),this._isHTML||(t|=l.bitmaskSVG),t|=l.bitmaskDOM},invalidateSupportedRenderers:function(){this.setRendererBitmask(this.getFillRendererBitmask()&this.getStrokeRendererBitmask()&this.getTextRendererBitmask())},invalidateText:function(){this.invalidateSelf();for(var t=this._drawables.length,e=0;e<t;e++)this._drawables[e].markDirtyBounds();this.invalidateSupportedRenderers()},updateSelfBounds:function(){var t;t=this._isHTML||v&&"accurate"!==this._boundsMethod?d.approximateDOMBounds(this._font,this.getDOMTextNode()):"hybrid"===this._boundsMethod?d.approximateHybridBounds(this._font,this.renderedText):"accurate"===this._boundsMethod?d.accurateCanvasBounds(this):d.approximateSVGBounds(this._font,this.renderedText),this.hasStroke()&&t.dilate(this.getLineWidth()/2);var e=!t.equals(this._selfBounds);return e&&this._selfBounds.set(t),e},invalidateStroke:function(){this.invalidateText()},invalidateFill:function(){this.invalidateText()},canvasPaintSelf:function(t,e){f.prototype.paintCanvas(t,this,e)},createDOMDrawable:function(t,e){return m.createFromPool(t,e)},createSVGDrawable:function(t,e){return g.createFromPool(t,e)},createCanvasDrawable:function(t,e){return f.createFromPool(t,e)},getDOMTextNode:function(){if(this._isHTML){var t=document.createElement("span");return t.innerHTML=this._text,t}return document.createTextNode(this.renderedText)},getSafeSelfBounds:function(){var t=this.getSelfBounds();return t.dilatedXY(1*t.width,1*t.height)},setFont:function(t){if(t!==("string"==typeof t?this._font.toCSS():this._font)){this._font="string"==typeof t?s.fromCSS(t):t;for(var e=this._drawables.length,i=0;i<e;i++)this._drawables[i].markDirtyFont();this.invalidateText()}return this},set font(t){this.setFont(t)},getFont:function(){return this._font.getFont()},get font(){return this.getFont()},setFontWeight:function(t){return this.setFont(this._font.copy({weight:t}))},set fontWeight(t){this.setFontWeight(t)},getFontWeight:function(){return this._font.getWeight()},get fontWeight(){return this.getFontWeight()},setFontFamily:function(t){return this.setFont(this._font.copy({family:t}))},set fontFamily(t){this.setFontFamily(t)},getFontFamily:function(){return this._font.getFamily()},get fontFamily(){return this.getFontFamily()},setFontStretch:function(t){return this.setFont(this._font.copy({stretch:t}))},set fontStretch(t){this.setFontStretch(t)},getFontStretch:function(){return this._font.getStretch()},get fontStretch(){return this.getFontStretch()},setFontStyle:function(t){return this.setFont(this._font.copy({style:t}))},set fontStyle(t){this.setFontStyle(t)},getFontStyle:function(){return this._font.getStyle()},get fontStyle(){return this.getFontStyle()},setFontSize:function(t){return this.setFont(this._font.copy({size:t}))},set fontSize(t){this.setFontSize(t)},getFontSize:function(){return this._font.getSize()},get fontSize(){return this.getFontSize()},isPainted:function(){return!0},areSelfBoundsValid:function(){return"accurate"===this._boundsMethod},getDebugHTMLExtras:function(){return' "'+i(this.renderedText)+'"'+(this._isHTML?" (html)":"")}}),o.mixInto(e);return e.embeddedDebugString=function(t){return t.replace(/\u202a/g,"[LTR]").replace(/\u202b/g,"[RTL]").replace(/\u202c/g,"[POP]")},e.simplifyEmbeddingMarks=function(t){function e(t){for(var i=t.children.length-1;i>=1;i--){var n=t.children[i-1],s=t.children[i];s.dir&&n.dir===s.dir&&(n.children=n.children.concat(s.children),t.children.splice(i,1),e(n))}}function i(t){if("string"!=typeof t){for(var n=0;n<t.children.length;n++)i(t.children[n]);return function(t){1===t.children.length&&t.children[0].dir&&(t.dir=t.children[0].dir,t.children=t.children[0].children)}(t),function(t){for(var e=t.children.length-1;e>=0;e--){var i=t.children[e];t.dir===i.dir&&Array.prototype.splice.apply(t.children,[e,1].concat(i.children))}}(t),e(t),t}}function n(t){if("string"==typeof t)return t;var e=t.children.map(n).join("");return t.dir?t.dir+e+"‬":e}for(var s={dir:null,children:[],parent:null},r=s,a=0;a<t.length;a++){var o=t.charAt(a);if("‪"===o||"‫"===o){var h={dir:o,children:[],parent:r};r.children.push(h),r=h}else"‬"===o?r=r.parent:r.children.push(o)}return n(i(s))},d.initializeTextBounds(),e}),i("SCENERY/nodes/HTMLText",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/nodes/Text"],function(t){"use strict";function e(t,e){this._isHTML=!0,s.call(this,t,e)}var i=t("PHET_CORE/inherit"),n=t("SCENERY/scenery"),s=t("SCENERY/nodes/Text");return n.register("HTMLText",e),i(s,e),e}),i("SCENERY/nodes/Leaf",["require","PHET_CORE/inheritance","SCENERY/nodes/Node","SCENERY/scenery"],function(t){"use strict";t("PHET_CORE/inheritance"),t("SCENERY/nodes/Node");var e=t("SCENERY/scenery"),i={mixInto:function(t){var e=t.prototype;e.insertChild=function(t,e){throw new Error("Attempt to insert child into Leaf")},e.removeChildWithIndex=function(t,e){throw new Error("Attempt to remove child from Leaf")}}};return e.register("Leaf",i),e.Leaf}),i("SCENERY/nodes/Spacer",["require","DOT/Bounds2","PHET_CORE/inherit","SCENERY/nodes/Leaf","SCENERY/nodes/Node","SCENERY/scenery"],function(t){"use strict";function e(t,e,n){r.call(this),this.localBounds=new i(0,0,t,e),this.mutate(n)}var i=t("DOT/Bounds2"),n=t("PHET_CORE/inherit"),s=t("SCENERY/nodes/Leaf"),r=t("SCENERY/nodes/Node");return t("SCENERY/scenery").register("Spacer",e),n(r,e),s.mixInto(e),e}),i("SCENERY/nodes/HStrut",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/nodes/Spacer"],function(t){"use strict";function e(t,e){s.call(this,t,0,e)}var i=t("PHET_CORE/inherit"),n=t("SCENERY/scenery"),s=t("SCENERY/nodes/Spacer");return n.register("HStrut",e),i(s,e)}),i("SCENERY/nodes/Image",["require","DOT/Bounds2","PHET_CORE/cleanArray","PHET_CORE/extendDefined","SCENERY/display/drawables/ImageCanvasDrawable","SCENERY/display/drawables/ImageDOMDrawable","SCENERY/display/drawables/ImageSVGDrawable","SCENERY/display/drawables/ImageWebGLDrawable","PHET_CORE/inherit","SCENERY/nodes/Node","SCENERY/display/Renderer","SCENERY/scenery","SCENERY/util/SpriteSheet","DOT/Util"],function(t){"use strict";function e(t,e){this._initialWidth=g.initialWidth,this._initialHeight=g.initialHeight,this._imageOpacity=g.imageOpacity,this._mipmap=g.mipmap,this._mipmapBias=g.mipmapBias,this._mipmapInitialLevel=g.mipmapInitialLevel,this._mipmapMaxLevel=g.mipmapMaxLevel,this._mipmapCanvases=[],this._mipmapURLs=[],this._mipmapData=null,this._imageLoadListener=this.onImageLoad.bind(this),this._imageLoadListenerAttached=!1,e=s({image:t},e),u.call(this,e),this.invalidateSupportedRenderers()}var i=t("DOT/Bounds2"),n=t("PHET_CORE/cleanArray"),s=t("PHET_CORE/extendDefined"),r=t("SCENERY/display/drawables/ImageCanvasDrawable"),a=t("SCENERY/display/drawables/ImageDOMDrawable"),o=t("SCENERY/display/drawables/ImageSVGDrawable"),h=t("SCENERY/display/drawables/ImageWebGLDrawable"),l=t("PHET_CORE/inherit"),u=t("SCENERY/nodes/Node"),c=t("SCENERY/display/Renderer"),d=t("SCENERY/scenery"),f=t("SCENERY/util/SpriteSheet"),m=t("DOT/Util"),p=Math.log2||function(t){return Math.log(t)/Math.LN2},g={imageOpacity:1,initialWidth:0,initialHeight:0,mipmap:!1,mipmapBias:0,mipmapInitialLevel:4,mipmapMaxLevel:5};return d.register("Image",e),l(u,e,{_mutatorKeys:["image","imageOpacity","initialWidth","initialHeight","mipmap","mipmapBias","mipmapInitialLevel","mipmapMaxLevel"].concat(u.prototype._mutatorKeys),drawableMarkFlags:u.prototype.drawableMarkFlags.concat(["image","imageOpacity","mipmap"]),setImage:function(t){var e=this._image!==t;if(e&&"string"==typeof t&&(this._image&&t===this._image.src&&(e=!1),t===this._mipmapData&&(e=!1)),e){if(this._initialWidth=0,this._initialHeight=0,this._image&&this._imageLoadListenerAttached&&this.detachImageLoadListener(),this._mipmapData=null,"string"==typeof t){var i=t;(t=document.createElement("img")).src=i}else Array.isArray(t)&&(this._mipmapData=t,t=t[0].img,this._mipmapInitialLevel=this._mipmapMaxLevel=this._mipmapData.length,this._mipmap=!0);this._image=t,!(this._image instanceof HTMLImageElement)||this._image.width&&this._image.height||this.attachImageLoadListener(),this.invalidateImage()}return this},set image(t){this.setImage(t)},getImage:function(){return this._image},get image(){return this.getImage()},invalidateImage:function(){this._image?this.invalidateSelf(new i(0,0,this.getImageWidth(),this.getImageHeight())):this.invalidateSelf(i.NOTHING);for(var t=this._drawables.length,e=0;e<t;e++)this._drawables[e].markDirtyImage();this.invalidateMipmaps(),this.invalidateSupportedRenderers()},invalidateSupportedRenderers:function(){var t=c.bitmaskCanvas;this.getImageWidth()<=f.MAX_DIMENSION.width&&this.getImageHeight()<=f.MAX_DIMENSION.height&&(t|=c.bitmaskWebGL),this._image instanceof HTMLCanvasElement||(t|=c.bitmaskSVG|c.bitmaskDOM),this.setRendererBitmask(t)},setImageWithSize:function(t,e,i){return this.setImage(t),this.setInitialWidth(e),this.setInitialHeight(i),this},setImageOpacity:function(t){if(this._imageOpacity!==t){this._imageOpacity=t;for(var e=this._drawables.length,i=0;i<e;i++)this._drawables[i].markDirtyImageOpacity()}},set imageOpacity(t){this.setImageOpacity(t)},getImageOpacity:function(){return this._imageOpacity},get imageOpacity(){return this.getImageOpacity()},setInitialWidth:function(t){return t!==this._initialWidth&&(this._initialWidth=t,this.invalidateImage()),this},set initialWidth(t){this.setInitialWidth(t)},getInitialWidth:function(){return this._initialWidth},get initialWidth(){return this.getInitialWidth()},setInitialHeight:function(t){return t!==this._initialHeight&&(this._initialHeight=t,this.invalidateImage()),this},set initialHeight(t){this.setInitialHeight(t)},getInitialHeight:function(){return this._initialHeight},get initialHeight(){return this.getInitialHeight()},setMipmap:function(t){return this._mipmap!==t&&(this._mipmap=t,this.invalidateMipmaps()),this},set mipmap(t){this.setMipmap(t)},isMipmap:function(){return this._mipmap},get mipmap(){return this.isMipmap()},setMipmapBias:function(t){return this._mipmapBias!==t&&(this._mipmapBias=t,this.invalidateMipmaps()),this},set mipmapBias(t){this.setMipmapBias(t)},getMipmapBias:function(){return this._mipmapBias},get mipmapBias(){return this.getMipmapBias()},setMipmapInitialLevel:function(t){return this._mipmapInitialLevel!==t&&(this._mipmapInitialLevel=t,this.invalidateMipmaps()),this},set mipmapInitialLevel(t){this.setMipmapInitialLevel(t)},getMipmapInitialLevel:function(){return this._mipmapInitialLevel},get mipmapInitialLevel(){return this.getMipmapInitialLevel()},setMipmapMaxLevel:function(t){return this._mipmapMaxLevel!==t&&(this._mipmapMaxLevel=t,this.invalidateMipmaps()),this},set mipmapMaxLevel(t){this.setMipmapMaxLevel(t)},getMipmapMaxLevel:function(){return this._mipmapMaxLevel},get mipmapMaxLevel(){return this.getMipmapMaxLevel()},constructNextMipmap:function(){var t=this._mipmapCanvases.length,e=this._mipmapCanvases[t-1];if(e.width*e.height>2){var i=document.createElement("canvas");if(i.width=Math.ceil(e.width/2),i.height=Math.ceil(e.height/2),i.width>0&&i.height>0){var n=i.getContext("2d");n.scale(.5,.5),n.drawImage(e,0,0),this._mipmapCanvases.push(i),this._mipmapURLs.push(i.toDataURL())}}},invalidateMipmaps:function(){if(n(this._mipmapCanvases),n(this._mipmapURLs),this._image&&this._mipmap)if(this._mipmapData)for(var t=0;t<this._mipmapData.length;t++){var e=this._mipmapData[t].url;this._mipmapURLs.push(e),this._mipmapData[t].updateCanvas&&this._mipmapData[t].updateCanvas(),this._mipmapCanvases.push(this._mipmapData[t].canvas)}else{var i=document.createElement("canvas");if(i.width=this.getImageWidth(),i.height=this.getImageHeight(),i.width&&i.height){i.getContext("2d").drawImage(this._image,0,0),this._mipmapCanvases.push(i),this._mipmapURLs.push(i.toDataURL());for(var s=0;++s<this._mipmapInitialLevel;)this.constructNextMipmap()}for(var r=this._drawables.length,a=0;a<r;a++)this._drawables[a].markDirtyMipmap()}this.trigger0("mipmap")},getMipmapLevel:function(t){var e=(Math.sqrt(t.m00()*t.m00()+t.m10()*t.m10())+Math.sqrt(t.m01()*t.m01()+t.m11()*t.m11()))/2;if((e*=window.devicePixelRatio||1)>=1)return 0;var i=p(1/e);if((i=m.roundSymmetric(i+this._mipmapBias-.7))<0&&(i=0),i>this._mipmapMaxLevel&&(i=this._mipmapMaxLevel),this.mipmap&&!this._mipmapCanvases[i]){for(var n=this._mipmapCanvases.length-1;++n<=i;)this.constructNextMipmap();return Math.min(i,this._mipmapCanvases.length-1)}return i},getMipmapCanvas:function(t){return this._mipmapData&&this._mipmapData[t]&&this._mipmapData[t].updateCanvas&&this._mipmapData[t].updateCanvas(),this._mipmapCanvases[t]},getMipmapURL:function(t){return this._mipmapURLs[t]},hasMipmaps:function(){return this._mipmapCanvases.length>0},getImageWidth:function(){var t=this._mipmapData?this._mipmapData[0].width:this._image.naturalWidth||this._image.width;return 0===t?this._initialWidth:t},get imageWidth(){return this.getImageWidth()},getImageHeight:function(){var t=this._mipmapData?this._mipmapData[0].height:this._image.naturalHeight||this._image.height;return 0===t?this._initialHeight:t},get imageHeight(){return this.getImageHeight()},getImageURL:function(){return this._image.src},isPainted:function(){return!0},canvasPaintSelf:function(t,e){r.prototype.paintCanvas(t,this,e)},createDOMDrawable:function(t,e){return a.createFromPool(t,e)},createSVGDrawable:function(t,e){return o.createFromPool(t,e)},createCanvasDrawable:function(t,e){return r.createFromPool(t,e)},createWebGLDrawable:function(t,e){return h.createFromPool(t,e)},attachImageLoadListener:function(){this.isDisposed||(this._image.addEventListener("load",this._imageLoadListener),this._imageLoadListenerAttached=!0)},detachImageLoadListener:function(){this._image.removeEventListener("load",this._imageLoadListener),this._imageLoadListenerAttached=!1},onImageLoad:function(){this.invalidateImage(),this.detachImageLoadListener()},dispose:function(){this._image&&this._imageLoadListenerAttached&&this.detachImageLoadListener(),u.prototype.dispose.call(this)}}),e.createSVGImage=function(t,e,i){var n=document.createElementNS(d.svgns,"image");return n.setAttribute("x",0),n.setAttribute("y",0),n.setAttribute("width",e+"px"),n.setAttribute("height",i+"px"),n.setAttributeNS(d.xlinkns,"xlink:href",t),n},e.createFastMipmapFromCanvas=function(t){var e=[],i=t.toDataURL(),n=new window.Image;n.src=i,e.push({img:n,url:i,width:t.width,height:t.height});for(var s=t;s.width>=2&&s.height>=2;){var r={},a=document.createElement("canvas");a.width=r.width=Math.ceil(s.width/2),a.height=r.height=Math.ceil(s.height/2);var o=a.getContext("2d");o.setTransform(.5,0,0,.5,0,0),o.drawImage(s,0,0),r.canvas=a,r.url=a.toDataURL(),r.img=new window.Image,r.img.src=r.url,s=a,e.push(r)}return e},e.DEFAULT_OPTIONS=_.extend({},u.DEFAULT_OPTIONS,g),e}),i("SCENERY/nodes/Line",["require","DOT/Bounds2","PHET_CORE/extendDefined","PHET_CORE/inherit","KITE/segments/Line","SCENERY/display/drawables/LineCanvasDrawable","SCENERY/display/drawables/LineSVGDrawable","SCENERY/nodes/Path","SCENERY/display/Renderer","SCENERY/scenery","KITE/Shape","DOT/Vector2"],function(t){"use strict";function e(t,e,i,s,r){this._x1=0,this._y1=0,this._x2=0,this._y2=0,r="object"===(void 0===t?"undefined":_typeof(t))?t instanceof d?n({x1:t.x,y1:t.y,x2:e.x,y2:e.y},i):t:n({x1:t,y1:e,x2:i,y2:s},r),h.call(this,null,r)}var i=t("DOT/Bounds2"),n=t("PHET_CORE/extendDefined"),s=t("PHET_CORE/inherit"),r=t("KITE/segments/Line"),a=t("SCENERY/display/drawables/LineCanvasDrawable"),o=t("SCENERY/display/drawables/LineSVGDrawable"),h=t("SCENERY/nodes/Path"),l=t("SCENERY/display/Renderer"),u=t("SCENERY/scenery"),c=t("KITE/Shape"),d=t("DOT/Vector2");return u.register("Line",e),s(h,e,{_mutatorKeys:["p1","p2","x1","y1","x2","y2"].concat(h.prototype._mutatorKeys),drawableMarkFlags:h.prototype.drawableMarkFlags.concat(["line","p1","p2","x1","x2","y1","y2"]).filter(function(t){return"shape"!==t}),setLine:function(t,e,i,n){this._x1=t,this._y1=e,this._x2=i,this._y2=n;for(var s=this._drawables.length,r=0;r<s;r++){this._drawables[r].markDirtyLine()}return this.invalidateLine(),this},setPoint1:function(t,e){"number"==typeof t?(this._x1=t,this._y1=e):(this._x1=t.x,this._y1=t.y);for(var i=this._drawables.length,n=0;n<i;n++){this._drawables[n].markDirtyP1()}return this.invalidateLine(),this},set p1(t){this.setPoint1(t)},get p1(){return new d(this._x1,this._y1)},setPoint2:function(t,e){"number"==typeof t?(this._x2=t,this._y2=e):(this._x2=t.x,this._y2=t.y);for(var i=this._drawables.length,n=0;n<i;n++){this._drawables[n].markDirtyP2()}return this.invalidateLine(),this},set p2(t){this.setPoint2(t)},get p2(){return new d(this._x2,this._y2)},setX1:function(t){if(this._x1!==t){this._x1=t;for(var e=this._drawables.length,i=0;i<e;i++)this._drawables[i].markDirtyX1();this.invalidateLine()}return this},set x1(t){this.setX1(t)},getX1:function(){return this._x1},get x1(){return this.getX1()},setY1:function(t){if(this._y1!==t){this._y1=t;for(var e=this._drawables.length,i=0;i<e;i++)this._drawables[i].markDirtyY1();this.invalidateLine()}return this},set y1(t){this.setY1(t)},getY1:function(){return this._y1},get y1(){return this.getY1()},setX2:function(t){if(this._x2!==t){this._x2=t;for(var e=this._drawables.length,i=0;i<e;i++)this._drawables[i].markDirtyX2();this.invalidateLine()}return this},set x2(t){this.setX2(t)},getX2:function(){return this._x2},get x2(){return this.getX2()},setY2:function(t){if(this._y2!==t){this._y2=t;for(var e=this._drawables.length,i=0;i<e;i++)this._drawables[i].markDirtyY2();this.invalidateLine()}return this},set y2(t){this.setY2(t)},getY2:function(){return this._y2},get y2(){return this.getY2()},createLineShape:function(){return c.lineSegment(this._x1,this._y1,this._x2,this._y2).makeImmutable()},invalidateLine:function(){this._shape=null,this.invalidatePath()},containsPointSelf:function(t){return!!this._strokePickable&&h.prototype.containsPointSelf.call(this,t)},intersectsBoundsSelf:function(t){return new r(this.p1,this.p2).intersectsBounds(t)},canvasPaintSelf:function(t,e){a.prototype.paintCanvas(t,this,e)},computeShapeBounds:function(){if(this._stroke){var t=this.getLineCap(),e=this.getLineWidth()/2;if("round"===t)return new i(Math.min(this._x1,this._x2)-e,Math.min(this._y1,this._y2)-e,Math.max(this._x1,this._x2)+e,Math.max(this._y1,this._y2)+e);var n=this._x2-this._x1,s=this._y2-this._y1,r=Math.sqrt(n*n+s*s);if(0===r)return new i(this._x1-e,this._y1-e,this._x2+e,this._y2+e);var a=e*n/r,o=e*s/r,h=i.NOTHING.copy();return"butt"===t?(h.addCoordinates(this._x1-o,this._y1+a),h.addCoordinates(this._x1+o,this._y1-a),h.addCoordinates(this._x2-o,this._y2+a),h.addCoordinates(this._x2+o,this._y2-a)):(h.addCoordinates(this._x1-a-o,this._y1-o+a),h.addCoordinates(this._x1-a+o,this._y1-o-a),h.addCoordinates(this._x2+a-o,this._y2+o+a),h.addCoordinates(this._x2+a+o,this._y2+o-a)),h}var l=i.NOTHING.copy();return l.addCoordinates(this._x1,this._y1),l.addCoordinates(this._x2,this._y2),l},createSVGDrawable:function(t,e){return o.createFromPool(t,e)},createCanvasDrawable:function(t,e){return a.createFromPool(t,e)},setShape:function(t){if(null!==t)throw new Error("Cannot set the shape of a scenery.Line to something non-null");this.invalidatePath()},getShape:function(){return this._shape||(this._shape=this.createLineShape()),this._shape},hasShape:function(){return!0},getFillRendererBitmask:function(){return l.bitmaskCanvas|l.bitmaskSVG|l.bitmaskDOM|l.bitmaskWebGL}}),e}),i("SCENERY/nodes/Rectangle",["require","DOT/Bounds2","DOT/Dimension2","PHET_CORE/extendDefined","SCENERY/util/Features","PHET_CORE/inherit","SCENERY/nodes/Path","SCENERY/display/drawables/RectangleCanvasDrawable","SCENERY/display/drawables/RectangleDOMDrawable","SCENERY/display/drawables/RectangleSVGDrawable","SCENERY/display/drawables/RectangleWebGLDrawable","SCENERY/display/Renderer","SCENERY/scenery","KITE/Shape"],function(t){"use strict";function e(t,e,n,r,a,h,l){this._rectX=0,this._rectY=0,this._rectWidth=0,this._rectHeight=0,this._cornerXRadius=0,this._cornerYRadius=0,l="object"===(void 0===t?"undefined":_typeof(t))?t instanceof i?"number"!=typeof e?s({rectBounds:t},e):s({rectBounds:t,cornerXRadius:e,cornerYRadius:n},r):t:void 0===h?s({rectX:t,rectY:e,rectWidth:n,rectHeight:r},a):s({rectX:t,rectY:e,rectWidth:n,rectHeight:r,cornerXRadius:a,cornerYRadius:h},l),o.call(this,null,l)}var i=t("DOT/Bounds2"),n=t("DOT/Dimension2"),s=t("PHET_CORE/extendDefined"),r=t("SCENERY/util/Features"),a=t("PHET_CORE/inherit"),o=t("SCENERY/nodes/Path"),h=t("SCENERY/display/drawables/RectangleCanvasDrawable"),l=t("SCENERY/display/drawables/RectangleDOMDrawable"),u=t("SCENERY/display/drawables/RectangleSVGDrawable"),c=t("SCENERY/display/drawables/RectangleWebGLDrawable"),d=t("SCENERY/display/Renderer"),f=t("SCENERY/scenery"),m=t("KITE/Shape");return f.register("Rectangle",e),a(o,e,{_mutatorKeys:["rectBounds","rectSize","rectX","rectY","rectWidth","rectHeight","cornerRadius","cornerXRadius","cornerYRadius"].concat(o.prototype._mutatorKeys),drawableMarkFlags:o.prototype.drawableMarkFlags.concat(["x","y","width","height","cornerXRadius","cornerYRadius"]).filter(function(t){return"shape"!==t}),getMaximumArcSize:function(){return Math.min(this._rectWidth/2,this._rectHeight/2)},getStrokeRendererBitmask:function(){var t=o.prototype.getStrokeRendererBitmask.call(this);return!this.hasStroke()||this.getStroke().isGradient||this.getStroke().isPattern||this.hasLineDash()||("miter"===this.getLineJoin()||"round"===this.getLineJoin()&&r.borderRadius)&&(t|=d.bitmaskDOM),this.hasStroke()||(t|=d.bitmaskWebGL),t},getPathRendererBitmask:function(){var t=d.bitmaskCanvas|d.bitmaskSVG,e=this.getMaximumArcSize();return(!this.hasStroke()||this.getLineWidth()<=this._rectHeight&&this.getLineWidth()<=this._rectWidth)&&(!this.isRounded()||r.borderRadius&&this._cornerXRadius===this._cornerYRadius)&&this._cornerYRadius<=e&&this._cornerXRadius<=e&&(t|=d.bitmaskDOM),this.hasStroke()||this.isRounded()||(t|=d.bitmaskWebGL),t},setRect:function(t,e,i,n,s,r){var a=void 0!==s,o=void 0!==r;if(this._rectX!==t||this._rectY!==e||this._rectWidth!==i||this._rectHeight!==n||a&&this._cornerXRadius!==s||o&&this._cornerYRadius!==r){this._rectX=t,this._rectY=e,this._rectWidth=i,this._rectHeight=n,this._cornerXRadius=a?s:this._cornerXRadius,this._cornerYRadius=o?r:this._cornerYRadius;for(var h=this._drawables.length,l=0;l<h;l++)this._drawables[l].markDirtyRectangle();return this.invalidateRectangle(),this}},setRectX:function(t){if(this._rectX!==t){this._rectX=t;for(var e=this._drawables.length,i=0;i<e;i++)this._drawables[i].markDirtyX();this.invalidateRectangle()}return this},set rectX(t){this.setRectX(t)},getRectX:function(){return this._rectX},get rectX(){return this.getRectX()},setRectY:function(t){if(this._rectY!==t){this._rectY=t;for(var e=this._drawables.length,i=0;i<e;i++)this._drawables[i].markDirtyY();this.invalidateRectangle()}return this},set rectY(t){this.setRectY(t)},getRectY:function(){return this._rectY},get rectY(){return this.getRectY()},setRectWidth:function(t){if(this._rectWidth!==t){this._rectWidth=t;for(var e=this._drawables.length,i=0;i<e;i++)this._drawables[i].markDirtyWidth();this.invalidateRectangle()}return this},set rectWidth(t){this.setRectWidth(t)},getRectWidth:function(){return this._rectWidth},get rectWidth(){return this.getRectWidth()},setRectHeight:function(t){if(this._rectHeight!==t){this._rectHeight=t;for(var e=this._drawables.length,i=0;i<e;i++)this._drawables[i].markDirtyHeight();this.invalidateRectangle()}return this},set rectHeight(t){this.setRectHeight(t)},getRectHeight:function(){return this._rectHeight},get rectHeight(){return this.getRectHeight()},setCornerXRadius:function(t){if(this._cornerXRadius!==t){this._cornerXRadius=t;for(var e=this._drawables.length,i=0;i<e;i++)this._drawables[i].markDirtyCornerXRadius();this.invalidateRectangle()}return this},set cornerXRadius(t){this.setCornerXRadius(t)},getCornerXRadius:function(){return this._cornerXRadius},get cornerXRadius(){return this.getCornerXRadius()},setCornerYRadius:function(t){if(this._cornerYRadius!==t){this._cornerYRadius=t;for(var e=this._drawables.length,i=0;i<e;i++)this._drawables[i].markDirtyCornerYRadius();this.invalidateRectangle()}return this},set cornerYRadius(t){this.setCornerYRadius(t)},getCornerYRadius:function(){return this._cornerYRadius},get cornerYRadius(){return this.getCornerYRadius()},setRectBounds:function(t){return this.setRect(t.x,t.y,t.width,t.height),this},set rectBounds(t){this.setRectBounds(t)},getRectBounds:function(){return i.rect(this._rectX,this._rectY,this._rectWidth,this._rectHeight)},get rectBounds(){return this.getRectBounds()},setRectSize:function(t){return this.setRectWidth(t.width),this.setRectHeight(t.height),this},set rectSize(t){this.setRectSize(t)},getRectSize:function(){return new n(this._rectWidth,this._rectHeight)},get rectSize(){return this.getRectSize()},setRectWidthFromRight:function(t){if(this._rectWidth!==t){var e=this._rectX+this._rectWidth;this.setRectWidth(t),this.setRectX(e-t)}return this},set rectWidthFromRight(t){this.setRectWidthFromRight(t)},get rectWidthFromRight(){return this.getRectWidth()},setRectHeightFromBottom:function(t){if(this._rectHeight!==t){var e=this._rectY+this._rectHeight;this.setRectHeight(t),this.setRectY(e-t)}return this},set rectHeightFromBottom(t){this.setRectHeightFromBottom(t)},get rectHeightFromBottom(){return this.getRectHeight()},isRounded:function(){return 0!==this._cornerXRadius&&0!==this._cornerYRadius},computeShapeBounds:function(){var t=new i(this._rectX,this._rectY,this._rectX+this._rectWidth,this._rectY+this._rectHeight);return this._stroke&&(t=t.dilated(this.getLineWidth()/2)),t},createRectangleShape:function(){if(this.isRounded()){var t=Math.min(this._rectWidth/2,this._rectHeight/2);return m.roundRectangle(this._rectX,this._rectY,this._rectWidth,this._rectHeight,Math.min(t,this._cornerXRadius),Math.min(t,this._cornerYRadius)).makeImmutable()}return m.rectangle(this._rectX,this._rectY,this._rectWidth,this._rectHeight).makeImmutable()},invalidateRectangle:function(){this._shape=null,this.invalidatePath(),this.invalidateSupportedRenderers()},containsPointSelf:function(t){var i=this._rectX,n=this._rectY,s=this._rectWidth,r=this._rectHeight,a=this._cornerXRadius,h=this._cornerYRadius,l=this.getLineWidth()/2,u=!0;if(this._strokePickable){var c=this.isRounded();if(!c&&"bevel"===this.getLineJoin())return o.prototype.containsPointSelf.call(this,t);var d="miter"===this.getLineJoin()&&!c;u=u&&e.intersects(i-l,n-l,s+2*l,r+2*l,d?0:a+l,d?0:h+l,t)}return this._fillPickable?this._strokePickable?u:e.intersects(i,n,s,r,a,h,t):!!this._strokePickable&&(u&&!e.intersects(i+l,n+l,s-2*l,r-2*l,a-l,h-l,t))},intersectsBoundsSelf:function(t){return!this.computeShapeBounds().intersection(t).isEmpty()},canvasPaintSelf:function(t,e){h.prototype.paintCanvas(t,this,e)},createDOMDrawable:function(t,e){return l.createFromPool(t,e)},createSVGDrawable:function(t,e){return u.createFromPool(t,e)},createCanvasDrawable:function(t,e){return h.createFromPool(t,e)},createWebGLDrawable:function(t,e){return c.createFromPool(t,e)},setShape:function(t){if(null!==t)throw new Error("Cannot set the shape of a scenery.Rectangle to something non-null");this.invalidatePath()},getShape:function(){return this._shape||(this._shape=this.createRectangleShape()),this._shape},hasShape:function(){return!0},setCornerRadius:function(t){return this.setCornerXRadius(t),this.setCornerYRadius(t),this},set cornerRadius(t){this.setCornerRadius(t)},getCornerRadius:function(){return this._cornerXRadius},get cornerRadius(){return this.getCornerRadius()}}),e.intersects=function(t,e,i,n,s,r,a){var o=a.x>=t&&a.x<=t+i&&a.y>=e&&a.y<=e+n;if(!o||s<=0||r<=0)return o;var h=Math.min(i/2,n/2);s=Math.min(h,s),r=Math.min(h,r);var l,u,c=!1;if(a.x<t+i/2?(l=t+s,c=c||a.x>=l):(l=t+i-s,c=c||a.x<=l),c)return!0;if(a.y<e+n/2?(u=e+r,c=c||a.y>=u):(u=e+n-r,c=c||a.y<=u),c)return!0;var d=a.x-l,f=a.y-u;return d/=s,f/=r,d*=d,f*=f,d+f<=1},e.rect=function(t,i,n,s,r){return new e(t,i,n,s,0,0,r)},e.roundedRect=function(t,i,n,s,r,a,o){return new e(t,i,n,s,r,a,o)},e.bounds=function(t,i){return new e(t.minX,t.minY,t.width,t.height,i)},e.roundedBounds=function(t,i,n,s){return new e(t.minX,t.minY,t.width,t.height,i,n,s)},e.dimension=function(t,i){return new e(0,0,t.width,t.height,0,0,i)},e}),i("SCENERY/nodes/Plane",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/nodes/Rectangle"],function(t){"use strict";function e(t){s.call(this,-2e3,-2e3,6e3,6e3,t)}var i=t("PHET_CORE/inherit"),n=t("SCENERY/scenery"),s=t("SCENERY/nodes/Rectangle");return n.register("Plane",e),i(s,e)}),i("SCENERY/nodes/RichTextIO",["require","SCENERY/nodes/NodeIO","SCENERY/util/NodeProperty","TANDEM/phetioInherit","AXON/PropertyIO","SCENERY/scenery","TANDEM/types/StringIO"],function(t){"use strict";function e(t,e){i.call(this,t,e);var s=new n(t,"text","text",{phetioReadOnly:t.phetioReadOnly,phetioState:t.phetioState,phetioType:r(o),tandem:t.tandem.createTandem("textProperty"),phetioDocumentation:"Property for the displayed text"});this.disposeRichTextIO=function(){s.dispose()}}var i=t("SCENERY/nodes/NodeIO"),n=t("SCENERY/util/NodeProperty"),s=t("TANDEM/phetioInherit"),r=t("AXON/PropertyIO"),a=t("SCENERY/scenery"),o=t("TANDEM/types/StringIO");return s(i,"RichTextIO",e,{dispose:function(){this.disposeRichTextIO(),i.prototype.dispose.call(this)}},{documentation:"The tandem IO type for the scenery RichText node",validator:{valueType:a.RichText}}),a.register("RichTextIO",e),e}),i("SCENERY/nodes/VStrut",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/nodes/Spacer"],function(t){"use strict";function e(t,e){s.call(this,0,t,e)}var i=t("PHET_CORE/inherit"),n=t("SCENERY/scenery"),s=t("SCENERY/nodes/Spacer");return n.register("VStrut",e),i(s,e)}),i("SCENERY/nodes/RichText",["require","SCENERY/input/ButtonListener","SCENERY/util/Color","PHET_CORE/extendDefined","SCENERY/util/Font","PHET_CORE/inherit","SCENERY/nodes/Line","DOT/Matrix3","SCENERY/nodes/Node","PHET_CORE/Poolable","SCENERY/nodes/RichTextIO","SCENERY/scenery","TANDEM/Tandem","SCENERY/nodes/Text","SCENERY/nodes/VStrut"],function(t){"use strict";function e(t,e){this._text="",this._font=E,this._boundsMethod="hybrid",this._fill="#000000",this._stroke=null,this._subScale=.75,this._subXSpacing=0,this._subYOffset=0,this._supScale=.75,this._supXSpacing=0,this._supYOffset=0,this._capHeightScale=.75,this._underlineLineWidth=1,this._underlineHeightScale=.15,this._strikethroughLineWidth=1,this._strikethroughHeightScale=.3,this._linkFill="rgb(27,0,241)",this._linkEventsHandled=!1,this._links={},this._align="left",this._leading=0,this._lineWrap=null,this._linkItems=[],this._hasAddedLeafToLine=!1,e=o({fill:"#000000",text:t,tandem:g.optional,phetioType:m},e),d.call(this),this.lineContainer=new d({}),this.addChild(this.lineContainer),this.rebuildRichText(),this.mutate(e)}function i(t){d.call(this),this.initialize(t)}function n(t,e,i,n,s,r){v.call(this,""),this.initialize(t,e,i,n,s,r)}function s(t,e){d.call(this,{cursor:"pointer",tagName:"a"}),this.buttonListener=null,this.accessibleInputListener=null,this.initialize(t,e)}var r=t("SCENERY/input/ButtonListener"),a=t("SCENERY/util/Color"),o=t("PHET_CORE/extendDefined"),h=t("SCENERY/util/Font"),l=t("PHET_CORE/inherit"),u=t("SCENERY/nodes/Line"),c=t("DOT/Matrix3"),d=t("SCENERY/nodes/Node"),f=t("PHET_CORE/Poolable"),m=t("SCENERY/nodes/RichTextIO"),p=t("SCENERY/scenery"),g=t("TANDEM/Tandem"),v=t("SCENERY/nodes/Text"),y=t("SCENERY/nodes/VStrut"),E=new h({size:20}),b=["b","strong","i","em","sub","sup","u","s"],S={COMPLETE:"COMPLETE",INCOMPLETE:"INCOMPLETE",NONE:"NONE"},T=new p.Text(""),C={fontFamily:"family",fontSize:"size",fontStretch:"stretch",fontStyle:"style",fontVariant:"variant",fontWeight:"weight",lineHeight:"lineHeight"},x=Object.keys(C);["color"].concat(x);return p.register("RichText",e),l(d,e,{_mutatorKeys:["boundsMethod","font","fill","stroke","subScale","subXSpacing","subYOffset","supScale","supXSpacing","supYOffset","capHeightScale","underlineLineWidth","underlineHeightScale","strikethroughLineWidth","strikethroughHeightScale","linkFill","linkEventsHandled","links","align","leading","lineWrap","text"].concat(d.prototype._mutatorKeys),rebuildRichText:function(){var t=this;if(this.freeChildrenToPool(),""!==this._text){var e=this._text.replace(/\u202a/g,'<span dir="ltr">').replace(/\u202b/g,'<span dir="rtl">').replace(/\u202c/g,"</span>"),n=himalaya.parse(e);this._linkItems.length=0;var r=null===this._lineWrap?Number.POSITIVE_INFINITY:this._lineWrap,a=i.createFromPool(!0);for(this._hasAddedLeafToLine=!1;n.length;){var o=n[0],h=a.bounds.isValid()?a.width:0,l=this.appendElement(a,o,this._font,this._fill,!0,r-h);l!==S.NONE&&(a.bounds.isValid()?this.appendLine(a):this.appendLine(new y(T.setText("X").setFont(this._font).height)),a=i.createFromPool(!0),this._hasAddedLeafToLine=!1),l!==S.INCOMPLETE&&n.splice(0,1)}for(a.bounds.isValid()&&this.appendLine(a),0===this.lineContainer.getChildrenCount()&&this.appendEmptyLeaf(),this.alignLines();this._linkItems.length;)!function(){var e,i=t._linkItems[0].element,n=t._linkItems[0].href,r=[];for(e=t._linkItems.length-1;e>=0;e--){var a=t._linkItems[e];a.element===i&&(r.push(a.node),t._linkItems.splice(e,1))}var o=s.createFromPool(i.innerContent,n);for(t.lineContainer.addChild(o),e=0;e<r.length;e++){var h=r[e],l=h.getUniqueTrailTo(t.lineContainer).getMatrix();h.detach(),h.matrix=l,o.addChild(h)}}();this._linkItems.length=0}else this.appendEmptyLeaf()},freeChildrenToPool:function(){for(;this.lineContainer._children.length;){var t=this.lineContainer._children[this.lineContainer._children.length-1];this.lineContainer.removeChild(t),t.clean()}},dispose:function(){this.freeChildrenToPool(),d.prototype.dispose.call(this)},appendLine:function(t){this.lineContainer.bounds.isValid()&&(t.top=this.lineContainer.bottom+this._leading,t.left=0),this.lineContainer.addChild(t)},appendEmptyLeaf:function(){this.appendLine(n.createFromPool("",!0,this._font,this._boundsMethod,this._fill,this._stroke))},alignLines:function(){for(var t="center"===this._align?"centerX":this._align,e=this.lineContainer[t],i=0;i<this.lineContainer.getChildrenCount();i++)this.lineContainer.getChildAt(i)[t]=e},appendElement:function(t,s,r,o,h,l){var c,d=S.NONE;if("Text"===s.type){c=n.createFromPool(s.content,h,r,this._boundsMethod,o,this._stroke);var f=h?t.rightSpacing:t.leftSpacing;if(!c.fitsIn(l-f,this._hasAddedLeafToLine,h)){var m=s.content.split(" ");if(this._hasAddedLeafToLine||m.length>1){var p=[],g=!1;for(p.unshift(m.pop());m.length;){if((c=n.createFromPool(m.join(" "),h,r,this._boundsMethod,o,this._stroke)).fitsIn(l-f,this._hasAddedLeafToLine,h)||!(this._hasAddedLeafToLine||m.length>1)){g=!0;break}p.unshift(m.pop())}if(!g)return S.INCOMPLETE;d=S.INCOMPLETE,s.content=p.join(" ")}}this._hasAddedLeafToLine=!0}else if("Element"===s.type){if("br"===s.tagName)return S.COMPLETE;if("span"===s.tagName&&s.attributes.dir&&(h="ltr"===s.attributes.dir),c=i.createFromPool(h),s.attributes.style){var v=s.attributes.style;v.color&&(o=new a(v.color));for(var y={},E=0;E<x.length;E++){var b=x[E];v[b]&&(y[C[b]]=v[b])}r=r.copy(y)}if("a"===s.tagName){var _=s.attributes.href;!0!==this._links&&(_=0===_.indexOf("{{")&&_.indexOf("}}")===_.length-2?this._links[_.slice(2,-2)]:null),_&&(null!==this._linkFill&&(o=this._linkFill),s.innerContent||(s.innerContent=e.himalayaElementToAccessibleString(s,h)),this._linkItems.push({element:s,node:c,href:_}))}else"b"===s.tagName||"strong"===s.tagName?r=r.copy({weight:"bold"}):"i"===s.tagName||"em"===s.tagName?r=r.copy({style:"italic"}):"sub"===s.tagName?(c.scale(this._subScale),c.addExtraBeforeSpacing(this._subXSpacing),c.y+=this._subYOffset):"sup"===s.tagName&&(c.scale(this._supScale),c.addExtraBeforeSpacing(this._supXSpacing),c.y+=this._supYOffset);for(var w=c.getScaleVector().x;d===S.NONE&&s.children.length;){var R=c.bounds.isValid()?c.width:0,D=s.children[0];(d=this.appendElement(c,D,r,o,h,l/w))!==S.INCOMPLETE&&s.children.splice(0,1);l+=R-(c.bounds.isValid()?c.width:0)}if(d===S.COMPLETE&&s.children.length&&(d=S.INCOMPLETE),"sub"===s.tagName)isFinite(c.height)&&(c.centerY=0);else if("sup"===s.tagName)isFinite(c.height)&&(c.centerY=T.setText("X").setFont(r).top*this._capHeightScale);else if("u"===s.tagName){var P=-c.top*this._underlineHeightScale;isFinite(c.top)&&c.addChild(new u(c.localBounds.left,P,c.localBounds.right,P,{stroke:o,lineWidth:this._underlineLineWidth}))}else if("s"===s.tagName){var N=c.top*this._strikethroughHeightScale;isFinite(c.top)&&c.addChild(new u(c.localBounds.left,N,c.localBounds.right,N,{stroke:o,lineWidth:this._strikethroughLineWidth}))}}return t.addElement(c)||(this._linkItems=this._linkItems.filter(function(t){return t.node!==c}),c.clean()),d},setText:function(t){if((t=""+t)!==this._text){var e=this._text;this._text=t,this.rebuildRichText(),this.trigger2("text",e,t)}return this},set text(t){this.setText(t)},getText:function(){return this._text},get text(){return this.getText()},setBoundsMethod:function(t){return t!==this._boundsMethod&&(this._boundsMethod=t,this.rebuildRichText()),this},set boundsMethod(t){this.setBoundsMethod(t)},getBoundsMethod:function(){return this._boundsMethod},get boundsMethod(){return this.getBoundsMethod()},setFont:function(t){return this._font!==t&&(this._font=t,this.rebuildRichText()),this},set font(t){this.setFont(t)},getFont:function(){return this._font},get font(){return this.getFont()},setFill:function(t){return this._fill!==t&&(this._fill=t,this.rebuildRichText()),this},set fill(t){this.setFill(t)},getFill:function(){return this._fill},get fill(){return this.getFill()},setStroke:function(t){return this._stroke!==t&&(this._stroke=t,this.rebuildRichText()),this},set stroke(t){this.setStroke(t)},getStroke:function(){return this._stroke},get stroke(){return this.getStroke()},setSubScale:function(t){return this._subScale!==t&&(this._subScale=t,this.rebuildRichText()),this},set subScale(t){this.setSubScale(t)},getSubScale:function(){return this._subScale},get subScale(){return this.getSubScale()},setSubXSpacing:function(t){return this._subXSpacing!==t&&(this._subXSpacing=t,this.rebuildRichText()),this},set subXSpacing(t){this.setSubXSpacing(t)},getSubXSpacing:function(){return this._subXSpacing},get subXSpacing(){return this.getSubXSpacing()},setSubYOffset:function(t){return this._subYOffset!==t&&(this._subYOffset=t,this.rebuildRichText()),this},set subYOffset(t){this.setSubYOffset(t)},getSubYOffset:function(){return this._subYOffset},get subYOffset(){return this.getSubYOffset()},setSupScale:function(t){return this._supScale!==t&&(this._supScale=t,this.rebuildRichText()),this},set supScale(t){this.setSupScale(t)},getSupScale:function(){return this._supScale},get supScale(){return this.getSupScale()},setSupXSpacing:function(t){return this._supXSpacing!==t&&(this._supXSpacing=t,this.rebuildRichText()),this},set supXSpacing(t){this.setSupXSpacing(t)},getSupXSpacing:function(){return this._supXSpacing},get supXSpacing(){return this.getSupXSpacing()},setSupYOffset:function(t){return this._supYOffset!==t&&(this._supYOffset=t,this.rebuildRichText()),this},set supYOffset(t){this.setSupYOffset(t)},getSupYOffset:function(){return this._supYOffset},get supYOffset(){return this.getSupYOffset()},setCapHeightScale:function(t){return this._capHeightScale!==t&&(this._capHeightScale=t,this.rebuildRichText()),this},set capHeightScale(t){this.setCapHeightScale(t)},getCapHeightScale:function(){return this._capHeightScale},get capHeightScale(){return this.getCapHeightScale()},setUnderlineLineWidth:function(t){return this._underlineLineWidth!==t&&(this._underlineLineWidth=t,this.rebuildRichText()),this},set underlineLineWidth(t){this.setUnderlineLineWidth(t)},getUnderlineLineWidth:function(){return this._underlineLineWidth},get underlineLineWidth(){return this.getUnderlineLineWidth()},setUnderlineHeightScale:function(t){return this._underlineHeightScale!==t&&(this._underlineHeightScale=t,this.rebuildRichText()),this},set underlineHeightScale(t){this.setUnderlineHeightScale(t)},getUnderlineHeightScale:function(){return this._underlineHeightScale},get underlineHeightScale(){return this.getUnderlineHeightScale()},setStrikethroughLineWidth:function(t){return this._strikethroughLineWidth!==t&&(this._strikethroughLineWidth=t,this.rebuildRichText()),this},set strikethroughLineWidth(t){this.setStrikethroughLineWidth(t)},getStrikethroughLineWidth:function(){return this._strikethroughLineWidth},get strikethroughLineWidth(){return this.getStrikethroughLineWidth()},setStrikethroughHeightScale:function(t){return this._strikethroughHeightScale!==t&&(this._strikethroughHeightScale=t,this.rebuildRichText()),this},set strikethroughHeightScale(t){this.setStrikethroughHeightScale(t)},getStrikethroughHeightScale:function(){return this._strikethroughHeightScale},get strikethroughHeightScale(){return this.getStrikethroughHeightScale()},setLinkFill:function(t){return this._linkFill!==t&&(this._linkFill=t,this.rebuildRichText()),this},set linkFill(t){this.setLinkFill(t)},getLinkFill:function(){return this._linkFill},get linkFill(){return this.getLinkFill()},setLinkEventsHandled:function(t){return this._linkEventsHandled!==t&&(this._linkEventsHandled=t,this.rebuildRichText()),this},set linkEventsHandled(t){this.setLinkEventsHandled(t)},getLinkEventsHandled:function(){return this._linkEventsHandled},get linkEventsHandled(){return this.getLinkEventsHandled()},setLinks:function(t){return this._links!==t&&(this._links=t,this.rebuildRichText()),this},set links(t){this.setLinks(t)},getLinks:function(){return this._links},get links(){return this.getLinks()},setAlign:function(t){return this._align!==t&&(this._align=t,this.rebuildRichText()),this},set align(t){this.setAlign(t)},getAlign:function(){return this._align},get align(){return this.getAlign()},setLeading:function(t){return this._leading!==t&&(this._leading=t,this.rebuildRichText()),this},set leading(t){this.setLeading(t)},getLeading:function(){return this._leading},get leading(){return this.getLeading()},setLineWrap:function(t){return this._lineWrap!==t&&(this._lineWrap=t,this.rebuildRichText()),this},set lineWrap(t){this.setLineWrap(t)},getLineWrap:function(){return this._lineWrap},get lineWrap(){return this.getLineWrap()}},{stringWithFont:function(t,e){return"<span style='font-style: "+e.style+";font-variant: "+e.variant+";font-weight: "+e.weight+";font-stretch: "+e.stretch+";font-size: "+e.size+";font-family: "+e.family+";line-height: "+e.lineHeight+";'>"+t+"</span>"},himalayaElementToString:function(t,i){return"Text"===t.type?e.contentToString(t.content,i):"Element"===t.type?("span"===t.tagName&&t.attributes.dir&&(i="ltr"===t.attributes.dir),t.children.map(function(t){return e.himalayaElementToString(t,i)}).join("")):""},himalayaElementToAccessibleString:function(t,i){if("Text"===t.type)return e.contentToString(t.content,i);if("Element"===t.type){"span"===t.tagName&&t.attributes.dir&&(i="ltr"===t.attributes.dir);var n=t.children.map(function(t){return e.himalayaElementToAccessibleString(t,i)}).join("");return _.includes(b,t.tagName)?"<"+t.tagName+">"+n+"</"+t.tagName+">":n}return""},contentToString:function(t,e){var i=he.decode(t);return e?"‪"+i+"‬":"‫"+i+"‬"}}),l(d,i,{initialize:function(t){return this.isLTR=t,this.leftSpacing=0,this.rightSpacing=0,this},clean:function(){for(;this._children.length;){var t=this._children[this._children.length-1];this.removeChild(t),t.clean()}this.matrix=c.IDENTITY,this.freeToPool()},addElement:function(t){var e=this.children.length>0,i=t.width>0,n=t.getScaleVector().x,s=t.leftSpacing*n,r=t.rightSpacing*n;if(e||i)return e?i?(this.isLTR?(t.left=this.localBounds.right+this.rightSpacing+s,this.rightSpacing=r):(t.right=this.localBounds.left-this.leftSpacing-r,this.leftSpacing=s),this.addChild(t),!0):(this.isLTR?this.rightSpacing+=s+r:this.leftSpacing+=s+r,!1):(this.isLTR?(t.left=0,this.rightSpacing=r):(t.right=0,this.leftSpacing=s),this.addChild(t),!0)},addExtraBeforeSpacing:function(t){this.isLTR?this.leftSpacing+=t:this.rightSpacing+=t}}),f.mixInto(i,{initialize:i.prototype.initialize}),l(v,n,{initialize:function(t,i,n,s,r,a){for(var o="";" "===t[0];)o+=" ",t=t.slice(1);for(var h="";" "===t[t.length-1];)h=" ",t=t.slice(0,t.length-1);this.text=e.contentToString(t,i),this.boundsMethod=s,this.font=n,this.fill=r,this.stroke=a;var l=o.length?T.setText(o).setFont(n).width:0,u=h.length?T.setText(h).setFont(n).width:0;return this.leftSpacing=i?l:u,this.rightSpacing=i?u:l,this},clean:function(){this.fill=null,this.stroke=null,this.matrix=c.IDENTITY,this.freeToPool()},fitsIn:function(t,e,i){return this.width+(e?i?this.leftSpacing:this.rightSpacing:0)<=t}}),f.mixInto(n,{initialize:n.prototype.initialize}),l(d,s,{initialize:function(t,e){return this.innerContent=t,"function"==typeof e?(this.buttonListener=new r({fire:e}),this.addInputListener(this.buttonListener),this.setAccessibleAttribute("href","#"),this.setAccessibleAttribute("target","_self"),this.accessibleInputListener={click:function(t){t.domEvent.preventDefault(),e()}},this.addInputListener(this.accessibleInputListener)):(this.buttonListener=new r({fire:function(t){self._linkEventsHandled&&t.handle();window.open(e,"_blank").focus()}}),this.addInputListener(this.buttonListener),this.setAccessibleAttribute("href",e),this.setAccessibleAttribute("target","_blank")),this},clean:function(){for(;this._children.length;){var t=this._children[this._children.length-1];this.removeChild(t),t.clean()}this.removeInputListener(this.buttonListener),this.buttonListener=null,this.accessibleInputListener&&(this.removeInputListener(this.accessibleInputListener),this.accessibleInputListener=null),this.matrix=c.IDENTITY,this.freeToPool()}}),f.mixInto(s,{initialize:s.prototype.initialize}),e}),i("SCENERY/nodes/VBox",["require","PHET_CORE/inherit","SCENERY/nodes/LayoutBox","SCENERY/scenery"],function(t){"use strict";function e(t){(t=t||{}).orientation="vertical",n.call(this,t)}var i=t("PHET_CORE/inherit"),n=t("SCENERY/nodes/LayoutBox");return t("SCENERY/scenery").register("VBox",e),i(n,e)}),i("SCENERY/nodes/WebGLNode",["require","PHET_CORE/inherit","DOT/Matrix3","SCENERY/nodes/Node","SCENERY/display/Renderer","SCENERY/scenery","SCENERY/util/Util","SCENERY/display/drawables/WebGLNodeDrawable"],function(t){"use strict";function e(t,e){s.call(this,e),this.setRendererBitmask(r.bitmaskWebGL),this.painterType=t}var i=t("PHET_CORE/inherit"),n=t("DOT/Matrix3"),s=t("SCENERY/nodes/Node"),r=t("SCENERY/display/Renderer"),a=t("SCENERY/scenery"),o=t("SCENERY/util/Util"),h=t("SCENERY/display/drawables/WebGLNodeDrawable");return a.register("WebGLNode",e),i(s,e,{_mutatorKeys:["canvasBounds"].concat(s.prototype._mutatorKeys),setCanvasBounds:function(t){return this.invalidateSelf(t),this},set canvasBounds(t){this.setCanvasBounds(t)},getCanvasBounds:function(){return this.getSelfBounds()},get canvasBounds(){return this.getCanvasBounds()},isPainted:function(){return!0},invalidatePaint:function(){for(var t=this._drawables.length,e=0;e<t;e++)this._drawables[e].markDirty()},containsPointSelf:function(t){return!1},canvasPaintSelf:function(t,e){},renderToCanvasSelf:function(t,e){var i=t.canvas.width,s=t.canvas.height,r=document.createElement("canvas");r.width=i,r.height=s;var a={antialias:!0,preserveDrawingBuffer:!0},h=r.getContext("webgl",a)||r.getContext("experimental-webgl",a);o.applyWebGLContextDefaults(h);var l=(new n).rowMajor(2/i,0,-1,0,-2/s,1,0,0,1);h.viewport(0,0,i,s);var u=new(0,this.painterType)(h,this);u.paint(e,l),u.dispose(),l.freeToPool(),h.flush(),t.context.setTransform(1,0,0,1,0,0),t.context.drawImage(r,0,0),t.context.restore()},createWebGLDrawable:function(t,e){return h.createFromPool(t,e)}},{PAINTED_NOTHING:0,PAINTED_SOMETHING:1}),e}),i("SCENERY/util/ColorDef",["require","SCENERY/util/Color","AXON/Property","SCENERY/scenery"],function(t){"use strict";var e=t("SCENERY/util/Color"),i=t("AXON/Property"),n={isColorDef:function(t){return null===t||"string"==typeof t||t instanceof e||t instanceof i&&("string"==typeof t.value||t.value instanceof e)}};return t("SCENERY/scenery").register("ColorDef",n),n}),i("SCENERY/util/DisplayedProperty",["require","AXON/BooleanProperty","SCENERY/scenery"],function(t){"use strict";var e=t("AXON/BooleanProperty"),i=t("SCENERY/scenery"),n=function(t){function i(t,e,n){_classCallCheck(this,i);var s=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,!1,n));s.node=t,s.display=e,s.updateListener=s.updateValue.bind(s),s.addedInstancelistener=s.addedInstance.bind(s),s.removedInstancelistener=s.removedInstance.bind(s),t.onStatic("addedInstance",s.addedInstancelistener),t.onStatic("removedInstance",s.removedInstancelistener);for(var r=t.instances,a=0;a<r.length;a++)s.addedInstance(r[a]);return s}return _inherits(i,e),_createClass(i,[{key:"updateValue",value:function(){this.value=this.node.wasDisplayed(this.display)}},{key:"addedInstance",value:function(t){t.onStatic("visibility",this.updateListener),this.updateValue()}},{key:"removedInstance",value:function(t){t.offStatic("visibility",this.updateListener),this.updateValue()}},{key:"dispose",value:function(){for(var t=this.node.instances,e=0;e<t.length;e++)this.removedInstance(t[e]);this.node.offStatic("addedInstance",this.addedInstancelistener),this.node.offStatic("removedInstance",this.removedInstancelistener),_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"dispose",this).call(this)}}]),i}();return i.register("DisplayedProperty",n)}),i("SCENERY/display/SVGGradientStop",["require","SCENERY/util/Color","PHET_CORE/inherit","PHET_CORE/Poolable","AXON/Property","SCENERY/scenery"],function(t){"use strict";function e(t,e,i){this.initialize(t,e,i)}var i=t("SCENERY/util/Color"),n=t("PHET_CORE/inherit"),s=t("PHET_CORE/Poolable"),r=t("AXON/Property"),a=t("SCENERY/scenery"),o=new i("transparent");return a.register("SVGGradientStop",e),n(Object,e,{initialize:function(t,e,n){return this.svgGradient=t,this.color=n,this.ratio=e,this.svgElement=this.svgElement||document.createElementNS(a.svgns,"stop"),this.svgElement.setAttribute("offset",e),this.dirty=!0,this.update(),this.propertyListener=this.propertyListener||this.onPropertyChange.bind(this),this.colorListener=this.colorListener||this.markDirty.bind(this),n instanceof r?(n.lazyLink(this.propertyListener),n.value instanceof i&&n.value.changeEmitter.addListener(this.colorListener)):n instanceof i&&n.changeEmitter.addListener(this.colorListener),this},onPropertyChange:function(t,e){e instanceof i&&e.changeEmitter.removeListener(this.colorListener),t instanceof i&&t.changeEmitter.addListener(this.colorListener),this.markDirty()},markDirty:function(){this.dirty=!0,this.svgGradient.markDirty()},update:function(){if(this.dirty){this.dirty=!1;var t=this.color;t instanceof r&&(t=t.value),null===t&&(t="transparent"),"string"==typeof t?o.setCSS(t):o.set(t);var e="stop-opacity: "+o.a.toFixed(20)+";";o.alpha=1;var i="stop-color: "+o.toCSS()+";";this.svgElement.setAttribute("style",i+" "+e)}},dispose:function(){var t=this.color;t instanceof r?(t.hasListener(this.propertyListener)&&t.unlink(this.propertyListener),t.value instanceof i&&t.value.changeEmitter.removeListener(this.colorListener)):t instanceof i&&t.changeEmitter.removeListener(this.colorListener),this.color=null,this.svgGradient=null,this.freeToPool()}}),s.mixInto(e,{initialize:e.prototype.initialize}),e}),i("SCENERY/display/SVGGradient",["require","PHET_CORE/cleanArray","PHET_CORE/inherit","SCENERY/scenery","SCENERY/display/SVGGradientStop"],function(t){"use strict";function e(t,e){this.initialize(t,e)}var i=t("PHET_CORE/cleanArray"),n=t("PHET_CORE/inherit"),s=t("SCENERY/scenery"),r=t("SCENERY/display/SVGGradientStop");return s.register("SVGGradient",e),n(Object,e,{initialize:function(t,e){this.svgBlock=t,this.gradient=e;var n=void 0!==this.definition;this.definition=this.definition||this.createDefinition(),n||this.definition.setAttribute("gradientUnits","userSpaceOnUse"),e.transformMatrix?this.definition.setAttribute("gradientTransform",e.transformMatrix.getSVGTransform()):this.definition.removeAttribute("gradientTransform");var s=e.getSVGStops();this.stops=i(this.stops);for(var a=0;a<s.length;a++){var o=new r(this,s[a].ratio,s[a].color);this.stops.push(o),this.definition.appendChild(o.svgElement)}this.dirty=!1},createDefinition:function(){throw new Error("abstract method")},markDirty:function(){this.dirty||(this.dirty=!0,this.svgBlock.markDirtyGradient(this))},update:function(){if(this.dirty){this.dirty=!1;for(var t=0;t<this.stops.length;t++)this.stops[t].update()}},dispose:function(){for(var t=0;t<this.stops.length;t++){var e=this.stops[t];this.definition.removeChild(e.svgElement),e.dispose()}i(this.stops),this.svgBlock=null,this.gradient=null,this.freeToPool()}}),e}),i("SCENERY/display/SVGLinearGradient",["require","PHET_CORE/inherit","PHET_CORE/Poolable","SCENERY/scenery","SCENERY/display/SVGGradient"],function(t){"use strict";function e(t,e){this.initialize(t,e)}var i=t("PHET_CORE/inherit"),n=t("PHET_CORE/Poolable"),s=t("SCENERY/scenery"),r=t("SCENERY/display/SVGGradient");return s.register("SVGLinearGradient",e),i(r,e,{initialize:function(t,e){return r.prototype.initialize.call(this,t,e),this.definition.setAttribute("x1",e.start.x),this.definition.setAttribute("y1",e.start.y),this.definition.setAttribute("x2",e.end.x),this.definition.setAttribute("y2",e.end.y),this},createDefinition:function(){return document.createElementNS(s.svgns,"linearGradient")}}),n.mixInto(e,{initialize:e.prototype.initialize}),e}),i("SCENERY/util/LinearGradient",["require","SCENERY/util/Gradient","PHET_CORE/inherit","SCENERY/scenery","SCENERY/display/SVGLinearGradient","DOT/Vector2"],function(t){"use strict";function e(t,e,n,s){var r=void 0===s;this.start=r?t:new a(t,e),this.end=r?e:new a(n,s),i.call(this)}var i=t("SCENERY/util/Gradient"),n=t("PHET_CORE/inherit"),s=t("SCENERY/scenery"),r=t("SCENERY/display/SVGLinearGradient"),a=t("DOT/Vector2");return s.register("LinearGradient",e),n(i,e,{isLinearGradient:!0,createCanvasGradient:function(){return s.scratchContext.createLinearGradient(this.start.x,this.start.y,this.end.x,this.end.y)},createSVGPaint:function(t){return r.createFromPool(t,this)},toString:function(){var t="new scenery.LinearGradient( "+this.start.x+", "+this.start.y+", "+this.end.x+", "+this.end.y+" )";return _.each(this.stops,function(e){t+=".addColorStop( "+e.ratio+", '"+(e.color.toCSS?e.color.toCSS():e.color.toString())+"' )"}),t}}),e}),i("SCENERY/util/PaintColorProperty",["require","SCENERY/util/PaintDef","SCENERY/display/PaintObserver","AXON/Property","SCENERY/scenery"],function(t){"use strict";var e=t("SCENERY/util/PaintDef"),i=t("SCENERY/display/PaintObserver"),n=t("AXON/Property"),s=t("SCENERY/scenery"),r=function(t){function s(t,n){_classCallCheck(this,s);var r=e.toColor(t);n=_.extend({luminanceFactor:0,useDeepEquality:!0},n);var a=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,r,n));return a._paint=null,a._luminanceFactor=n.luminanceFactor,a._changeListener=a.invalidatePaint.bind(a),a._paintObserver=new i(a._changeListener),a.setPaint(t),a}return _inherits(s,n),_createClass(s,[{key:"setPaint",value:function(t){this._paint=t,this._paintObserver.setPrimary(t)}},{key:"getPaint",value:function(){return this._paint}},{key:"setLuminanceFactor",value:function(t){this.luminanceFactor!==t&&(this._luminanceFactor=t,this.invalidatePaint())}},{key:"getLuminanceFactor",value:function(){return this._luminanceFactor}},{key:"invalidatePaint",value:function(){this.value=e.toColor(this._paint).colorUtilsBrightness(this._luminanceFactor)}},{key:"dispose",value:function(){this.paint=null,_get(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"dispose",this).call(this)}},{key:"paint",set:function(t){this.setPaint(t)},get:function(){return this.getPaint()}},{key:"luminanceFactor",set:function(t){this.setLuminanceFactor(t)},get:function(){return this.getLuminanceFactor()}}]),s}();return s.register("PaintColorProperty",r)}),i("SCENERY/display/SVGPattern",["require","PHET_CORE/inherit","PHET_CORE/Poolable","SCENERY/scenery"],function(t){"use strict";function e(t){this.initialize(t)}var i=t("PHET_CORE/inherit"),n=t("PHET_CORE/Poolable"),s=t("SCENERY/scenery");return s.register("SVGPattern",e),i(Object,e,{initialize:function(t){var e=void 0!==this.definition;return this.definition=this.definition||document.createElementNS(s.svgns,"pattern"),e||(this.definition.setAttribute("patternUnits","userSpaceOnUse"),this.definition.setAttribute("patternContentUnits","userSpaceOnUse")),t.transformMatrix?this.definition.setAttribute("patternTransform",t.transformMatrix.getSVGTransform()):this.definition.removeAttribute("patternTransform"),this.definition.setAttribute("x",0),this.definition.setAttribute("y",0),this.definition.setAttribute("width",t.image.width),this.definition.setAttribute("height",t.image.height),this.imageElement=this.imageElement||document.createElementNS(s.svgns,"image"),this.imageElement.setAttribute("x",0),this.imageElement.setAttribute("y",0),this.imageElement.setAttribute("width",t.image.width+"px"),this.imageElement.setAttribute("height",t.image.height+"px"),this.imageElement.setAttributeNS(s.xlinkns,"xlink:href",t.image.src),e||this.definition.appendChild(this.imageElement),this},update:function(){},dispose:function(){this.freeToPool()}}),n.mixInto(e,{initialize:e.prototype.initialize}),e}),i("SCENERY/util/Pattern",["require","PHET_CORE/inherit","SCENERY/util/Paint","SCENERY/scenery","SCENERY/display/SVGPattern"],function(t){"use strict";function e(t){n.call(this),this.image=t,this.canvasPattern=s.scratchContext.createPattern(t,"repeat")}var i=t("PHET_CORE/inherit"),n=t("SCENERY/util/Paint"),s=t("SCENERY/scenery"),r=t("SCENERY/display/SVGPattern");return s.register("Pattern",e),i(n,e,{isPattern:!0,getCanvasStyle:function(){return this.canvasPattern},createSVGPaint:function(t){return r.createFromPool(this)},toString:function(){return"new scenery.Pattern( $( '<img src=\""+this.image.src+"\"/>' )[0] )"}}),e}),i("SCENERY/display/SVGRadialGradient",["require","PHET_CORE/inherit","PHET_CORE/Poolable","SCENERY/scenery","SCENERY/display/SVGGradient"],function(t){"use strict";function e(t,e){this.initialize(t,e)}var i=t("PHET_CORE/inherit"),n=t("PHET_CORE/Poolable"),s=t("SCENERY/scenery"),r=t("SCENERY/display/SVGGradient");return s.register("SVGRadialGradient",e),i(r,e,{initialize:function(t,e){return r.prototype.initialize.call(this,t,e),this.definition.setAttribute("cx",e.largePoint.x),this.definition.setAttribute("cy",e.largePoint.y),this.definition.setAttribute("r",e.maxRadius),this.definition.setAttribute("fx",e.focalPoint.x),this.definition.setAttribute("fy",e.focalPoint.y),this},createDefinition:function(){return document.createElementNS(s.svgns,"radialGradient")}}),n.mixInto(e,{initialize:e.prototype.initialize}),e}),i("SCENERY/util/RadialGradient",["require","SCENERY/util/Gradient","PHET_CORE/inherit","SCENERY/scenery","SCENERY/display/SVGRadialGradient","DOT/Vector2"],function(t){"use strict";function e(t,e,n,s,r,o){this.start=new a(t,e),this.end=new a(s,r),this.startRadius=n,this.endRadius=o,this.focalPoint=this.start.plus(this.end.minus(this.start).times(this.startRadius/(this.startRadius-this.endRadius))),this.startIsLarger=this.startRadius>this.endRadius,this.largePoint=this.startIsLarger?this.start:this.end,this.maxRadius=Math.max(this.startRadius,this.endRadius),this.minRadius=Math.min(this.startRadius,this.endRadius),this.startRadius,this.endRadius,i.call(this)}var i=t("SCENERY/util/Gradient"),n=t("PHET_CORE/inherit"),s=t("SCENERY/scenery"),r=t("SCENERY/display/SVGRadialGradient"),a=t("DOT/Vector2");return s.register("RadialGradient",e),n(i,e,{isRadialGradient:!0,createCanvasGradient:function(){return s.scratchContext.createRadialGradient(this.start.x,this.start.y,this.startRadius,this.end.x,this.end.y,this.endRadius)},createSVGPaint:function(t){return r.createFromPool(t,this)},getSVGStops:function(){var t=this.startIsLarger,e=this.maxRadius,i=this.minRadius,n=this.stops.map(function(n){var s=t?1-n.ratio:n.ratio;return i>0&&(s=function(t,e,i,n,r){return i+(s-t)*(1-i)/(1-t)}(0,0,i/e)),{ratio:s,color:n.color}});return t&&n.reverse(),n},toString:function(){var t="new scenery.RadialGradient( "+this.start.x+", "+this.start.y+", "+this.startRadius+", "+this.end.x+", "+this.end.y+", "+this.endRadius+" )";return _.each(this.stops,function(e){t+=".addColorStop( "+e.ratio+", '"+e.color.toString()+"' )"}),t}}),e}),i("SCENERY/util/SceneImage",["require","PHET_CORE/inherit","SCENERY/scenery"],function(t){"use strict";function e(t){this.scene=t,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.img=document.createElement("img"),this.update()}var i=t("PHET_CORE/inherit");return t("SCENERY/scenery").register("SceneImage",e),i(Object,e,{update:function(t){var e=this;this.scene.updateScene(),this.canvas.width=this.scene.getSceneWidth(),this.canvas.height=this.scene.getSceneHeight(),this.scene.renderToCanvas(this.canvas,this.context,function(){var i=e.toDataURL();e.img.onload=function(){t(),delete e.img.onload},e.img.src=i})}}),e}),i("main",["SCENERY/scenery","SCENERY/accessibility/AccessibilityFuzzer","SCENERY/accessibility/AccessibilityTree","SCENERY/accessibility/AccessibilityUtil","SCENERY/accessibility/AccessibleInstance","SCENERY/accessibility/AccessiblePeer","SCENERY/accessibility/Accessibility","SCENERY/accessibility/AccessibilityUtil","SCENERY/accessibility/reader/Cursor","SCENERY/accessibility/reader/Reader","SCENERY/debug/DebugContext","SCENERY/display/BackboneDrawable","SCENERY/display/Block","SCENERY/display/CanvasBlock","SCENERY/display/CanvasSelfDrawable","SCENERY/display/ChangeInterval","SCENERY/display/Display","SCENERY/display/DOMBlock","SCENERY/display/DOMSelfDrawable","SCENERY/display/Drawable","SCENERY/display/Fittability","SCENERY/display/FittedBlock","SCENERY/display/GreedyStitcher","SCENERY/display/InlineCanvasCacheDrawable","SCENERY/display/Instance","SCENERY/display/PaintObserver","SCENERY/display/PaintSVGState","SCENERY/display/RebuildStitcher","SCENERY/display/RelativeTransform","SCENERY/display/Renderer","SCENERY/display/SelfDrawable","SCENERY/display/SharedCanvasCacheDrawable","SCENERY/display/Stitcher","SCENERY/display/SVGBlock","SCENERY/display/SVGGroup","SCENERY/display/SVGSelfDrawable","SCENERY/display/WebGLBlock","SCENERY/display/WebGLSelfDrawable","SCENERY/display/drawables/CanvasNodeDrawable","SCENERY/display/drawables/CircleCanvasDrawable","SCENERY/display/drawables/CircleDOMDrawable","SCENERY/display/drawables/CircleStatefulDrawable","SCENERY/display/drawables/CircleSVGDrawable","SCENERY/display/drawables/DOMDrawable","SCENERY/display/drawables/ImageCanvasDrawable","SCENERY/display/drawables/ImageDOMDrawable","SCENERY/display/drawables/ImageStatefulDrawable","SCENERY/display/drawables/ImageSVGDrawable","SCENERY/display/drawables/ImageWebGLDrawable","SCENERY/display/drawables/LineCanvasDrawable","SCENERY/display/drawables/LineStatefulDrawable","SCENERY/display/drawables/LineStatelessDrawable","SCENERY/display/drawables/LineSVGDrawable","SCENERY/display/drawables/PaintableStatefulDrawable","SCENERY/display/drawables/PaintableStatelessDrawable","SCENERY/display/drawables/PathCanvasDrawable","SCENERY/display/drawables/PathStatefulDrawable","SCENERY/display/drawables/PathSVGDrawable","SCENERY/display/drawables/RectangleCanvasDrawable","SCENERY/display/drawables/RectangleDOMDrawable","SCENERY/display/drawables/RectangleStatefulDrawable","SCENERY/display/drawables/RectangleSVGDrawable","SCENERY/display/drawables/RectangleWebGLDrawable","SCENERY/display/drawables/TextCanvasDrawable","SCENERY/display/drawables/TextDOMDrawable","SCENERY/display/drawables/TextStatefulDrawable","SCENERY/display/drawables/TextSVGDrawable","SCENERY/display/drawables/WebGLNodeDrawable","SCENERY/input/BatchedDOMEvent","SCENERY/input/BrowserEvents","SCENERY/input/ButtonListener","SCENERY/input/DownUpListener","SCENERY/input/Event","SCENERY/input/Input","SCENERY/input/Mouse","SCENERY/input/Pen","SCENERY/input/Pointer","SCENERY/input/SimpleDragHandler","SCENERY/input/Touch","SCENERY/listeners/DragListener","SCENERY/listeners/FireListener","SCENERY/listeners/HandleDownListener","SCENERY/listeners/MultiListener","SCENERY/listeners/PanZoomListener","SCENERY/listeners/PressListener","SCENERY/nodes/AlignBox","SCENERY/nodes/AlignGroup","SCENERY/nodes/CanvasNode","SCENERY/nodes/Circle","SCENERY/nodes/DOM","SCENERY/nodes/HBox","SCENERY/nodes/HTMLText","SCENERY/nodes/HStrut","SCENERY/nodes/Image","SCENERY/nodes/Leaf","SCENERY/nodes/Line","SCENERY/nodes/Node","SCENERY/nodes/Paintable","SCENERY/nodes/Path","SCENERY/nodes/Plane","SCENERY/nodes/Rectangle","SCENERY/nodes/RichText","SCENERY/nodes/Spacer","SCENERY/nodes/Text","SCENERY/nodes/VBox","SCENERY/nodes/VStrut","SCENERY/nodes/WebGLNode","SCENERY/overlays/CanvasNodeBoundsOverlay","SCENERY/overlays/FittedBlockBoundsOverlay","SCENERY/overlays/FocusOverlay","SCENERY/overlays/PointerAreaOverlay","SCENERY/overlays/PointerOverlay","SCENERY/util/CanvasContextWrapper","SCENERY/util/Color","SCENERY/util/ColorDef","SCENERY/util/DisplayedProperty","SCENERY/util/Features","SCENERY/util/Font","SCENERY/util/FullScreen","SCENERY/util/Gradient","SCENERY/util/LinearGradient","SCENERY/util/Paint","SCENERY/util/PaintColorProperty","SCENERY/util/PaintDef","SCENERY/util/Pattern","SCENERY/util/Picker","SCENERY/util/RadialGradient","SCENERY/util/RendererSummary","SCENERY/util/SceneImage","SCENERY/util/SceneryStyle","SCENERY/util/ShaderProgram","SCENERY/util/SpriteSheet","SCENERY/util/TextBounds","SCENERY/util/Trail","SCENERY/util/TrailPointer","SCENERY/util/TransformTracker","SCENERY/util/Util"],function(t){"use strict";return t}),function(){"use strict";if(!window.hasOwnProperty("_"))throw new Error("Underscore/Lodash not found: _");if(!window.hasOwnProperty("$"))throw new Error("jQuery not found: $");i("scenery-main",["require","AXON/main","DOT/main","KITE/main","PHET_CORE/main","main"],function(t){window.axon=t("AXON/main"),window.dot=t("DOT/main"),window.kite=t("KITE/main"),window.phetCore=t("PHET_CORE/main"),window.scenery=t("main"),window.scenery.Util.polyfillRequestAnimationFrame()})}(),window.axon=e("AXON/main"),window.dot=e("DOT/main"),window.kite=e("KITE/main"),window.phetCore=e("PHET_CORE/main"),window.scenery=e("main"),scenery.Util.polyfillRequestAnimationFrame()}();